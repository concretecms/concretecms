function ConcretePanel(a){"use strict";this.options=a,this.isOpen=!1,this.detail=!1,this.getPositionClass=function(){var b;switch(a.position){case"left":b="ccm-panel-left";break;case"right":b="ccm-panel-right"}switch(a.transition){case"slide":b+=" ccm-panel-transition-slide";break;default:b+=" ccm-panel-transition-none"}return b},this.getURL=function(){return this.options.url},this.getIdentifier=function(){return this.options.identifier},this.getDOMID=function(){return"ccm-panel-"+this.options.identifier.replace("/","-")},this.onPanelLoad=function(a){this.setupSubPanels(),this.setupPanelDetails(),Concrete.event.publish("PanelLoad",{panel:this,element:a})},this.hide=function(){var a=this.closePanelDetail();a||(a=0);var b=this;Concrete.event.publish("PanelClose",{panel:this}),$(window).delay(a).queue(function(){$("[data-launch-panel='"+b.getIdentifier()+"']").removeClass("ccm-launch-panel-active"),$("#"+b.getDOMID()).removeClass("ccm-panel-active"),$("#ccm-panel-overlay").queue(function(){$(this).removeClass("ccm-panel-translucent"),$(this).dequeue()}).delay(1e3).hide(0),$("html").removeClass(b.getPositionClass()),$("html").removeClass("ccm-panel-open"),b.isOpen=!1,$(this).dequeue()})},this.toggle=function(){this.isOpen?this.hide():this.show()},this.setupSubPanels=function(){var a=$("#"+this.getDOMID()),b=this;a.find("[data-launch-sub-panel-url]").unbind(".sub").on("click.sub",function(){b.closePanelDetailImmediately();var c=$(this).attr("data-launch-sub-panel-url");return $("<div />",{"class":"ccm-panel-content ccm-panel-content-appearing"}).appendTo(a.find(".ccm-panel-content-wrapper")).load(c+"?cID="+CCM_CID,function(){a.find(".ccm-panel-content-visible").removeClass("ccm-panel-content-visible").addClass("ccm-panel-slide-left"),$(this).removeClass("ccm-panel-content-appearing").addClass("ccm-panel-content-visible"),b.onPanelLoad(this)}),$(this).removeClass("ccm-panel-menu-item-active"),!1}),a.find("[data-panel-navigation=back]").on("click.navigate",function(){return b.closePanelDetailImmediately(),$(this).queue(function(){var b=a.find(".ccm-panel-content-visible").prev();a.find(".ccm-panel-content-visible").removeClass("ccm-panel-content-visible").addClass("ccm-panel-slide-right"),b.removeClass("ccm-panel-slide-left").addClass("ccm-panel-content-visible"),$(this).dequeue()}).delay(500).queue(function(){a.find(".ccm-panel-slide-right").remove(),$(this).dequeue()}),!1})},this.showPanelConfirmationMessage=function(a,b,c){var d='<div id="ccm-panel-confirmation-'+a+'" class="ccm-ui ccm-panel-confirmation-wrapper"><div class="ccm-panel-confirmation">';d+="<p>"+b+'</p><div class="ccm-panel-confirmation-buttons"></div>',d+="</div></div>",$(d).appendTo(document.body);var e=$("#ccm-panel-confirmation-"+a);e.delay(0).queue(function(){$(this).addClass("ccm-panel-confirmation-displayed"),$(this).dequeue()});for(var f=[{"class":"btn pull-left btn-link",type:"button","data-panel-confirmation-action":"cancel",text:ccmi18n.cancel}],g=0;g<c.length;g++)f.push(c[g]);$.each(f,function(a,b){e.find(".ccm-panel-confirmation-buttons").append($("<button />",b))}),e.find("button").on("click",function(){e.delay(0).queue(function(){e.removeClass("ccm-panel-confirmation-displayed"),e.addClass("ccm-panel-confirmation-disappearing"),$(this).dequeue()}).delay(350).queue(function(){e.remove()})})},this.closePanelDetail=function(){if(!this.detail)return!1;$("a[data-launch-panel-detail="+this.detail.identifier+"]").removeClass("ccm-panel-menu-item-active");var a=this.detail.transition;return $("div.ccm-panel-detail").queue(function(){$(this).removeClass("ccm-panel-detail-transition-"+a+"-apply"),$(this).dequeue()}).delay(550).queue(function(){$(this).remove(),$(this).dequeue()}),$("div.ccm-page").queue(function(){$(this).removeClass("ccm-panel-detail-transition-"+a+"-apply"),$(this).dequeue()}).delay(550).queue(function(){$("html").removeClass("ccm-panel-detail-open"),$(this).addClass("ccm-panel-detail-disable-transition"),$(this).dequeue()}).delay(1).queue(function(){$(this).removeClass("ccm-panel-detail-transition-"+a),$(this).dequeue()}).delay(1).queue(function(){$(this).removeClass("ccm-panel-detail-disable-transition"),$(this).dequeue()}),$("#ccm-panel-detail-form-actions-wrapper .ccm-panel-detail-form-actions").queue(function(){$(this).css("opacity",0),$(this).dequeue(0)}).delay(550).queue(function(){$(this).remove(),$(this).dequeue()}),Concrete.event.publish("PanelCloseDetail",this.detail),this.detail=!1,$(".ccm-panel-detail").length>0?550:void 0},this.closePanelDetailImmediately=function(){return this.detail?($(".ccm-panel-detail").remove(),$(".ccm-panel-detail-form-actions").remove(),$(".ccm-page").removeClass().addClass("ccm-page"),Concrete.event.publish("PanelCloseDetail",this.detail),void(this.detail=!1)):!1},this.openPanelDetail=function(a){var b=this,c=$.extend({transition:"none",url:!1,data:""},a),d=c.identifier;b.detail,b.detail&&b.closePanelDetailImmediately(),b.detail=c;var e="ccm-panel-detail-"+d,f=$("<div />",{id:e,"class":"ccm-panel-detail"}).appendTo(document.body),g=$("<div />",{"class":"ccm-panel-detail-content"}).appendTo(f);$("div.ccm-page").queue(function(){f.addClass("ccm-panel-detail-transition-"+c.transition),$(this).addClass("ccm-panel-detail-transition-"+c.transition),$(this).dequeue()}).delay(3).queue(function(){f.addClass("ccm-panel-detail-transition-"+c.transition+"-apply"),$(this).addClass("ccm-panel-detail-transition-"+c.transition+"-apply"),$(this).dequeue()}),$("html").addClass("ccm-panel-detail-open"),g.load(c.url+"?cID="+CCM_CID+c.data,function(){jQuery.fn.dialog.hideLoader(),g.find(".launch-tooltip").tooltip({container:"#ccm-tooltip-holder"}),b.loadPanelDetailActions(g),_.defer(function(){Concrete.event.publish("PanelOpenDetail",{container:g})})})},this.loadPanelDetailActions=function(a){var b=this,c=a.find(".ccm-panel-detail-form-actions");c.length&&($(document.body).delay(500).queue(function(){var a=$("#ccm-panel-detail-form-actions-wrapper");a.length||(a=$("<div />",{id:"ccm-panel-detail-form-actions-wrapper","class":"ccm-ui"}),a.appendTo(document.body)),a.html("").append(c),$(this).dequeue()}).delay(5).queue(function(){$("#ccm-panel-detail-form-actions-wrapper .ccm-panel-detail-form-actions").css("opacity",1),$(this).dequeue()}),$("button[data-panel-detail-action=cancel]").on("click",function(){b.closePanelDetail()}),$("button[data-panel-detail-action=submit]").on("click",function(){$("[data-panel-detail-form]").concreteAjaxForm().submit()}))},this.setupPanelDetails=function(){var a=$("#"+this.getDOMID()),b=this;a.find(".launch-tooltip").tooltip({container:"#ccm-tooltip-holder"}),a.find("[data-panel-menu=accordion]").each(function(){var c=$(this),d=$(this).find(">nav>span");d.text($(this).find("a[data-panel-accordion-tab-selected=true]").text()),d.unbind(".accordion").on("click.accordion",function(){c.toggleClass("ccm-panel-header-accordion-dropdown-visible")}),$(this).find(">nav ul a").unbind(".accordion").on("click.accordion",function(){var e=b.getURL(),f=a.find(".ccm-panel-content");c.removeClass("ccm-panel-header-accordion-dropdown-visible"),d.html($(this).text()),f.load(e+"?cID="+CCM_CID+"&tab="+$(this).attr("data-panel-accordion-tab"),function(){b.onPanelLoad(this)})})}),a.find(".dialog-launch").dialog(),a.find("[data-panel-menu=collapsible-list-group]").each(function(){var a=$(this);a.find(".list-group-item-collapse").unbind(".clg").on("click.clg",function(){var b=a.find(".list-group-item-collapse-wrapper"),c=a.attr("data-panel-menu-id"),d=a.find(".list-group-item-collapse span"),e=b.height();a.hasClass("ccm-panel-list-group-item-expanded")?(d.text(ccmi18n.expand),Concrete.event.publish("PanelCollapsibleListGroupCollapse",c),b.queue(function(){$(this).css("height",0),$(this).dequeue()}).delay(305).queue(function(){$(this).hide(),$(this).css("height","auto"),$(this).dequeue()})):(Concrete.event.publish("PanelCollapsibleListGroupExpand",c),d.text(ccmi18n.collapse),b.queue(function(){$(this).css("height",0),$(this).show(),$(this).dequeue()}).delay(5).queue(function(){$(this).css("height",e),$(this).dequeue()})),a.toggleClass("ccm-panel-list-group-item-expanded")})}),a.find("[data-launch-panel-detail]").unbind(".detail").on("click.detail",function(){jQuery.fn.dialog.showLoader(),$(".ccm-panel-menu-item-active").removeClass("ccm-panel-menu-item-active"),$(this).addClass("ccm-panel-menu-item-active");var a=$(this).attr("data-launch-panel-detail"),c={identifier:a};return $(this).attr("data-panel-transition")&&(c.transition=$(this).attr("data-panel-transition")),$(this).attr("data-panel-detail-url")&&(c.url=$(this).data("panel-detail-url")),b.openPanelDetail(c),!1}),b.loadPanelDetailActions(a)},this.show=function(){var a=0;if(this.options.primary)for(var b=ConcretePanelManager.getPanels(),c=0;c<b.length;c++){var d=b[c];d.getIdentifier()!=this.getIdentifier()&&d.isOpen&&(a=d.hide())}var e=this;$("html").addClass("ccm-panel-open"),$(window).delay(a).queue(function(){var a=$("#"+e.getDOMID());a.find(".ccm-panel-content-wrapper").html(""),a.addClass("ccm-panel-active ccm-panel-loading"),$("<div />",{"class":"ccm-panel-content ccm-panel-content-visible"}).appendTo(a.find(".ccm-panel-content-wrapper")).load(e.getURL()+"?cID="+CCM_CID,function(){var b=this;a.delay(1).queue(function(){$(this).removeClass("ccm-panel-loading").addClass("ccm-panel-loaded"),$(this).dequeue()}),e.onPanelLoad(b),e.isOpen=!0,Concrete.event.publish("PanelOpen",{panel:e,element:b})}),e.options.overlay&&ConcretePanelManager.showOverlay(e.options.translucent),$("[data-launch-panel='"+e.getIdentifier()+"']").addClass("ccm-launch-panel-active"),$("html").addClass(e.getPositionClass()),$(this).dequeue()})}}function ccm_previewInternalTheme(a,b,c){var d=$("input[name=ptID]").val();$.fn.dialog.open({title:c,href:CCM_TOOLS_PATH+"/themes/preview?themeID="+b+"&previewCID="+a+"&ptID="+d,width:"85%",modal:!1,height:"75%"})}function ccm_previewMarketplaceTheme(a,b,c,d){var e=$("input[name=ptID]").val();$.fn.dialog.open({title:c,href:CCM_TOOLS_PATH+"/themes/preview?themeCID="+b+"&previewCID="+a+"&themeHandle="+encodeURIComponent(d)+"&ptID="+e,width:"85%",modal:!1,height:"75%"})}"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(a){function b(){if(a.fn.ajaxSubmit.debug){var b="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(b):window.opera&&window.opera.postError&&window.opera.postError(b)}}a.fn.ajaxSubmit=function(c){function d(d){function f(a){var b=a.contentWindow?a.contentWindow.document:a.contentDocument?a.contentDocument:a.document;return b}function g(){function c(){try{var a=f(p).readyState;b("state = "+a),"uninitialized"==a.toLowerCase()&&setTimeout(c,50)}catch(d){b("Server abort: ",d," (",d.name,")"),i(y),u&&clearTimeout(u),u=void 0}}var d=h.attr("target"),g=h.attr("action");v.setAttribute("target",n),e||v.setAttribute("method","POST"),g!=l.url&&v.setAttribute("action",l.url),l.skipEncodingOverride||e&&!/post/i.test(e)||h.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),l.timeout&&(u=setTimeout(function(){t=!0,i(x)},l.timeout));var j=[];try{if(l.extraData)for(var k in l.extraData)j.push(a('<input type="hidden" name="'+k+'" />').attr("value",l.extraData[k]).appendTo(v)[0]);l.iframeTarget||(o.appendTo("body"),p.attachEvent?p.attachEvent("onload",i):p.addEventListener("load",i,!1)),setTimeout(c,15),v.submit()}finally{v.setAttribute("action",g),d?v.setAttribute("target",d):h.removeAttr("target"),a(j).remove()}}function i(c){if(!q.aborted&&!B){try{A=f(p)}catch(d){b("cannot access response document: ",d),c=y}if(c===x&&q)return void q.abort("timeout");if(c==y&&q)return void q.abort("server abort");if(A&&A.location.href!=l.iframeSrc||t){p.detachEvent?p.detachEvent("onload",i):p.removeEventListener("load",i,!1);var e,g="success";try{if(t)throw"timeout";var h="xml"==l.dataType||A.XMLDocument||a.isXMLDoc(A);if(b("isXml="+h),!h&&window.opera&&(null==A.body||""==A.body.innerHTML)&&--C)return b("requeing onLoad callback, DOM not available"),void setTimeout(i,250);var j=A.body?A.body:A.documentElement;q.responseText=j?j.innerHTML:null,q.responseXML=A.XMLDocument?A.XMLDocument:A,h&&(l.dataType="xml"),q.getResponseHeader=function(a){var b={"content-type":l.dataType};return b[a]},j&&(q.status=Number(j.getAttribute("status"))||q.status,q.statusText=j.getAttribute("statusText")||q.statusText);var k=(l.dataType||"").toLowerCase(),n=/(json|script|text)/.test(k);if(n||l.textarea){var r=A.getElementsByTagName("textarea")[0];if(r)q.responseText=r.value,q.status=Number(r.getAttribute("status"))||q.status,q.statusText=r.getAttribute("statusText")||q.statusText;else if(n){var s=A.getElementsByTagName("pre")[0],v=A.getElementsByTagName("body")[0];s?q.responseText=s.textContent?s.textContent:s.innerText:v&&(q.responseText=v.textContent?v.textContent:v.innerText)}}else"xml"!=k||q.responseXML||null==q.responseText||(q.responseXML=D(q.responseText));try{z=F(q,k,l)}catch(c){g="parsererror",q.error=e=c||g}}catch(c){b("error caught: ",c),g="error",q.error=e=c||g}q.aborted&&(b("upload aborted"),g=null),q.status&&(g=q.status>=200&&q.status<300||304===q.status?"success":"error"),"success"===g?(l.success&&l.success.call(l.context,z,"success",q),m&&a.event.trigger("ajaxSuccess",[q,l])):g&&(void 0==e&&(e=q.statusText),l.error&&l.error.call(l.context,q,g,e),m&&a.event.trigger("ajaxError",[q,l,e])),m&&a.event.trigger("ajaxComplete",[q,l]),m&&!--a.active&&a.event.trigger("ajaxStop"),l.complete&&l.complete.call(l.context,q,g),B=!0,l.timeout&&clearTimeout(u),setTimeout(function(){l.iframeTarget||o.remove(),q.responseXML=null},100)}}}var j,k,l,m,n,o,p,q,r,s,t,u,v=h[0],w=!!a.fn.prop;if(d)if(w)for(k=0;k<d.length;k++)j=a(v[d[k].name]),j.prop("disabled",!1);else for(k=0;k<d.length;k++)j=a(v[d[k].name]),j.removeAttr("disabled");if(a(":input[name=submit],:input[id=submit]",v).length)return void alert('Error: Form elements must not have name or id of "submit".');if(l=a.extend(!0,{},a.ajaxSettings,c),l.context=l.context||l,n="jqFormIO"+(new Date).getTime(),l.iframeTarget?(o=a(l.iframeTarget),s=o.attr("name"),null==s?o.attr("name",n):n=s):(o=a('<iframe name="'+n+'" src="'+l.iframeSrc+'" />'),o.css({position:"absolute",top:"-1000px",left:"-1000px"})),p=o[0],q={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(c){var d="timeout"===c?"timeout":"aborted";b("aborting upload... "+d),this.aborted=1,o.attr("src",l.iframeSrc),q.error=d,l.error&&l.error.call(l.context,q,d,c),m&&a.event.trigger("ajaxError",[q,l,d]),l.complete&&l.complete.call(l.context,q,d)}},m=l.global,m&&!a.active++&&a.event.trigger("ajaxStart"),m&&a.event.trigger("ajaxSend",[q,l]),l.beforeSend&&l.beforeSend.call(l.context,q,l)===!1)return void(l.global&&a.active--);if(!q.aborted){r=v.clk,r&&(s=r.name,s&&!r.disabled&&(l.extraData=l.extraData||{},l.extraData[s]=r.value,"image"==r.type&&(l.extraData[s+".x"]=v.clk_x,l.extraData[s+".y"]=v.clk_y)));var x=1,y=2;l.forceSync?g():setTimeout(g,10);var z,A,B,C=50,D=a.parseXML||function(a,b){return window.ActiveXObject?(b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a)):b=(new DOMParser).parseFromString(a,"text/xml"),b&&b.documentElement&&"parsererror"!=b.documentElement.nodeName?b:null},E=a.parseJSON||function(a){return window.eval("("+a+")")},F=function(b,c,d){var e=b.getResponseHeader("content-type")||"",f="xml"===c||!c&&e.indexOf("xml")>=0,g=f?b.responseXML:b.responseText;return f&&"parsererror"===g.documentElement.nodeName&&a.error&&a.error("parsererror"),d&&d.dataFilter&&(g=d.dataFilter(g,c)),"string"==typeof g&&("json"===c||!c&&e.indexOf("json")>=0?g=E(g):("script"===c||!c&&e.indexOf("javascript")>=0)&&a.globalEval(g)),g}}}if(!this.length)return b("ajaxSubmit: skipping submit process - no element selected"),this;var e,f,g,h=this;"function"==typeof c&&(c={success:c}),e=this.attr("method"),f=this.attr("action"),g="string"==typeof f?a.trim(f):"",g=g||window.location.href||"",g&&(g=(g.match(/^([^#]+)/)||[])[1]),c=a.extend(!0,{url:g,success:a.ajaxSettings.success,type:e||"GET",iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},c);var i={};if(this.trigger("form-pre-serialize",[this,c,i]),i.veto)return b("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(c.beforeSerialize&&c.beforeSerialize(this,c)===!1)return b("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var j=c.traditional;void 0===j&&(j=a.ajaxSettings.traditional);var k,l=this.formToArray(c.semantic);if(c.data&&(c.extraData=c.data,k=a.param(c.data,j)),c.beforeSubmit&&c.beforeSubmit(l,this,c)===!1)return b("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[l,this,c,i]),i.veto)return b("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var m=a.param(l,j);k&&(m=m?m+"&"+k:k),"GET"==c.type.toUpperCase()?(c.url+=(c.url.indexOf("?")>=0?"&":"?")+m,c.data=null):c.data=m;var n=[];if(c.resetForm&&n.push(function(){h.resetForm()}),c.clearForm&&n.push(function(){h.clearForm(c.includeHidden)}),!c.dataType&&c.target){var o=c.success||function(){};n.push(function(b){var d=c.replaceTarget?"replaceWith":"html";a(c.target)[d](b).each(o,arguments)})}else c.success&&n.push(c.success);c.success=function(a,b,d){for(var e=c.context||c,f=0,g=n.length;g>f;f++)n[f].apply(e,[a,b,d||h,h])};var p=a("input:file",this).length>0,q="multipart/form-data",r=h.attr("enctype")==q||h.attr("encoding")==q;return c.iframe!==!1&&(p||c.iframe||r)?c.closeKeepAlive?a.get(c.closeKeepAlive,function(){d(l)}):d(l):a.ajax(c),this.trigger("form-submit-notify",[this,c]),this},a.fn.ajaxForm=function(c){if(0===this.length){var d={s:this.selector,c:this.context};return!a.isReady&&d.s?(b("DOM not ready, queuing ajaxForm"),a(function(){a(d.s,d.c).ajaxForm(c)}),this):(b("terminating; zero elements found by selector"+(a.isReady?"":" (DOM not ready)")),this)}return this.ajaxFormUnbind().bind("submit.form-plugin",function(b){b.isDefaultPrevented()||(b.preventDefault(),a(this).ajaxSubmit(c))}).bind("click.form-plugin",function(b){var c=b.target,d=a(c);if(!d.is(":submit,input:image")){var e=d.closest(":submit");if(0==e.length)return;c=e[0]}var f=this;if(f.clk=c,"image"==c.type)if(void 0!=b.offsetX)f.clk_x=b.offsetX,f.clk_y=b.offsetY;else if("function"==typeof a.fn.offset){var g=d.offset();f.clk_x=b.pageX-g.left,f.clk_y=b.pageY-g.top}else f.clk_x=b.pageX-c.offsetLeft,f.clk_y=b.pageY-c.offsetTop;setTimeout(function(){f.clk=f.clk_x=f.clk_y=null},100)})},a.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},a.fn.formToArray=function(b){var c=[];if(0===this.length)return c;var d=this[0],e=b?d.getElementsByTagName("*"):d.elements;if(!e)return c;var f,g,h,i,j,k,l;for(f=0,k=e.length;k>f;f++)if(j=e[f],h=j.name)if(b&&d.clk&&"image"==j.type)j.disabled||d.clk!=j||(c.push({name:h,value:a(j).val()}),c.push({name:h+".x",value:d.clk_x},{name:h+".y",value:d.clk_y}));else if(i=a.fieldValue(j,!0),i&&i.constructor==Array)for(g=0,l=i.length;l>g;g++)c.push({name:h,value:i[g]});else null!==i&&"undefined"!=typeof i&&c.push({name:h,value:i});if(!b&&d.clk){var m=a(d.clk),n=m[0];h=n.name,h&&!n.disabled&&"image"==n.type&&(c.push({name:h,value:m.val()}),c.push({name:h+".x",value:d.clk_x},{name:h+".y",value:d.clk_y}))}return c},a.fn.formSerialize=function(b){return a.param(this.formToArray(b))},a.fn.fieldSerialize=function(b){var c=[];return this.each(function(){var d=this.name;if(d){var e=a.fieldValue(this,b);if(e&&e.constructor==Array)for(var f=0,g=e.length;g>f;f++)c.push({name:d,value:e[f]});else null!==e&&"undefined"!=typeof e&&c.push({name:this.name,value:e})}}),a.param(c)},a.fn.fieldValue=function(b){for(var c=[],d=0,e=this.length;e>d;d++){var f=this[d],g=a.fieldValue(f,b);null===g||"undefined"==typeof g||g.constructor==Array&&!g.length||(g.constructor==Array?a.merge(c,g):c.push(g))}return c},a.fieldValue=function(b,c){var d=b.name,e=b.type,f=b.tagName.toLowerCase();if(void 0===c&&(c=!0),c&&(!d||b.disabled||"reset"==e||"button"==e||("checkbox"==e||"radio"==e)&&!b.checked||("submit"==e||"image"==e)&&b.form&&b.form.clk!=b||"select"==f&&-1==b.selectedIndex))return null;if("select"==f){var g=b.selectedIndex;if(0>g)return null;for(var h=[],i=b.options,j="select-one"==e,k=j?g+1:i.length,l=j?g:0;k>l;l++){var m=i[l];if(m.selected){var n=m.value;if(n||(n=m.attributes&&m.attributes.value&&!m.attributes.value.specified?m.text:m.value),j)return n;h.push(n)}}return h}return a(b).val()},a.fn.clearForm=function(b){return this.each(function(){a("input,select,textarea",this).clearFields(b)})},a.fn.clearFields=a.fn.clearInputs=function(a){var b=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var c=this.type,d=this.tagName.toLowerCase();b.test(c)||"textarea"==d||a&&/hidden/.test(c)?this.value="":"checkbox"==c||"radio"==c?this.checked=!1:"select"==d&&(this.selectedIndex=-1)})},a.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},a.fn.enable=function(a){return void 0===a&&(a=!0),this.each(function(){this.disabled=!a})},a.fn.selected=function(b){return void 0===b&&(b=!0),this.each(function(){var c=this.type;if("checkbox"==c||"radio"==c)this.checked=b;else if("option"==this.tagName.toLowerCase()){var d=a(this).parent("select");b&&d[0]&&"select-one"==d[0].type&&d.find("option").selected(!1),this.selected=b}})},a.fn.ajaxSubmit.debug=!1}(jQuery);var Concrete=function(a,b){"use strict";function c(a,b){return a[b]}function d(a,b,e){b+="";var f="get"+b.substr(0,1).toUpperCase()+b.substr(1),g="set"+b.substr(0,1).toUpperCase()+b.substr(1);return"undefined"==typeof this[f]&&(this[f]=_.partial(c,a,b)),"undefined"==typeof this[g]&&(this[g]=_.partial(d,a,b)),a[b]=e,e}var e=b("html");return{editMode:null,event:a,createGetterSetters:function(a){var b=this;return b.getAttr=_.partial(c,a),b.setAttr=_.partial(d,a),_(a).each(function(a,c){b.setAttr(c,a)}),!0},forceRefresh:function(){e.hide(0,function(){b(this).show()})}}}(ConcreteEvent,jQuery);!function(a){var b=null;a.fn.liveUpdate=function(b,c){return this.each(function(){new a.liveUpdate(this,b,c)})},a.liveUpdate=function(b,c,d){this.field=a(b),a(b).data("liveUpdate",this),this.list=a("#"+c),this.lutype="blocktypes","undefined"!=typeof d&&(this.lutype=d),this.list.length>0&&this.init()},a.liveUpdate.prototype={init:function(){var a=this;this.setupCache(),this.field.parents("form").submit(function(){return!1}),this.field.keyup(function(){a.filter()}),a.filter()},filter:function(){if(this.field.val()!=b){if(""==a.trim(this.field.val()))return void("blocktypes"==this.lutype||("attributes"==this.lutype?(this.list.find("h5").show(),this.list.find("li").show()):"stacks"==this.lutype?(this.list.children("li").addClass("ccm-stack-available"),this.list.children("li").removeClass("ccm-stack-selected")):"intelligent-search"==this.lutype?this.list.is(":visible")&&this.list.hide():this.list.children("li").show()));"intelligent-search"!=this.lutype||this.field.val().length>2?this.displayResults(this.getScores(this.field.val().toLowerCase())):"intelligent-search"==this.lutype&&this.list.is(":visible")&&this.list.hide()}b=this.field.val(),""==b&&"intelligent-search"==this.lutype&&this.list.is(":visible")&&this.list.hide()},setupCache:function(){var b=this;this.cache=[],this.rows=[];var c=this.lutype;this.list.find("li").each(function(){if("blocktypes"==c)b.cache.push(a(this).find("span").html().toLowerCase());else if("attributes"==c){var d=a(this).find("a,span").html().toLowerCase();b.cache.push(d)}else if("stacks"==c){var d=a(this).find("a,span").html().toLowerCase();b.cache.push(d)}else if("fileset"==c)b.cache.push(a(this).find("span").html().toLowerCase());else if("intelligent-search"==c){var e=a(this).find("span").html();e&&b.cache.push(e.toLowerCase())}b.rows.push(a(this))}),this.cache_length=this.cache.length},displayResults:function(b){var c=this;if("blocktypes"==this.lutype)this.list.children("li").hide(),a.each(b,function(a,b){c.rows[b[1]].show()});else if("attributes"==this.lutype)this.list.find("h5").hide(),this.list.find("li").hide(),a.each(b,function(a,b){c.rows[b[1]].show()});else if("stacks"==this.lutype)this.list.children("li").removeClass("ccm-stack-available"),this.list.children("li").removeClass("ccm-stack-selected"),this.list.children("li").removeClass("ccm-item-selected"),a.each(b,function(a,b){c.rows[b[1]].addClass("ccm-stack-available")}),this.list.children("li.item-select-list-header").removeClass("ccm-stack-available"),a(this.list.find("li.ccm-stack-available")[0]).addClass("ccm-item-selected");else if("intelligent-search"==this.lutype){this.list.is(":visible")||this.list.fadeIn(160,"easeOutExpo"),this.list.find(".ccm-intelligent-search-results-module-onsite").hide(),this.list.find("li").hide();var d=0;a.each(b,function(a,b){$li=c.rows[b[1]],b[0]>.75&&(d++,$li.parent().parent().is(":visible")||$li.parent().parent().show(),$li.show())}),this.list.find("li a").removeClass("ccm-intelligent-search-result-selected"),this.list.find("li:visible a:first").addClass("ccm-intelligent-search-result-selected")}else this.list.children("li").hide(),a.each(b,function(a,b){c.rows[b[1]].show()})},getScores:function(a){for(var b=[],c=0;c<this.cache_length;c++){var d=this.cache[c].score(a);d>0&&b.push([d,c])}return b.sort(function(a,b){return b[0]-a[0]})}}}(jQuery),function(){var a,b,c,d,e=function(a,b){return function(){return a.apply(b,arguments)}};d=this,a=jQuery,a.fn.extend({chosen:function(c){return"msie"!==a.browser||"6.0"!==a.browser.version&&"7.0"!==a.browser.version?a(this).each(function(){return a(this).hasClass("chzn-done")?void 0:new b(this,c)}):this}}),b=function(){function b(b,c){this.form_field=b,this.options=null!=c?c:{},this.set_default_values(),this.form_field_jq=a(this.form_field),this.is_multiple=this.form_field.multiple,this.is_rtl=this.form_field_jq.hasClass("chzn-rtl"),this.default_text_default=this.form_field.multiple?this.options.placeholder_text_multiple||this.options.placeholder_text||"Select Some Options":this.options.placeholder_text_single||this.options.placeholder_text||"Select an Option",this.set_up_html(),this.register_observers(),this.form_field_jq.addClass("chzn-done")}return b.prototype.set_default_values=function(){return this.click_test_action=e(function(a){return this.test_active_click(a)},this),this.activate_action=e(function(a){return this.activate_field(a)},this),this.active_field=!1,this.mouse_on_container=!1,this.results_showing=!1,this.result_highlighted=null,this.result_single_selected=null,this.allow_single_deselect=null!=this.options.allow_single_deselect&&""===this.form_field.options[0].text?this.options.allow_single_deselect:!1,this.disable_search_threshold=this.options.disable_search_threshold||0,this.choices=0,this.results_none_found=this.options.no_results_text||"No results match"},b.prototype.set_up_html=function(){var b,d,e,f;return this.container_id=this.form_field.id.length?this.form_field.id.replace(/(:|\.)/g,"_"):this.generate_field_id(),this.container_id+="_chzn",this.f_width=this.form_field_jq.outerWidth(),this.default_text=this.form_field_jq.data("placeholder")?this.form_field_jq.data("placeholder"):this.default_text_default,b=a("<div />",{id:this.container_id,"class":"chzn-container"+(this.is_rtl?" chzn-rtl":""),style:"width: "+this.f_width+"px;"}),b.html(this.is_multiple?'<ul class="chzn-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chzn-drop" style="left:-9000px;"><ul class="chzn-results"></ul></div>':'<a href="javascript:void(0)" class="chzn-single"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chzn-drop" style="left:-9000px;"><div class="chzn-search"><input type="text" autocomplete="off" /></div><ul class="chzn-results"></ul></div>'),this.form_field_jq.hide().after(b),this.container=a("#"+this.container_id),this.container.addClass("chzn-container-"+(this.is_multiple?"multi":"single")),!this.is_multiple&&this.form_field.options.length<=this.disable_search_threshold&&this.container.addClass("chzn-container-single-nosearch"),this.dropdown=this.container.find("div.chzn-drop").first(),d=this.container.height(),e=this.f_width-c(this.dropdown),this.dropdown.css({width:e+"px",top:d+"px"}),this.search_field=this.container.find("input").first(),this.search_results=this.container.find("ul.chzn-results").first(),this.search_field_scale(),this.search_no_results=this.container.find("li.no-results").first(),this.is_multiple?(this.search_choices=this.container.find("ul.chzn-choices").first(),this.search_container=this.container.find("li.search-field").first()):(this.search_container=this.container.find("div.chzn-search").first(),this.selected_item=this.container.find(".chzn-single").first(),f=e-c(this.search_container)-c(this.search_field),this.search_field.css({width:f+"px"})),this.results_build(),this.set_tab_index()
},b.prototype.register_observers=function(){return this.container.mousedown(e(function(a){return this.container_mousedown(a)},this)),this.container.mouseup(e(function(a){return this.container_mouseup(a)},this)),this.container.mouseenter(e(function(a){return this.mouse_enter(a)},this)),this.container.mouseleave(e(function(a){return this.mouse_leave(a)},this)),this.search_results.mouseup(e(function(a){return this.search_results_mouseup(a)},this)),this.search_results.mouseover(e(function(a){return this.search_results_mouseover(a)},this)),this.search_results.mouseout(e(function(a){return this.search_results_mouseout(a)},this)),this.form_field_jq.bind("liszt:updated",e(function(a){return this.results_update_field(a)},this)),this.search_field.blur(e(function(a){return this.input_blur(a)},this)),this.search_field.keyup(e(function(a){return this.keyup_checker(a)},this)),this.search_field.keydown(e(function(a){return this.keydown_checker(a)},this)),this.is_multiple?(this.search_choices.click(e(function(a){return this.choices_click(a)},this)),this.search_field.focus(e(function(a){return this.input_focus(a)},this))):void 0},b.prototype.search_field_disabled=function(){return this.is_disabled=this.form_field_jq.attr("disabled"),this.is_disabled?(this.container.addClass("chzn-disabled"),this.search_field.attr("disabled",!0),this.is_multiple||this.selected_item.unbind("focus",this.activate_action),this.close_field()):(this.container.removeClass("chzn-disabled"),this.search_field.attr("disabled",!1),this.is_multiple?void 0:this.selected_item.bind("focus",this.activate_action))},b.prototype.container_mousedown=function(b){var c;return this.is_disabled?void 0:(c=null!=b?a(b.target).hasClass("search-choice-close"):!1,b&&"mousedown"===b.type&&b.stopPropagation(),this.pending_destroy_click||c?this.pending_destroy_click=!1:(this.active_field?this.is_multiple||!b||a(b.target)!==this.selected_item&&!a(b.target).parents("a.chzn-single").length||(b.preventDefault(),this.results_toggle()):(this.is_multiple&&this.search_field.val(""),a(document).click(this.click_test_action),this.results_show()),this.activate_field()))},b.prototype.container_mouseup=function(a){return"ABBR"===a.target.nodeName?this.results_reset(a):void 0},b.prototype.mouse_enter=function(){return this.mouse_on_container=!0},b.prototype.mouse_leave=function(){return this.mouse_on_container=!1},b.prototype.input_focus=function(){return this.active_field?void 0:setTimeout(e(function(){return this.container_mousedown()},this),50)},b.prototype.input_blur=function(){return this.mouse_on_container?void 0:(this.active_field=!1,setTimeout(e(function(){return this.blur_test()},this),100))},b.prototype.blur_test=function(){return!this.active_field&&this.container.hasClass("chzn-container-active")?this.close_field():void 0},b.prototype.close_field=function(){return a(document).unbind("click",this.click_test_action),this.is_multiple||(this.selected_item.attr("tabindex",this.search_field.attr("tabindex")),this.search_field.attr("tabindex",-1)),this.active_field=!1,this.results_hide(),this.container.removeClass("chzn-container-active"),this.winnow_results_clear(),this.clear_backstroke(),this.show_search_field_default(),this.search_field_scale()},b.prototype.activate_field=function(){return this.is_multiple||this.active_field||(this.search_field.attr("tabindex",this.selected_item.attr("tabindex")),this.selected_item.attr("tabindex",-1)),this.container.addClass("chzn-container-active"),this.active_field=!0,this.search_field.val(this.search_field.val()),this.search_field.focus()},b.prototype.test_active_click=function(b){return a(b.target).parents("#"+this.container_id).length?this.active_field=!0:this.close_field()},b.prototype.results_build=function(){var a,b,c,e,f,g;for(c=new Date,this.parsing=!0,this.results_data=d.SelectParser.select_to_array(this.form_field),this.is_multiple&&this.choices>0?(this.search_choices.find("li.search-choice").remove(),this.choices=0):this.is_multiple||this.selected_item.find("span").text(this.default_text),a="",g=this.results_data,e=0,f=g.length;f>e;e++)b=g[e],b.group?a+=this.result_add_group(b):b.empty||(a+=this.result_add_option(b),b.selected&&this.is_multiple?this.choice_build(b):b.selected&&!this.is_multiple&&(this.selected_item.find("span").text(b.text),this.allow_single_deselect&&this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>')));return this.search_field_disabled(),this.show_search_field_default(),this.search_field_scale(),this.search_results.html(a),this.parsing=!1},b.prototype.result_add_group=function(b){return b.disabled?"":(b.dom_id=this.container_id+"_g_"+b.array_index,'<li id="'+b.dom_id+'" class="group-result">'+a("<div />").text(b.label).html()+"</li>")},b.prototype.result_add_option=function(a){var b,c;return a.disabled?"":(a.dom_id=this.container_id+"_o_"+a.array_index,b=a.selected&&this.is_multiple?[]:["active-result"],a.selected&&b.push("result-selected"),null!=a.group_array_index&&b.push("group-option"),""!==a.classes&&b.push(a.classes),c=""!==a.style.cssText?' style="'+a.style+'"':"",'<li id="'+a.dom_id+'" class="'+b.join(" ")+'"'+c+">"+a.html+"</li>")},b.prototype.results_update_field=function(){return this.result_clear_highlight(),this.result_single_selected=null,this.results_build()},b.prototype.result_do_highlight=function(a){var b,c,d,e,f;if(a.length){if(this.result_clear_highlight(),this.result_highlight=a,this.result_highlight.addClass("highlighted"),d=parseInt(this.search_results.css("maxHeight"),10),f=this.search_results.scrollTop(),e=d+f,c=this.result_highlight.position().top+this.search_results.scrollTop(),b=c+this.result_highlight.outerHeight(),b>=e)return this.search_results.scrollTop(b-d>0?b-d:0);if(f>c)return this.search_results.scrollTop(c)}},b.prototype.result_clear_highlight=function(){return this.result_highlight&&this.result_highlight.removeClass("highlighted"),this.result_highlight=null},b.prototype.results_toggle=function(){return this.results_showing?this.results_hide():this.results_show()},b.prototype.results_show=function(){var a;return this.is_multiple||(this.selected_item.addClass("chzn-single-with-drop"),this.result_single_selected&&this.result_do_highlight(this.result_single_selected)),a=this.is_multiple?this.container.height():this.container.height()-1,this.dropdown.css({top:a+"px",left:0}),this.results_showing=!0,this.search_field.focus(),this.search_field.val(this.search_field.val()),this.winnow_results()},b.prototype.results_hide=function(){return this.is_multiple||this.selected_item.removeClass("chzn-single-with-drop"),this.result_clear_highlight(),this.dropdown.css({left:"-9000px"}),this.results_showing=!1},b.prototype.set_tab_index=function(){var a;return this.form_field_jq.attr("tabindex")?(a=this.form_field_jq.attr("tabindex"),this.form_field_jq.attr("tabindex",-1),this.is_multiple?this.search_field.attr("tabindex",a):(this.selected_item.attr("tabindex",a),this.search_field.attr("tabindex",-1))):void 0},b.prototype.show_search_field_default=function(){return this.is_multiple&&this.choices<1&&!this.active_field?(this.search_field.val(this.default_text),this.search_field.addClass("default")):(this.search_field.val(""),this.search_field.removeClass("default"))},b.prototype.search_results_mouseup=function(b){var c;return c=a(b.target).hasClass("active-result")?a(b.target):a(b.target).parents(".active-result").first(),c.length?(this.result_highlight=c,this.result_select(b)):void 0},b.prototype.search_results_mouseover=function(b){var c;return c=a(b.target).hasClass("active-result")?a(b.target):a(b.target).parents(".active-result").first(),c?this.result_do_highlight(c):void 0},b.prototype.search_results_mouseout=function(b){return a(b.target).hasClass("active-result")?this.result_clear_highlight():void 0},b.prototype.choices_click=function(b){return b.preventDefault(),!this.active_field||a(b.target).hasClass("search-choice")||this.results_showing?void 0:this.results_show()},b.prototype.choice_build=function(b){var c,d;return c=this.container_id+"_c_"+b.array_index,this.choices+=1,this.search_container.before('<li class="search-choice" id="'+c+'"><span>'+b.html+'</span><a href="javascript:void(0)" class="search-choice-close" rel="'+b.array_index+'"></a></li>'),d=a("#"+c).find("a").first(),d.click(e(function(a){return this.choice_destroy_link_click(a)},this))},b.prototype.choice_destroy_link_click=function(b){return b.preventDefault(),this.is_disabled?b.stopPropagation:(this.pending_destroy_click=!0,this.choice_destroy(a(b.target)))},b.prototype.choice_destroy=function(a){return this.choices-=1,this.show_search_field_default(),this.is_multiple&&this.choices>0&&this.search_field.val().length<1&&this.results_hide(),this.result_deselect(a.attr("rel")),a.parents("li").first().remove()},b.prototype.results_reset=function(b){return this.form_field.options[0].selected=!0,this.selected_item.find("span").text(this.default_text),this.show_search_field_default(),a(b.target).remove(),this.form_field_jq.trigger("change"),this.active_field?this.results_hide():void 0},b.prototype.result_select=function(a){var b,c,d,e;return this.result_highlight?(b=this.result_highlight,c=b.attr("id"),this.result_clear_highlight(),this.is_multiple?this.result_deactivate(b):(this.search_results.find(".result-selected").removeClass("result-selected"),this.result_single_selected=b),b.addClass("result-selected"),e=c.substr(c.lastIndexOf("_")+1),d=this.results_data[e],d.selected=!0,this.form_field.options[d.options_index].selected=!0,this.is_multiple?this.choice_build(d):(this.selected_item.find("span").first().text(d.text),this.allow_single_deselect&&this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>')),a.metaKey&&this.is_multiple||this.results_hide(),this.search_field.val(""),this.form_field_jq.trigger("change"),this.search_field_scale()):void 0},b.prototype.result_activate=function(a){return a.addClass("active-result")},b.prototype.result_deactivate=function(a){return a.removeClass("active-result")},b.prototype.result_deselect=function(b){var c,d;return d=this.results_data[b],d.selected=!1,this.form_field.options[d.options_index].selected=!1,c=a("#"+this.container_id+"_o_"+b),c.removeClass("result-selected").addClass("active-result").show(),this.result_clear_highlight(),this.winnow_results(),this.form_field_jq.trigger("change"),this.search_field_scale()},b.prototype.results_search=function(){return this.results_showing?this.winnow_results():this.results_show()},b.prototype.winnow_results=function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;for(j=new Date,this.no_results_clear(),h=0,i=this.search_field.val()===this.default_text?"":a("<div/>").text(a.trim(this.search_field.val())).html(),f=new RegExp("^"+i.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i"),m=new RegExp(i.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i"),r=this.results_data,n=0,p=r.length;p>n;n++)if(c=r[n],!c.disabled&&!c.empty)if(c.group)a("#"+c.dom_id).hide();else if(!this.is_multiple||!c.selected){if(b=!1,g=c.dom_id,f.test(c.html))b=!0,h+=1;else if((c.html.indexOf(" ")>=0||0===c.html.indexOf("["))&&(e=c.html.replace(/\[|\]/g,"").split(" "),e.length))for(o=0,q=e.length;q>o;o++)d=e[o],f.test(d)&&(b=!0,h+=1);b?(i.length?(k=c.html.search(m),l=c.html.substr(0,k+i.length)+"</em>"+c.html.substr(k+i.length),l=l.substr(0,k)+"<em>"+l.substr(k)):l=c.html,a("#"+g).html!==l&&a("#"+g).html(l),this.result_activate(a("#"+g)),null!=c.group_array_index&&a("#"+this.results_data[c.group_array_index].dom_id).show()):(this.result_highlight&&g===this.result_highlight.attr("id")&&this.result_clear_highlight(),this.result_deactivate(a("#"+g)))}return 1>h&&i.length?this.no_results(i):this.winnow_results_set_highlight()},b.prototype.winnow_results_clear=function(){var b,c,d,e,f;for(this.search_field.val(""),c=this.search_results.find("li"),f=[],d=0,e=c.length;e>d;d++)b=c[d],b=a(b),f.push(b.hasClass("group-result")?b.show():this.is_multiple&&b.hasClass("result-selected")?void 0:this.result_activate(b));return f},b.prototype.winnow_results_set_highlight=function(){var a,b;return this.result_highlight||(b=this.is_multiple?[]:this.search_results.find(".result-selected.active-result"),a=b.length?b.first():this.search_results.find(".active-result").first(),null==a)?void 0:this.result_do_highlight(a)},b.prototype.no_results=function(b){var c;return c=a('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>'),c.find("span").first().html(b),this.search_results.append(c)},b.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()},b.prototype.keydown_arrow=function(){var b,c;return this.result_highlight?this.results_showing&&(c=this.result_highlight.nextAll("li.active-result").first(),c&&this.result_do_highlight(c)):(b=this.search_results.find("li.active-result").first(),b&&this.result_do_highlight(a(b))),this.results_showing?void 0:this.results_show()},b.prototype.keyup_arrow=function(){var a;return this.results_showing||this.is_multiple?this.result_highlight?(a=this.result_highlight.prevAll("li.active-result"),a.length?this.result_do_highlight(a.first()):(this.choices>0&&this.results_hide(),this.result_clear_highlight())):void 0:this.results_show()},b.prototype.keydown_backstroke=function(){return this.pending_backstroke?(this.choice_destroy(this.pending_backstroke.find("a").first()),this.clear_backstroke()):(this.pending_backstroke=this.search_container.siblings("li.search-choice").last(),this.pending_backstroke.addClass("search-choice-focus"))},b.prototype.clear_backstroke=function(){return this.pending_backstroke&&this.pending_backstroke.removeClass("search-choice-focus"),this.pending_backstroke=null},b.prototype.keyup_checker=function(a){var b,c;switch(b=null!=(c=a.which)?c:a.keyCode,this.search_field_scale(),b){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices>0)return this.keydown_backstroke();if(!this.pending_backstroke)return this.result_clear_highlight(),this.results_search();break;case 13:if(a.preventDefault(),this.results_showing)return this.result_select(a);break;case 27:if(this.results_showing)return this.results_hide();break;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}},b.prototype.keydown_checker=function(a){var b,c;switch(b=null!=(c=a.which)?c:a.keyCode,this.search_field_scale(),8!==b&&this.pending_backstroke&&this.clear_backstroke(),b){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:this.mouse_on_container=!1;break;case 13:a.preventDefault();break;case 38:a.preventDefault(),this.keyup_arrow();break;case 40:this.keydown_arrow()}},b.prototype.search_field_scale=function(){var b,c,d,e,f,g,h,i,j;if(this.is_multiple){for(d=0,h=0,f="position:absolute; left: -1000px; top: -1000px; display:none;",g=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"],i=0,j=g.length;j>i;i++)e=g[i],f+=e+":"+this.search_field.css(e)+";";return c=a("<div />",{style:f}),c.text(this.search_field.val()),a("body").append(c),h=c.width()+25,c.remove(),h>this.f_width-10&&(h=this.f_width-10),this.search_field.css({width:h+"px"}),b=this.container.height(),this.dropdown.css({top:b+"px"})}},b.prototype.generate_field_id=function(){var a;return a=this.generate_random_id(),this.form_field.id=a,a},b.prototype.generate_random_id=function(){var b;for(b="sel"+this.generate_random_char()+this.generate_random_char()+this.generate_random_char();a("#"+b).length>0;)b+=this.generate_random_char();return b},b.prototype.generate_random_char=function(){var a,b,c;return a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ",c=Math.floor(Math.random()*a.length),b=a.substring(c,c+1)},b}(),c=function(a){var b;return b=a.outerWidth()-a.width()},d.get_side_border_padding=c}.call(this),function(){var a;a=function(){function a(){this.options_index=0,this.parsed=[]}return a.prototype.add_node=function(a){return"OPTGROUP"===a.nodeName?this.add_group(a):this.add_option(a)},a.prototype.add_group=function(a){var b,c,d,e,f,g;for(b=this.parsed.length,this.parsed.push({array_index:b,group:!0,label:a.label,children:0,disabled:a.disabled}),f=a.childNodes,g=[],d=0,e=f.length;e>d;d++)c=f[d],g.push(this.add_option(c,b,a.disabled));return g},a.prototype.add_option=function(a,b,c){return"OPTION"===a.nodeName?(""!==a.text?(null!=b&&(this.parsed[b].children+=1),this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:a.value,text:a.text,html:a.innerHTML,selected:a.selected,disabled:c===!0?c:a.disabled,group_array_index:b,classes:a.className,style:a.style.cssText})):this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:!0}),this.options_index+=1):void 0},a}(),a.select_to_array=function(b){var c,d,e,f,g;for(d=new a,g=b.childNodes,e=0,f=g.length;f>e;e++)c=g[e],d.add_node(c);return d.parsed},this.SelectParser=a}.call(this),function(a,b,c){"use strict";function d(b,c){this.name=e,this.el=b,this.$el=a(b),this.options=a.extend({},f,c),this.$document=a(this.$el[0].ownerDocument),this.$body=this.$document.find("body"),this.moveTrigger="MSPointerMove touchmove mousemove",this.startTrigger="MSPointerDown touchstart mousedown",this.stopTrigger="MSPointerUp touchend mouseup",this.startTriggerArray=this.startTrigger.split(" "),this.moveTriggerArray=this.moveTrigger.split(" "),this.stopTriggerArray=this.stopTrigger.split(" "),this.stopEvents=[this.stopTrigger,this.options.stopEvents].join(" "),this.$container="window"===this.options.constrainTo?this.$document:this.options.constrainTo&&"parent"!==this.options.constrainTo?a(this.options.constrainTo):this.$el.parent(),this.isPointerEventCompatible()&&this.applyMSDefaults(),this.CSSEaseHash=this.getCSSEaseHash(),this.scale=1,this.started=!1,this.disabled=!1,this.activeDropRegions=[],this.resetVelocityQueue(),this.init()}var e="pep",f={initiate:function(){},start:function(){},drag:function(){},stop:function(){},rest:function(){},moveTo:!1,callIfNotStarted:["stop","rest"],startThreshold:[0,0],grid:[1,1],debug:!1,activeClass:"pep-active",multiplier:1,velocityMultiplier:2.5,shouldPreventDefault:!0,allowDragEventPropagation:!0,stopEvents:"",hardwareAccelerate:!0,useCSSTranslation:!0,disableSelect:!0,cssEaseString:"cubic-bezier(0.190, 1.000, 0.220, 1.000)",cssEaseDuration:1e3,shouldEase:!0,droppable:!1,droppableActiveClass:"pep-dpa",overlapFunction:!1,constrainTo:!1,removeMargins:!0,place:!0,deferPlacement:!1,axis:null,forceNonCSS3Movement:!1,elementsWithInteraction:"input",revert:!1,revertAfter:"stop",revertIf:function(){return!0},ignoreRightClick:!0};d.prototype.init=function(){this.options.debug&&this.buildDebugDiv(),this.options.disableSelect&&this.disableSelect(),this.options.place&&!this.options.deferPlacement&&(this.positionParent(),this.placeObject()),this.ev={},this.pos={},this.subscribe()},d.prototype.subscribe=function(){var a=this;this.onStartEvent=function(b){a.handleStart(b)},this.$el.on(this.startTrigger,this.onStartEvent),this.onStartEventOnElementsWithInteraction=function(a){a.stopPropagation()},this.$el.on(this.startTrigger,this.options.elementsWithInteraction,this.onStartEventOnElementsWithInteraction),this.onStopEvents=function(b){a.handleStop(b)},this.$document.on(this.stopEvents,this.onStopEvents),this.onMoveEvents=function(b){a.moveEvent=b},this.$document.on(this.moveTrigger,this.onMoveEvents)},d.prototype.unsubscribe=function(){this.$el.off(this.startTrigger,this.onStartEvent),this.$el.off(this.startTrigger,this.options.elementsWithInteraction,this.onStartEventOnElementsWithInteraction),this.$document.off(this.stopEvents,this.onStopEvents),this.$document.off(this.moveTrigger,this.onMoveEvents)},d.prototype.handleStart=function(b){var c=this;if(this.isValidMoveEvent(b)&&!this.disabled&&(!this.options.ignoreRightClick||3!==b.which)){this.isPointerEventCompatible()&&b.preventManipulation&&b.preventManipulation(),b=this.normalizeEvent(b),this.options.place&&this.options.deferPlacement&&(this.positionParent(),this.placeObject()),this.log({type:"event",event:b.type}),this.options.hardwareAccelerate&&!this.hardwareAccelerated&&(this.hardwareAccelerate(),this.hardwareAccelerated=!0);var d=this.options.initiate.call(this,b,this);if(d===!1)return;clearTimeout(this.restTimeout),this.$el.addClass(this.options.activeClass),this.removeCSSEasing(),this.startX=this.ev.x=b.pep.x,this.startY=this.ev.y=b.pep.y,this.initialPosition=this.initialPosition||this.$el.position(),this.startEvent=this.moveEvent=b,this.active=!0,this.options.shouldPreventDefault&&b.preventDefault(),this.options.allowDragEventPropagation||b.stopPropagation(),function e(){c.active&&(c.handleMove(),c.requestAnimationFrame(e))}(a,c)}},d.prototype.handleMove=function(){if("undefined"!=typeof this.moveEvent){var c=this.normalizeEvent(this.moveEvent),d=b.parseInt(c.pep.x/this.options.grid[0])*this.options.grid[0],e=b.parseInt(c.pep.y/this.options.grid[1])*this.options.grid[1];this.addToLIFO({time:c.timeStamp,x:d,y:e});var f,g;if(a.inArray(c.type,this.startTriggerArray)>-1?(f=0,g=0):(f=d-this.ev.x,g=e-this.ev.y),this.dx=f,this.dy=g,this.ev.x=d,this.ev.y=e,0===f&&0===g)return void this.log({type:"event",event:"** stopped **"});var h=Math.abs(this.startX-d),i=Math.abs(this.startY-e);!this.started&&(h>this.options.startThreshold[0]||i>this.options.startThreshold[1])&&(this.started=!0,this.$el.addClass("pep-start"),this.options.start.call(this,this.startEvent,this)),this.options.droppable&&this.calculateActiveDropRegions();var j=this.options.drag.call(this,c,this);if(j===!1)return void this.resetVelocityQueue();this.log({type:"event",event:c.type}),this.log({type:"event-coords",x:this.ev.x,y:this.ev.y}),this.log({type:"velocity"}),this.doMoveTo(f,g)}},d.prototype.doMoveTo=function(a,b){var c,d,e=this.handleConstraint(a,b);"function"==typeof this.options.moveTo?(c=a>=0?"+="+Math.abs(a/this.scale)*this.options.multiplier:"-="+Math.abs(a/this.scale)*this.options.multiplier,d=b>=0?"+="+Math.abs(b/this.scale)*this.options.multiplier:"-="+Math.abs(b/this.scale)*this.options.multiplier,this.options.constrainTo&&(c=e.x!==!1?e.x:c,d=e.y!==!1?e.y:d),"x"===this.options.axis&&(d=e.y),"y"===this.options.axis&&(c=e.x),this.options.moveTo.call(this,c,d)):this.shouldUseCSSTranslation()?(a=a/this.scale*this.options.multiplier,b=b/this.scale*this.options.multiplier,this.options.constrainTo&&(a=e.x===!1?a:0,b=e.y===!1?b:0),"x"===this.options.axis&&(b=0),"y"===this.options.axis&&(a=0),this.moveToUsingTransforms(a,b)):(c=a>=0?"+="+Math.abs(a/this.scale)*this.options.multiplier:"-="+Math.abs(a/this.scale)*this.options.multiplier,d=b>=0?"+="+Math.abs(b/this.scale)*this.options.multiplier:"-="+Math.abs(b/this.scale)*this.options.multiplier,this.options.constrainTo&&(c=e.x!==!1?e.x:c,d=e.y!==!1?e.y:d),"x"===this.options.axis&&(d=e.y),"y"===this.options.axis&&(c=e.x),this.moveTo(c,d))},d.prototype.handleStop=function(b){this.active&&(this.log({type:"event",event:b.type}),this.active=!1,this.$el.removeClass("pep-start").addClass("pep-ease"),this.options.droppable&&this.calculateActiveDropRegions(),(this.started||!this.started&&a.inArray("stop",this.options.callIfNotStarted)>-1)&&this.options.stop.call(this,b,this),this.options.shouldEase?this.ease(b,this.started):this.removeActiveClass(),this.options.revert&&("stop"===this.options.revertAfter||!this.options.shouldEase)&&this.options.revertIf&&this.options.revertIf.call(this)&&this.revert(),this.started=!1,this.resetVelocityQueue())},d.prototype.ease=function(b,c){var d=(this.$el.position(),this.velocity()),e=(this.dt,d.x/this.scale*this.options.multiplier),f=d.y/this.scale*this.options.multiplier,g=this.handleConstraint(e,f,!0);this.cssAnimationsSupported()&&this.$el.css(this.getCSSEaseHash());var h=d.x>0?"+="+e:"-="+Math.abs(e),i=d.y>0?"+="+f:"-="+Math.abs(f);this.options.constrainTo&&(h=g.x!==!1?g.x:h,i=g.y!==!1?g.y:i),"x"===this.options.axis&&(i="+=0"),"y"===this.options.axis&&(h="+=0");var j=!this.cssAnimationsSupported()||this.options.forceNonCSS3Movement;"function"==typeof this.options.moveTo?this.options.moveTo.call(this,h,i):this.moveTo(h,i,j);var k=this;this.restTimeout=setTimeout(function(){k.options.droppable&&k.calculateActiveDropRegions(),(c||!c&&a.inArray("rest",k.options.callIfNotStarted)>-1)&&k.options.rest.call(k,b,k),k.options.revert&&"ease"===k.options.revertAfter&&k.options.shouldEase&&k.options.revertIf&&k.options.revertIf.call(k)&&k.revert(),k.removeActiveClass()},this.options.cssEaseDuration)},d.prototype.normalizeEvent=function(a){return a.pep={},this.isPointerEventCompatible()||!this.isTouch(a)?(a.pageX?(a.pep.x=a.pageX,a.pep.y=a.pageY):(a.pep.x=a.originalEvent.pageX,a.pep.y=a.originalEvent.pageY),a.pep.type=a.type):(a.pep.x=a.originalEvent.touches[0].pageX,a.pep.y=a.originalEvent.touches[0].pageY,a.pep.type=a.type),a},d.prototype.resetVelocityQueue=function(){this.velocityQueue=new Array(5)},d.prototype.moveTo=function(a,b,c){this.log({type:"delta",x:a,y:b}),c?this.$el.animate({top:b,left:a},0,"easeOutQuad",{queue:!1}):this.$el.stop(!0,!1).css({top:b,left:a})},d.prototype.moveToUsingTransforms=function(a,b){var c=this.matrixToArray(this.matrixString());this.cssX||(this.cssX=this.xTranslation(c)),this.cssY||(this.cssY=this.yTranslation(c)),this.cssX=this.cssX+a,this.cssY=this.cssY+b,this.log({type:"delta",x:a,y:b}),c[4]=this.cssX,c[5]=this.cssY,this.translation=this.arrayToMatrix(c),this.transform(this.translation)},d.prototype.transform=function(a){this.$el.css({"-webkit-transform":a,"-moz-transform":a,"-ms-transform":a,"-o-transform":a,transform:a})},d.prototype.xTranslation=function(a){return a=a||this.matrixToArray(this.matrixString()),parseInt(a[4],10)},d.prototype.yTranslation=function(a){return a=a||this.matrixToArray(this.matrixString()),parseInt(a[5],10)},d.prototype.matrixString=function(){var a=function(a){return!(!a||"none"===a||a.indexOf("matrix")<0)},b="matrix(1, 0, 0, 1, 0, 0)";return a(this.$el.css("-webkit-transform"))&&(b=this.$el.css("-webkit-transform")),a(this.$el.css("-moz-transform"))&&(b=this.$el.css("-moz-transform")),a(this.$el.css("-ms-transform"))&&(b=this.$el.css("-ms-transform")),a(this.$el.css("-o-transform"))&&(b=this.$el.css("-o-transform")),a(this.$el.css("transform"))&&(b=this.$el.css("transform")),b},d.prototype.matrixToArray=function(a){return a.split("(")[1].split(")")[0].split(",")},d.prototype.arrayToMatrix=function(a){return"matrix("+a.join(",")+")"},d.prototype.addToLIFO=function(a){var b=this.velocityQueue;b=b.slice(1,b.length),b.push(a),this.velocityQueue=b},d.prototype.velocity=function(){for(var a=0,b=0,c=0;c<this.velocityQueue.length-1;c++)this.velocityQueue[c]&&(a+=this.velocityQueue[c+1].x-this.velocityQueue[c].x,b+=this.velocityQueue[c+1].y-this.velocityQueue[c].y,this.dt=this.velocityQueue[c+1].time-this.velocityQueue[c].time);return{x:a*this.options.velocityMultiplier,y:b*this.options.velocityMultiplier}},d.prototype.revert=function(){this.shouldUseCSSTranslation()&&this.moveToUsingTransforms(-this.xTranslation(),-this.yTranslation()),this.moveTo(this.initialPosition.left,this.initialPosition.top)},d.prototype.requestAnimationFrame=function(a){return b.requestAnimationFrame&&b.requestAnimationFrame(a)||b.webkitRequestAnimationFrame&&b.webkitRequestAnimationFrame(a)||b.mozRequestAnimationFrame&&b.mozRequestAnimationFrame(a)||b.oRequestAnimationFrame&&b.mozRequestAnimationFrame(a)||b.msRequestAnimationFrame&&b.msRequestAnimationFrame(a)||b.setTimeout(a,1e3/60)},d.prototype.positionParent=function(){this.options.constrainTo&&!this.parentPositioned&&(this.parentPositioned=!0,"parent"===this.options.constrainTo?this.$container.css({position:"relative"}):"window"===this.options.constrainTo&&"#document"!==this.$container.get(0).nodeName&&"static"!==this.$container.css("position")&&this.$container.css({position:"static"}))},d.prototype.placeObject=function(){this.objectPlaced||(this.objectPlaced=!0,this.offset="parent"===this.options.constrainTo||this.hasNonBodyRelative()?this.$el.position():this.$el.offset(),parseInt(this.$el.css("left"),10)&&(this.offset.left=this.$el.css("left")),parseInt(this.$el.css("top"),10)&&(this.offset.top=this.$el.css("top")),this.options.removeMargins&&this.$el.css({margin:0}),this.$el.css({position:"absolute",top:this.offset.top,left:this.offset.left}))},d.prototype.hasNonBodyRelative=function(){return this.$el.parents().filter(function(){var b=a(this);return b.is("body")||"relative"===b.css("position")}).length>1},d.prototype.setScale=function(a){this.scale=a},d.prototype.setMultiplier=function(a){this.options.multiplier=a},d.prototype.removeCSSEasing=function(){this.cssAnimationsSupported()&&this.$el.css(this.getCSSEaseHash(!0))},d.prototype.disableSelect=function(){this.$el.css({"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"})},d.prototype.removeActiveClass=function(){this.$el.removeClass([this.options.activeClass,"pep-ease"].join(" "))},d.prototype.handleConstraint=function(b,d,e){var f=this.$el.position();this.pos.x=f.left,this.pos.y=f.top;var g,h,i,j,k={x:!1,y:!1};return this.log({type:"pos-coords",x:this.pos.x,y:this.pos.y}),a.isArray(this.options.constrainTo)?(this.options.constrainTo[3]!==c&&this.options.constrainTo[1]!==c&&(h=this.options.constrainTo[1]===!1?1/0:this.options.constrainTo[1],i=this.options.constrainTo[3]===!1?-1/0:this.options.constrainTo[3]),this.options.constrainTo[0]!==!1&&this.options.constrainTo[2]!==!1&&(g=this.options.constrainTo[2]===!1?1/0:this.options.constrainTo[2],j=this.options.constrainTo[0]===!1?-1/0:this.options.constrainTo[0]),this.pos.x+b<i&&(k.x=i),this.pos.y+d<j&&(k.y=j)):"string"==typeof this.options.constrainTo&&(i=0,j=0,h=this.$container.width()-this.$el.outerWidth(),g=this.$container.height()-this.$el.outerHeight(),this.pos.x+b<0&&(k.x=0),this.pos.y+d<0&&(k.y=0)),this.pos.x+b>h&&(k.x=h),this.pos.y+d>g&&(k.y=g),this.shouldUseCSSTranslation()&&e&&(k.x===i&&this.xTranslation()&&(k.x=i-this.xTranslation()),k.x===h&&this.xTranslation()&&(k.x=h-this.xTranslation()),k.y===j&&this.yTranslation()&&(k.y=j-this.yTranslation()),k.y===g&&this.yTranslation()&&(k.y=g-this.yTranslation())),k},d.prototype.getCSSEaseHash=function(a){"undefined"==typeof a&&(a=!1);var b;if(a)b="";else{if(this.CSSEaseHash)return this.CSSEaseHash;b=["all",this.options.cssEaseDuration+"ms",this.options.cssEaseString].join(" ")}return{"-webkit-transition":b,"-moz-transition":b,"-ms-transition":b,"-o-transition":b,transition:b}},d.prototype.calculateActiveDropRegions=function(){var b=this;this.activeDropRegions.length=0,a.each(a(this.options.droppable),function(c,d){var e=a(d);b.isOverlapping(e,b.$el)?(e.addClass(b.options.droppableActiveClass),b.activeDropRegions.push(e)):e.removeClass(b.options.droppableActiveClass)})},d.prototype.isOverlapping=function(a,b){if(this.options.overlapFunction)return this.options.overlapFunction(a,b);var c=a[0].getBoundingClientRect(),d=b[0].getBoundingClientRect();return!(c.right<d.left||c.left>d.right||c.bottom<d.top||c.top>d.bottom)},d.prototype.isTouch=function(a){return a.type.search("touch")>-1},d.prototype.isPointerEventCompatible=function(){return"MSPointerEvent"in b},d.prototype.applyMSDefaults=function(){this.$el.css({"-ms-touch-action":"none","touch-action":"none","-ms-scroll-chaining":"none","-ms-scroll-limit":"0 0 0 0"})},d.prototype.isValidMoveEvent=function(a){return!this.isTouch(a)||this.isTouch(a)&&a.originalEvent&&a.originalEvent.touches&&1===a.originalEvent.touches.length},d.prototype.shouldUseCSSTranslation=function(){if(this.options.forceNonCSS3Movement)return!1;if("undefined"!=typeof this.useCSSTranslation)return this.useCSSTranslation;var a=!1;return a=!this.options.useCSSTranslation||"undefined"!=typeof Modernizr&&!Modernizr.csstransforms?!1:!0,this.useCSSTranslation=a,a},d.prototype.cssAnimationsSupported=function(){if("undefined"!=typeof this.cssAnimationsSupport)return this.cssAnimationsSupport;if("undefined"!=typeof Modernizr&&Modernizr.cssanimations)return this.cssAnimationsSupport=!0,!0;
var a=!1,b=document.createElement("div"),d="animation",e="",f="Webkit Moz O ms Khtml".split(" "),g="";if(b.style.animationName&&(a=!0),a===!1)for(var h=0;h<f.length;h++)if(b.style[f[h]+"AnimationName"]!==c){g=f[h],d=g+"Animation",e="-"+g.toLowerCase()+"-",a=!0;break}return this.cssAnimationsSupport=a,a},d.prototype.hardwareAccelerate=function(){this.$el.css({"-webkit-perspective":1e3,perspective:1e3,"-webkit-backface-visibility":"hidden","backface-visibility":"hidden"})},d.prototype.getMovementValues=function(){return{ev:this.ev,pos:this.pos,velocity:this.velocity()}},d.prototype.buildDebugDiv=function(){var b;0===a("#pep-debug").length&&(b=a("<div></div>"),b.attr("id","pep-debug").append("<div style='font-weight:bold; background: red; color: white;'>DEBUG MODE</div>").append("<div id='pep-debug-event'>no event</div>").append("<div id='pep-debug-ev-coords'>event coords: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").append("<div id='pep-debug-pos-coords'>position coords: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").append("<div id='pep-debug-velocity'>velocity: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").append("<div id='pep-debug-delta'>&Delta; movement: <span class='pep-x'>-</span>, <span class='pep-y'>-</span></div>").css({position:"fixed",bottom:5,right:5,zIndex:99999,textAlign:"right",fontFamily:"Arial, sans",fontSize:10,border:"1px solid #DDD",padding:"3px",background:"white",color:"#333"}));var c=this;setTimeout(function(){c.debugElements={$event:a("#pep-debug-event"),$velocityX:a("#pep-debug-velocity .pep-x"),$velocityY:a("#pep-debug-velocity .pep-y"),$dX:a("#pep-debug-delta .pep-x"),$dY:a("#pep-debug-delta .pep-y"),$evCoordsX:a("#pep-debug-ev-coords .pep-x"),$evCoordsY:a("#pep-debug-ev-coords .pep-y"),$posCoordsX:a("#pep-debug-pos-coords .pep-x"),$posCoordsY:a("#pep-debug-pos-coords .pep-y")}},0),a("body").append(b)},d.prototype.log=function(a){if(this.options.debug)switch(a.type){case"event":this.debugElements.$event.text(a.event);break;case"pos-coords":this.debugElements.$posCoordsX.text(a.x),this.debugElements.$posCoordsY.text(a.y);break;case"event-coords":this.debugElements.$evCoordsX.text(a.x),this.debugElements.$evCoordsY.text(a.y);break;case"delta":this.debugElements.$dX.text(a.x),this.debugElements.$dY.text(a.y);break;case"velocity":var b=this.velocity();this.debugElements.$velocityX.text(Math.round(b.x)),this.debugElements.$velocityY.text(Math.round(b.y))}},d.prototype.toggle=function(a){this.disabled="undefined"==typeof a?!this.disabled:!a},a.extend(a.easing,{easeOutQuad:function(a,b,c,d,e){return-d*(b/=e)*(b-2)+c},easeOutCirc:function(a,b,c,d,e){return d*Math.sqrt(1-(b=b/e-1)*b)+c},easeOutExpo:function(a,b,c,d,e){return b===e?c+d:d*(-Math.pow(2,-10*b/e)+1)+c}}),a.fn[e]=function(b){return this.each(function(){if(!a.data(this,"plugin_"+e)){var c=new d(this,b);a.data(this,"plugin_"+e,c),a.pep.peps.push(c)}})},a.pep={},a.pep.peps=[],a.pep.toggleAll=function(b){a.each(this.peps,function(a,c){c.toggle(b)})},a.pep.unbind=function(a){var b=a.data("plugin_"+e);"undefined"!=typeof b&&(b.toggle(!1),b.unsubscribe(),a.removeData("plugin_"+e))}}(jQuery,window),ccm_t=function(a){return $("input[name=ccm-string-"+a+"]").val()},ccm_parseJSON=function(a,b){a.error?alert(a.message):b()},ccm_addHeaderItem=function(a,b){var c=-1!=a.indexOf("?")?"":"?ts=";if("CSS"==b)if(-1!=navigator.userAgent.indexOf("MSIE")){var d=document.createElement("link"),e=document.getElementsByTagName("head")[0];d.type="text/css",d.rel="stylesheet",d.href=a,d.media="screen",e.appendChild(d)}else $("head").children('link[href*="'+a+'"]').length||$("head").append('<link rel="stylesheet" media="screen" type="text/css" href="'+a+c+(new Date).getTime()+'" />');else"JAVASCRIPT"==b?$('script[src*="'+a+'"]').length||$("head").append('<script type="text/javascript" src="'+a+c+(new Date).getTime()+'"></script>'):$("head").children(a).length||$("head").append(a)};var ccm_isBlockError=!1,ccm_blockError=!1;ccm_addError=function(a){ccm_isBlockError||(ccm_blockError="",ccm_blockError+="<ul>"),ccm_isBlockError=!0,ccm_blockError+="<li>"+a+"</li>"},ccm_resetBlockErrors=function(){ccm_isBlockError=!1,ccm_blockError=""},!function(a,b){"use strict";function c(a){var c=this;a=a||{},a=b.extend({dataType:"json",type:"post",error:function(a){c.error(a,c)},complete:function(){c.complete(c)}},a),c.options=a,c.execute()}c.prototype={execute:function(){var a=this,c=a.options,d=c.success;c.success=function(b){a.success(b,a,d)},a.before(),b.ajax(c)},before:function(){jQuery.fn.dialog.showLoader()},error:function(a){ConcreteAlert.dialog("Error",a.responseText)},validateResponse:function(a){return a.error?(ConcreteAlert.dialog("Error",a.errors.join("<br/>")),!1):!0},success:function(a,b,c){b.validateResponse(a)&&c(a)},complete:function(){jQuery.fn.dialog.hideLoader()}},c.validateResponse=c.prototype.validateResponse,b.concreteAjax=function(a){new c(a)},a.ConcreteAjaxRequest=c}(this,$),!function(a,b){"use strict";function c(a,c){var d=this;return c=c||{},c=b.extend({beforeSubmit:d.before,complete:d.complete,data:{}},c),d.$form=a,ConcreteAjaxRequest.call(d,c),d.$form}c.prototype=Object.create(ConcreteAjaxRequest.prototype),c.prototype.execute=function(){var a=this,b=a.options,c=b.success;a.$form.ajaxForm({type:b.type,data:b.data,url:b.url,dataType:b.dataType,beforeSubmit:function(){b.beforeSubmit(a)},error:function(b){a.error(b,a)},success:function(b){a.success(b,a,c)},complete:function(){b.complete(a)}})},c.prototype.success=function(a,b,c){b.validateResponse(a)&&(c?c(a):(ConcreteEvent.publish("AjaxFormSubmitSuccess",{response:a,form:b.$form.attr("data-dialog-form")}),a.redirectURL?window.location.href=a.redirectURL:(b.$form.attr("data-dialog-form")&&jQuery.fn.dialog.closeTop(),ConcreteAlert.notify({message:a.message,title:a.title}))))},b.fn.concreteAjaxForm=function(a){return b.each(b(this),function(){new c(b(this),a)})},a.ConcreteAjaxForm=c}(this,$),!function(a,b){"use strict";function c(a,c){var d=this;return c=b.extend({iframe:!0,task:!1,dragAreaBlockID:!1,bID:!1},c),d.options=c,c.dragAreaBlockID&&a.find("input[name=dragAreaBlockID]").val(c.dragAreaBlockID),ConcreteAjaxForm.call(d,a,c)}c.prototype=Object.create(ConcreteAjaxForm.prototype),c.prototype.beforeSubmit=function(a){ConcreteAjaxForm.prototype.beforeSubmit.call(this,a)},c.prototype.success=function(a,c){if(c.validateResponse(a)){var d=a.cID?a.cID:CCM_CID,e=CCM_TOOLS_PATH+"/edit_block_popup?cID="+d+"&bID="+a.bID+"&arHandle="+encodeURIComponent(a.arHandle)+"&btask=view_edit_mode";jQuery.fn.dialog.closeTop(),b.get(e,function(d){ConcreteToolbar.disableDirectExit(),jQuery.fn.dialog.hideLoader();var e=new Concrete.getEditMode,f=e.getAreaByID(a.aID);if("add"==c.options.task){var g=b("div[data-area-id="+a.aID+"]");if(c.options.dragAreaBlockID){var h=g.find("div[data-block-id="+c.options.dragAreaBlockID+"]");h.next(".ccm-area-drag-area").after(d)}else g.find(".ccm-area-block-list").prepend(d);var i=new Concrete.Block(b("[data-block-id="+a.bID+"]"),e);f.addBlock(i),1==f.getTotalBlocks()&&f.bindMenu(),ConcreteAlert.notify({message:ccmi18n.addBlockMsg,title:ccmi18n.addBlock}),jQuery.fn.dialog.closeAll(),c.options.btSupportsInlineAdd&&(e.destroyInlineEditModeToolbars(),ConcreteEvent.fire("EditModeExitInlineComplete",{block:i})),ConcreteEvent.fire("EditModeAddBlockComplete",{block:i})}else{var i=f.getBlockByID(c.options.bID),j=i.replace(a.bID,d);ConcreteAlert.notify({message:ccmi18n.updateBlockMsg,title:ccmi18n.updateBlock}),c.options.btSupportsInlineEdit&&(e.destroyInlineEditModeToolbars(),ConcreteEvent.fire("EditModeExitInlineComplete",{block:j})),ConcreteEvent.fire("EditModeUpdateBlockComplete",{block:j})}})}},b.fn.concreteAjaxBlockForm=function(a){return b.each(b(this),function(){new c(b(this),a)})},a.ConcreteAjaxBlockForm=c}(this,$),function(a,b,c,d){"use strict";var e=d.EditMode=function(e){function f(a,b,d,e,g,h,j){if(g.call()){i=!0;var k=h.call(b),l=k+d,m=c.toArray(arguments),n=a.getDraggerPosition();h.call(b,l),n[j]-=k-h.call(b),a.renderPosition(),c.defer(function(){f.apply(this,m)},e)}else i=!1}var g=this;e=e||{},e=b.extend({notify:!0},e),d.createGetterSetters.call(g,{dragging:!1,areas:[],blocks:[],selectedCache:[],selectedThreshold:5,dragAreaBlacklist:[]}),d.event.bind("PanelLoad",function(a,b){g.panelOpened(b.panel,b.element)}),d.event.bind("EditModeBlockEditInline",function(a,e){var f,h=e.block,i=h.getArea(),j=[{name:"btask",value:"edit"},{name:"cID",value:h.getCID()},{name:"arHandle",value:i.getHandle()},{name:"arGridColumnSpan",value:e.arGridColumnSpan},{name:"aID",value:i.getId()},{name:"bID",value:h.getId()}],k=h.getId(),l=h.getElem();if(h.menu&&h.menu.destroy(),e.postData)for(f in e.postData)e.postData.hasOwnProperty(f)&&j.push({name:f,value:e.postData[f]});d.event.bind("EditModeExitInline",function(a){d.event.unbind(a),a.stopPropagation();var e=CCM_TOOLS_PATH+"/edit_block_popup?cID="+h.getCID()+"&bID="+h.getId()+"&arHandle="+escape(i.getHandle())+"&btask=view_edit_mode";b.fn.dialog.showLoader(),b.get(e,function(a){var b=i.getBlockByID(k),d=b.replace(k,a);c.defer(function(){ConcreteEvent.fire("EditModeExitInlineComplete",{block:d}),g.destroyInlineEditModeToolbars()})})}),ConcreteMenuManager.disable(),ConcreteToolbar.disable(),i.getElem().addClass("ccm-area-inline-edit-disabled"),l.addClass("ccm-block-edit-inline-active"),b.ajax({type:"GET",url:CCM_TOOLS_PATH+"/edit_block_popup",data:j,success:function(a){l.html(a),g.loadInlineEditModeToolbars(l),b.fn.dialog.hideLoader()}})}),d.event.bind("EditModeBlockAddInline",function(a,c){var e,f,h,i=c.area,j=c.selected,k=c.btID,l=c.cID,m=[{name:"btask",value:"edit"},{name:"cID",value:l},{name:"arGridColumnSpan",value:c.arGridColumnSpan},{name:"arHandle",value:i.getHandle()},{name:"btID",value:k}];j?(h=j.getElem(),e=j.getBlock()):(h=i.getElem(),e=c.dragAreaBlock),e&&(f=e.getId()),ConcreteMenuManager.disable(),ConcreteToolbar.disable(),jQuery.fn.dialog.closeAll(),b("div.ccm-area").addClass("ccm-area-inline-edit-disabled"),b.fn.dialog.showLoader(),i.menu&&i.menu.destroy(),d.event.unsubscribe("EditModeExitInline"),d.event.bind("EditModeExitInline",function(){b("#a"+i.getId()+"-bt"+k).remove(),g.destroyInlineEditModeToolbars()}),b.ajax({type:"GET",url:CCM_DISPATCHER_FILENAME+"/ccm/system/dialogs/page/add_block",data:m,success:function(a){var c=b('<div id="a'+i.getId()+"-bt"+k+'" class="ccm-block-edit-inline-active">'+a+"</div>");h.addClass("ccm-area-edit-inline-active"),h.append(c),b(function(){h.find("#ccm-block-form").concreteAjaxBlockForm({task:"add",btSupportsInlineAdd:!0,dragAreaBlockID:f})}),g.loadInlineEditModeToolbars(c)},complete:function(){b.fn.dialog.hideLoader()}})}),d.event.bind("EditModeBlockAddToClipboard",function(a,c){var d=c.block,e=d.getArea();ConcreteToolbar.disableDirectExit(),b.ajax({type:"POST",url:CCM_TOOLS_PATH+"/pile_manager",data:"cID="+d.getCID()+"&bID="+d.getId()+"&arHandle="+encodeURIComponent(e.getHandle())+"&btask=add&scrapbookName=userScrapbook",success:function(){ConcreteAlert.notify({message:ccmi18n.copyBlockToScrapbookMsg,title:ccmi18n.copyBlockToScrapbook})}})}),d.event.bind("EditModeBlockDelete",function(a,b){var c=b.block;c.delete(b.message),ConcreteEvent.fire("EditModeBlockDeleteComplete",{block:c})});var h=b(a.document.body),i=!1,j=100;d.event.bind("EditModeBlockDrag",c.throttle(function(e,k){if(g.getDragging()){var l=k.block,m=k.pep,n=c.flatten(c(g.getAreas()).map(function(a){var b=a.contendingDragAreas(m,l);return b}),!0);c.defer(function(){d.event.fire("EditModeContenders",n),g.selectContender(m,l,n,k.event)}),i||(f(l,h,2,10,function(){var c=l.getDraggerPosition().y-h.scrollTop();return l.getDragging()&&b(a).height()-c<=j},b.fn.scrollTop,"y"),f(l,h,-2,10,function(){var a=l.getDraggerPosition().y-h.scrollTop();return l.getDragging()&&j>=a},b.fn.scrollTop,"y"),f(l,h,2,10,function(){var c=l.getDraggerPosition().x-h.scrollLeft();return l.getDragging()&&b(a).width()-c<=j},b.fn.scrollLeft,"x"),f(l,h,-2,10,function(){var a=l.getDraggerPosition().x-h.scrollLeft();return l.getDragging()&&j>=a},b.fn.scrollLeft,"x"))}},250,{trailing:!1})),d.event.bind("EditModeBlockDragStop",function(){d.event.fire("EditModeContenders",[]),d.event.fire("EditModeSelectableContender"),g.setDragging(!1)}),d.event.bind("EditModeBlockMove",function(d,e){var f=e.block,g=e.targetArea,h=e.sourceArea,i={ccm_token:a.CCM_SECURITY_TOKEN,btask:"ajax_do_arrange",area:g.getId(),sourceArea:h.getId(),block:f.getId(),blocks:{}};c(g.getBlocks()).each(function(a,b){i.blocks[b]=a.getId()}),f.bindMenu();var j=!1,k=setTimeout(function(){j=!0,b.fn.dialog.showLoader()},150);b.concreteAjax({url:CCM_DISPATCHER_FILENAME+"/ccm/system/page/arrange_blocks?cID="+f.getCID(),data:i,success:function(){b.fn.dialog.hideLoader(),clearTimeout(k)}})}),d.event.bind("EditModeBlockDragStart",function(){g.setDragging(!0)}),g.scanBlocks(),d.getEditMode=function(){return g},e.notify&&ConcreteAlert.notify({message:ccmi18n.editModeMsg,title:ccmi18n.editMode})},f=d.Area=function(a,b){var c=this;a.data("Concrete.area",c),d.createGetterSetters.call(c,{id:a.data("area-id"),elem:a,totalBlocks:0,handle:a.data("area-handle"),dragAreas:[],blocks:[],editMode:b,maximumBlocks:parseInt(a.data("maximumBlocks"),10),blockTypes:a.data("accepts-block-types").split(" ")}),c.id=c.getId(),c.setTotalBlocks(0),c.addDragArea()},g=d.Block=function(a,b,e){var f=this;a.data("Concrete.block",f),d.createGetterSetters.call(f,{id:a.data("block-id"),handle:a.data("block-type-handle"),areaId:a.data("area-id"),cID:a.data("cid"),area:null,elem:a,dragger:null,draggerOffset:{x:0,y:0},draggerPosition:{x:0,y:0},dragging:!1,rotationDeg:0,editMode:b,selected:null,stepIndex:0,peper:e||a.find('a[data-inline-command="move-block"]'),pepSettings:{}}),f.id=f.getId(),c(f.getPepSettings()).extend({deferPlacement:!0,moveTo:function(){f.dragPosition(this)},initiate:function(a,b){f.pepInitiate.call(f,this,a,b)},drag:function(a,b){f.pepDrag.call(f,this,a,b)},start:function(a,b){f.pepStart.call(f,this,a,b)},stop:function(a,b){f.pepStop.call(f,this,a,b)},place:!1}),f.bindMenu(),d.event.bind("EditModeSelectableContender",function(a,b){f.getDragging()&&b instanceof l?f.setSelected(b):f.getDragging()&&f.setSelected(null)}),f.getPeper().click(function(a){return a.preventDefault(),a.stopPropagation(),!1}).pep(f.getPepSettings())},h=d.BlockType=function(a,b,c){var d=this;g.call(d,a,b,c)},i=d.Stack=function(a,b,c){var d=this;g.call(d,a,b,c)},j=d.DuplicateBlock=function(a,b,c){var d=this;g.call(d,a,b,c)},k=d.StackBlock=function(a,b,c,d){var e=this;g.call(e,a,c,d),e.setAttr("stack",b)},l=d.DragArea=function(a,b,e){var f=this;d.createGetterSetters.call(f,{block:e,elem:a,area:b,isContender:!1,isSelectable:!1,animationLength:500}),d.event.bind("EditModeContenders",function(a,b){var d=b;f.setIsContender(c.contains(d,f))}),d.event.bind("EditModeSelectableContender",function(a,b){f.setIsSelectable(b===f)})};e.prototype={reset:function(){var a=this;a.setAttr("areas",[]),b(".ccm-area-drag-area").remove()},scanBlocks:function(){var a,d,e=this;e.reset(),b("div.ccm-area").each(function(){a=new f(b(this),e),e.addArea(a)}),b("div.ccm-block-edit").each(function(){e.addBlock(d=new g(b(this),e)),c(e.getAreas()).findWhere({id:d.getAreaId()}).addBlock(d)}),c.invoke(e.getAreas(),"bindMenu")},panelOpened:function(a,c){var d=this;return"add-block"!==a.getIdentifier()?null:(b(c).find("a.ccm-panel-add-block-draggable-block-type").each(function(){var a,c=b(this),e=b("<a/>").addClass("ccm-panel-add-block-draggable-block-type-dragger").appendTo(c);d.addBlock(a=new h(b(this),d,e)),a.setPeper(e)}),b(c).find("div.ccm-panel-add-block-stack-item").each(function(){var a,c=b(this),e=c.find("div.stack-name");d.addBlock(a=new i(b(this),d,e)),a.setPeper(e),b(this).find("div.block").each(function(){var c,e=b(this),f=e.find("div.block-name");d.addBlock(c=new k(b(this),a,d,f)),c.setPeper(f)})}),b(c).find("div.ccm-panel-add-clipboard-block-item").each(function(){var a,c=b(this),e=c;d.addBlock(a=new j(b(this),d,e)),a.setPeper(e)}),a)},getAreaByID:function(a){var b=this.getAreas();return c.findWhere(b,{id:parseInt(a)})},selectContender:function(a,b,e,f){var g=this;if(e=c(e).filter(function(c){return c.isSelectable(a,b,f)}),e.length<2)return d.event.fire("EditModeSelectableContender",c(e).first());var h=g.getSelectedCache(),i=g.getDragAreaBlacklist();g.getSelectedThreshold()!==h.length||c(h).without(c(h).last()).length||(i.push(c(h).last()),g.setDragAreaBlacklist(i),c.delay(function(a){var b=g.getDragAreaBlacklist();g.setDragAreaBlacklist(c(b).without(a))},5e3,c(h).last())),e=c(e).difference(i);var j=c(e).min(function(a){var b=a.centerDistanceToBlock(this);return b},b);return h.push(j),g.setSelectedCache(c(h).last(g.getSelectedThreshold())),d.event.fire("EditModeSelectableContender",j),j},addArea:function(a){var b=this;b.getAreas().push(a)},addBlock:function(a){var b=this;b.getBlocks().push(a)},destroyInlineEditModeToolbars:function(){ConcreteMenuManager.enable(),b("div.ccm-area-edit-inline-active").removeClass("ccm-area-edit-inline-active"),b("div.ccm-block-edit-inline-active").remove(),b("div.ccm-area").removeClass("ccm-area-inline-edit-disabled"),b("#ccm-toolbar").css("opacity",1),b("#ccm-inline-toolbar-container").remove(),b(a).unbind("scroll.inline-toolbar"),ConcreteToolbar.enable(),b.fn.dialog.hideLoader()},loadInlineEditModeToolbars:function(c){b("#ccm-inline-toolbar-container").remove();var d=c.find(".ccm-inline-toolbar"),e=b("<div />",{id:"ccm-inline-toolbar-container"}).appendTo(document.body),f=b(a),g=c.offset(),h=g.left;d.appendTo(e);var i=h+parseInt(d.width());if(i>f.width()){var j=i-(h+c.width());d.css("left",h-j)}else d.css("left",h);d.css("opacity",1),d.find(".dialog-launch").dialog();var k=g.top-e.outerHeight()-5;e.css("top",k).css("opacity",1),f.scrollTop()>k&&(b("#ccm-toolbar-disabled,#ccm-toolbar").css("opacity",0),e.addClass("ccm-inline-toolbar-affixed")),f.on("scroll.inline-toolbar",function(){e.toggleClass("ccm-inline-toolbar-affixed",f.scrollTop()>k),f.scrollTop()>k?b("#ccm-toolbar-disabled,#ccm-toolbar").css("opacity",0):b("#ccm-toolbar-disabled,#ccm-toolbar").css("opacity",1)})}},f.prototype={getBlockByID:function(a){var b=this;return c.findWhere(b.getBlocks(),{id:a})},getMenuElem:function(){var a=this;return b("[data-area-menu=area-menu-a"+a.getId()+"]")},bindMenu:function(){var a,e=this,f=e.getElem(),g=e.getTotalBlocks(),h=e.getMenuElem();a=g>0?"#area-menu-footer-"+e.getId():"div[data-area-menu-handle="+e.getId()+"]",e.menu&&e.menu.destroy(),e.menu=new ConcreteMenu(f,{handle:a,highlightClassName:"ccm-area-highlight",menuActiveClass:"ccm-area-highlight",menu:b("[data-area-menu="+f.attr("data-launch-area-menu")+"]")}),h.find("a[data-menu-action=add-inline]").on("click",function(a){var f=!1;return c.each(e.getBlocks(),function(a){f=a}),d.event.fire("EditModeBlockAddInline",{area:e,btID:b(this).attr("data-block-type-id"),arGridColumnSpan:b(this).attr("data-area-grid-column-span"),event:a,dragAreaBlock:f}),!1}),h.find("a[data-menu-action=edit-container-layout]").on("click",function(a){var f=b(this),g=!1;c.each(e.getBlocks(),function(a){g=a});var h=parseInt(b(this).attr("data-container-layout-block-id")),i=d.getEditMode(),j=c.findWhere(i.getBlocks(),{id:h});return d.event.fire("EditModeBlockEditInline",{block:j,arGridColumnSpan:f.attr("data-area-grid-column-span"),event:a}),!1})},addBlock:function(a,b){var d=this;return b?this.addBlockToIndex(a,c(d.getBlocks()).indexOf(b)+1):this.addBlockToIndex(a,d.getBlocks().length)},setTotalBlocks:function(a){this.setAttr("totalBlocks",a),this.getElem().attr("data-total-blocks",a)},addBlockToIndex:function(a,b){var c=this.getTotalBlocks(),d=this.getBlocks(),e=c-b;if(a.setArea(this),this.setTotalBlocks(c+1),e>0){for(var f=[],g=0;g<d.length;g++)g>=b?f[g+1]=d[g]:f[g]=d[g];f[b]=a,this.setBlocks(f)}else this.getBlocks()[b]=a;return this.addDragArea(a),a.getElem().attr("data-area-id",this.getId()),!0},removeBlock:function(a){var b=this,d=b.getTotalBlocks();a.getElem().remove(),b.setBlocks(c(b.getBlocks()).without(a)),b.setTotalBlocks(d-1);var e=c.first(c(b.getDragAreas()).filter(function(b){return b.getBlock()===a}));return e&&(e.getElem().remove(),b.setDragAreas(c(b.getDragAreas()).without(e))),b.getTotalBlocks()||b.bindMenu(),!0},addDragArea:function(a){var c,d,e=this;if(a)c=b('<div class="ccm-area-drag-area"/>'),d=new l(c,e,a),a.getElem().after(c);else{if(e.getDragAreas().length)throw new Error("No block supplied");c=b('<div class="ccm-area-drag-area"/>'),d=new l(c,e,a),e.getElem().prepend(c)}return e.getDragAreas().push(d),d},contendingDragAreas:function(a,b){var d=this,e=d.getMaximumBlocks();return b instanceof i||"core_stack_display"===b.getHandle()?c(d.getDragAreas()).filter(function(c){return c.isContender(a,b)}):e>0&&d.getBlocks().length>=e||!c(d.getBlockTypes()).contains(b.getHandle())?[]:c(d.getDragAreas()).filter(function(c){return c.isContender(a,b)})}},g.prototype={addToDragArea:function(a){var b,c=this,e=c.getArea(),f=a.getArea();e.removeBlock(c),a.getElem().after(c.getElem()),b=a.getBlock(),b?a.getArea().addBlock(c,b):a.getArea().addBlockToIndex(c,0),c.getPeper().pep(c.getPepSettings()),1===f.getTotalBlocks()&&f.bindMenu(),d.event.fire("EditModeBlockMove",{block:c,sourceArea:e,targetArea:f})},handleAddResponse:function(a,e,f,g){var h=this;if(!a.error)return b.get(CCM_TOOLS_PATH+"/edit_block_popup",{arHandle:a.arHandle,cID:a.cID,bID:a.bID,btask:"view_edit_mode"},function(a){f?f.getElem().after(a):e.getElem().prepend(a),b.fn.dialog.hideLoader(),c.defer(function(){h.getEditMode().scanBlocks(),h.showSuccessfulAdd(),d.forceRefresh(),g&&g()})}),!0},showSuccessfulAdd:function(){ConcreteAlert.notify({message:ccmi18n.addBlockMsg,title:ccmi18n.addBlock})},"delete":function(){var a=this,c=a.getId(),d=a.getArea(),e=d.getBlockByID(c),f=a.getCID(),g=d.getHandle();ConcreteToolbar.disableDirectExit(),d.removeBlock(e),ConcreteAlert.notify({message:ccmi18n.deleteBlockMsg,title:ccmi18n.deleteBlock}),b.ajax({type:"POST",url:CCM_DISPATCHER_FILENAME,data:"cID="+f+"&ccm_token="+CCM_SECURITY_TOKEN+"&isAjax=true&btask=remove&bID="+c+"&arHandle="+encodeURIComponent(g)})},replace:function(a,c){var e,f,g=this,h=d.getEditMode(),i=g.getId(),j=g.getArea(),k=j.getTotalBlocks();g.getElem().next(".ccm-area-drag-area").remove(),g.getElem().data("block-id",a),g.getElem().attr("data-block-id",a),c&&g.getElem().before(c).remove();var l=new d.Block(b("[data-block-id="+a+"]"),h);j.setTotalBlocks(k-1);var m=h.getBlocks();for(e=0;e<m.length;e++)f=m[e],f.getId()===i&&(m[e]=l);h.setBlocks(m);var n=j.getBlocks(),o=n.length;for(e=0;o>e;e++)f=n[e],f.getId()===i&&j.addBlockToIndex(l,e);return l},getMenuElem:function(){var a=this;return b("[data-block-menu=block-menu-b"+a.getId()+"-"+a.getAreaId()+"]")},bindMenu:function(){var a=this,c=a.getElem(),e=c.attr("data-block-menu-handle"),f=a.getMenuElem();"none"!==e&&(a.menu=new ConcreteMenu(c,{handle:"this",highlightClassName:"ccm-block-highlight",menuActiveClass:"ccm-block-highlight",menu:b("[data-block-menu="+c.attr("data-launch-block-menu")+"]")}),f.find("a[data-menu-action=edit_inline]").unbind().on("click",function(){d.event.fire("EditModeBlockEditInline",{block:a,event:event})}),f.find("a[data-menu-action=block_scrapbook]").unbind().on("click",function(){d.event.fire("EditModeBlockAddToClipboard",{block:a,event:event})}),f.find("a[data-menu-action=delete_block]").unbind().on("click",function(){d.event.fire("EditModeBlockDelete",{message:b(this).attr("data-menu-delete-message"),block:a,event:event})}))},setArea:function(a){this.setAttr("area",a);var c=this;c.getElem().find("a[data-menu-action=block_dialog]").each(function(){var d=b(this).data("menu-href");d+=-1!==d.indexOf("?")?"&cID="+c.getCID():"?cID="+c.getCID(),d+="&arHandle="+encodeURIComponent(a.getHandle())+"&bID="+c.getId(),b(this).attr("href",d).dialog()})},getDragger:function(){var a=this;if(!a.getAttr("dragger")){var c=b("<a />").html(a.getElem().data("dragging-avatar")||'<p><img src="/concrete/blocks/content/icon.png"><span>'+ccmi18n.content+"</span></p>").addClass("ccm-block-edit-drag ccm-panel-add-block-draggable-block-type");a.setAttr("dragger",c.css({width:a.getElem().width(),height:a.getElem().height()}))}return a.getAttr("dragger")},transform:function(a,b){var c=this,d=c.getDragger().css({"-webkit-transform":a,"-moz-transform":a,"-ms-transform":a,"-o-transform":a,transform:a}).get(0);return d.filters&&(d.filters["DXImageTransform.Microsoft.Matrix"]||(d.style.filter=(d.style.filter?"":" ")+"progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand')"),d.filters["DXImageTransform.Microsoft.Matrix"].M11=b.elements[0][0],d.filters["DXImageTransform.Microsoft.Matrix"].M12=b.elements[0][1],d.filters["DXImageTransform.Microsoft.Matrix"].M21=b.elements[1][0],d.filters["DXImageTransform.Microsoft.Matrix"].M22=b.elements[1][1],d.style.left=-(d.offsetWidth/2)+d.clientWidth/2+"px",d.style.top=-(d.offsetHeight/2)+d.clientHeight/2+"px"),!0},resetTransform:function(){var a="",b=this.getDragger().css({top:0,left:0,"-webkit-transform":a,"-moz-transform":a,"-ms-transform":a,"-o-transform":a,transform:a}).get(0);return b.filters&&(b.filters=[]),this.setDraggerPosition({x:0,y:0}),this.renderPosition()},multiplyMatrices:function(a,b){for(var c=[],d=0;d<a.length;d++){c[d]=[];for(var e=0;e<a[0].length;e++){for(var f=0,g=0;g<a[0].length;g++)f+=a[d][g]*b[g][e];c[d][e]=f}}return c},matrixToCss:function(a){var b=[a[0][0],a[0][1],a[1][0],a[1][1],a[0][2],a[1][2]];return"matrix("+b.join(",")+")"},endRotation:function(){var a=this,b=a.getRotationDeg();a.getDragger().animate({rotation:0},{duration:1,step:function(){}});var c=a.setStepIndex(a.getStepIndex()+1);return a.getDragger().animate({rotation:a.getRotationDeg()},{queue:!1,duration:150,step:function(d){a.getStepIndex()===c&&(a.setRotationDeg(b-d),a.renderPosition())}},"easeOutElastic"),!0},renderPosition:function(){var a,b,d=this,e=d.getDraggerPosition().x,f=d.getDraggerPosition().y,g=d.getRotationDeg()*(Math.PI/180),h=c.bind(Math.cos,Math),i=c.bind(Math.sin,Math),j=[[1,0,e],[0,1,f],[0,0,1]];return g?(a=[[h(g),i(g),0],[-i(g),h(g),0],[0,0,1]],b=d.multiplyMatrices(j,a)):b=j,this.transform(d.matrixToCss(b),b)},dragPosition:function(a){var b=this;b.setRotationDeg(Math.max(-15,Math.min(15,a.velocity().x/15))),b.endRotation();var d=c.last(a.velocityQueue),e=b.getDraggerOffset();d||(d={x:b.getDragger().offset().left,y:b.getDragger().offset().top});var f=d.x-e.x,g=d.y-e.y;return b.setDraggerPosition({x:f,y:g}),b.renderPosition(),!0},pepInitiate:function(b,e,f){var g=this;g.resetTransform(),g.setDragging(!0),g.getDragger().hide().appendTo(a.document.body).css(g.getElem().offset()),g.setDraggerOffset({x:e.clientX-g.getElem().offset().left+a.document.body.scrollLeft,y:e.clientY-g.getElem().offset().top+a.document.body.scrollTop}),g.getDragger().fadeIn(250),c.defer(function(){d.event.fire("EditModeBlockDragInitialization",{block:g,pep:f,event:e})})},pepDrag:function(a,b,e){var f=this;c.defer(function(){d.event.fire("EditModeBlockDrag",{block:f,pep:e,event:b})})},pepStart:function(a,e,f){var g=this;g.resetTransform();var h=g.getElem(),i={x:e.pageX,y:e.pageY},j={x:h.offset().left,y:h.offset().top},k={x:(j.x-i.x)/h.width(),y:(j.y-i.y)/h.height()};g.setDraggerPosition({x:j.x,y:j.y}),g.renderPosition(),g.setDraggerOffset({x:-1*k.x*h.width(),y:-1*k.y*h.height()}),g.getDragger().animate({width:90,height:90},{duration:250,step:function(){g.setDraggerOffset({x:-1*k.x*b(this).width(),y:-1*k.y*b(this).height()}),g.dragPosition(f)}}),c.defer(function(){d.event.fire("EditModeBlockDragStart",{block:g,pep:f,event:e})})},pepStop:function(a,b,e){var f,g=this;g.getDragger().stop(1),g.getDragger().css({top:0,left:0}),g.dragPosition(e),(f=g.getSelected())&&g.addToDragArea(f),g.animateToElem(),c.defer(function(){d.event.fire("EditModeBlockDragStop",{block:g,pep:e,event:b})})},animateToElem:function(a){var b=this,c=a||b.getElem(),d={x:b.getDraggerPosition().x,y:b.getDragger().offset().top,width:b.getDragger().width(),height:b.getDragger().height()};b.setDragging(!1),b.getDragger().animate({ccm_perc:0},{duration:0,step:function(){}}).animate({ccm_perc:1,opacity:0},{duration:500,step:function(a,e){if("ccm_perc"===e.prop){var f={x:c.offset().left,y:c.offset().top,width:c.width(),height:c.height()},g={x:(f.x-d.x)*a,y:(f.y-d.y)*a,width:(f.width-d.width)*a,height:(f.height-d.height)*a};b.setDraggerPosition({x:d.x+g.x,y:d.y+g.y}),b.renderPosition(),b.getDragger().css({width:d.width+g.width,height:d.height+g.height})}else b.getDragger().css({opacity:a})},complete:function(){b.getDragger().remove(),b.setAttr("dragger",null)}})}},h.prototype=c({pepStop:function(a,b,e){var f,g=this;(f=g.getSelected())&&g.addToDragArea(f),c.defer(function(){d.event.fire("EditModeBlockDragStop",{block:g,pep:e,event:b})}),g.getDragger().remove(),g.setAttr("dragger",null)},addToDragArea:function(a){var d=this,e=d.getElem(),f=e.data("btid"),g=e.data("cid"),h=a.getArea(),i=h.getHandle(),j=0,k=a.getBlock(),l=!!e.data("supports-inline-add"),m=!!e.data("has-add-template");k&&(j=k.getId()),ConcretePanelManager.exitPanelMode(),m?l?ConcreteEvent.fire("EditModeBlockAddInline",{selected:a,area:a.getArea(),cID:g,btID:f,dragAreaBlockID:j}):b.fn.dialog.open({onOpen:function(){b(function(){b("#ccm-block-form").concreteAjaxBlockForm({task:"add",dragAreaBlockID:j})})},width:parseInt(e.data("dialog-width"),10),height:parseInt(e.data("dialog-height"),10)+20,title:e.data("dialog-title"),href:CCM_DISPATCHER_FILENAME+"/ccm/system/dialogs/page/add_block?cID="+g+"&btID="+f+"&arHandle="+encodeURIComponent(i)}):b.get(CCM_DISPATCHER_FILENAME,{cID:g,arHandle:i,btID:f,mode:"edit",processBlock:1,add:1,ccm_token:CCM_SECURITY_TOKEN,dragAreaBlockID:j},function(a){b.fn.dialog.showLoader(),b.get(CCM_TOOLS_PATH+"/edit_block_popup",{arHandle:a.arHandle,cID:a.cID,bID:a.bID,btask:"view_edit_mode"},function(a){k?k.getElem().after(a):h.getElem().append(a),b.fn.dialog.hideLoader(),c.defer(function(){d.getEditMode().scanBlocks()})})})}}).defaults(g.prototype),i.prototype=c({addToDragArea:function(a){var c=this,d=c.getElem(),e=a.getArea(),f=e.getHandle(),g=0,h=a.getBlock();h&&(g=h.getId()),ConcretePanelManager.exitPanelMode();var i={cID:CCM_CID,arHandle:f,stID:d.data("cid"),atask:"add_stack",ccm_token:CCM_SECURITY_TOKEN};g&&(i.dragAreaBlockID=g),b.fn.dialog.showLoader(),b.getJSON(CCM_DISPATCHER_FILENAME,i,function(a){c.handleAddResponse(a,e,h)})},showSuccessfulAdd:function(){ConcreteAlert.notify({message:ccmi18n.addBlockStackMsg,title:ccmi18n.addBlockStack})}}).defaults(h.prototype),j.prototype=c({addToDragArea:function(a){var c=this,d=c.getElem(),e=d.data("btid"),f=a.getArea(),g=f.getHandle(),h=0,i=d.data("cid"),j=a.getBlock(),k=d.data("pcid");j&&(h=j.getId()),ConcretePanelManager.exitPanelMode(),jQuery.fn.dialog.closeAll(),jQuery.fn.dialog.showLoader();var l={cID:i,arHandle:g,btID:e,mode:"edit",processBlock:1,add:1,btask:"alias_existing_block",pcID:[k],ccm_token:CCM_SECURITY_TOKEN};h&&(l.dragAreaBlockID=h),b.getJSON(CCM_DISPATCHER_FILENAME,l,function(a){c.handleAddResponse(a,f,j,function(){ConcreteEvent.fire("EditModeAddClipboardComplete",{block:c})})})}}).defaults(h.prototype),k.prototype=c({addToDragArea:function(a){var c=this,d=c.getElem(),e=d.data("btid"),f=a.getArea(),g=f.getHandle(),h=0,i=a.getBlock();i&&(h=i.getId()),ConcretePanelManager.exitPanelMode();var j={cID:CCM_CID,bID:d.data("block-id"),arHandle:g,btID:e,mode:"edit",processBlock:1,add:1,btask:"alias_existing_block",pcID:[d.data("cID")],ccm_token:CCM_SECURITY_TOKEN};h&&(j.dragAreaBlockID=h),b.getJSON(CCM_DISPATCHER_FILENAME,j,function(a){c.handleAddResponse(a,f,i)})}}).defaults(h.prototype),l.prototype={isSelectable:function(a,b){return a.isOverlapping(b.getDragger(),this.getElem())},setIsSelectable:function(a){var b=this;return a&&!b.getIsSelectable()?b.getElem().addClass("ccm-area-drag-area-selectable"):!a&&b.getIsSelectable()&&b.getElem().removeClass("ccm-area-drag-area-selectable"),b.setAttr("isSelectable",a),!0},isContender:function(a,b){var d=this;return c.identity(a),d.getBlock()!==b
},setIsContender:function(a){var b=this;return a&&!b.getIsContender()?c.defer(function(){b.getElem().addClass("ccm-area-drag-area-contender")}):!a&&b.getIsContender()&&c.defer(function(){b.getElem().removeClass("ccm-area-drag-area-contender")}),b.setAttr("isContender",a),!0},centerDistanceToBlock:function(a){var b=this,c=a.getDragger(),d={x:c.offset().left+c.width()/2,y:c.offset().top+c.height()/2},e=b.getElem(),f={x:e.offset().left+e.width()/2,y:e.offset().top+e.height()/2};return Math.sqrt(Math.pow(Math.abs(d.x-f.x),2)+Math.pow(Math.abs(d.y-f.y),2))}}}(window,jQuery,_,Concrete),jQuery.cookie=function(a,b,c){if("undefined"==typeof b){var d=null;if(document.cookie&&""!=document.cookie)for(var e=document.cookie.split(";"),f=0;f<e.length;f++){var g=jQuery.trim(e[f]);if(g.substring(0,a.length+1)==a+"="){d=decodeURIComponent(g.substring(a.length+1));break}}return d}c=c||{},null===b&&(b="",c=$.extend({},c),c.expires=-1);var h="";if(c.expires&&("number"==typeof c.expires||c.expires.toUTCString)){var i;"number"==typeof c.expires?(i=new Date,i.setTime(i.getTime()+24*c.expires*60*60*1e3)):i=c.expires,h="; expires="+i.toUTCString()}var j=c.path?"; path="+c.path:"",k=c.domain?"; domain="+c.domain:"",l=c.secure?"; secure":"";document.cookie=[a,"=",encodeURIComponent(b),h,j,k,l].join("")};var ConcretePanelManager=function(){"use strict";var a=[];return{getPanels:function(){return a},showOverlay:function(a){$("#ccm-panel-overlay").clearQueue().show(0).delay(100).queue(function(){a?$(this).addClass("ccm-panel-translucent"):$(this).removeClass("ccm-panel-translucent"),$(this).dequeue()})},exitPanelMode:function(){for(var b=0;b<a.length;b++)a[b].isOpen&&a[b].hide()},register:function(b){var c=$.extend({translucent:!0,overlay:!0,position:"left",primary:!0,transition:"slide"},b),d=new ConcretePanel(c);a.push(d);var e=$("#"+d.getDOMID());e.length||($("<div />",{id:d.getDOMID(),"class":"ccm-panel "+d.getPositionClass()}).appendTo($(document.body)),$("<div />",{"class":"ccm-panel-content-wrapper ccm-ui"}).appendTo($("#"+d.getDOMID())),$("<div />",{"class":"ccm-panel-shadow-layer"}).appendTo($("#"+d.getDOMID())))},getByIdentifier:function(b){for(var c=0;c<a.length;c++)if(a[c].getIdentifier()==b)return a[c]}}}();$.widget.bridge("jqdialog",$.ui.dialog),jQuery.fn.dialog=function(){return arguments.length>0?void $(this).jqdialog(arguments[0],arguments[1],arguments[2]):$(this).is("div")?void $(this).jqdialog():$(this).each(function(){$(this).unbind("click.make-dialog").bind("click.make-dialog",function(){var a=$(this).attr("href"),b=$(this).attr("dialog-width"),c=$(this).attr("dialog-height"),d=$(this).attr("dialog-title"),e=$(this).attr("dialog-on-open"),f=$(this).attr("dialog-on-destroy"),g=$(this).attr("dialog-on-close"),h=$(this).attr("dialog-on-direct-close");return obj={modal:!0,href:a,width:b,height:c,title:d,onOpen:e,onDestroy:f,onClose:g,onDirectClose:h},jQuery.fn.dialog.open(obj),!1})})},jQuery.fn.dialog.close=function(a){a++,$("#ccm-dialog-content"+a).jqdialog("close")},jQuery.fn.dialog.open=function(options){if("undefined"!=typeof ConcreteMenu){var activeMenu=ConcreteMenuManager.getActiveMenu();activeMenu&&activeMenu.hide()}"string"==typeof options.width?"auto"==options.width?w="auto":options.width.indexOf("%",0)>0?(w=options.width.replace("%",""),w=$(window).width()*(w/100),w+=50):w=parseInt(options.width)+50:w=options.width?parseInt(options.width)+50:550,"string"==typeof options.height?"auto"==options.height?h="auto":options.height.indexOf("%",0)>0?(h=options.height.replace("%",""),h=$(window).height()*(h/100),h+=100):h=parseInt(options.height)+100:h=options.height?parseInt(options.height)+100:400,"auto"!==h&&h>$(window).height()&&(h=$(window).height()),options.width=w,options.height=h;var defaults={modal:!0,escapeClose:!0,width:w,height:h,create:function(){$(this).parent().addClass("animated fadeIn")},open:function(){var $dialog=$(this),nd=$(".ui-dialog").length;1==nd&&($("body").attr("data-last-overflow",$("body").css("overflow")),$("body").css("overflow","hidden"));var overlays=$(".ui-widget-overlay").length;$(".ui-widget-overlay").each(function(a){overlays>a+1&&$(this).css("opacity",0)}),jQuery.fn.dialog.activateDialogContents($dialog),"undefined"!=typeof options.onOpen&&("function"==typeof options.onOpen?options.onOpen($dialog):eval(options.onOpen))},beforeClose:function(){var a=$(".ui-dialog").length;1==a&&$("body").css("overflow",$("body").attr("data-last-overflow"))},close:function(ev,u){options.element||$(this).jqdialog("destroy").remove(),"undefined"!=typeof options.onClose&&("function"==typeof options.onClose?options.onClose():eval(options.onClose)),"undefined"==typeof options.onDirectClose||!ev.handleObj||"keydown"!=ev.handleObj.type&&"click"!=ev.handleObj.type||("function"==typeof options.onDirectClose?options.onDirectClose():eval(options.onDirectClose)),"undefined"!=typeof options.onDestroy&&("function"==typeof options.onDestroy?options.onDestroy():eval(options.onDestroy));var overlays=$(".ui-widget-overlay").length;$(".ui-widget-overlay").each(function(a){overlays>a+1?$(this).css("opacity",0):$(this).css("opacity",1)})}},finalSettings={autoOpen:!1};$.extend(finalSettings,defaults,options),finalSettings.element?($(finalSettings.element).jqdialog(finalSettings).jqdialog(),$(finalSettings.element).jqdialog("open")):(jQuery.fn.dialog.showLoader(),$.ajax({type:"GET",url:finalSettings.href,success:function(a){jQuery.fn.dialog.hideLoader(),$("<div />").jqdialog(finalSettings).html(a).jqdialog("open")}}))},jQuery.fn.dialog.activateDialogContents=function(a){if(a.find("button[data-dialog-action=cancel]").on("click",function(){jQuery.fn.dialog.closeTop()}),$("[data-dialog-form]").concreteAjaxForm(),a.find("button[data-dialog-action=submit]").on("click",function(){$("[data-dialog-form]").submit()}),a.find(".dialog-buttons").length>0&&(a.jqdialog("option","buttons",[{}]),a.parent().find(".ui-dialog-buttonset").remove(),a.parent().find(".ui-dialog-buttonpane").html(""),a.find(".dialog-buttons").removeClass().appendTo(a.parent().find(".ui-dialog-buttonpane").addClass("ccm-ui"))),a.find(".dialog-launch").dialog(),a.find(".ccm-dialog-close").on("click",function(){a.dialog("close")}),a.find(".launch-tooltip").tooltip({container:"#ccm-tooltip-holder"}),a.find(".chosen-select").chosen(),a.find(".dialog-help").length>0){a.find(".dialog-help").hide();var b=a.find(".dialog-help").html();if(ccmi18n.helpPopup){ccmi18n.helpPopup}else;a.parent().find(".ui-dialog-titlebar").addClass("ccm-ui").append('<button class="ui-dialog-titlebar-help ccm-menu-help-trigger"><i class="fa fa-info-circle"></i></button>'),a.parent().find(".ui-dialog-titlebar .ccm-menu-help-trigger").popover({content:function(){return b},placement:"bottom",html:!0,container:"#ccm-tooltip-holder",trigger:"click"})}},jQuery.fn.dialog.getTop=function(){var a=$(".ui-dialog:visible").length;return $($(".ui-dialog:visible")[a-1]).find(".ui-dialog-content")},jQuery.fn.dialog.replaceTop=function(a){$dialog=jQuery.fn.dialog.getTop(),$dialog.html(a),jQuery.fn.dialog.activateDialogContents($dialog)},jQuery.fn.dialog.showLoader=function(){$("body").addClass("ccm-loading")},jQuery.fn.dialog.hideLoader=function(){$("body").removeClass("ccm-loading")},jQuery.fn.dialog.closeTop=function(){$dialog=jQuery.fn.dialog.getTop(),$dialog.jqdialog("close")},jQuery.fn.dialog.closeAll=function(){$($(".ui-dialog-content").get().reverse()).jqdialog("close")},!function(a,b){"use strict";var c={dialog:function(a,c,d){b('<div id="ccm-popup-alert" class="ccm-ui"><div id="ccm-popup-alert-message" class="alert alert-danger">'+c+"</div></div>").dialog({title:a,modal:!0,onDestroy:d})},notify:function(a){var c=b.extend({type:"success",icon:"ok",title:!1,message:!1,appendTo:!1},a),d="",e=b(c.appendTo?c.appendTo:document.body);d=c.title?"<h3>"+c.title+"</h3>"+c.message:"<h3>"+c.message+"</h3>",b('<div id="ccm-notification-hud" class="ccm-ui ccm-notification ccm-notification-'+c.type+'"><i class="fa fa-'+c.icon+'"></i><div class="ccm-notification-inner">'+d+"</div></div>").appendTo(e).delay(5).queue(function(){b(this).addClass("animated fadeIn"),b(this).dequeue()}).delay(2e3).queue(function(){b(this).css("opacity",1),b(this).dequeue()}).delay(1).queue(function(){b(this).addClass("animated bounceOutRight"),b(this).dequeue()}).delay(1e3).queue(function(){b(this).remove(),b(this).dequeue()})}};a.ConcreteAlert=c}(this,$),ccm_closeNewsflow=function(){$ovl=ccm_getNewsflowOverlayWindow(),$ovl.fadeOut(300,"easeOutExpo"),$(".ui-widget-overlay").fadeOut(300,"easeOutExpo",function(){$(this).remove()})},ccm_setNewsflowPagingArrowHeight=function(){if($("#ccm-marketplace-detail").length>0)var a=$("#ccm-marketplace-detail");else var a=$("#newsflow-main");var b=a.height();$(".newsflow-paging-previous a, .newsflow-paging-next a").css("height",b+"px"),$(".newsflow-paging-previous, .newsflow-paging-next").css("height",b+"px"),$(".newsflow-paging-next").show(),$(".newsflow-paging-previous").show()},ccm_setNewsflowOverlayDimensions=function(){if($("#newsflow-overlay").length>0){var a=$("#newsflow-overlay").width(),b=$(window).width(),c=$(window).height(),d=650,e=c-80;h=e>d?d:e,$("#newsflow-overlay").css("height",d);var f=(b-a)/2,g=(c-h)/2;g+=29,f+="px",g+="px",$("#newsflow-overlay").css("left",f).css("top",g)}},ccm_getNewsflowOverlayWindow=function(){if($("#ccm-dashboard-content").length>0&&$("#newsflow-main").length>0&&0==$("#newsflow-overlay").length)var a=$("#newsflow-main").parent();else if($("#newsflow-overlay").length>0)var a=$("#newsflow-overlay");else var a=$("<div />").attr("id","newsflow-overlay").attr("class","ccm-ui").css("display","none").appendTo(document.body);return a},ccm_showNewsflowOverlayWindow=function(a,b){if($("#ccm-dashboard-content").length>0&&$("#newsflow-main").length>0);else{if($(".ui-widget-overlay").length<1){$('<div class="ui-widget-overlay"></div>').hide().appendTo("body")}$(".ui-widget-overlay").show()}$(window).resize(function(){ccm_setNewsflowOverlayDimensions()}),$ovl=ccm_getNewsflowOverlayWindow(),$ovl.load(a,function(){$ovl.hide(),$(".newsflow-paging-next").hide(),$(".newsflow-paging-previous").hide(),$ovl.html($(this).html()),b&&b(),ccm_setNewsflowOverlayDimensions(),ccm_setupTrickleUpNewsflowStyles(),$ovl.fadeIn("300","easeOutExpo",function(){ccm_setNewsflowPagingArrowHeight()})})},ccm_setupTrickleUpNewsflowStyles=function(){ovl=ccm_getNewsflowOverlayWindow(),ovl.find(".newsflow-em1").each(function(){$(this).parent().addClass("newsflow-em1")})},ccm_showDashboardNewsflowWelcome=function(){jQuery.fn.dialog.showLoader(ccmi18n.newsflowLoading),ccm_showNewsflowOverlayWindow(CCM_DISPATCHER_FILENAME+"/dashboard/home?_ccm_dashboard_external=1",function(){jQuery.fn.dialog.hideLoader()})},ccm_showNewsflowOffsite=function(a){jQuery.fn.dialog.showLoader(),ccm_showNewsflowOverlayWindow(CCM_TOOLS_PATH+"/newsflow?cID="+a,function(){jQuery.fn.dialog.hideLoader()})},ccm_showAppIntroduction=function(){ccm_showNewsflowOverlayWindow(CCM_DISPATCHER_FILENAME+"/dashboard/welcome?_ccm_dashboard_external=1")},ccm_getNewsflowByPath=function(a){jQuery.fn.dialog.showLoader(),ccm_showNewsflowOverlayWindow(CCM_TOOLS_PATH+"/newsflow?cPath="+a,function(){jQuery.fn.dialog.hideLoader()})},!function(a,b){"use strict";function c(a,c){var d=this;return c=c||{},c=b.extend({url:!1,data:{}},c),d.$element=a,d.options=c,d.initializeEditableFields(),d.initializeClearCommands(),d.$element}c.prototype={getAjaxURL:function(a){var b=this,c=b.options.url;return a.attr("data-url")&&(c=a.attr("data-url")),c},setupXeditableField:function(a){var b=this;a.editable({ajaxOptions:{dataType:"json"},emptytext:ccmi18n.none,showbuttons:!0,params:b.options.data,url:b.options.url,success:function(a,b){return ConcreteAjaxRequest.validateResponse(a)?{newValue:b}:""},pk:"_x"})},setupXeditableAttributeField:function(a){var b=this;a.editable({ajaxOptions:{dataType:"json"},emptytext:ccmi18n.none,showbuttons:!0,savenochange:!0,autotext:"never",url:b.options.url,params:function(a){var c=[];return c.push({name:"name",value:a.name}),c.push({name:"pk",value:a.pk}),_.each(b.options.data,function(a,b){c.push("object"==typeof a?{name:a.name,value:a.value}:{name:b,value:a})}),_.each(a.value,function(a){c.push({name:a.name,value:a.value})}),c},success:function(a){return ConcreteAjaxRequest.validateResponse(a)?{newValue:a.value}:""},pk:"_x"})},setupImageField:function(a){var b=this,c=a.find(".editable-image-wrapper img");a.find(".editable-image-wrapper input").css("width",c.width()).css("height",c.height()),a.fileupload({url:b.getAjaxURL(a),dataType:"json",formData:b.options.data,start:function(){jQuery.fn.dialog.showLoader()},success:function(c){b.updateImageField(c,a)},error:function(a){ConcreteAlert.dialog("Error",a.responseText)},complete:function(){jQuery.fn.dialog.hideLoader()}})},updateImageField:function(a,b){var c=this;ConcreteAjaxRequest.validateResponse(a)&&(b.find(".editable-image-display").html(a.imageHTML),c.setupImageField(b),ConcreteAlert.notify({message:a.message}))},initializeEditableFields:function(){var a=this;a.$element.find("[data-editable-field-type]").each(function(){var c=b(this),d="setup"+c.attr("data-editable-field-type").charAt(0).toUpperCase()+c.attr("data-editable-field-type").slice(1)+"Field";a[d](c)})},initializeClearCommands:function(){var a=this;a.$element.on("click","[data-editable-field-command=clear]",function(){var c=b(this),d=c.closest("[data-editable-field-type]"),e="update"+d.attr("data-editable-field-type").charAt(0).toUpperCase()+d.attr("data-editable-field-type").slice(1)+"Field",f=a.options.data;f.task="clear";var g=a.getAjaxURL(d);return new ConcreteAjaxRequest({url:g,data:f,success:function(b){a[e](b,d)}})}),a.$element.on("click","[data-editable-field-command=clear_attribute]",function(){var c=a.options.data,d=a.getAjaxURL(b(this)),e=b(this).attr("data-key-id"),f=[];return _.each(c,function(a,b){f.push("object"==typeof a?{name:a.name,value:a.value}:{name:b,value:a})}),f.push({name:"akID",value:e}),new ConcreteAjaxRequest({url:d,data:f,success:function(){b("[data-key-id="+e+"][data-editable-field-type=xeditableAttribute]").editable("setValue","")}})})}},b.fn.concreteEditableFieldContainer=function(a){return b.each(b(this),function(){new c(b(this),a)})},a.ConcreteEditableFieldContainer=c}(this,$),ccm_doPageReindexing=function(){$.get(CCM_TOOLS_PATH+"/reindex_pending_pages?ccm_token="+CCM_SECURITY_TOKEN)},!function(a,b,c){"use strict";function d(a,c){var d=this;c=c||{},c=b.extend({handle:"this",menu:!1,highlightClassName:"ccm-menu-highlight",highlightOffset:0,menuContainerClass:!1,menuActiveClass:"ccm-menu-item-active",menuActiveParentClass:"ccm-parent-menu-item-active",menuLauncherHoverClass:"ccm-menu-item-hover",menuLauncherHoverParentClass:"ccm-parent-menu-item-hover",enabled:!0,onHide:!1},c),d.$element=a,d.options=c,"none"==c.handle?d.$launcher=!1:(d.$launcher="this"==c.handle?d.$element:b(c.handle),d.$launcher.each(function(){var a=b(this);a.on("mousemove.concreteMenu",function(a){d.hoverProxy(a,b(this))})})),d.$menu=b(c.menu),d.setup()}d.prototype={setup:function(){var a=this,c=(a.options,e);c.$clickProxy||(c.$clickProxy=b("<div />",{id:"ccm-menu-click-proxy"}),c.$clickProxy.on("mouseout.concreteMenuProxy",function(a){var b=c.hoverMenu;b.mouseout(a)}),c.$clickProxy.on("mouseover.concreteMenuProxy",function(a){var b=c.hoverMenu;b.mouseover(a)}),c.$clickProxy.on("click.concreteMenuProxy",function(a){var b=c.hoverMenu;b.show(a)}),b(document.body).append(c.$clickProxy)),c.$highlighter||(c.$highlighter=b("<div />",{id:"ccm-menu-highlighter"}),b(document.body).append(c.$highlighter)),c.$container||(c.$container=b("<div />",{id:"ccm-popover-menu-container","class":"ccm-ui"}),b(document.body).append(c.$container))},destroy:function(){var a=this;a.hide(),a.$launcher.each(function(){b(this).unbind("mousemove.concreteMenu")})},positionAt:function(a,b){if(!b)return!1;var c=this,d=b.offset(),e={top:d.top-c.options.highlightOffset,left:d.left-c.options.highlightOffset,width:b.outerWidth()+2*c.options.highlightOffset,height:b.outerHeight()+2*c.options.highlightOffset,"border-top-left-radius":b.css("border-top-left-radius"),"border-top-right-radius":b.css("border-top-right-radius"),"border-bottom-left-radius":b.css("border-bottom-left-radius"),"border-bottom-right-radius":b.css("border-bottom-right-radius")};a.css(e)},hoverProxy:function(a,b){a.stopPropagation();var c=this,d=e,f=c.options.menuLauncherHoverClass,g=d.$clickProxy;return!d.enabled||d.activeMenu?!1:(c.positionAt(g,b),g.removeClass().addClass(f),void(e.hoverMenu=c))},mouseover:function(){var a=this.$launcher,b=this.options;a.addClass(b.menuLauncherHoverClass),a.parents("*").slice(0,3).addClass(b.menuLauncherHoverParentClass)},mouseout:function(){var a=this.$launcher,b=this.options;a.removeClass(b.menuLauncherHoverClass),a.parents("*").slice(0,3).removeClass(b.menuLauncherHoverParentClass)},setupMenuOptions:function(a){a.find(".dialog-launch").dialog()},show:function(a){var d=this,f=e,g=d.options,h=d.$launcher,i=d.$element,j=f.$container,k=f.$highlighter,l=d.$menu.clone(!0,!0),m=a.pageX+2,n=a.pageY+2;a.stopPropagation(),k.removeClass(),d.positionAt(k,h),c.defer(function(){k.addClass(g.highlightClassName)}),i.addClass(g.menuActiveClass),i.parents("*").slice(0,3).addClass(g.menuActiveParentClass),d.setupMenuOptions(l),j.html(""),l.appendTo(j),g.menuContainerClass&&j.addClass(g.menuContainerClass),l.css("opacity",0).show();var o=l.width(),p=l.height();b(window).height()<a.clientY+p+30?(n=n-p-10,m-=o/2,l.removeClass("bottom"),l.addClass("top")):(m-=o/2,n+=10,l.removeClass("top"),l.addClass("bottom")),l.css({top:n+"px",left:m+"px"}),c.defer(function(){l.css("opacity",1)}),l.find("a").click(function(a){d.hide(a)}),b(document).unbind(".concreteMenuDisable").on("click.concreteMenuDisable",function(a){d.hide(a)}),d.$menuPointer=l,e.activeMenu=d},hide:function(a){var b=this,d=e,f={"class":"",width:0,height:0,top:0,left:0};a&&a.stopPropagation(),b.$menuPointer&&(b.$menuPointer.css("opacity",0),c.defer(function(){b.$menuPointer.hide()})),c.defer(function(){b.$element.removeClass(b.options.menuActiveClass),b.$element.parents("*").slice(0,3).removeClass(b.options.menuActiveParentClass),d.$container.removeClass().addClass("ccm-ui").html("")}),d.$clickProxy.css(f),d.$highlighter.css(f),e.activeMenu=!1,b.options.onHide&&b.options.onHide(b)}};var e={enabled:!0,$clickProxy:!1,$highlighter:!1,$container:!1,hoverMenu:!1,activeMenu:!1,reset:function(){},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},getActiveMenu:function(){return this.activeMenu}};b.fn.concreteMenu=function(a){return b.each(b(this),function(){new d(b(this),a)})},a.ConcreteMenu=d,a.ConcreteMenuManager=e}(this,$,_),String.prototype.score=function(a,b){if(b=b||0,0==a.length)return.9;if(a.length>this.length)return 0;for(var c=a.length;c>0;c--){var d=a.substring(0,c),e=this.indexOf(d);if(!(0>e||e+a.length>this.length+b)){var f=this.substring(e+d.length),g=null;g=c>=a.length?"":a.substring(c);var h=f.score(g,b+e);if(h>0){var i=this.length-f.length;if(0!=e){var j=0,k=this.charCodeAt(e-1);if(32==k||9==k)for(var j=e-2;j>=0;j--)k=this.charCodeAt(j),i-=32==k||9==k?1:.15;else i-=e}return i+=h*f.length,i/=this.length}}}return 0},ccm_openThemeLauncher=function(){jQuery.fn.dialog.closeTop(),jQuery.fn.dialog.showLoader(),ccm_testMarketplaceConnection(function(){$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/themes",width:"905",modal:!1,height:"410"})},"open_theme_launcher")},ccm_testMarketplaceConnection=function(a,b,c){mpIDStr=c?"&mpID="+c:"",b||(b=""),params={mpID:c},$.getJSON(CCM_TOOLS_PATH+"/marketplace/connect",params,function(c){return c.isConnected?void a():($.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/frame?task="+b+mpIDStr,width:"90%",modal:!1,height:"70%"}),!1)})},ccm_openAddonLauncher=function(){jQuery.fn.dialog.closeTop(),jQuery.fn.dialog.showLoader(),ccm_testMarketplaceConnection(function(){$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/add-ons",width:"905",modal:!1,height:"410"})},"open_addon_launcher")},ccm_setupMarketplaceDialogForm=function(){$(".ccm-pane-dialog-pagination").each(function(){$(this).closest(".ui-dialog-content").dialog("option","buttons",[{}]),$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane .ccm-pane-dialog-pagination").remove(),$(this).appendTo($(this).closest(".ui-dialog").find(".ui-dialog-buttonpane").addClass("ccm-ui"))}),$(".ccm-pane-dialog-pagination a").click(function(){return jQuery.fn.dialog.showLoader(),$("#ccm-marketplace-browser-form").closest(".ui-dialog-content").load($(this).attr("href"),function(){jQuery.fn.dialog.hideLoader()}),!1}),ccm_marketplaceBrowserInit(),$("#ccm-marketplace-browser-form").ajaxForm({beforeSubmit:function(){jQuery.fn.dialog.showLoader()},success:function(a){jQuery.fn.dialog.hideLoader(),$("#ccm-marketplace-browser-form").closest(".ui-dialog-content").html(a)}})},ccm_marketplaceBrowserInit=function(){$(".ccm-marketplace-item").click(function(){ccm_getMarketplaceItemDetails($(this).attr("mpID"))}),$(".ccm-marketplace-item-thumbnail").mouseover(function(){var a=$(this).parent().find("div.ccm-marketplace-results-image-hover").clone().addClass("ccm-marketplace-results-image-hover-displayed").appendTo(document.body),b=$(this).offset().top,c=$(this).offset().left;c+=60,a.css("top",b).css("left",c),a.show()}),$(".ccm-marketplace-item-thumbnail").mouseout(function(){$(".ccm-marketplace-results-image-hover-displayed").hide().remove()})},ccm_getMarketplaceItemDetails=function(a){jQuery.fn.dialog.showLoader(),$("#ccm-intelligent-search-results").hide(),ccm_testMarketplaceConnection(function(){$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/details?mpID="+a,width:820,appendButtons:!0,modal:!1,height:640})},"get_item_details",a)},ccm_getMarketplaceItem=function(a){var b=a.mpID,c=a.closeTop;this.onComplete=function(){},a.onComplete&&(ccm_getMarketplaceItem.onComplete=a.onComplete),c&&jQuery.fn.dialog.closeTop(),jQuery.fn.dialog.showLoader(),params={mpID:b},$.getJSON(CCM_TOOLS_PATH+"/marketplace/connect",params,function(a){jQuery.fn.dialog.hideLoader(),$.fn.dialog.open(a.isConnected?a.purchaseRequired?{title:ccmi18n.communityCheckout,iframe:!0,href:CCM_TOOLS_PATH+"/marketplace/checkout?mpID="+b,width:"560px",modal:!1,height:"400px"}:{title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/download?install=1&mpID="+b,width:500,appendButtons:!0,modal:!1,height:400}:{title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/frame?task=get&mpID="+b,width:"90%",modal:!1,height:"70%"})})},!function(a,b){"use strict";function c(a,c){c=c||{},c=b.extend({result:{},onLoad:!1,onUpdateResults:!1},c),this.$element=a,this.$results=a.find("div[data-search-element=results]"),this.$resultsTableBody=this.$results.find("tbody"),this.$resultsTableHead=this.$results.find("thead"),this.$resultsPagination=this.$results.find("div.ccm-search-results-pagination"),this.$menuTemplate=a.find("script[data-template=search-results-menu]"),this.$searchFieldRowTemplate=a.find("script[data-template=search-field-row]"),this.options=c,this._templateSearchForm=_.template(a.find("script[data-template=search-form]").html()),this._templateSearchResultsTableHead=_.template(a.find("script[data-template=search-results-table-head]").html()),this._templateSearchResultsTableBody=_.template(a.find("script[data-template=search-results-table-body]").html()),this._templateSearchResultsPagination=_.template(a.find("script[data-template=search-results-pagination]").html()),this.$menuTemplate.length&&(this._templateSearchResultsMenu=_.template(this.$menuTemplate.html())),this.$searchFieldRowTemplate.length&&(this._templateAdvancedSearchFieldRow=_.template(this.$searchFieldRowTemplate.html())),this.setupSearch(),this.setupCheckboxes(),this.setupBulkActions(),this.setupSort(),this.setupPagination(),this.setupAdvancedSearch(),this.setupCustomizeColumns(),this.updateResults(c.result),c.onLoad&&c.onLoad(this)}c.prototype.ajaxUpdate=function(a,c,d){var e=this;b.concreteAjax({url:a,data:c,success:function(a){d?d(a):e.updateResults(a)}})},c.prototype.createMenu=function(a){a.concreteMenu({menu:b("[data-search-menu="+a.attr("data-launch-search-menu")+"]")})},c.prototype.setupMenus=function(a){var c=this;c._templateSearchResultsMenu&&(c.$element.find("[data-search-menu]").remove(),b.each(a.items,function(a,b){c.$results.append(c._templateSearchResultsMenu({item:b}))}),c.$element.find("tbody tr").each(function(){c.createMenu(b(this))}))},c.prototype.setupCustomizeColumns=function(){var a=this;a.$element.on("click","a[data-search-toggle=customize]",function(){var c=b(this).attr("data-search-column-customize-url");return b.fn.dialog.open({width:480,height:400,href:c,modal:!0,title:ccmi18n.customizeSearch,onOpen:function(){var c=b("form[data-dialog-form=search-customize"),d=c.find("select[data-search-select-default-column]"),e=c.find("ul[data-search-column-list]");b("ul[data-search-column-list]").sortable({cursor:"move",opacity:.5}),c.on("click","input[type=checkbox]",function(){var a=b(this).parent().find("span").html(),f=b(this).attr("id");b(this).prop("checked")?0==c.find("li[data-field-order-column="+f+"]").length&&(d.append(b("<option>",{value:f,text:a})),d.prop("disabled",!1),e.append('<li data-field-order-column="'+f+'"><input type="hidden" name="column[]" value="'+f+'" />'+a+"</li>")):(e.find("li[data-field-order-column="+f+"]").remove(),d.find("option[value="+f+"]").remove(),0==e.find("li").length&&d.prop("disabled",!0))}),ConcreteEvent.subscribe("AjaxFormSubmitSuccess",function(b,c){a.updateResults(c.response.result)})}}),!1})},c.prototype.updateResults=function(a){var c=this,d=c.options;c.$resultsTableHead.html(c._templateSearchResultsTableHead({columns:a.columns})),c.$resultsTableBody.html(c._templateSearchResultsTableBody({items:a.items})),c.$resultsPagination.html(c._templateSearchResultsPagination({pagination:a.pagination})),c.$advancedFields.html(""),b.each(a.fields,function(a,b){c.$advancedFields.append(c._templateAdvancedSearchFieldRow({field:b}))}),c.setupMenus(a),d.onUpdateResults&&d.onUpdateResults(this)},c.prototype.setupAdvancedSearch=function(){var a=this;a.$advancedFields=a.$element.find("div.ccm-search-fields-advanced"),a.$element.on("click","a[data-search-toggle=advanced]",function(){return a.$advancedFields.append(a._templateAdvancedSearchFieldRow()),!1}),a.$element.on("change","select[data-search-field]",function(){var c=b(this).parent().find(".ccm-search-field-content");c.html("");var d=b(this).find(":selected").attr("data-search-field-url");d&&a.ajaxUpdate(d,!1,function(a){c.html(a.html)})}),a.$element.on("click","a[data-search-remove=search-field]",function(){var a=b(this).parent();return a.remove(),!1})},c.prototype.setupSort=function(){var a=this;this.$element.on("click","thead th a",function(){return a.ajaxUpdate(b(this).attr("href")),!1})},c.prototype.refreshResults=function(){var a=this;a.$element.find("form[data-search-form]").trigger("submit")},c.prototype.setupSearch=function(){var a=this;a.$element.find("[data-search-element=wrapper]").html(a._templateSearchForm()),a.$element.on("submit","form[data-search-form]",function(){var c=b(this).serializeArray();return c.push({name:"submitSearch",value:"1"}),a.ajaxUpdate(b(this).attr("action"),c),!1})},c.prototype.handleSelectedBulkAction=function(a,c,d,e){var f=this,g=[];b.each(e,function(a,c){g.push({name:"item[]",value:b(c).val()})}),"dialog"==c&&jQuery.fn.dialog.open({width:d.attr("data-bulk-action-dialog-width"),height:d.attr("data-bulk-action-dialog-height"),modal:!0,href:d.attr("data-bulk-action-url")+"?"+jQuery.param(g),title:d.attr("data-bulk-action-title")}),f.publish("SearchBulkActionSelect",{value:a,option:d,items:e})},c.prototype.publish=function(a,b){var c=this;ConcreteEvent.publish(a,b,c)},c.prototype.subscribe=function(a,b){var c=this;ConcreteEvent.subscribe(a,b,c)},c.prototype.setupBulkActions=function(){var a=this;a.$bulkActions=a.$element.find("select[data-bulk-action]"),a.$element.on("change","select[data-bulk-action]",function(){var c=b(this).find("option:selected"),d=c.val(),e=c.attr("data-bulk-action-type");a.handleSelectedBulkAction(d,e,c,a.$element.find("input[data-search-checkbox=individual]:checked"))})},c.prototype.setupPagination=function(){var a=this;this.$element.on("click","ul.pagination a",function(){return a.ajaxUpdate(b(this).attr("href")),!1})},c.prototype.setupCheckboxes=function(){var a=this;a.$element.on("click","input[data-search-checkbox=select-all]",function(){a.$element.find("input[data-search-checkbox=individual]").prop("checked",b(this).is(":checked")).trigger("change")}),a.$element.on("change","input[data-search-checkbox=individual]",function(){a.$element.find("input[data-search-checkbox=individual]:checked").length?a.$bulkActions.prop("disabled",!1):a.$bulkActions.prop("disabled",!0)})},b.fn.concreteAjaxSearch=function(a){return new c(this,a)},a.ConcreteAjaxSearch=c}(this,$),ccm_triggerProgressiveOperation=function(a,b,c,d,e){jQuery.fn.dialog.showLoader(),$("#ccm-dialog-progress-bar").remove(),$.ajax({url:a,type:"POST",data:b,success:function(f){jQuery.fn.dialog.hideLoader(),$('<div id="ccm-dialog-progress-bar" />').appendTo(document.body).html(f).jqdialog({autoOpen:!1,height:200,width:400,modal:!0,title:c,closeOnEscape:!1,open:function(){$(".ui-dialog-titlebar-close",this.parentNode).hide();var c=$("#ccm-progressive-operation-progress-bar").attr("data-total-items");ccm_doProgressiveOperation(a,b,c,d,e)}}),$("#ccm-dialog-progress-bar").jqdialog("open")}})},ccm_doProgressiveOperation=function(a,b,c,d,e){b.push({name:"process",value:"1"}),b.process=!0,$.ajax({url:a,dataType:"json",type:"POST",data:b,error:function(a,b){switch(b){case"timeout":var c=ccmi18n.requestTimeout;break;default:var c=a.responseText}$("#ccm-dialog-progress-bar").dialog("option","height",200),$("#ccm-dialog-progress-bar").dialog("option","closeOnEscape",!0),$("#ccm-progressive-operation-progress-bar").html('<div class="alert alert-error">'+c+"</div>"),$(".ui-dialog-titlebar-close").show()},success:function(f){if(f.error){var g=f.message;$("#ccm-dialog-progress-bar").dialog("option","height",200),$("#ccm-dialog-progress-bar").dialog("option","closeOnEscape",!0),$("#ccm-progressive-operation-progress-bar").html('<div class="alert alert-error">'+g+"</div>"),$(".ui-dialog-titlebar-close").show(),"function"==typeof e&&e(f)}else{var h=f.totalItems,i=Math.round((c-h)/c*100);$("#ccm-progressive-operation-status").html(1),c-h>0&&$("#ccm-progressive-operation-status").html(c-h),$("#ccm-progressive-operation-progress-bar div.bar").width(i+"%"),h>0?setTimeout(function(){ccm_doProgressiveOperation(a,b,c,d,e)},250):setTimeout(function(){$("#ccm-progressive-operation-progress-bar div.bar").width("0%"),$("#ccm-dialog-progress-bar").dialog("close"),"function"==typeof d&&d(f)},1e3)}}})};var ccmCustomStyle={tabs:function(a,b){return $(".ccm-styleEditPane").hide(),$("#ccm-styleEditPane-"+b).show(),$(a.parentNode.parentNode).find("li").removeClass("ccm-nav-active"),$(a.parentNode).addClass("ccm-nav-active"),!1},resetAll:function(){return confirm(ccmi18n.confirmCssReset)?(jQuery.fn.dialog.showLoader(),$("#ccm-reset-style").val(1),$("#ccmCustomCssForm").get(0).submit(),!0):!1},showPresetDeleteIcon:function(){$("select[name=cspID]").val()>0?$("#ccm-style-delete-preset").show():$("#ccm-style-delete-preset").hide()},deletePreset:function(){var a=$("select[name=cspID]").val();if(a>0){if(!confirm(ccmi18n.confirmCssPresetDelete))return!1;var b=$("#ccm-custom-style-refresh-action").val()+"&deleteCspID="+a+"&subtask=delete_custom_style_preset";jQuery.fn.dialog.showLoader(),$.get(b,function(a){$("#ccm-custom-style-wrapper").html(a),jQuery.fn.dialog.hideLoader()})}},initForm:function(){$("#cspFooterPreset").length>0&&$("#ccmCustomCssFormTabs input, #ccmCustomCssFormTabs select, #ccmCustomCssFormTabs textarea").bind("change click",function(){$("#cspFooterPreset").show(),$("#cspFooterNoPreset").remove(),$("#ccmCustomCssFormTabs input, #ccmCustomCssFormTabs select").unbind("change click")
}),$("input[name=cspPresetAction]").click(function(){"create_new_preset"==$(this).val()&&$(this).prop("checked")?$("input[name=cspName]").attr("disabled",!1).focus():$("input[name=cspName]").val("").attr("disabled",!0)}),ccmCustomStyle.showPresetDeleteIcon(),ccmCustomStyle.lastPresetID=parseInt($("select[name=cspID]").val()),$("select[name=cspID]").change(function(){var a=parseInt($(this).val()),b=parseInt($("input[name=selectedCsrID]").val());if(ccmCustomStyle.lastPresetID==a)return!1;if(ccmCustomStyle.lastPresetID=a,jQuery.fn.dialog.showLoader(),a>0)var c=$("#ccm-custom-style-refresh-action").val()+"&cspID="+a;else var c=$("#ccm-custom-style-refresh-action").val()+"&csrID="+b;$.get(c,function(a){$("#ccm-custom-style-wrapper").html(a),jQuery.fn.dialog.hideLoader()})}),$("#ccmCustomCssForm").submit(function(){return 1==$("input[name=cspCreateNew]").prop("checked")&&""==$("input[name=cspName]").val()?($("input[name=cspName]").focus(),alert(ccmi18n.errorCustomStylePresetNoName),!1):(jQuery.fn.dialog.showLoader(),!0)}),parseInt(ccmCustomStyle.lastPresetID)||setTimeout('$("#ccmCustomCssFormTabs input").attr("disabled", false).get(0).focus()',500)},validIdCheck:function(a,b){var c=$("#"+a.value);c&&c.get(0)&&c.get(0).id!=b?$("#ccm-styles-invalid-id").css("display","block"):$("#ccm-styles-invalid-id").css("display","none")}};ccm_activateTabBar=function(a){$("#ccm-tab-content-"+a.find("li[class=active] a").attr("data-tab")).show(),a.find("a").unbind().click(function(){a.find("li").removeClass("active"),$(this).parent().addClass("active"),a.find("a").each(function(){$("#ccm-tab-content-"+$(this).attr("data-tab")).hide()});var b=$(this).attr("data-tab");return $("#ccm-tab-content-"+b).show(),!1})};var ConcreteToolbar=function(){var a,b,c=$("#ccm-toolbar"),d=$("#ccm-nav-intelligent-search"),e=$("#ccm-intelligent-search-results");return setupHelpNotifications=function(){$(document.body).on("click","a[data-dismiss]",function(){var a="help-all"==$(this).attr("data-dismiss")?"all":"this";return $(this).parentsUntil(".ccm-notification-help").parent().queue(function(){$(this).addClass("animated fadeOut"),$(this).dequeue()}).delay(500).queue(function(){$(this).remove(),$(this).dequeue()}),$.ajax({type:"post",data:{type:$(this).attr("data-help-notification-type"),identifier:$(this).attr("data-help-notification-identifier"),action:a,ccm_token:CCM_SECURITY_TOKEN},url:CCM_TOOLS_PATH+"/help/dismiss",success:function(){}}),!1})},setupPageAlerts=function(){$(document.body).on("click","a[data-dismiss-alert=page-alert]",function(a){return a.stopPropagation(),$("#ccm-notification-page-alert").queue(function(){$(this).addClass("animated fadeOut"),$(this).dequeue()}).delay(500).queue(function(){$(this).remove(),$(this).dequeue()}),!1}),$("#ccm-notification-page-alert form").ajaxForm({dataType:"json",beforeSubmit:function(){jQuery.fn.dialog.showLoader()},success:function(a){a.redirect&&(window.location.href=a.redirect)}})},setupTooltips=function(){0==$("#ccm-tooltip-holder").length&&$("<div />").attr("id","ccm-tooltip-holder").attr("class","ccm-ui").prependTo(document.body),$(".launch-tooltip").tooltip({container:"#ccm-tooltip-holder"})},setupChosen=function(){$(".chosen-select").chosen()},setupPanels=function(){$("<div />",{id:"ccm-panel-overlay"}).appendTo($(document.body)),$("[data-launch-panel]").unbind().on("click",function(){var a=$(this).attr("data-launch-panel");$(this).toggleClass("ccm-launch-panel-active");var b=ConcretePanelManager.getByIdentifier(a);return b.toggle(),!1}),$("html").addClass("ccm-panel-ready"),ConcreteEvent.subscribe("PanelOpen",function(a,b){var c=b.panel;"page"==c.options.identifier&&$("#"+c.getDOMID()).find("[data-launch-panel-detail='page-composer']").click(),$("a[data-toolbar-action=check-in]").on("click.close-check-in",function(){return ConcretePanelManager.exitPanelMode(),!1})}),ConcreteEvent.subscribe("PanelClose",function(){$("a[data-toolbar-action=check-in]").unbind("click.close-check-in")})},setupIntelligentSearch=function(){d.bind("keydown.ccm-intelligent-search",function(a){if(13==a.keyCode||40==a.keyCode||38==a.keyCode){if(a.preventDefault(),a.stopPropagation(),13==a.keyCode&&$("a.ccm-intelligent-search-result-selected").length>0){var b=$("a.ccm-intelligent-search-result-selected").attr("href");b&&"#"!=b&&"javascript:void(0)"!=b?window.location.href=b:$("a.ccm-intelligent-search-result-selected").click()}var c,d=$("#ccm-intelligent-search-results li:visible");(40==a.keyCode||38==a.keyCode)&&($.each(d,function(b,e){$(e).children("a").hasClass("ccm-intelligent-search-result-selected")&&(io=38==a.keyCode?d[b-1]:d[b+1],c=$(io).find("a"))}),c&&c.length>0&&($("a.ccm-intelligent-search-result-selected").removeClass(),$(c).addClass("ccm-intelligent-search-result-selected")))}}),d.liveUpdate("ccm-intelligent-search-results","intelligent-search"),d.bind("keyup.ccm-intelligent-search",function(){doRemoteSearchCall($(this).val())}),d.bind("click",function(){""==this.value&&e.hide()})},setupMobileNav=function(){$(".ccm-toolbar-mobile-menu-button").click(function(){$(this).toggleClass("ccm-mobile-close"),$(".ccm-mobile-menu-overlay").slideToggle()}),$(".ccm-mobile-menu-overlay .parent-ul a").click(function(a){$(this).parent("li").hasClass("last-li")||($(this).parent("li").siblings().children("ul").hide(),$(this).parent("li").children("ul").is(":visible")||($(this).next("ul").show(),a.preventDefault()))})},activateIntelligentSearchResults=function(){0==$("#ccm-intelligent-search-results div:visible").length&&$("#ccm-intelligent-search-results").hide(),$("#ccm-intelligent-search-results a").hover(function(){$("a.ccm-intelligent-search-result-selected").removeClass(),$(this).addClass("ccm-intelligent-search-result-selected")},function(){$(this).removeClass("ccm-intelligent-search-result-selected")})},doRemoteSearchCall=function(c){if(c=jQuery.trim(c),c&&c.length>2){if(c==a)return;b&&window.clearTimeout(b),a=c,b=window.setTimeout(function(){b=null,$("#ccm-intelligent-search-results-list-marketplace").parent().show(),$("#ccm-intelligent-search-results-list-help").parent().show(),$("#ccm-intelligent-search-results-list-your-site").parent().show(),$("#ccm-intelligent-search-results-list-marketplace").parent().addClass("ccm-intelligent-search-results-module-loading"),$("#ccm-intelligent-search-results-list-help").parent().addClass("ccm-intelligent-search-results-module-loading"),$("#ccm-intelligent-search-results-list-your-site").parent().addClass("ccm-intelligent-search-results-module-loading"),$.getJSON(CCM_TOOLS_PATH+"/marketplace/intelligent_search",{q:a},function(a){for($("#ccm-intelligent-search-results-list-marketplace").parent().removeClass("ccm-intelligent-search-results-module-loading"),$("#ccm-intelligent-search-results-list-marketplace").html(""),i=0;i<a.length;i++){var b=a[i],c="ccm_getMarketplaceItemDetails("+b.mpID+")";$("#ccm-intelligent-search-results-list-marketplace").append('<li><a href="javascript:void(0)" onclick="'+c+'"><img src="'+b.img+'" />'+b.name+"</a></li>")}0==a.length&&$("#ccm-intelligent-search-results-list-marketplace").parent().hide(),0==$(".ccm-intelligent-search-result-selected").length&&($("#ccm-intelligent-search-results").find("li a").removeClass("ccm-intelligent-search-result-selected"),$("#ccm-intelligent-search-results li:visible a:first").addClass("ccm-intelligent-search-result-selected")),activateIntelligentSearchResults()}).error(function(){$("#ccm-intelligent-search-results-list-marketplace").parent().hide()}),$.getJSON(CCM_TOOLS_PATH+"/get_remote_help",{q:a},function(a){for($("#ccm-intelligent-search-results-list-help").parent().removeClass("ccm-intelligent-search-results-module-loading"),$("#ccm-intelligent-search-results-list-help").html(""),i=0;i<a.length;i++){var b=a[i];$("#ccm-intelligent-search-results-list-help").append('<li><a href="'+b.href+'">'+b.name+"</a></li>")}0==a.length&&$("#ccm-intelligent-search-results-list-help").parent().hide(),0==$(".ccm-intelligent-search-result-selected").length&&($("#ccm-intelligent-search-results").find("li a").removeClass("ccm-intelligent-search-result-selected"),$("#ccm-intelligent-search-results li:visible a:first").addClass("ccm-intelligent-search-result-selected")),activateIntelligentSearchResults()}).error(function(){$("#ccm-intelligent-search-results-list-help").parent().hide()}),$.getJSON(CCM_TOOLS_PATH+"/pages/intelligent_search",{q:a},function(a){for($("#ccm-intelligent-search-results-list-your-site").parent().removeClass("ccm-intelligent-search-results-module-loading"),$("#ccm-intelligent-search-results-list-your-site").html(""),i=0;i<a.length;i++){var b=a[i];$("#ccm-intelligent-search-results-list-your-site").append('<li><a href="'+b.href+'">'+b.name+"</a></li>")}0==a.length&&$("#ccm-intelligent-search-results-list-your-site").parent().hide(),0==$(".ccm-intelligent-search-result-selected").length&&($("#ccm-intelligent-search-results").find("li a").removeClass("ccm-intelligent-search-result-selected"),$("#ccm-intelligent-search-results li:visible a:first").addClass("ccm-intelligent-search-result-selected")),activateIntelligentSearchResults()}).error(function(){$("#ccm-intelligent-search-results-list-your-site").parent().hide()})},500)}},{start:function(){c.length>0&&(c.find(".dialog-launch").dialog(),setupIntelligentSearch(),setupPanels(),setupTooltips(),setupChosen(),setupPageAlerts(),setupHelpNotifications(),setupMobileNav(),$("#ccm-toolbar-menu-dashboard").on("click",function(a){a.stopPropagation()}))},disable:function(){$("#ccm-toolbar-disabled").remove(),$("<div />",{id:"ccm-toolbar-disabled"}).appendTo(document.body),setTimeout(function(){$("#ccm-toolbar-disabled").css("opacity",1)},10)},enable:function(){$("#ccm-toolbar-disabled").remove()},disableDirectExit:function(){var a=$("li.ccm-toolbar-page-edit a");"check-in"!=a.attr("data-launch-panel")&&a.attr("data-launch-panel","check-in").on("click",function(){$(this).toggleClass("ccm-launch-panel-active");var a=ConcretePanelManager.getByIdentifier("check-in");return a.toggle(),!1})}}}();ccm_marketplaceDetailShowMore=function(){$(".ccm-marketplace-item-information-more").hide(),$(".ccm-marketplace-item-information-inner").css("max-height","none")},ccm_marketplaceUpdatesShowMore=function(a){$(a).parent().hide(),$(a).parent().parent().find(".ccm-marketplace-update-changelog").css("max-height","none")},ccm_enableDesignScrollers=function(){$("a.ccm-scroller-l").hover(function(){$(this).find("img").attr("src",CCM_IMAGE_PATH+"/button_scroller_l_active.png")},function(){$(this).find("img").attr("src",CCM_IMAGE_PATH+"/button_scroller_l.png")}),$("a.ccm-scroller-r").hover(function(){$(this).find("img").attr("src",CCM_IMAGE_PATH+"/button_scroller_r_active.png")},function(){$(this).find("img").attr("src",CCM_IMAGE_PATH+"/button_scroller_r.png")});var a=4,b=132;$("a.ccm-scroller-r").unbind("click"),$("a.ccm-scroller-l").unbind("click"),$("a.ccm-scroller-r").click(function(){var c=$(this).parent().children("div.ccm-scroller-inner").children("ul"),d=$(this).parent().attr("current-page"),e=$(this).parent().attr("current-pos"),f=$(this).parent().attr("num-pages"),g=a*b;e=parseInt(e)-g,d++,$(this).parent().attr("current-page",d),$(this).parent().attr("current-pos",e),d==f&&$(this).hide(),d>1&&$(this).siblings("a.ccm-scroller-l").show(),$(c).css("left",e+"px")}),$("a.ccm-scroller-l").click(function(){var c=$(this).parent().children("div.ccm-scroller-inner").children("ul"),d=$(this).parent().attr("current-page"),e=$(this).parent().attr("current-pos"),f=$(this).parent().attr("num-pages"),g=a*b;e=parseInt(e)+g,d--,$(this).parent().attr("current-page",d),$(this).parent().attr("current-pos",e),1==d&&$(this).hide(),f>d&&$(this).siblings("a.ccm-scroller-r").show(),$(c).css("left",e+"px")}),$("a.ccm-scroller-l").hide(),$("a.ccm-scroller-r").each(function(){1==parseInt($(this).parent().attr("num-pages"))&&$(this).hide()}),$("#ccm-select-page-type a").click(function(){$("#ccm-select-page-type li").each(function(){$(this).removeClass("ccm-item-selected")}),$(this).parent().addClass("ccm-item-selected"),$("input[name=ptID]").val($(this).attr("ccm-page-type-id"))}),$("#ccm-select-theme a").click(function(){$("#ccm-select-theme li").each(function(){$(this).removeClass("ccm-item-selected")}),$(this).parent().addClass("ccm-item-selected"),$("input[name=plID]").val($(this).attr("ccm-theme-id"))})};