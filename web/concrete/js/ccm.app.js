function ccmLayout(areaNameNumber,cvalID,layout_id,area,locked){this.layout_id=layout_id;this.cvalID=cvalID;this.locked=locked;this.area=area;this.areaNameNumber=areaNameNumber;this.init=function(){var e=this;this.layoutWrapper=$("#ccm-layout-wrapper-"+this.cvalID);this.ccmControls=this.layoutWrapper.find("#ccm-layout-controls-"+this.cvalID);this.ccmControls.get(0).layoutObj=this;this.ccmControls.mouseover(function(){e.dontUpdateTwins=0;e.highlightAreas(1)});this.ccmControls.mouseout(function(){e.moving||e.highlightAreas(0)});this.ccmControls.find(".ccm-layout-menu-button").click(function(t){e.optionsMenu(t)});this.gridSizing()};this.highlightAreas=function(e){var t=this.layoutWrapper.find(".ccm-add-block");e?t.addClass("ccm-layout-area-highlight"):t.removeClass("ccm-layout-area-highlight")};this.optionsMenu=function(e){ccm_hideMenus();e.stopPropagation();ccm_menuActivated=!0;var t=document.getElementById("ccm-layout-options-menu-"+this.cvalID);if(!t){el=document.createElement("DIV");el.id="ccm-layout-options-menu-"+this.cvalID;el.className="ccm-menu ccm-ui";el.style.display="none";document.body.appendChild(el);t=$(el);t.css("position","absolute");var n='<div class="popover"><div class="arrow"></div><div class="inner"><div class="content">';n+="<ul>";n+='<li><a onclick="ccm_hideMenus()" class="ccm-menu-icon ccm-icon-edit-menu" dialog-title="'+ccmi18n.editAreaLayout+'" dialog-modal="false" dialog-width="550" dialog-height="280" dialog-append-buttons="true" id="menuEditLayout'+this.cvalID+'" href="'+CCM_TOOLS_PATH+"/edit_area_popup.php?cID="+CCM_CID+"&arHandle="+encodeURIComponent(this.area)+"&layoutID="+this.layout_id+"&cvalID="+this.cvalID+'&atask=layout">'+ccmi18n.editAreaLayout+"</a></li>";n+='<li><a onclick="ccm_hideMenus()" href="javascript:void(0)" class="ccm-menu-icon ccm-icon-move-up" id="menuAreaLayoutMoveUp'+this.cvalID+'">'+ccmi18n.moveLayoutUp+"</a></li>";n+='<li><a onclick="ccm_hideMenus()" href="javascript:void(0)" class="ccm-menu-icon ccm-icon-move-down" id="menuAreaLayoutMoveDown'+this.cvalID+'">'+ccmi18n.moveLayoutDown+"</a></li>";var r=this.locked?ccmi18n.unlockAreaLayout:ccmi18n.lockAreaLayout;n+='<li><a onclick="ccm_hideMenus()" href="javascript:void(0)" class="ccm-menu-icon ccm-icon-lock-menu" id="menuAreaLayoutLock'+this.cvalID+'">'+r+"</a></li>";n+='<li><a onclick="ccm_hideMenus()" href="javascript:void(0)" class="ccm-menu-icon ccm-icon-delete-menu" dialog-append-buttons="true" id="menuAreaLayoutDelete'+this.cvalID+'">'+ccmi18n.deleteLayout+"</a></li>";n+="</ul>";n+="</div></div></div>";t.append(n);var i=$(t),s=this;i.find("#menuEditLayout"+this.cvalID).dialog();i.find("#menuAreaLayoutMoveUp"+this.cvalID).click(function(){s.moveLayout("up")});i.find("#menuAreaLayoutMoveDown"+this.cvalID).click(function(){s.moveLayout("down")});i.find("#menuAreaLayoutLock"+this.cvalID).click(function(){s.lock()});i.find("#menuAreaLayoutDelete"+this.cvalID).click(function(){s.deleteLayoutOptions()})}else t=$("#ccm-layout-options-menu-"+this.cvalID);ccm_fadeInMenu(t,e)};this.moveLayout=function(direction){this.moving=1;ccm_hideHighlighter();this.highlightAreas(1);this.servicesAjax=$.ajax({url:CCM_TOOLS_PATH+"/layout_services/?cID="+CCM_CID+"&arHandle="+encodeURIComponent(this.area)+"&layoutID="+this.layout_id+"&cvalID="+this.cvalID+"&task=move&direction="+direction+"&areaNameNumber="+this.areaNameNumber,success:function(response){eval("var jObj="+response);parseInt(jObj.success)!=1?alert(jObj.msg):ccm_mainNavDisableDirectExit()}});var el=$("#ccm-layout-wrapper-"+this.cvalID),layoutObj=this;if(direction=="down"){var nextLayout=el.next();if(nextLayout.hasClass("ccm-layout-wrapper")){el.slideUp(600,function(){el.insertAfter(nextLayout);el.slideDown(600,function(){layoutObj.highlightAreas(0);layoutObj.moving=0})});return}ccmAlert.hud(ccmi18n.moveLayoutAtBoundary,4e3,"icon_move_down",ccmi18n.moveLayoutDown)}else if(direction=="up"){var previousLayout=el.prev();if(previousLayout.hasClass("ccm-layout-wrapper")){el.slideUp(600,function(){el.insertBefore(previousLayout);el.slideDown(600,function(){layoutObj.highlightAreas(0);layoutObj.moving=0})});return}ccmAlert.hud(ccmi18n.moveLayoutAtBoundary,4e3,"icon_move_up",ccmi18n.moveLayoutUp)}};this.lock=function(lock,twinLock){var a=$("#menuAreaLayoutLock"+this.cvalID);this.locked=!this.locked;if(this.locked){a.html(ccmi18n.unlockAreaLayout);this.s&&this.s.slider("disable")}else{a.find("span").html(ccmi18n.lockAreaLayout);this.s&&this.s.slider("enable")}var lock=this.locked?1:0;if(!twinLock){this.servicesAjax=$.ajax({url:CCM_TOOLS_PATH+"/layout_services/?cID="+CCM_CID+"&arHandle="+encodeURIComponent(this.area)+"&layoutID="+this.layout_id+"&task=lock&lock="+lock,success:function(response){eval("var jObj="+response);parseInt(jObj.success)!=1&&alert(jObj.msg)}});this.getTwins();for(var i=0;i<this.layoutTwinObjs.length;i++)this.layoutTwinObjs[i].lock(lock,1)}};this.hasBeenQuickSaved=0;this.quickSaveLayoutId=0;this.quickSave=function(){var breakPoints=this.ccmControls.find("#layout_col_break_points_"+this.cvalID).val().replace(/%/g,"");clearTimeout(this.secondSavePauseTmr);if(!this.hasBeenQuickSaved&&this.quickSaveInProgress){quickSaveLayoutObj=this;this.secondSavePauseTmr=setTimeout("quickSaveLayoutObj.quickSave()",100);return}this.quickSaveInProgress=1;var layoutObj=this,modifyLayoutId=this.quickSaveLayoutId?this.quickSaveLayoutId:this.layout_id;this.quickSaveAjax=$.ajax({url:CCM_TOOLS_PATH+"/layout_services/?cID="+CCM_CID+"&arHandle="+encodeURIComponent(this.area)+"&layoutID="+modifyLayoutId+"&task=quicksave&breakpoints="+encodeURIComponent(breakPoints),success:function(response){eval("var jObj="+response);if(parseInt(jObj.success)!=1)alert(jObj.msg);else{layoutObj.hasBeenQuickSaved=1;layoutObj.quickSaveInProgress=0;jObj.layoutID&&(layoutObj.quickSaveLayoutId=jObj.layoutID);ccm_mainNavDisableDirectExit()}}})};this.deleteLayoutOptions=function(){var e=0;deleteLayoutObj=this;this.layoutWrapper.find(".ccm-block").each(function(t,n){n.style.display!="none"&&(e=1)});var t=e?"135px":"70px";$.fn.dialog.open({title:ccmi18n.deleteLayoutOptsTitle,href:CCM_TOOLS_PATH+"/layout_services/?cID="+CCM_CID+"&arHandle="+encodeURIComponent(this.area)+"&layoutID="+this.layout_id+"&task=deleteOpts&hasBlocks="+e,width:"340px",modal:!1,appendButtons:!0,height:t})};this.deleteLayout=function(deleteBlocks){ccm_hideMenus();jQuery.fn.dialog.closeTop();this.layoutWrapper.slideUp(300);jQuery.fn.dialog.showLoader();var cvalID=this.cvalID;this.servicesAjax=$.ajax({url:CCM_TOOLS_PATH+"/layout_services/?cID="+CCM_CID+"&arHandle="+encodeURIComponent(this.area)+"&layoutID="+this.layout_id+"&task=delete&deleteBlocks="+parseInt(deleteBlocks)+"&areaNameNumber="+this.areaNameNumber,success:function(response){eval("var jObj="+response);if(parseInt(jObj.success)!=1){alert(jObj.msg);jQuery.fn.dialog.hideLoader()}else{$("#ccm-layout-wrapper-"+cvalID).remove();ccm_hideHighlighter();ccm_mainNavDisableDirectExit();jObj.refreshPage?window.location=window.location:jQuery.fn.dialog.hideLoader()}}})};this.gridSizing=function(){this.ccmGrid=$("#ccm-layout-"+this.layout_id);var e=parseInt(this.ccmControls.find(".layout_column_count").val());if(e>1){var t=this.ccmControls.find("#layout_col_break_points_"+this.cvalID).val().replace(/%/g,"").split("|");this.s=this.ccmControls.find(".ccm-layout-controls-slider");this.s.get(0).layoutObj=this;this.s.get(0).ccmGrid=this.ccmGrid;this.s.slider({step:1,values:t,change:function(){if(this.layoutObj.dontUpdateTwins)return;this.layoutObj.resizeGrid(this.childNodes);var e=[];for(var t=0;t<this.childNodes.length;t++)e.push(parseFloat(this.childNodes[t].style.left.replace("%","")));e.sort(function(e,t){return e-t});this.layoutObj.ccmControls.find(".layout_col_break_points").val(e.join("%|")+"%");this.layoutObj.quickSave();ccm_arrangeMode=0;this.layoutObj.moving=0;this.layoutObj.highlightAreas(0)},slide:function(){ccm_arrangeMode=1;this.layoutObj.moving=1;if(this.layoutObj.dontUpdateTwins)return;this.layoutObj.resizeGrid(this.childNodes)}});parseInt(this.ccmControls.find(".layout_locked").val())&&this.s.slider("disable")}};this.getTwins=function(){if(!this.layoutTwins){this.layoutTwins=$(".ccm-layout-controls-layoutID-"+this.layout_id).not(this.ccmControls);this.layoutTwinObjs=[];for(var e=0;e<this.layoutTwins.length;e++){this.layoutTwinObjs.push(this.layoutTwins[e].layoutObj);this.layoutTwins[e].handles=$(this.layoutTwins[e]).find(".ui-slider-handle")}}return this.layoutTwins};this.resizeGrid=function(e){var t=[];this.getTwins();for(var n=0;n<e.length;n++){var r=parseFloat(e[n].style.left.replace("%",""));t.push(r);if(!this.dontUpdateTwins)for(var i=0;i<this.layoutTwinObjs.length;i++){this.layoutTwinObjs[i].dontUpdateTwins=1;this.layoutTwinObjs[i].s.slider("values",n,r)}}t.sort(function(e,t){return e-t});var s=0,o;for(o=0;o<t.length;o++){var r=t[o],i=r-s;s+=i;$(".ccm-layout-"+this.layout_id+"-col-"+(o+1)).css("width",i+"%");if(!this.dontUpdateTwins)for(j=0;j<this.layoutTwins.length;j++)this.layoutTwins[j].handles[o].style.left=r+"%"}$(".ccm-layout-"+this.layout_id+"-col-"+(o+1)).css("width",100-s+"%")}}function fixResortingDroppables(){if(tr_reorderMode==0)return!1;var e=$(".dropzone");for(var t=0;t<e.length;t++){var n=$(e[t]).attr("id").substr(7);n.indexOf("-sub")>0&&(n=n.substr(0,n.length-4));addResortDroppable(n)}}function addResortDroppable(e){if($(".tree-branch"+e).length<=1)return;$("div.tree-dz"+e).droppable({accept:".tree-branch"+e,activeClass:"dropzone-ready",hoverClass:"dropzone-active",drop:function(e,t){var n=t.draggable;$(n).insertAfter(this);var r=$(n).attr("id").substring(9);$("#tree-dz"+r).insertAfter($(n));rescanDisplayOrder($(this).attr("tree-parent"))}})}function ccm_previewInternalTheme(e,t,n){var r=$("input[name=ctID]").val();$.fn.dialog.open({title:n,href:CCM_TOOLS_PATH+"/themes/preview?themeID="+t+"&previewCID="+e+"&ctID="+r,width:"85%",modal:!1,height:"75%"})}function ccm_previewMarketplaceTheme(e,t,n,r){var i=$("input[name=ctID]").val();$.fn.dialog.open({title:n,href:CCM_TOOLS_PATH+"/themes/preview?themeCID="+t+"&previewCID="+e+"&themeHandle="+encodeURIComponent(r)+"&ctID="+i,width:"85%",modal:!1,height:"75%"})}(function(e){var t=function(){var t={},n,r=65,i,s='<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" class="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" class="text" maxlength="3" size="3" /><span></span></div><input type="button" class="colorpicker_none" name="none" value="x" /><input type="button" class="colorpicker_submit" name="save" value="Ok" /></div>',o={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onNone:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:!0,flat:!1},u=function(t,n){var r=R(t);e(n).data("colorpicker").fields.eq(1).val(r.r).end().eq(2).val(r.g).end().eq(3).val(r.b).end()},a=function(t,n){e(n).data("colorpicker").fields.eq(4).val(t.h).end().eq(5).val(t.s).end().eq(6).val(t.b).end()},f=function(t,n){e(n).data("colorpicker").fields.eq(0).val(z(t)).end()},l=function(t,n){e(n).data("colorpicker").selector.css("backgroundColor","#"+z({h:t.h,s:100,b:100}));e(n).data("colorpicker").selectorIndic.css({left:parseInt(150*t.s/100,10),top:parseInt(150*(100-t.b)/100,10)})},c=function(t,n){e(n).data("colorpicker").hue.css("top",parseInt(150-150*t.h/360,10))},h=function(t,n){e(n).data("colorpicker").currentColor.css("backgroundColor","#"+z(t))},p=function(t,n){e(n).data("colorpicker").newColor.css("backgroundColor","#"+z(t))},d=function(t){var n=t.charCode||t.keyCode||-1;if(n>r&&n<=90||n==32)return!1;var i=e(this).parent().parent();i.data("colorpicker").livePreview===!0&&v.apply(this)},v=function(t){var n=e(this).parent().parent(),r;if(!n.data("colorpicker")||!n.data("colorpicker").fields)return;this.parentNode.className.indexOf("_hex")>0?n.data("colorpicker").color=r=I(j(this.value)):this.parentNode.className.indexOf("_hsb")>0?n.data("colorpicker").color=r=H({h:parseInt(n.data("colorpicker").fields.eq(4).val(),10),s:parseInt(n.data("colorpicker").fields.eq(5).val(),10),b:parseInt(n.data("colorpicker").fields.eq(6).val(),10)}):n.data("colorpicker").color=r=q(B({r:parseInt(n.data("colorpicker").fields.eq(1).val(),10),g:parseInt(n.data("colorpicker").fields.eq(2).val(),10),b:parseInt(n.data("colorpicker").fields.eq(3).val(),10)}));if(t){u(r,n.get(0));f(r,n.get(0));a(r,n.get(0))}l(r,n.get(0));c(r,n.get(0));p(r,n.get(0));n.data("colorpicker").onChange.apply(n,[r,z(r),R(r)])},m=function(t){var n=e(this).parent().parent(),r=n.data("colorpicker");r&&r.fields&&r.fields.parent().removeClass("colorpicker_focus")},g=function(){r=this.parentNode.className.indexOf("_hex")>0?70:65;var t=e(this).parent().parent().data("colorpicker");t&&t.fields&&t.fields.parent().removeClass("colorpicker_focus");e(this).parent().addClass("colorpicker_focus")},y=function(t){var n=e(this).parent().find("input").focus(),r={el:e(this).parent().addClass("colorpicker_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:this.parentNode.className.indexOf("_hsb")>0?100:255,y:t.pageY,field:n,val:parseInt(n.val(),10),preview:e(this).parent().parent().data("colorpicker").livePreview};e(document).bind("mouseup",r,w);e(document).bind("mousemove",r,b)},b=function(e){e.data.field.val(Math.max(0,Math.min(e.data.max,parseInt(e.data.val+e.pageY-e.data.y,10))));e.data.preview&&v.apply(e.data.field.get(0),[!0]);return!1},w=function(t){v.apply(t.data.field.get(0),[!0]);t.data.el.removeClass("colorpicker_slider").find("input").focus();e(document).unbind("mouseup",w);e(document).unbind("mousemove",b);return!1},E=function(t){var n={cal:e(this).parent(),y:e(this).offset().top};n.preview=n.cal.data("colorpicker").livePreview;e(document).bind("mouseup",n,x);e(document).bind("mousemove",n,S)},S=function(e){v.apply(e.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,e.pageY-e.data.y)))/150,10)).get(0),[e.data.preview]);return!1},x=function(t){u(t.data.cal.data("colorpicker").color,t.data.cal.get(0));f(t.data.cal.data("colorpicker").color,t.data.cal.get(0));e(document).unbind("mouseup",x);e(document).unbind("mousemove",S);return!1},T=function(t){var n={cal:e(this).parent(),pos:e(this).offset()};n.preview=n.cal.data("colorpicker").livePreview;e(document).bind("mouseup",n,C);e(document).bind("mousemove",n,N)},N=function(e){v.apply(e.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,e.pageY-e.data.pos.top)))/150,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(150,e.pageX-e.data.pos.left))/150,10)).get(0),[e.data.preview]);return!1},C=function(t){u(t.data.cal.data("colorpicker").color,t.data.cal.get(0));f(t.data.cal.data("colorpicker").color,t.data.cal.get(0));e(document).unbind("mouseup",C);e(document).unbind("mousemove",N);return!1},k=function(t){e(this).addClass("colorpicker_focus")},L=function(t){e(this).removeClass("colorpicker_focus")},A=function(t){var n=e(this).parent(),r=n.data("colorpicker").color;n.data("colorpicker").origColor=r;h(r,n.get(0));var i=e("#"+e(this).data("colorpickerId"));n.data("colorpicker").onSubmit(r,z(r),R(r),n)},O=function(t){var n=e(this).parent();n.data("colorpicker").onNone(n);n.hide()},M=function(t){var n=e("#"+e(this).data("colorpickerId"));n.data("colorpicker").onBeforeShow.apply(this,[n.get(0)]);var r=e(this).offset(),i=P(),s=r.top+this.offsetHeight,o=r.left;s+176>i.t+i.h&&(s-=this.offsetHeight+176);o+356>i.l+i.w&&(o-=356);n.css({left:o+"px",top:s+"px"});n.data("colorpicker").onShow.apply(this,[n.get(0)])!=0&&n.show();e(document).bind("mousedown",{cal:n},_);return!1},_=function(t){if(!D(t.data.cal.get(0),t.target,t.data.cal.get(0))){t.data.cal.data("colorpicker").onHide.apply(this,[t.data.cal.get(0)])!=0&&t.data.cal.hide();e(document).unbind("mousedown",_)}},D=function(e,t,n){if(e==t)return!0;if(e.contains)return e.contains(t);if(e.compareDocumentPosition)return!!(e.compareDocumentPosition(t)&16);var r=t.parentNode;while(r&&r!=n){if(r==e)return!0;r=r.parentNode}return!1},P=function(){var e=document.compatMode=="CSS1Compat";return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(e?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(e?document.documentElement.clientHeight:document.body.clientHeight)}},H=function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b))}},B=function(e){return{r:Math.min(255,Math.max(0,e.r)),g:Math.min(255,Math.max(0,e.g)),b:Math.min(255,Math.max(0,e.b))}},j=function(e){var t=6-e.length;if(t>0){var n=[];for(var r=0;r<t;r++)n.push("0");n.push(e);e=n.join("")}return e},F=function(e){var e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16);return{r:e>>16,g:(e&65280)>>8,b:e&255}},I=function(e){return q(F(e))},q=function(e){var t={};t.b=Math.max(Math.max(e.r,e.g),e.b);t.s=t.b<=0?0:Math.round(100*(t.b-Math.min(Math.min(e.r,e.g),e.b))/t.b);t.b=Math.round(t.b/255*100);e.r==e.g&&e.g==e.b?t.h=0:e.r>=e.g&&e.g>=e.b?t.h=60*(e.g-e.b)/(e.r-e.b):e.g>=e.r&&e.r>=e.b?t.h=60+60*(e.g-e.r)/(e.g-e.b):e.g>=e.b&&e.b>=e.r?t.h=120+60*(e.b-e.r)/(e.g-e.r):e.b>=e.g&&e.g>=e.r?t.h=180+60*(e.b-e.g)/(e.b-e.r):e.b>=e.r&&e.r>=e.g?t.h=240+60*(e.r-e.g)/(e.b-e.g):e.r>=e.b&&e.b>=e.g?t.h=300+60*(e.r-e.b)/(e.r-e.g):t.h=0;t.h=Math.round(t.h);return t},R=function(e){var t={},n=Math.round(e.h),r=Math.round(e.s*255/100),i=Math.round(e.b*255/100);if(r==0)t.r=t.g=t.b=i;else{var s=i,o=(255-r)*i/255,u=(s-o)*(n%60)/60;n==360&&(n=0);if(n<60){t.r=s;t.b=o;t.g=o+u}else if(n<120){t.g=s;t.b=o;t.r=s-u}else if(n<180){t.g=s;t.r=o;t.b=o+u}else if(n<240){t.b=s;t.r=o;t.g=s-u}else if(n<300){t.b=s;t.g=o;t.r=o+u}else if(n<360){t.r=s;t.g=o;t.b=s-u}else{t.r=0;t.g=0;t.b=0}}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}},U=function(t){var n=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];e.each(n,function(e,t){t.length==1&&(n[e]="0"+t)});return n.join("")},z=function(e){return U(R(e))};return{init:function(t){t=e.extend({},o,t||{});if(typeof t.color=="string")t.color=I(t.color);else if(t.color.r!=undefined&&t.color.g!=undefined&&t.color.b!=undefined)t.color=q(t.color);else{if(t.color.h==undefined||t.color.s==undefined||t.color.b==undefined)return this;t.color=H(t.color)}t.origColor=t.color;return this.each(function(){if(!e(this).data("colorpickerId")){var n="collorpicker_"+parseInt(Math.random()*1e3);e(this).data("colorpickerId",n);var r=e(s).attr("id",n);t.flat?r.appendTo(this).show():r.appendTo(document.body);t.fields=r.find("input").bind("keydown",d).bind("change",v).bind("blur",m).bind("focus",g);r.find("span").bind("mousedown",y);t.selector=r.find("div.colorpicker_color").bind("mousedown",T);t.selectorIndic=t.selector.find("div div");t.hue=r.find("div.colorpicker_hue div");r.find("div.colorpicker_hue").bind("mousedown",E);t.newColor=r.find("div.colorpicker_new_color");t.currentColor=r.find("div.colorpicker_current_color");r.data("colorpicker",t);r.find("input.colorpicker_none").bind("click",O);r.find("input.colorpicker_submit").bind("click",A);u(t.color,r.get(0));a(t.color,r.get(0));f(t.color,r.get(0));c(t.color,r.get(0));l(t.color,r.get(0));h(t.color,r.get(0));p(t.color,r.get(0));t.flat?r.css({position:"relative",display:"block"}):e(this).bind(t.eventName,M)}})},showPicker:function(){return this.each(function(){e(this).data("colorpickerId")&&M.apply(this)})},hidePicker:function(){return this.each(function(){e(this).data("colorpickerId")&&e("#"+e(this).data("colorpickerId")).hide()})},setColor:function(t){if(typeof t=="string")t=I(t);else if(t.r!=undefined&&t.g!=undefined&&t.b!=undefined)t=q(t);else{if(t.h==undefined||t.s==undefined||t.b==undefined)return this;t=H(t)}return this.each(function(){if(e(this).data("colorpickerId")){var n=e("#"+e(this).data("colorpickerId"));n.data("colorpicker").color=t;n.data("colorpicker").origColor=t;u(t,n.get(0));a(t,n.get(0));f(t,n.get(0));c(t,n.get(0));l(t,n.get(0));h(t,n.get(0));p(t,n.get(0))}})}}}();e.fn.extend({ColorPicker:t.init,ColorPickerHide:t.hide,ColorPickerShow:t.show,ColorPickerSetColor:t.setColor})})(jQuery);(function(e){e.fn.hoverIntent=function(t,n){var r={sensitivity:7,interval:100,timeout:0};r=e.extend(r,n?{over:t,out:n}:t);var i,s,o,u,a=function(e){i=e.pageX;s=e.pageY},f=function(t,n){n.hoverIntent_t=clearTimeout(n.hoverIntent_t);if(Math.abs(o-i)+Math.abs(u-s)<r.sensitivity){e(n).unbind("mousemove",a);n.hoverIntent_s=1;return r.over.apply(n,[t])}o=i;u=s;n.hoverIntent_t=setTimeout(function(){f(t,n)},r.interval)},l=function(e,t){t.hoverIntent_t=clearTimeout(t.hoverIntent_t);t.hoverIntent_s=0;return r.out.apply(t,[e])},c=function(t){var n=jQuery.extend({},t),i=this;i.hoverIntent_t&&(i.hoverIntent_t=clearTimeout(i.hoverIntent_t));if(t.type=="mouseenter"){o=n.pageX;u=n.pageY;e(i).bind("mousemove",a);i.hoverIntent_s!=1&&(i.hoverIntent_t=setTimeout(function(){f(n,i)},r.interval))}else{e(i).unbind("mousemove",a);i.hoverIntent_s==1&&(i.hoverIntent_t=setTimeout(function(){l(n,i)},r.timeout))}};return this.bind("mouseenter",c).bind("mouseleave",c)}})(jQuery);(function(e){var t=null,n="blocktypes",r=null;e.fn.liveUpdate=function(t,n){return this.each(function(){new e.liveUpdate(this,t,n)})};e.liveUpdate=function(t,n,r){this.field=e(t);e(t).data("liveUpdate",this);this.list=e("#"+n);this.lutype="blocktypes";typeof r!="undefined"&&(this.lutype=r);this.list.length>0&&this.init()};e.liveUpdate.prototype={init:function(){var e=this;this.setupCache();this.field.parents("form").submit(function(){return!1});this.field.keyup(function(){e.filter()});e.filter()},filter:function(){if(this.field.val()!=r){if(e.trim(this.field.val())==""){if(this.lutype=="blocktypes"){this.list.children("li").addClass("ccm-block-type-available");this.list.children("li").removeClass("ccm-block-type-selected")}else if(this.lutype=="attributes"){this.list.children("li").addClass("ccm-attribute-available");this.list.children("li").removeClass("ccm-attribute-selected")}else if(this.lutype=="stacks"){this.list.children("li").addClass("ccm-stack-available");this.list.children("li").removeClass("ccm-stack-selected")}else this.lutype=="intelligent-search"?this.list.is(":visible")&&this.list.hide():this.list.children("li").show();return}this.lutype!="intelligent-search"||this.field.val().length>2?this.displayResults(this.getScores(this.field.val().toLowerCase())):this.lutype=="intelligent-search"&&this.list.is(":visible")&&this.list.hide()}r=this.field.val();r==""&&this.lutype=="intelligent-search"&&this.list.is(":visible")&&this.list.hide()},setupCache:function(){var t=this;this.cache=[];this.rows=[];var n=this.lutype;this.list.find("li").each(function(){if(n=="blocktypes")t.cache.push(e(this).find("a.ccm-block-type-inner").html().toLowerCase());else if(n=="attributes"){var r=e(this).find("a,span").html().toLowerCase();t.cache.push(r)}else if(n=="stacks"){var r=e(this).find("a,span").html().toLowerCase();t.cache.push(r)}else if(n=="fileset")t.cache.push(e(this).find("label").html().toLowerCase());else if(n=="intelligent-search"){var i=e(this).find("span").html();i&&t.cache.push(i.toLowerCase())}t.rows.push(e(this))});this.cache_length=this.cache.length},displayResults:function(t){var n=this;if(this.lutype=="blocktypes"){this.list.children("li").removeClass("ccm-block-type-available");this.list.children("li").removeClass("ccm-block-type-selected");e.each(t,function(e,t){n.rows[t[1]].addClass("ccm-block-type-available")});e(this.list.find("li.ccm-block-type-available")[0]).addClass("ccm-block-type-selected")}else if(this.lutype=="attributes"){this.list.children("li").removeClass("ccm-attribute-available");this.list.children("li").removeClass("ccm-attribute-selected");this.list.children("li").removeClass("ccm-item-selected");e.each(t,function(e,t){n.rows[t[1]].addClass("ccm-attribute-available")});this.list.children("li.item-select-list-header").removeClass("ccm-attribute-available");e(this.list.find("li.ccm-attribute-available")[0]).addClass("ccm-item-selected")}else if(this.lutype=="stacks"){this.list.children("li").removeClass("ccm-stack-available");this.list.children("li").removeClass("ccm-stack-selected");this.list.children("li").removeClass("ccm-item-selected");e.each(t,function(e,t){n.rows[t[1]].addClass("ccm-stack-available")});this.list.children("li.item-select-list-header").removeClass("ccm-stack-available");e(this.list.find("li.ccm-stack-available")[0]).addClass("ccm-item-selected")}else if(this.lutype=="intelligent-search"){this.list.is(":visible")||this.list.fadeIn(160,"easeOutExpo");this.list.find(".ccm-intelligent-search-results-module-onsite").hide();this.list.find("li").hide();var r=0;e.each(t,function(e,t){$li=n.rows[t[1]];if(t[0]>.7){r++;$li.parent().parent().is(":visible")||$li.parent().parent().show();$li.show()}});this.list.find("li a").removeClass("ccm-intelligent-search-result-selected");this.list.find("li:visible a:first").addClass("ccm-intelligent-search-result-selected")}else{this.list.children("li").hide();e.each(t,function(e,t){n.rows[t[1]].show()})}},getScores:function(e){var t=[];for(var n=0;n<this.cache_length;n++){var r=this.cache[n].score(e);r>0&&t.push([r,n])}return t.sort(function(e,t){return t[0]-e[0]})}}})(jQuery);(function($){$.extend({metadata:{defaults:{type:"class",name:"metadata",cre:/({.*})/,single:"metadata"},setType:function(e,t){this.defaults.type=e;this.defaults.name=t},get:function(elem,opts){var settings=$.extend({},this.defaults,opts);settings.single.length||(settings.single="metadata");var data=$.data(elem,settings.single);if(data)return data;data="{}";if(settings.type=="class"){var m=settings.cre.exec(elem.className);m&&(data=m[1])}else if(settings.type=="elem"){if(!elem.getElementsByTagName)return;var e=elem.getElementsByTagName(settings.name);e.length&&(data=$.trim(e[0].innerHTML))}else if(elem.getAttribute!=undefined){var attr=elem.getAttribute(settings.name);attr&&(data=attr)}data.indexOf("{")<0&&(data="{"+data+"}");data=eval("("+data+")");$.data(elem,settings.single,data);return data}}});$.fn.metadata=function(e){return $.metadata.get(this[0],e)}})(jQuery);(function(){var e,t,n,r,i=function(e,t){return function(){return e.apply(t,arguments)}};r=this;e=jQuery;e.fn.extend({chosen:function(n){return e.browser!=="msie"||e.browser.version!=="6.0"&&e.browser.version!=="7.0"?e(this).each(function(r){if(!e(this).hasClass("chzn-done"))return new t(this,n)}):this}});t=function(){function t(t,n){this.form_field=t;this.options=n!=null?n:{};this.set_default_values();this.form_field_jq=e(this.form_field);this.is_multiple=this.form_field.multiple;this.is_rtl=this.form_field_jq.hasClass("chzn-rtl");this.default_text_default=this.form_field.multiple?"Select Some Options":"Select an Option";this.set_up_html();this.register_observers();this.form_field_jq.addClass("chzn-done")}t.prototype.set_default_values=function(){this.click_test_action=i(function(e){return this.test_active_click(e)},this);this.activate_action=i(function(e){return this.activate_field(e)},this);this.active_field=!1;this.mouse_on_container=!1;this.results_showing=!1;this.result_highlighted=null;this.result_single_selected=null;this.allow_single_deselect=this.options.allow_single_deselect!=null&&this.form_field.options[0].text===""?this.options.allow_single_deselect:!1;this.disable_search_threshold=this.options.disable_search_threshold||0;this.choices=0;return this.results_none_found=this.options.no_results_text||"No results match"};t.prototype.set_up_html=function(){var t,r,i,s;this.container_id=this.form_field.id.length?this.form_field.id.replace(/(:|\.)/g,"_"):this.generate_field_id();this.container_id+="_chzn";this.f_width=this.form_field_jq.outerWidth();this.default_text=this.form_field_jq.data("placeholder")?this.form_field_jq.data("placeholder"):this.default_text_default;t=e("<div />",{id:this.container_id,"class":"chzn-container"+(this.is_rtl?" chzn-rtl":""),style:"width: "+this.f_width+"px;"});this.is_multiple?t.html('<ul class="chzn-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chzn-drop" style="left:-9000px;"><ul class="chzn-results"></ul></div>'):t.html('<a href="javascript:void(0)" class="chzn-single"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chzn-drop" style="left:-9000px;"><div class="chzn-search"><input type="text" autocomplete="off" /></div><ul class="chzn-results"></ul></div>');this.form_field_jq.hide().after(t);this.container=e("#"+this.container_id);this.container.addClass("chzn-container-"+(this.is_multiple?"multi":"single"));!this.is_multiple&&this.form_field.options.length<=this.disable_search_threshold&&this.container.addClass("chzn-container-single-nosearch");this.dropdown=this.container.find("div.chzn-drop").first();r=this.container.height();i=this.f_width-n(this.dropdown);this.dropdown.css({width:i+"px",top:r+"px"});this.search_field=this.container.find("input").first();this.search_results=this.container.find("ul.chzn-results").first();this.search_field_scale();this.search_no_results=this.container.find("li.no-results").first();if(this.is_multiple){this.search_choices=this.container.find("ul.chzn-choices").first();this.search_container=this.container.find("li.search-field").first()}else{this.search_container=this.container.find("div.chzn-search").first();this.selected_item=this.container.find(".chzn-single").first();s=i-n(this.search_container)-n(this.search_field);this.search_field.css({width:s+"px"})}this.results_build();return this.set_tab_index()};t.prototype.register_observers=function(){this.container.mousedown(i(function(e){return this.container_mousedown(e)},this));this.container.mouseup(i(function(e){return this.container_mouseup(e)},this));this.container.mouseenter(i(function(e){return this.mouse_enter(e)},this));this.container.mouseleave(i(function(e){return this.mouse_leave(e)},this));this.search_results.mouseup(i(function(e){return this.search_results_mouseup(e)},this));this.search_results.mouseover(i(function(e){return this.search_results_mouseover(e)},this));this.search_results.mouseout(i(function(e){return this.search_results_mouseout(e)},this));this.form_field_jq.bind("liszt:updated",i(function(e){return this.results_update_field(e)},this));this.search_field.blur(i(function(e){return this.input_blur(e)},this));this.search_field.keyup(i(function(e){return this.keyup_checker(e)},this));this.search_field.keydown(i(function(e){return this.keydown_checker(e)},this));if(this.is_multiple){this.search_choices.click(i(function(e){return this.choices_click(e)},this));return this.search_field.focus(i(function(e){return this.input_focus(e)},this))}};t.prototype.search_field_disabled=function(){this.is_disabled=this.form_field_jq.attr("disabled");if(this.is_disabled){this.container.addClass("chzn-disabled");this.search_field.attr("disabled",!0);this.is_multiple||this.selected_item.unbind("focus",this.activate_action);return this.close_field()}this.container.removeClass("chzn-disabled");this.search_field.attr("disabled",!1);if(!this.is_multiple)return this.selected_item.bind("focus",this.activate_action)};t.prototype.container_mousedown=function(t){var n;if(!this.is_disabled){n=t!=null?e(t.target).hasClass("search-choice-close"):!1;t&&t.type==="mousedown"&&t.stopPropagation();if(!this.pending_destroy_click&&!n){if(!this.active_field){this.is_multiple&&this.search_field.val("");e(document).click(this.click_test_action);this.results_show()}else if(!this.is_multiple&&t&&(e(t.target)===this.selected_item||e(t.target).parents("a.chzn-single").length)){t.preventDefault();this.results_toggle()}return this.activate_field()}return this.pending_destroy_click=!1}};t.prototype.container_mouseup=function(e){if(e.target.nodeName==="ABBR")return this.results_reset(e)};t.prototype.mouse_enter=function(
){return this.mouse_on_container=!0};t.prototype.mouse_leave=function(){return this.mouse_on_container=!1};t.prototype.input_focus=function(e){if(!this.active_field)return setTimeout(i(function(){return this.container_mousedown()},this),50)};t.prototype.input_blur=function(e){if(!this.mouse_on_container){this.active_field=!1;return setTimeout(i(function(){return this.blur_test()},this),100)}};t.prototype.blur_test=function(e){if(!this.active_field&&this.container.hasClass("chzn-container-active"))return this.close_field()};t.prototype.close_field=function(){e(document).unbind("click",this.click_test_action);if(!this.is_multiple){this.selected_item.attr("tabindex",this.search_field.attr("tabindex"));this.search_field.attr("tabindex",-1)}this.active_field=!1;this.results_hide();this.container.removeClass("chzn-container-active");this.winnow_results_clear();this.clear_backstroke();this.show_search_field_default();return this.search_field_scale()};t.prototype.activate_field=function(){if(!this.is_multiple&&!this.active_field){this.search_field.attr("tabindex",this.selected_item.attr("tabindex"));this.selected_item.attr("tabindex",-1)}this.container.addClass("chzn-container-active");this.active_field=!0;this.search_field.val(this.search_field.val());return this.search_field.focus()};t.prototype.test_active_click=function(t){return e(t.target).parents("#"+this.container_id).length?this.active_field=!0:this.close_field()};t.prototype.results_build=function(){var e,t,n,i,s,o;n=new Date;this.parsing=!0;this.results_data=r.SelectParser.select_to_array(this.form_field);if(this.is_multiple&&this.choices>0){this.search_choices.find("li.search-choice").remove();this.choices=0}else this.is_multiple||this.selected_item.find("span").text(this.default_text);e="";o=this.results_data;for(i=0,s=o.length;i<s;i++){t=o[i];if(t.group)e+=this.result_add_group(t);else if(!t.empty){e+=this.result_add_option(t);if(t.selected&&this.is_multiple)this.choice_build(t);else if(t.selected&&!this.is_multiple){this.selected_item.find("span").text(t.text);this.allow_single_deselect&&this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>')}}}this.search_field_disabled();this.show_search_field_default();this.search_field_scale();this.search_results.html(e);return this.parsing=!1};t.prototype.result_add_group=function(t){if(!t.disabled){t.dom_id=this.container_id+"_g_"+t.array_index;return'<li id="'+t.dom_id+'" class="group-result">'+e("<div />").text(t.label).html()+"</li>"}return""};t.prototype.result_add_option=function(e){var t,n;if(!e.disabled){e.dom_id=this.container_id+"_o_"+e.array_index;t=e.selected&&this.is_multiple?[]:["active-result"];e.selected&&t.push("result-selected");e.group_array_index!=null&&t.push("group-option");e.classes!==""&&t.push(e.classes);n=e.style.cssText!==""?' style="'+e.style+'"':"";return'<li id="'+e.dom_id+'" class="'+t.join(" ")+'"'+n+">"+e.html+"</li>"}return""};t.prototype.results_update_field=function(){this.result_clear_highlight();this.result_single_selected=null;return this.results_build()};t.prototype.result_do_highlight=function(e){var t,n,r,i,s;if(e.length){this.result_clear_highlight();this.result_highlight=e;this.result_highlight.addClass("highlighted");r=parseInt(this.search_results.css("maxHeight"),10);s=this.search_results.scrollTop();i=r+s;n=this.result_highlight.position().top+this.search_results.scrollTop();t=n+this.result_highlight.outerHeight();if(t>=i)return this.search_results.scrollTop(t-r>0?t-r:0);if(n<s)return this.search_results.scrollTop(n)}};t.prototype.result_clear_highlight=function(){this.result_highlight&&this.result_highlight.removeClass("highlighted");return this.result_highlight=null};t.prototype.results_toggle=function(){return this.results_showing?this.results_hide():this.results_show()};t.prototype.results_show=function(){var e;if(!this.is_multiple){this.selected_item.addClass("chzn-single-with-drop");this.result_single_selected&&this.result_do_highlight(this.result_single_selected)}e=this.is_multiple?this.container.height():this.container.height()-1;this.dropdown.css({top:e+"px",left:0});this.results_showing=!0;this.search_field.focus();this.search_field.val(this.search_field.val());return this.winnow_results()};t.prototype.results_hide=function(){this.is_multiple||this.selected_item.removeClass("chzn-single-with-drop");this.result_clear_highlight();this.dropdown.css({left:"-9000px"});return this.results_showing=!1};t.prototype.set_tab_index=function(e){var t;if(this.form_field_jq.attr("tabindex")){t=this.form_field_jq.attr("tabindex");this.form_field_jq.attr("tabindex",-1);if(this.is_multiple)return this.search_field.attr("tabindex",t);this.selected_item.attr("tabindex",t);return this.search_field.attr("tabindex",-1)}};t.prototype.show_search_field_default=function(){if(this.is_multiple&&this.choices<1&&!this.active_field){this.search_field.val(this.default_text);return this.search_field.addClass("default")}this.search_field.val("");return this.search_field.removeClass("default")};t.prototype.search_results_mouseup=function(t){var n;n=e(t.target).hasClass("active-result")?e(t.target):e(t.target).parents(".active-result").first();if(n.length){this.result_highlight=n;return this.result_select(t)}};t.prototype.search_results_mouseover=function(t){var n;n=e(t.target).hasClass("active-result")?e(t.target):e(t.target).parents(".active-result").first();if(n)return this.result_do_highlight(n)};t.prototype.search_results_mouseout=function(t){if(e(t.target).hasClass("active-result"))return this.result_clear_highlight()};t.prototype.choices_click=function(t){t.preventDefault();if(this.active_field&&!e(t.target).hasClass("search-choice")&&!this.results_showing)return this.results_show()};t.prototype.choice_build=function(t){var n,r;n=this.container_id+"_c_"+t.array_index;this.choices+=1;this.search_container.before('<li class="search-choice" id="'+n+'"><span>'+t.html+'</span><a href="javascript:void(0)" class="search-choice-close" rel="'+t.array_index+'"></a></li>');r=e("#"+n).find("a").first();return r.click(i(function(e){return this.choice_destroy_link_click(e)},this))};t.prototype.choice_destroy_link_click=function(t){t.preventDefault();if(!this.is_disabled){this.pending_destroy_click=!0;return this.choice_destroy(e(t.target))}return t.stopPropagation};t.prototype.choice_destroy=function(e){this.choices-=1;this.show_search_field_default();this.is_multiple&&this.choices>0&&this.search_field.val().length<1&&this.results_hide();this.result_deselect(e.attr("rel"));return e.parents("li").first().remove()};t.prototype.results_reset=function(t){this.form_field.options[0].selected=!0;this.selected_item.find("span").text(this.default_text);this.show_search_field_default();e(t.target).remove();this.form_field_jq.trigger("change");if(this.active_field)return this.results_hide()};t.prototype.result_select=function(e){var t,n,r,i;if(this.result_highlight){t=this.result_highlight;n=t.attr("id");this.result_clear_highlight();if(this.is_multiple)this.result_deactivate(t);else{this.search_results.find(".result-selected").removeClass("result-selected");this.result_single_selected=t}t.addClass("result-selected");i=n.substr(n.lastIndexOf("_")+1);r=this.results_data[i];r.selected=!0;this.form_field.options[r.options_index].selected=!0;if(this.is_multiple)this.choice_build(r);else{this.selected_item.find("span").first().text(r.text);this.allow_single_deselect&&this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>')}(!e.metaKey||!this.is_multiple)&&this.results_hide();this.search_field.val("");this.form_field_jq.trigger("change");return this.search_field_scale()}};t.prototype.result_activate=function(e){return e.addClass("active-result")};t.prototype.result_deactivate=function(e){return e.removeClass("active-result")};t.prototype.result_deselect=function(t){var n,r;r=this.results_data[t];r.selected=!1;this.form_field.options[r.options_index].selected=!1;n=e("#"+this.container_id+"_o_"+t);n.removeClass("result-selected").addClass("active-result").show();this.result_clear_highlight();this.winnow_results();this.form_field_jq.trigger("change");return this.search_field_scale()};t.prototype.results_search=function(e){return this.results_showing?this.winnow_results():this.results_show()};t.prototype.winnow_results=function(){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g;f=new Date;this.no_results_clear();u=0;a=this.search_field.val()===this.default_text?"":e("<div/>").text(e.trim(this.search_field.val())).html();s=new RegExp("^"+a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i");h=new RegExp(a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i");g=this.results_data;for(p=0,v=g.length;p<v;p++){n=g[p];if(!n.disabled&&!n.empty)if(n.group)e("#"+n.dom_id).hide();else if(!this.is_multiple||!n.selected){t=!1;o=n.dom_id;if(s.test(n.html)){t=!0;u+=1}else if(n.html.indexOf(" ")>=0||n.html.indexOf("[")===0){i=n.html.replace(/\[|\]/g,"").split(" ");if(i.length)for(d=0,m=i.length;d<m;d++){r=i[d];if(s.test(r)){t=!0;u+=1}}}if(t){if(a.length){l=n.html.search(h);c=n.html.substr(0,l+a.length)+"</em>"+n.html.substr(l+a.length);c=c.substr(0,l)+"<em>"+c.substr(l)}else c=n.html;e("#"+o).html!==c&&e("#"+o).html(c);this.result_activate(e("#"+o));n.group_array_index!=null&&e("#"+this.results_data[n.group_array_index].dom_id).show()}else{this.result_highlight&&o===this.result_highlight.attr("id")&&this.result_clear_highlight();this.result_deactivate(e("#"+o))}}}return u<1&&a.length?this.no_results(a):this.winnow_results_set_highlight()};t.prototype.winnow_results_clear=function(){var t,n,r,i,s;this.search_field.val("");n=this.search_results.find("li");s=[];for(r=0,i=n.length;r<i;r++){t=n[r];t=e(t);s.push(t.hasClass("group-result")?t.show():!this.is_multiple||!t.hasClass("result-selected")?this.result_activate(t):void 0)}return s};t.prototype.winnow_results_set_highlight=function(){var e,t;if(!this.result_highlight){t=this.is_multiple?[]:this.search_results.find(".result-selected.active-result");e=t.length?t.first():this.search_results.find(".active-result").first();if(e!=null)return this.result_do_highlight(e)}};t.prototype.no_results=function(t){var n;n=e('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>');n.find("span").first().html(t);return this.search_results.append(n)};t.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()};t.prototype.keydown_arrow=function(){var t,n;if(!this.result_highlight){t=this.search_results.find("li.active-result").first();t&&this.result_do_highlight(e(t))}else if(this.results_showing){n=this.result_highlight.nextAll("li.active-result").first();n&&this.result_do_highlight(n)}if(!this.results_showing)return this.results_show()};t.prototype.keyup_arrow=function(){var e;if(!this.results_showing&&!this.is_multiple)return this.results_show();if(this.result_highlight){e=this.result_highlight.prevAll("li.active-result");if(e.length)return this.result_do_highlight(e.first());this.choices>0&&this.results_hide();return this.result_clear_highlight()}};t.prototype.keydown_backstroke=function(){if(this.pending_backstroke){this.choice_destroy(this.pending_backstroke.find("a").first());return this.clear_backstroke()}this.pending_backstroke=this.search_container.siblings("li.search-choice").last();return this.pending_backstroke.addClass("search-choice-focus")};t.prototype.clear_backstroke=function(){this.pending_backstroke&&this.pending_backstroke.removeClass("search-choice-focus");return this.pending_backstroke=null};t.prototype.keyup_checker=function(e){var t,n;t=(n=e.which)!=null?n:e.keyCode;this.search_field_scale();switch(t){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices>0)return this.keydown_backstroke();if(!this.pending_backstroke){this.result_clear_highlight();return this.results_search()}break;case 13:e.preventDefault();if(this.results_showing)return this.result_select(e);break;case 27:if(this.results_showing)return this.results_hide();break;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}};t.prototype.keydown_checker=function(e){var t,n;t=(n=e.which)!=null?n:e.keyCode;this.search_field_scale();t!==8&&this.pending_backstroke&&this.clear_backstroke();switch(t){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:this.mouse_on_container=!1;break;case 13:e.preventDefault();break;case 38:e.preventDefault();this.keyup_arrow();break;case 40:this.keydown_arrow()}};t.prototype.search_field_scale=function(){var t,n,r,i,s,o,u,a,f;if(this.is_multiple){r=0;u=0;s="position:absolute; left: -1000px; top: -1000px; display:none;";o=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"];for(a=0,f=o.length;a<f;a++){i=o[a];s+=i+":"+this.search_field.css(i)+";"}n=e("<div />",{style:s});n.text(this.search_field.val());e("body").append(n);u=n.width()+25;n.remove();u>this.f_width-10&&(u=this.f_width-10);this.search_field.css({width:u+"px"});t=this.container.height();return this.dropdown.css({top:t+"px"})}};t.prototype.generate_field_id=function(){var e;e=this.generate_random_id();this.form_field.id=e;return e};t.prototype.generate_random_id=function(){var t;t="sel"+this.generate_random_char()+this.generate_random_char()+this.generate_random_char();while(e("#"+t).length>0)t+=this.generate_random_char();return t};t.prototype.generate_random_char=function(){var e,t,n;e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZ";n=Math.floor(Math.random()*e.length);return t=e.substring(n,n+1)};return t}();n=function(e){var t;return t=e.outerWidth()-e.width()};r.get_side_border_padding=n}).call(this);(function(){var e;e=function(){function e(){this.options_index=0;this.parsed=[]}e.prototype.add_node=function(e){return e.nodeName==="OPTGROUP"?this.add_group(e):this.add_option(e)};e.prototype.add_group=function(e){var t,n,r,i,s,o;t=this.parsed.length;this.parsed.push({array_index:t,group:!0,label:e.label,children:0,disabled:e.disabled});s=e.childNodes;o=[];for(r=0,i=s.length;r<i;r++){n=s[r];o.push(this.add_option(n,t,e.disabled))}return o};e.prototype.add_option=function(e,t,n){if(e.nodeName==="OPTION"){if(e.text!==""){t!=null&&(this.parsed[t].children+=1);this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:e.value,text:e.text,html:e.innerHTML,selected:e.selected,disabled:n===!0?n:e.disabled,group_array_index:t,classes:e.className,style:e.style.cssText})}else this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:!0});return this.options_index+=1}};return e}();e.select_to_array=function(t){var n,r,i,s,o;r=new e;o=t.childNodes;for(i=0,s=o.length;i<s;i++){n=o[i];r.add_node(n)}return r.parsed};this.SelectParser=e}).call(this);var ccm_totalAdvancedSearchFields=0,ccm_alLaunchType=new Array,ccm_alActiveAssetField="",ccm_alProcessorTarget="",ccm_alDebug=!1;ccm_triggerSelectFile=function(e,t){if(t==null)var t=ccm_alActiveAssetField;var n=$("#"+t+"-fm-selected"),r=$("#"+t+"-fm-display");r.hide();n.show();n.load(CCM_TOOLS_PATH+"/files/selector_data?fID="+e+"&ccm_file_selected_field="+t,function(){n.attr("fID",e);n.attr("ccm-file-manager-can-view",n.children("div").attr("ccm-file-manager-can-view"));n.attr("ccm-file-manager-can-edit",n.children("div").attr("ccm-file-manager-can-edit"));n.attr("ccm-file-manager-can-admin",n.children("div").attr("ccm-file-manager-can-admin"));n.attr("ccm-file-manager-can-replace",n.children("div").attr("ccm-file-manager-can-replace"));n.attr("ccm-file-manager-instance",t);n.click(function(e){e.stopPropagation();ccm_alActivateMenu($(this),e)});typeof ccm_triggerSelectFileComplete=="function"&&ccm_triggerSelectFileComplete(e,t)});var i=$("#"+t+"-fm-value");i.attr("value",e);ccm_alSetupFileProcessor()};ccm_alGetFileData=function(e,t){$.getJSON(CCM_TOOLS_PATH+"/files/get_data.php?fID="+e,function(e){t(e)})};ccm_clearFile=function(e,t){e.stopPropagation();var n=$("#"+t+"-fm-selected"),r=$("#"+t+"-fm-display"),i=$("#"+t+"-fm-value");i.attr("value",0);n.hide();r.show()};ccm_activateFileManager=function(e,t){ccm_alLaunchType[t]=e;ccm_alSetupSelectFiles(t);$(document).click(function(e){e.stopPropagation();ccm_alSelectNone()});ccm_setupAdvancedSearch(t);e=="DASHBOARD"&&$(".dialog-launch").dialog();ccm_alSetupCheckboxes(t);ccm_alSetupFileProcessor();ccm_alSetupSingleUploadForm();$("form#ccm-"+t+"-advanced-search select[name=fssID]").change(function(){if(e=="DASHBOARD")window.location.href=CCM_DISPATCHER_FILENAME+"/dashboard/files/search?fssID="+$(this).val();else{jQuery.fn.dialog.showLoader();var n=$("div#ccm-"+t+"-overlay-wrapper input[name=dialogAction]").val()+"&refreshDialog=1&fssID="+$(this).val();$.get(n,function(e){jQuery.fn.dialog.hideLoader();$("div#ccm-"+t+"-overlay-wrapper").html(e);$("div#ccm-"+t+"-overlay-wrapper a.dialog-launch").dialog()})}});ccm_searchActivatePostFunction[t]=function(){ccm_alSetupCheckboxes(t);ccm_alSetupSelectFiles(t);ccm_alSetupSingleUploadForm()}};ccm_alSetupSingleUploadForm=function(){$(".ccm-file-manager-submit-single").submit(function(){$(this).attr("target",ccm_alProcessorTarget);ccm_alSubmitSingle($(this).get(0))})};ccm_activateFileSelectors=function(){$(".ccm-file-manager-launch").unbind();$(".ccm-file-manager-launch").click(function(){ccm_alLaunchSelectorFileManager($(this).parent().attr("ccm-file-manager-field"))})};ccm_alLaunchSelectorFileManager=function(e){ccm_alActiveAssetField=e;var t="",n=$("#"+e+"-fm-display input.ccm-file-manager-filter");if(n.length)for(i=0;i<n.length;i++)t+="&"+$(n[i]).attr("name")+"="+$(n[i]).attr("value");ccm_launchFileManager(t)};ccm_launchFileManager=function(e){$.fn.dialog.open({width:"90%",height:"70%",appendButtons:!0,modal:!1,href:CCM_TOOLS_PATH+"/files/search_dialog?ocID="+CCM_CID+"&search=1"+e,title:ccmi18n_filemanager.title})};ccm_launchFileSetPicker=function(e){$.fn.dialog.open({width:500,height:160,modal:!1,href:CCM_TOOLS_PATH+"/files/pick_set?oldFSID="+e,title:ccmi18n_filemanager.sets})};ccm_alSubmitSetsForm=function(e){ccm_deactivateSearchResults(e);jQuery.fn.dialog.showLoader();$("#ccm-"+e+"-add-to-set-form").ajaxSubmit(function(t){jQuery.fn.dialog.closeTop();jQuery.fn.dialog.hideLoader();$("#ccm-"+e+"-advanced-search").ajaxSubmit(function(t){$("#ccm-"+e+"-sets-search-wrapper").load(CCM_TOOLS_PATH+"/files/search_sets_reload",{searchInstance:e},function(){$(".chosen-select").chosen();ccm_parseAdvancedSearchResponse(t,e)})})})};ccm_alSubmitPasswordForm=function(e){ccm_deactivateSearchResults(e);$("#ccm-"+e+"-password-form").ajaxSubmit(function(t){jQuery.fn.dialog.closeTop();$("#ccm-"+e+"-advanced-search").ajaxSubmit(function(t){ccm_parseAdvancedSearchResponse(t,e)})})};ccm_alSubmitStorageForm=function(e){ccm_deactivateSearchResults(e);$("#ccm-"+e+"-storage-form").ajaxSubmit(function(t){jQuery.fn.dialog.closeTop();$("#ccm-"+e+"-advanced-search").ajaxSubmit(function(t){ccm_parseAdvancedSearchResponse(t,e)})})};ccm_alSubmitPermissionsForm=function(e){ccm_deactivateSearchResults(e);$("#ccm-"+e+"-permissions-form").ajaxSubmit(function(t){jQuery.fn.dialog.closeTop();$("#ccm-"+e+"-advanced-search").ajaxSubmit(function(t){ccm_parseAdvancedSearchResponse(t,e)})})};ccm_alSetupSetsForm=function(e){$("#fsAddToSearchName").liveUpdate("ccm-file-search-add-to-sets-list","fileset");$(".ccm-file-set-add-cb a").each(function(){var e=$(this),t=e.attr("ccm-tri-state-startup");$(this).click(function(){var e=$(this).attr("ccm-tri-state-selected"),n=0;switch(e){case"0":t=="1"?n="1":n="2";break;case"1":n="2";break;case"2":n="0"}$(this).attr("ccm-tri-state-selected",n);$(this).parent().find("input").val(n);$(this).find("img").attr("src",CCM_IMAGE_PATH+"/checkbox_state_"+n+".png")})});$("#ccm-"+e+"-add-to-set-form input[name=fsNew]").click(function(){$(this).prop("checked")||$("#ccm-"+e+"-add-to-set-form input[name=fsNewText]").val("")});$("#ccm-"+e+"-add-to-set-form").submit(function(){ccm_alSubmitSetsForm(e);return!1})};ccm_alSetupPasswordForm=function(){$("#ccm-file-password-form").submit(function(){ccm_alSubmitPasswordForm();return!1})};ccm_alRescanFiles=function(){var e=CCM_TOOLS_PATH+"/files/rescan?",t=arguments;for(i=0;i<t.length;i++)e+="fID[]="+t[i]+"&";$.fn.dialog.open({title:ccmi18n_filemanager.rescan,href:e,width:350,modal:!1,height:200,onClose:function(){if(t.length==1){$("#ccm-file-properties-wrapper").html("");jQuery.fn.dialog.showLoader();$("#ccm-file-properties-wrapper").load(CCM_TOOLS_PATH+"/files/properties?fID="+t[0]+"&reload=1",!1,function(){jQuery.fn.dialog.hideLoader();$(this).find(".dialog-launch").dialog()})}}})};ccm_alSelectPermissionsEntity=function(e,t,n){var r=$("#ccm-file-permissions-entity-base").html();$("#ccm-file-permissions-entities-wrapper").append('<div class="ccm-file-permissions-entity">'+r+"</div>");var i=$(".ccm-file-permissions-entity"),s=i[i.length-1];$(s).find("h3 span").html(n);$(s).find("input[type=hidden]").val(e+"_"+t);$(s).find("select").each(function(){$(this).attr("name",$(this).attr("name")+"_"+e+"_"+t)});$(s).find("div.ccm-file-access-extensions input[type=checkbox]").each(function(){$(this).attr("name",$(this).attr("name")+"_"+e+"_"+t+"[]")});ccm_alActivateFilePermissionsSelector()};ccm_alActivateFilePermissionsSelector=function(){$(".ccm-file-access-add select").unbind();$(".ccm-file-access-add select").change(function(){var e=$(this).parents("div.ccm-file-permissions-entity")[0];$(this).val()==ccmi18n_filemanager.PTYPE_CUSTOM?$(e).find("div.ccm-file-access-add-extensions").show():$(e).find("div.ccm-file-access-add-extensions").hide()});$(".ccm-file-access-file-manager select").change(function(){var e=$(this).parents("div.ccm-file-permissions-entity")[0];if($(this).val()!=ccmi18n_filemanager.PTYPE_NONE){$(e).find(".ccm-file-access-add").show();$(e).find(".ccm-file-access-edit").show();$(e).find(".ccm-file-access-admin").show()}else{$(e).find(".ccm-file-access-add").hide();$(e).find(".ccm-file-access-edit").hide();$(e).find(".ccm-file-access-admin").hide();$(e).find("div.ccm-file-access-add-extensions").hide()}});$("a.ccm-file-permissions-remove").click(function(){$(this).parent().parent().fadeOut(100,function(){$(this).remove()})});$("input[name=toggleCanAddExtension]").unbind();$("input[name=toggleCanAddExtension]").click(function(){var e=$(this).parent().parent().find("div.ccm-file-access-extensions");$(this).prop("checked")==1?e.find("input").attr("checked",!0):e.find("input").attr("checked",!1)})};ccm_alSetupVersionSelector=function(){$("#ccm-file-versions-grid input[type=radio]").click(function(){$("#ccm-file-versions-grid tr").removeClass("ccm-file-versions-grid-active");var e=$(this).parent().parent(),t=e.attr("fID"),n=e.attr("fvID"),r="task=approve_version&fID="+t+"&fvID="+n;$.post(CCM_TOOLS_PATH+"/files/properties",r,function(t){e.addClass("ccm-file-versions-grid-active");e.find("td").show("highlight",{color:"#FFF9BB"})})});$(".ccm-file-versions-remove").click(function(){var e=$(this).parent().parent(),t=e.attr("fID"),n=e.attr("fvID"),r="task=delete_version&fID="+t+"&fvID="+n;$.post(CCM_TOOLS_PATH+"/files/properties",r,function(t){e.fadeOut(200,function(){e.remove()})});return!1})};ccm_alDeleteFiles=function(e){$("#ccm-"+e+"-delete-form").ajaxSubmit(function(t){ccm_parseJSON(t,function(){jQuery.fn.dialog.closeTop();ccm_deactivateSearchResults(e);$("#ccm-"+e+"-advanced-search").ajaxSubmit(function(t){ccm_parseAdvancedSearchResponse(t,e)})})})};ccm_alDuplicateFiles=function(searchInstance){$("#ccm-"+searchInstance+"-duplicate-form").ajaxSubmit(function(resp){ccm_parseJSON(resp,function(){jQuery.fn.dialog.closeTop();ccm_deactivateSearchResults(searchInstance);var r=eval("("+resp+")");$("#ccm-"+searchInstance+"-advanced-search").ajaxSubmit(function(e){ccm_parseAdvancedSearchResponse(e,searchInstance);var t=new Array;for(i=0;i<r.fID.length;i++){fID=r.fID[i];ccm_uploadedFiles.push(fID);t.push(fID)}ccm_alRefresh(t,searchInstance);ccm_filesUploadedDialog(searchInstance)})})})};ccm_alSetupSelectFiles=function(e){$(".ccm-file-list").unbind();$(".ccm-file-list tr.ccm-list-record").click(function(e){e.stopPropagation();ccm_alActivateMenu($(this),e)});$(".ccm-file-list img.ccm-star").click(function(e){e.stopPropagation();var t=$(e.target).parents("tr.ccm-list-record")[0].id;t=t.substring(3);ccm_starFile(e.target,t)});ccm_alLaunchType[e]=="DASHBOARD"&&$(".ccm-file-list-thumbnail").hover(function(e){var t=$(this).attr("fID"),n=$("#fID"+t+"hoverThumbnail");if(n.length>0){var r=n.find("div"),i=n.position();r.css("top",i.top);r.css("left",i.left);r.show()}},function(){var e=$(this).attr("fID"),t=$("#fID"+e+"hoverThumbnail"),n=t.find("div");n.hide()})};ccm_alSetupCheckboxes=function(e){$("#ccm-"+e+"-list-cb-all").unbind();$("#ccm-"+e+"-list-cb-all").click(function(){ccm_hideMenus();if($(this).prop("checked")==1){$("#ccm-"+e+"-search-results td.ccm-file-list-cb input[type=checkbox]").attr("checked",!0);$("#ccm-"+e+"-list-multiple-operations").attr("disabled",!1)}else{$("#ccm-"+e+"-search-results td.ccm-file-list-cb input[type=checkbox]").attr("checked",!1);$("#ccm-"+e+"-list-multiple-operations").attr("disabled",!0)}});$("#ccm-"+e+"-search-results td.ccm-file-list-cb input[type=checkbox]").click(function(t){t.stopPropagation();ccm_hideMenus();ccm_alRescanMultiFileMenu(e)});$("#ccm-"+e+"-search-results td.ccm-file-list-cb").click(function(t){t.stopPropagation();ccm_hideMenus();$(this).find("input[type=checkbox]").click();ccm_alRescanMultiFileMenu(e)});if(ccm_alLaunchType[e]!="DASHBOARD"&&ccm_alLaunchType[e]!="BROWSE"){var t=ccmi18n_filemanager.select;$("#ccm-"+e+"-list-multiple-operations option:eq(0)").after('<option value="choose">'+t+"</option>")}$("#ccm-"+e+"-list-multiple-operations").change(function(){var t=$(this).val(),n=ccm_alGetSelectedFileIDs(e);switch(t){case"choose":var r=new Array;$("#ccm-"+e+"-search-results td.ccm-file-list-cb input[type=checkbox]:checked").each(function(){r.push($(this).val())});ccm_alSelectFile(r,!0);break;case"delete":jQuery.fn.dialog.open({width:500,height:400,modal:!1,appendButtons:!0,href:CCM_TOOLS_PATH+"/files/delete?"+n+"&searchInstance="+e,title:ccmi18n_filemanager.deleteFile});break;case"duplicate":jQuery.fn.dialog.open({width:500,height:400,modal:!1,href:CCM_TOOLS_PATH+"/files/duplicate?"+n+"&searchInstance="+e,title:ccmi18n_filemanager.duplicateFile});break;case"sets":jQuery.fn.dialog.open({width:500,height:400,modal:!1,href:CCM_TOOLS_PATH+"/files/add_to?"+n+"&searchInstance="+e,title:ccmi18n_filemanager.sets});break;case"properties":jQuery.fn.dialog.open({width:690,height:440,modal:!1,href:CCM_TOOLS_PATH+"/files/bulk_properties?"+n+"&searchInstance="+e,title:ccmi18n.properties});break;case"rescan":jQuery.fn.dialog.open({width:350,height:200,modal:!1,href:CCM_TOOLS_PATH+"/files/rescan?"+n+"&searchInstance="+e,title:ccmi18n_filemanager.rescan,onClose:function(){$("#ccm-"+e+"-advanced-search").submit()}});break;case"download":window.frames[ccm_alProcessorTarget].location=CCM_TOOLS_PATH+"/files/download?"+n}$(this).get(0).selectedIndex=0});ccm_alSetupFileSetSearch(e)};ccm_alSetupFileSetSearch=function(e){$("#ccm-"+e+"-sets-search-wrapper select").chosen().unbind();$("#ccm-"+e+"-sets-search-wrapper select").chosen().change(function(){var t=$("#ccm-"+e+"-sets-search-wrapper option:selected");$("#ccm-"+e+"-advanced-search").submit()})};ccm_alGetSelectedFileIDs=function(e){var t="";$("#ccm-"+e+"-search-results td.ccm-file-list-cb input[type=checkbox]:checked").each(function(){t+="fID[]="+$(this).val()+"&"});return t};ccm_alRescanMultiFileMenu=function(e){$("#ccm-"+e+"-search-results td.ccm-file-list-cb input[type=checkbox]:checked").length>0?$("#ccm-"+e+"-list-multiple-operations").attr("disabled",!1):$("#ccm-"+e+"-list-multiple-operations").attr("disabled",!0)};ccm_alSetupFileProcessor=function(){if(ccm_alProcessorTarget!="")return!1;var e=parseInt((new Date).getTime().toString().substring(0,10)),t;try{t=document.createElement('<iframe name="ccm-al-upload-processor'+e+'">')}catch(n){t=document.createElement("iframe")}t.id="ccm-al-upload-processor"+e;t.name="ccm-al-upload-processor"+e;t.style.border="0px";t.style.width="0px";t.style.height="0px";t.style.display="none";document.body.appendChild(t);ccm_alDebug?ccm_alProcessorTarget="_blank":ccm_alProcessorTarget="ccm-al-upload-processor"+e};ccm_alSubmitSingle=function(e){if($(e).find(".ccm-al-upload-single-file").val()=="")return!1;$(e).find(".ccm-al-upload-single-submit").hide();$(e).find(".ccm-al-upload-single-loader").show()};ccm_alResetSingle=function(){$(".ccm-al-upload-single-file").val("");$(".ccm-al-upload-single-loader").hide();$(".ccm-al-upload-single-submit").show()};var ccm_uploadedFiles=[];ccm_filesUploadedDialog=function(e){document.getElementById("ccm-file-upload-multiple-tab")&&jQuery.fn.dialog.closeTop();var t="";for(var n=0;n<ccm_uploadedFiles.length;n++)t=t+"&fID[]="+ccm_uploadedFiles[n];jQuery.fn.dialog.open({width:690,height:440,modal:!1,href:CCM_TOOLS_PATH+"/files/bulk_properties/?"+t+"&uploaded=true&searchInstance="+e,onClose:function(){ccm_deactivateSearchResults(e);$("#ccm-"+e+"-advanced-search").ajaxSubmit(function(t){ccm_parseAdvancedSearchResponse(t,e)})},title:ccmi18n_filemanager.uploadComplete});ccm_uploadedFiles=[]};ccm_alSetupUploadDetailsForm=function(e){$("#ccm-"+e+"-update-uploaded-details-form").submit(function(){ccm_alSubmitUploadDetailsForm(e);return!1})};ccm_alSubmitUploadDetailsForm=function(searchInstance){jQuery.fn.dialog.showLoader();$("#ccm-"+searchInstance+"-update-uploaded-details-form").ajaxSubmit(function(r1){var r1a=eval("("+r1+")"),form=$("#ccm-"+searchInstance+"-advanced-search");if(form.length>0)form.ajaxSubmit(function(e){$("#ccm-"+searchInstance+"-sets-search-wrapper").load(CCM_TOOLS_PATH+"/files/search_sets_reload",{searchInstance:searchInstance},function(){jQuery.fn.dialog.hideLoader();jQuery.fn.dialog.closeTop();ccm_parseAdvancedSearchResponse(e,searchInstance);ccm_alHighlightFileIDArray(r1a)})});else{jQuery.fn.dialog.hideLoader();jQuery.fn.dialog.closeTop()}})};ccm_alRefresh=function(e,t,n){var r=e;ccm_deactivateSearchResults(t);$("#ccm-"+t+"-search-results").load(CCM_TOOLS_PATH+"/files/search_results",{ccm_order_by:"fvDateAdded",ccm_order_dir:"desc",fileSelector:n,searchType:ccm_alLaunchType[t],searchInstance:t},function(){ccm_activateSearchResults(t);r!=0&&ccm_alHighlightFileIDArray(r);ccm_alSetupSelectFiles(t)})};ccm_alHighlightFileIDArray=function(e){for(i=0;i<e.length;i++){var t=$("tr[fID="+e[i]+"] td"),n=t.css("backgroundColor");t.animate({backgroundColor:"#FFF9BB"},{queue:!0,duration:1e3}).animate({backgroundColor:n},500)}};ccm_alSelectFile=function(e){if(typeof ccm_chooseAsset=="function"){var t="";if(typeof e=="object")for(i=0;i<e.length;i++)t+="fID[]="+e[i]+"&";else t+="fID="+e;$.getJSON(CCM_TOOLS_PATH+"/files/get_data.php?"+t,function(e){ccm_parseJSON(e,function(){for(i=0;i<e.length;i++)ccm_chooseAsset(e[i]);jQuery.fn.dialog.closeTop()})})}else{if(typeof e=="object")for(i=0;i<e.length;i++)ccm_triggerSelectFile(e[i]);else ccm_triggerSelectFile(e);jQuery.fn.dialog.closeTop()}};ccm_alActivateMenu=function(e,t){var n=$(e).find("div[ccm-file-manager-field]"),r="";n.length>0&&(r=n.attr("ccm-file-manager-field"));r||(r=ccm_alActiveAssetField);ccm_hideMenus();var i=$(e).attr("fID"),s=$(e).attr("ccm-file-manager-instance"),o=document.getElementById("ccm-al-menu"+i+s+r);if(!o){el=document.createElement("DIV");el.id="ccm-al-menu"+i+s+r;el.className="ccm-menu ccm-ui";el.style.display="block";el.style.visibility="hidden";document.body.appendChild(el);var u=$("div[ccm-file-manager-field="+r+"] input.ccm-file-manager-filter"),a="";u.length>0&&u.each(function(){a+="&"+$(this).attr("name")+"="+$(this).attr("value")});var f=$(e).attr("al-filepath");o=$("#ccm-al-menu"+i+s+r);o.css("position","absolute");var l='<div class="popover"><div class="arrow"></div><div class="inner"><div class="content">';l+="<ul>";if(ccm_alLaunchType[s]!="DASHBOARD"&&ccm_alLaunchType[s]!="BROWSE"){var c=n.length>0?"ccm_alLaunchSelectorFileManager('"+r+"')":"ccm_alSelectFile("+i+")",h=n.length>0?ccmi18n_filemanager.chooseNew:ccmi18n_filemanager.select;l+='<li><a class="ccm-menu-icon ccm-icon-choose-file-menu" dialog-modal="false" dialog-width="90%" dialog-height="70%" dialog-title="'+ccmi18n_filemanager.select+'" id="menuSelectFile'+i+'" href="javascript:void(0)" onclick="'+c+'">'+h+"</a></li>"}n.length>0&&(l+='<li><a class="ccm-menu-icon ccm-icon-clear-file-menu" href="javascript:void(0)" id="menuClearFile'+i+s+r+'">'+ccmi18n_filemanager.clear+"</a></li>");ccm_alLaunchType[s]!="DASHBOARD"&&ccm_alLaunchType[s]!="BROWSE"&&n.length>0&&(l+='<li class="ccm-menu-separator"></li>');$(e).attr("ccm-file-manager-can-view")=="1"?l+='<li><a class="ccm-menu-icon ccm-icon-view dialog-launch" dialog-modal="false" dialog-append-buttons="true" dialog-width="90%" dialog-height="75%" dialog-title="'+
ccmi18n_filemanager.view+'" id="menuView'+i+'" href="'+CCM_TOOLS_PATH+"/files/view?fID="+i+'">'+ccmi18n_filemanager.view+"</a></li>":l+='<li><a class="ccm-menu-icon ccm-icon-download-menu" href="javascript:void(0)" id="menuDownload'+i+'" onclick="window.frames[\''+ccm_alProcessorTarget+"'].location='"+CCM_TOOLS_PATH+"/files/download?fID="+i+"'\">"+ccmi18n_filemanager.download+"</a></li>";$(e).attr("ccm-file-manager-can-edit")=="1"&&(l+='<li><a class="ccm-menu-icon ccm-icon-edit-menu dialog-launch" dialog-modal="false" dialog-width="90%" dialog-height="75%" dialog-title="'+ccmi18n_filemanager.edit+'" id="menuEdit'+i+'" href="'+CCM_TOOLS_PATH+"/files/edit?searchInstance="+s+"&fID="+i+a+'">'+ccmi18n_filemanager.edit+"</a></li>");l+='<li><a class="ccm-menu-icon ccm-icon-properties-menu dialog-launch" dialog-modal="false" dialog-width="680" dialog-height="450" dialog-title="'+ccmi18n_filemanager.properties+'" id="menuProperties'+i+'" href="'+CCM_TOOLS_PATH+"/files/properties?searchInstance="+s+"&fID="+i+'">'+ccmi18n_filemanager.properties+"</a></li>";$(e).attr("ccm-file-manager-can-replace")=="1"&&(l+='<li><a class="ccm-menu-icon ccm-icon-replace dialog-launch" dialog-modal="false" dialog-width="300" dialog-height="260" dialog-title="'+ccmi18n_filemanager.replace+'" id="menuFileReplace'+i+'" href="'+CCM_TOOLS_PATH+"/files/replace?searchInstance="+s+"&fID="+i+'">'+ccmi18n_filemanager.replace+"</a></li>");$(e).attr("ccm-file-manager-can-duplicate")=="1"&&(l+='<li><a class="ccm-menu-icon ccm-icon-copy-menu" id="menuFileDuplicate'+i+'" href="javascript:void(0)" onclick="ccm_alDuplicateFile('+i+",'"+s+"')\">"+ccmi18n_filemanager.duplicate+"</a></li>");l+='<li><a class="ccm-menu-icon ccm-icon-sets dialog-launch" dialog-modal="false" dialog-width="500" dialog-height="400" dialog-title="'+ccmi18n_filemanager.sets+'" id="menuFileSets'+i+'" href="'+CCM_TOOLS_PATH+"/files/add_to?searchInstance="+s+"&fID="+i+'">'+ccmi18n_filemanager.sets+"</a></li>";if($(e).attr("ccm-file-manager-can-admin")=="1"||$(e).attr("ccm-file-manager-can-delete")=="1")l+='<li class="ccm-menu-separator"></li>';$(e).attr("ccm-file-manager-can-admin")=="1"&&(l+='<li><a class="ccm-menu-icon ccm-icon-access-permissions dialog-launch" dialog-modal="false" dialog-width="400" dialog-height="450" dialog-title="'+ccmi18n_filemanager.permissions+'" id="menuFilePermissions'+i+'" href="'+CCM_TOOLS_PATH+"/files/permissions?searchInstance="+s+"&fID="+i+'">'+ccmi18n_filemanager.permissions+"</a></li>");$(e).attr("ccm-file-manager-can-delete")=="1"&&(l+='<li><a class="ccm-icon-delete-menu ccm-menu-icon dialog-launch" dialog-append-buttons="true" dialog-modal="false" dialog-width="500" dialog-height="200" dialog-title="'+ccmi18n_filemanager.deleteFile+'" id="menuDeleteFile'+i+'" href="'+CCM_TOOLS_PATH+"/files/delete?searchInstance="+s+"&fID="+i+'">'+ccmi18n_filemanager.deleteFile+"</a></li>");l+="</ul>";l+="</div></div></div>";o.append(l);$(o).find("a").bind("click.hide-menu",function(e){ccm_hideMenus();return!1});$("#ccm-al-menu"+i+s+r+" a.dialog-launch").dialog();$("a#menuClearFile"+i+s+r).click(function(e){ccm_clearFile(e,r);ccm_hideMenus()})}else o=$("#ccm-al-menu"+i+s+r);ccm_fadeInMenu(o,t)};ccm_alSelectNone=function(){ccm_hideMenus()};var checkbox_status=!1;toggleCheckboxStatus=function(e){if(checkbox_status){for(i=0;i<e.elements.length;i++)e.elements[i].type=="checkbox"&&(e.elements[i].checked=!1);checkbox_status=!1}else{for(i=0;i<e.elements.length;i++)e.elements[i].type=="checkbox"&&(e.elements[i].checked=!0);checkbox_status=!0}};ccm_alDuplicateFile=function(fID,searchInstance){var postStr="fID="+fID+"&searchInstance="+searchInstance;$.post(CCM_TOOLS_PATH+"/files/duplicate",postStr,function(resp){var r=eval("("+resp+")");if(r.error==1){ccmAlert.notice(ccmi18n.error,r.message);return!1}var highlight=new Array;if(r.fID){highlight.push(r.fID);ccm_alRefresh(highlight,searchInstance);ccm_uploadedFiles.push(r.fID);ccm_filesUploadedDialog(searchInstance)}})};ccm_alSelectMultipleIncomingFiles=function(e){$(e).prop("checked")?$("input.ccm-file-select-incoming").attr("checked",!0):$("input.ccm-file-select-incoming").attr("checked",!1)};ccm_starFile=function(e,t){var n="";if($(e).attr("src").indexOf(CCM_STAR_STATES.unstarred)!=-1){$(e).attr("src",$(e).attr("src").replace(CCM_STAR_STATES.unstarred,CCM_STAR_STATES.starred));n="star"}else{$(e).attr("src",$(e).attr("src").replace(CCM_STAR_STATES.starred,CCM_STAR_STATES.unstarred));n="unstar"}$.post(CCM_TOOLS_PATH+"/"+CCM_STAR_ACTION,{action:n,"file-id":t},function(e,t){})};jQuery.cookie=function(e,t,n){if(typeof t=="undefined"){var a=null;if(document.cookie&&document.cookie!=""){var f=document.cookie.split(";");for(var l=0;l<f.length;l++){var c=jQuery.trim(f[l]);if(c.substring(0,e.length+1)==e+"="){a=decodeURIComponent(c.substring(e.length+1));break}}}return a}n=n||{};if(t===null){t="";n=$.extend({},n);n.expires=-1}var r="";if(n.expires&&(typeof n.expires=="number"||n.expires.toUTCString)){var i;if(typeof n.expires=="number"){i=new Date;i.setTime(i.getTime()+n.expires*24*60*60*1e3)}else i=n.expires;r="; expires="+i.toUTCString()}var s=n.path?"; path="+n.path:"",o=n.domain?"; domain="+n.domain:"",u=n.secure?"; secure":"";document.cookie=[e,"=",encodeURIComponent(t),r,s,o,u].join("")};var quickSaveLayoutObj,deleteLayoutObj,ccmLayoutEdit={init:function(){this.showPresetDeleteIcon();$("#ccmLayoutPresentIdSelector").change(function(){var e=parseInt($(this).val()),t=$("#ccmAreaLayoutForm_layoutID").val();jQuery.fn.dialog.showLoader();if(e>0)var n=$("#ccm-layout-refresh-action").val()+"&lpID="+e;else var n=$("#ccm-layout-refresh-action").val()+"&layoutID="+t;$.get(n,function(e){$("#ccm-layout-edit-wrapper").html(e);jQuery.fn.dialog.hideLoader();ccmLayoutEdit.showPresetDeleteIcon()})});$("#layoutPresetActionNew input[name=layoutPresetAction]").click(function(){$(this).val()=="create_new_preset"&&$(this).prop("checked")?$("input[name=layoutPresetName]").attr("disabled",!1).focus():$("input[name=layoutPresetName]").val("").attr("disabled",!0)});$("#layoutPresetActions input[name=layoutPresetAction]").click(function(){$(this).val()=="create_new_preset"&&$(this).prop("checked")?$("input[name=layoutPresetNameAlt]").attr("disabled",!1).focus():$("input[name=layoutPresetNameAlt]").val("").attr("disabled",!0)});$("#layoutPresetActions").length>0&&$("#ccmLayoutConfigOptions input, #ccmLayoutConfigOptions select").bind("change click",function(){$("#layoutPresetActions").show();$("#layoutPresetActionNew").hide();$("#ccmLayoutConfigOptions input, #ccmLayoutConfigOptions select").unbind("change click")})},showPresetDeleteIcon:function(){$("#ccmLayoutPresentIdSelector").val()>0?$("#ccm-layout-delete-preset").show():$("#ccm-layout-delete-preset").hide()},deletePreset:function(){var lpID=parseInt($("#ccmLayoutPresentIdSelector").val());if(lpID>0){if(!confirm(ccmi18n.confirmLayoutPresetDelete))return!1;jQuery.fn.dialog.showLoader();var area=$("#ccmAreaLayoutForm_arHandle").val(),url=CCM_TOOLS_PATH+"/layout_services/?cID="+CCM_CID+"&arHandle="+encodeURIComponent(area)+"&task=deletePreset&lpID="+lpID;$.get(url,function(r){eval("var jObj="+r);parseInt(jObj.success)!=1?alert(jObj.msg):$("#ccmLayoutPresentIdSelector option[value='"+lpID+"']").remove();jQuery.fn.dialog.hideLoader()})}}};$.widget.bridge("jqdialog",$.ui.dialog);jQuery.fn.dialog=function(){if(arguments.length>0){$(this).jqdialog(arguments[0],arguments[1],arguments[2]);return}if($(this).is("div")){$(this).jqdialog();return}return $(this).each(function(){$(this).unbind("click.make-dialog").bind("click.make-dialog",function(e){var t=$(this).attr("href"),n=$(this).attr("dialog-width"),r=$(this).attr("dialog-height"),i=$(this).attr("dialog-title"),s=$(this).attr("dialog-on-open"),o=$(this).attr("dialog-on-destroy"),u=$(this).attr("dialog-on-close");obj={modal:!0,href:t,width:n,height:r,title:i,onOpen:s,onDestroy:o,onClose:u};jQuery.fn.dialog.open(obj);return!1})})};jQuery.fn.dialog.close=function(e){e++;$("#ccm-dialog-content"+e).jqdialog("close")};jQuery.fn.dialog.open=function(obj){jQuery.fn.dialog.showLoader();ccm_uiLoaded&&ccm_hideMenus();var nd=$(".ui-dialog").length;nd++;$("body").append('<div id="ccm-dialog-content'+nd+'" style="display: none"></div>');if(typeof obj.width=="string"){if(obj.width.indexOf("%",0)>0){w=obj.width.replace("%","");w=$(window).width()*(w/100);w+=50}else w=parseInt(obj.width)+50;if(obj.height.indexOf("%",0)>0){h=obj.height.replace("%","");h=$(window).height()*(h/100);h+=100}else h=parseInt(obj.height)+100}else if(obj.width){w=parseInt(obj.width)+50;h=parseInt(obj.height)+100}else{w=550;h=400}h>$(window).height()&&(h=$(window).height());$("#ccm-dialog-content"+nd).jqdialog({modal:!0,height:h,width:w,show:{effect:"fade",duration:150,easing:"easeInExpo"},escapeClose:!0,title:obj.title,open:function(){var e=$(".ui-dialog").length;if(e==1){$("body").attr("data-last-overflow",$("body").css("overflow"));$("body").css("overflow","hidden")}},beforeClose:function(){var e=$(".ui-dialog").length;e==1&&$("body").css("overflow",$("body").attr("data-last-overflow"))},close:function(ev,u){$(this).jqdialog("destroy").remove();$("#ccm-dialog-content"+nd).remove();typeof obj.onClose!="undefined"&&(typeof obj.onClose=="function"?obj.onClose():eval(obj.onClose));typeof obj.onDestroy!="undefined"&&(typeof obj.onDestroy=="function"?obj.onDestroy():eval(obj.onDestroy));nd--}});if(!obj.element)$.ajax({type:"GET",url:obj.href,success:function(r){jQuery.fn.dialog.hideLoader();jQuery.fn.dialog.replaceTop(r);typeof obj.onOpen!="undefined"&&(typeof obj.onOpen=="function"?obj.onOpen():eval(obj.onOpen))}});else{jQuery.fn.dialog.hideLoader();jQuery.fn.dialog.replaceTop($(obj.element));typeof obj.onOpen!="undefined"&&(typeof obj.onOpen=="function"?obj.onOpen():eval(obj.onOpen))}};jQuery.fn.dialog.replaceTop=function(e){var t=$(".ui-dialog").length;if(typeof e=="string")$("#ccm-dialog-content"+t).html(e);else{var n=e.clone(!0,!0).appendTo("#ccm-dialog-content"+t);n.css("display")=="none"&&n.show()}$("#ccm-dialog-content"+t+" .dialog-launch").dialog();$("#ccm-dialog-content"+t+" .ccm-dialog-close").click(function(){jQuery.fn.dialog.closeTop()});if($("#ccm-dialog-content"+t+" .dialog-buttons").length>0){$("#ccm-dialog-content"+t).jqdialog("option","buttons",[{}]);$("#ccm-dialog-content"+t).parent().find(".ui-dialog-buttonset").remove();$("#ccm-dialog-content"+t).parent().find(".ui-dialog-buttonpane").html("");$("#ccm-dialog-content"+t+" .dialog-buttons").appendTo($("#ccm-dialog-content"+t).parent().find(".ui-dialog-buttonpane").addClass("ccm-ui"))}if($("#ccm-dialog-content"+t+" .dialog-help").length>0){$("#ccm-dialog-content"+t+" .dialog-help").hide();var r=$("#ccm-dialog-content"+t+" .dialog-help").html();if(ccmi18n.helpPopup)var i=ccmi18n.helpPopup;else var i="Help";$("#ccm-dialog-content"+t).parent().find(".ui-dialog-titlebar").append('<span class="ccm-dialog-help"><a href="javascript:void(0)" title="'+i+'" class="ccm-menu-help-trigger">Help</a></span>');$("#ccm-dialog-content"+t).parent().find(".ui-dialog-titlebar .ccm-menu-help-trigger").popover({content:function(){return r},placement:"bottom",html:!0,trigger:"click"})}};jQuery.fn.dialog.showLoader=function(e){if(typeof imgLoader=="undefined"||!imgLoader||!imgLoader.src)return!1;$("#ccm-dialog-loader").length<1&&$("body").append("<div id='ccm-dialog-loader-wrapper' class='ccm-ui'><img id='ccm-dialog-loader' src='"+imgLoader.src+"' /></div>");e!=null&&$("<div />").attr("id","ccm-dialog-loader-text").html(e).prependTo($("#ccm-dialog-loader-wrapper"));var t=$("#ccm-dialog-loader-wrapper").width(),n=$("#ccm-dialog-loader-wrapper").height(),r=$(window).width(),i=$(window).height(),s=(r-t)/2,o=(i-n)/2;$("#ccm-dialog-loader-wrapper").css("left",s+"px").css("top",o+"px");$("#ccm-dialog-loader-wrapper").show()};jQuery.fn.dialog.hideLoader=function(){$("#ccm-dialog-loader-wrapper").hide();$("#ccm-dialog-loader-text").remove()};jQuery.fn.dialog.closeTop=function(){var e=$(".ui-dialog").length;$("#ccm-dialog-content"+e).jqdialog("close")};jQuery.fn.dialog.closeAll=function(){$($(".ui-dialog-content").get().reverse()).jqdialog("close")};var imgLoader,ccm_dialogOpen=0;jQuery.fn.dialog.loaderImage=CCM_IMAGE_PATH+"/throbber_white_32.gif";var ccmAlert={notice:function(e,t,n){$.fn.dialog.open({href:CCM_TOOLS_PATH+"/alert",title:e,width:320,height:160,modal:!1,onOpen:function(){$("#ccm-popup-alert-message").html(t)},onDestroy:n})},hud:function(e,t,n,r){$("#ccm-notification-inner").length==0&&$(document.body).append('<div id="ccm-notification" class="ccm-ui"><div id="ccm-notification-inner"></div></div>');n==null&&(n="edit_small");if(r==null)var i=e;else var i="<h3>"+r+"</h3>"+e;$("#ccm-notification-inner").html('<img id="ccm-notification-icon" src="'+CCM_IMAGE_PATH+"/icons/"+n+'.png" width="16" height="16" /><div id="ccm-notification-message">'+i+"</div>");$("#ccm-notification").show();t>0&&setTimeout(function(){$("#ccm-notification").fadeOut({easing:"easeOutExpo",duration:300})},t)}};$(document).ready(function(){imgLoader=new Image;imgLoader.src=jQuery.fn.dialog.loaderImage});ccm_closeNewsflow=function(e){$ovl=ccm_getNewsflowOverlayWindow();$ovl.fadeOut(300,"easeOutExpo");$(".ui-widget-overlay").fadeOut(300,"easeOutExpo",function(){$(this).remove()})};ccm_setNewsflowPagingArrowHeight=function(){if($("#ccm-marketplace-detail").length>0)var e=$("#ccm-marketplace-detail");else var e=$("#newsflow-main");var t=e.height();$(".newsflow-paging-previous a, .newsflow-paging-next a").css("height",t+"px");$(".newsflow-paging-previous, .newsflow-paging-next").css("height",t+"px");$(".newsflow-paging-next").show();$(".newsflow-paging-previous").show()};ccm_setNewsflowOverlayDimensions=function(){if($("#newsflow-overlay").length>0){var e=$("#newsflow-overlay").width(),t=$(window).width(),n=$(window).height(),r=650,i=n-80;i>r?h=r:h=i;$("#newsflow-overlay").css("height",r);var s=(t-e)/2,o=(n-h)/2;o+=29;s+="px";o+="px";$("#newsflow-overlay").css("left",s).css("top",o)}};ccm_getNewsflowOverlayWindow=function(){if($("#ccm-dashboard-content").length>0&&$("#newsflow-main").length>0&&$("#newsflow-overlay").length==0)var e=$("#newsflow-main").parent();else if($("#newsflow-overlay").length>0)var e=$("#newsflow-overlay");else var e=$("<div />").attr("id","newsflow-overlay").attr("class","ccm-ui").css("display","none").appendTo(document.body);return e};ccm_showNewsflowOverlayWindow=function(e,t){if(!($("#ccm-dashboard-content").length>0&&$("#newsflow-main").length>0)){if($(".ui-widget-overlay").length<1)var n=$('<div class="ui-widget-overlay"></div>').hide().appendTo("body");$(".ui-widget-overlay").show()}$(window).resize(function(){ccm_setNewsflowOverlayDimensions()});$ovl=ccm_getNewsflowOverlayWindow();$ovl.load(e,function(){$ovl.hide();$(".newsflow-paging-next").hide();$(".newsflow-paging-previous").hide();$ovl.html($(this).html());t&&t();ccm_setNewsflowOverlayDimensions();ccm_setupTrickleUpNewsflowStyles();$ovl.fadeIn("300","easeOutExpo",function(){ccm_setNewsflowPagingArrowHeight()})})};ccm_setupTrickleUpNewsflowStyles=function(){ovl=ccm_getNewsflowOverlayWindow();ovl.find(".newsflow-em1").each(function(){$(this).parent().addClass("newsflow-em1")})};ccm_showDashboardNewsflowWelcome=function(){jQuery.fn.dialog.showLoader(ccmi18n.newsflowLoading);ccm_showNewsflowOverlayWindow(CCM_DISPATCHER_FILENAME+"/dashboard/home?_ccm_dashboard_external=1",function(){jQuery.fn.dialog.hideLoader()})};ccm_showNewsflowOffsite=function(e){jQuery.fn.dialog.showLoader();ccm_showNewsflowOverlayWindow(CCM_TOOLS_PATH+"/newsflow?cID="+e,function(){jQuery.fn.dialog.hideLoader()})};ccm_showAppIntroduction=function(){ccm_showNewsflowOverlayWindow(CCM_DISPATCHER_FILENAME+"/dashboard/welcome?_ccm_dashboard_external=1")};ccm_getNewsflowByPath=function(e){jQuery.fn.dialog.showLoader();ccm_showNewsflowOverlayWindow(CCM_TOOLS_PATH+"/newsflow?cPath="+e,function(){jQuery.fn.dialog.hideLoader()})};ccm_doPageReindexing=function(){$.get(CCM_TOOLS_PATH+"/reindex_pending_pages?ccm_token="+CCM_SECURITY_TOKEN)};String.prototype.score=function(e,t){t=t||0;if(e.length==0)return.9;if(e.length>this.length)return 0;for(var n=e.length;n>0;n--){var r=e.substring(0,n),i=this.indexOf(r);if(i<0)continue;if(i+e.length>this.length+t)continue;var s=this.substring(i+r.length),o=null;n>=e.length?o="":o=e.substring(n);var u=s.score(o,t+i);if(u>0){var a=this.length-s.length;if(i!=0){var f=0,l=this.charCodeAt(i-1);if(l==32||l==9)for(var f=i-2;f>=0;f--){l=this.charCodeAt(f);a-=l==32||l==9?1:.15}else a-=i}a+=u*s.length;a/=this.length;return a}}return 0};ccm_openThemeLauncher=function(){jQuery.fn.dialog.closeTop();jQuery.fn.dialog.showLoader();ccm_testMarketplaceConnection(function(){$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/themes",width:"905",modal:!1,height:"410"})},"open_theme_launcher")};ccm_testMarketplaceConnection=function(e,t,n){n?mpIDStr="&mpID="+n:mpIDStr="";t||(t="");params={mpID:n};$.getJSON(CCM_TOOLS_PATH+"/marketplace/connect",params,function(n){if(!n.isConnected){$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/frame?task="+t+mpIDStr,width:"90%",modal:!1,height:"70%"});return!1}e()})};ccm_openAddonLauncher=function(){jQuery.fn.dialog.closeTop();jQuery.fn.dialog.showLoader();ccm_testMarketplaceConnection(function(){$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/add-ons",width:"905",modal:!1,height:"410"})},"open_addon_launcher")};ccm_setupMarketplaceDialogForm=function(){$(".ccm-pane-dialog-pagination").each(function(){$(this).closest(".ui-dialog-content").dialog("option","buttons",[{}]);$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane .ccm-pane-dialog-pagination").remove();$(this).appendTo($(this).closest(".ui-dialog").find(".ui-dialog-buttonpane").addClass("ccm-ui"))});$(".ccm-pane-dialog-pagination a").click(function(){jQuery.fn.dialog.showLoader();$("#ccm-marketplace-browser-form").closest(".ui-dialog-content").load($(this).attr("href"),function(){jQuery.fn.dialog.hideLoader()});return!1});ccm_marketplaceBrowserInit();$("#ccm-marketplace-browser-form").ajaxForm({beforeSubmit:function(){jQuery.fn.dialog.showLoader()},success:function(e){jQuery.fn.dialog.hideLoader();$("#ccm-marketplace-browser-form").closest(".ui-dialog-content").html(e)}})};ccm_marketplaceBrowserInit=function(){$(".ccm-marketplace-item").click(function(){ccm_getMarketplaceItemDetails($(this).attr("mpID"))});$(".ccm-marketplace-item-thumbnail").mouseover(function(){var e=$(this).parent().find("div.ccm-marketplace-results-image-hover").clone().addClass("ccm-marketplace-results-image-hover-displayed").appendTo(document.body),t=$(this).offset().top,n=$(this).offset().left;n+=60;e.css("top",t).css("left",n);e.show()});$(".ccm-marketplace-item-thumbnail").mouseout(function(){$(".ccm-marketplace-results-image-hover-displayed").hide().remove()})};ccm_getMarketplaceItemDetails=function(e){jQuery.fn.dialog.showLoader();$("#ccm-intelligent-search-results").hide();ccm_testMarketplaceConnection(function(){$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/details?mpID="+e,width:820,appendButtons:!0,modal:!1,height:640})},"get_item_details",e)};ccm_getMarketplaceItem=function(e){var t=e.mpID,n=e.closeTop;this.onComplete=function(){};e.onComplete&&(ccm_getMarketplaceItem.onComplete=e.onComplete);n&&jQuery.fn.dialog.closeTop();jQuery.fn.dialog.showLoader();params={mpID:t};$.getJSON(CCM_TOOLS_PATH+"/marketplace/connect",params,function(e){jQuery.fn.dialog.hideLoader();e.isConnected?e.purchaseRequired?$.fn.dialog.open({title:ccmi18n.communityCheckout,iframe:!0,href:CCM_TOOLS_PATH+"/marketplace/checkout?mpID="+t,width:"560px",modal:!1,height:"400px"}):$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/download?install=1&mpID="+t,width:500,appendButtons:!0,modal:!1,height:400}):$.fn.dialog.open({title:ccmi18n.community,href:CCM_TOOLS_PATH+"/marketplace/frame?task=get&mpID="+t,width:"90%",modal:!1,height:"70%"})})};var ccm_searchActivatePostFunction=new Array;ccm_setupAdvancedSearchFields=function(e){ccm_totalAdvancedSearchFields=$(".ccm-search-request-field-set").length;$("#ccm-"+e+"-search-add-option").unbind();$("#ccm-"+e+"-search-add-option").click(function(){ccm_totalAdvancedSearchFields++;$("#ccm-search-fields-wrapper").length>0?$("#ccm-search-fields-wrapper").append('<div class="ccm-search-field" id="ccm-'+e+"-search-field-set"+ccm_totalAdvancedSearchFields+'">'+$("#ccm-search-field-base").html()+"</div>"):$("#ccm-"+e+"-search-advanced-fields").append('<tr class="ccm-search-field" id="ccm-'+e+"-search-field-set"+ccm_totalAdvancedSearchFields+'">'+$("#ccm-search-field-base").html()+"</tr>");ccm_activateAdvancedSearchFields(e,ccm_totalAdvancedSearchFields)});var t=1;$(".ccm-search-request-field-set").each(function(){ccm_activateAdvancedSearchFields(e,t);t++})};ccm_setupAdvancedSearch=function(e){ccm_setupAdvancedSearchFields(e);$("#ccm-"+e+"-advanced-search").ajaxForm({beforeSubmit:function(){ccm_deactivateSearchResults(e)},success:function(t){ccm_parseAdvancedSearchResponse(t,e)}});ccm_setupInPagePaginationAndSorting(e);ccm_setupSortableColumnSelection(e)};ccm_parseAdvancedSearchResponse=function(e,t){var n=$("#ccm-"+t+"-search-results");if(n.length==0||t==null)n=$("#ccm-search-results");n.html(e);ccm_activateSearchResults(t)};ccm_deactivateSearchResults=function(e){var t=$("#ccm-"+e+"-search-fields-submit");if(t.length==0||e==null)t=$("#ccm-search-fields-submit");t.attr("disabled",!0);var t=$("#ccm-"+e+"-search-results table.ccm-results-list");if(t.length==0||e==null)t=$("#ccm-search-results");t.css("opacity",.4);jQuery.fn.dialog.showLoader()};ccm_activateSearchResults=function(e){$(".ui-dialog-content").length==0?window.scrollTo(0,0):$(".ui-dialog-content").each(function(e){$(this).get(0).scrollTop=0});$(".dialog-launch").dialog();var t=$("#ccm-"+e+"-search-results table.ccm-results-list");if(t.length==0||e==null)t=$("#ccm-search-results");t.css("opacity",1);jQuery.fn.dialog.hideLoader();var t=$("#ccm-"+e+"-search-fields-submit");if(t.length==0||e==null)t=$("#ccm-search-fields-submit");t.attr("disabled",!1);ccm_setupInPagePaginationAndSorting(e);ccm_setupSortableColumnSelection(e);typeof ccm_searchActivatePostFunction[e]=="function"&&ccm_searchActivatePostFunction[e]()};ccm_setupInPagePaginationAndSorting=function(e){$(".ccm-results-list th a").click(function(){ccm_deactivateSearchResults(e);var t=$("#ccm-"+e+"-search-results");t.length==0&&(t=$("#ccm-search-results"));t.load($(this).attr("href"),!1,function(){ccm_activateSearchResults(e)});return!1});$("div.ccm-pagination a").click(function(){if(!$(this).parent().hasClass("disabled")){ccm_deactivateSearchResults(e);var t=$("#ccm-"+e+"-search-results");t.length==0&&(t=$("#ccm-search-results"));t.load($(this).attr("href"),!1,function(){ccm_activateSearchResults(e);$("div.ccm-dialog-content").attr("scrollTop",0)})}return!1});$(".ccm-pane-dialog-pagination").each(function(){$(this).closest(".ui-dialog-content").dialog("option","buttons",[{}]);$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane .ccm-pane-dialog-pagination").remove();$(this).appendTo($(this).closest(".ui-dialog").find(".ui-dialog-buttonpane").addClass("ccm-ui"))})};ccm_setupSortableColumnSelection=function(e){$("#ccm-list-view-customize").unbind();$("#ccm-list-view-customize").click(function(){jQuery.fn.dialog.open({width:550,height:350,appendButtons:!0,modal:!1,href:$(this).attr("href"),title:ccmi18n.customizeSearch});return!1})};ccm_checkSelectedAdvancedSearchField=function(e,t){$("#ccm-"+e+"-search-field-set"+t+" .ccm-search-option-type-date_time input").each(function(){$(this).attr("id",$(this).attr("id")+t)});$("#ccm-"+e+"-search-field-set"+t+" .ccm-search-option-type-date_time input").datepicker({showAnim:"fadeIn"});$("#ccm-"+e+"-search-field-set"+t+" .ccm-search-option-type-rating input").rating()};ccm_activateAdvancedSearchFields=function(e,t){var n=$("#ccm-"+e+"-search-field-set"+t+" select:first");n.unbind();n.change(function(){var n=$(this).find(":selected").val();$(this).parent().parent().find("input.ccm-"+e+"-selected-field").val(n);var r=$("#ccm-"+e+"-search-field-base-elements span[search-field="+n+"]");$("#ccm-"+e+"-search-field-set"+t+" .ccm-selected-field-content").html("");r.clone().appendTo("#ccm-"+e+"-search-field-set"+t+" .ccm-selected-field-content");$("#ccm-"+e+"-search-field-set"+t+" .ccm-selected-field-content .ccm-search-option").show();ccm_checkSelectedAdvancedSearchField(e,t)});$("#ccm-"+e+"-search-field-set"+t+" .ccm-search-remove-option").unbind();$("#ccm-"+e+"-search-field-set"+t+" .ccm-search-remove-option").click(function(){$(this).parents("div.ccm-search-field").remove();$(this).parents("tr.ccm-search-field").remove()});ccm_checkSelectedAdvancedSearchField(e,t)};ccm_activateEditablePropertiesGrid=function(){$("tr.ccm-attribute-editable-field").each(function(){var e=$(this);$(this).find("a").click(function(){e.find(".ccm-attribute-editable-field-text").hide();e.find(".ccm-attribute-editable-field-clear-button").hide();e.find(".ccm-attribute-editable-field-form").show();e.find(".ccm-attribute-editable-field-save-button").show()});e.find("form").submit(function(){return!1});e.find(".ccm-attribute-editable-field-save-button").parent().click(function(){var t=e.find("form input[name=task]");if(t.val()=="clear_extended_attribute"){t.val(t.attr("data-original-task"));t.attr("data-original-task","")}ccm_submitEditablePropertiesGrid(e)});e.find(".ccm-attribute-editable-field-clear-button").parent().unbind();e.find(".ccm-attribute-editable-field-clear-button").parent().click(function(){var t=e.find("form input[name=task]");t.attr("data-original-task",t.val());t.val("clear_extended_attribute");ccm_submitEditablePropertiesGrid(e);return!1})})};ccm_submitEditablePropertiesGrid=function(e){e.find(".ccm-attribute-editable-field-save-button").hide();e.find(".ccm-attribute-editable-field-clear-button").hide();e.find(".ccm-attribute-editable-field-loading").show();try{tinyMCE.triggerSave(!0,!0)}catch(t){}e.find("form").ajaxSubmit(function(t){e.find(".ccm-attribute-editable-field-loading").hide();e.find(".ccm-attribute-editable-field-save-button").show();e.find(".ccm-attribute-editable-field-text").html(t);e.find(".ccm-attribute-editable-field-form").hide();e.find(".ccm-attribute-editable-field-save-button").hide();e.find(".ccm-attribute-editable-field-text").show();e.find(".ccm-attribute-editable-field-clear-button").show();e.find("td").show("highlight",{color:"#FFF9BB"})})};var tr_activeNode=!1;if(typeof tr_doAnim=="undefined")var tr_doAnim=!1;var tr_parseSubnodes=!0,tr_reorderMode=!1,tr_moveCopyMode=!1;showPageMenu=function(e,t){ccm_hideMenus();t.stopPropagation();var n=$("#ccm-page-menu"+e.cID);if(!n.get(0)){el=document.createElement("DIV");el.id="ccm-page-menu"+e.cID;el.className="ccm-menu ccm-ui";el.style.display="block";el.style.visibility="hidden";document.body.appendChild(el);n=$("#ccm-page-menu"+e.cID);n.css("position","absolute");var r='<div class="popover"><div class="arrow"></div><div class="inner"><div class="content">';r+="<ul>";if(e.isTrash)r+='<li><a class="ccm-menu-icon ccm-icon-delete-menu" onclick="ccm_sitemapEmptyTrash('+e.instance_id+","+e.cID+')" href="javascript:void(0)">'+ccmi18n_sitemap.emptyTrash+"</a></li>";else if(e.inTrash){r+='<li><a class="ccm-menu-icon ccm-icon-search-pages" onclick="ccm_previewInternalTheme('+e.cID+", false, '"+ccmi18n_sitemap.previewPage+'\')" href="javascript:void(0)">'+ccmi18n_sitemap.previewPage+"</a></li>";r+='<li class="ccm-menu-separator"></li>';r+='<li><a class="ccm-menu-icon ccm-icon-delete-menu" onclick="ccm_sitemapDeleteForever('+e.instance_id+","+e.cID+')" href="javascript:void(0)">'+ccmi18n_sitemap.deletePageForever+"</a></li>"}else if(e.cAlias=="LINK"||e.cAlias=="POINTER"){r+='<li><a class="ccm-menu-icon ccm-icon-visit" id="menuVisit'+e.cID+'" href="javascript:void(0)" onclick="window.location.href=\''+CCM_DISPATCHER_FILENAME+"?cID="+e.cID+"'\">"+ccmi18n_sitemap.visitExternalLink+"</a></li>";e.cAlias=="LINK"&&e.canEditProperties&&(r+='<li><a class="ccm-menu-icon ccm-icon-edit-external-link" dialog-width="350" dialog-height="170" dialog-title="'+ccmi18n_sitemap.editExternalLink+'" dialog-modal="false" dialog-append-buttons="true" id="menuLink'+e.cID+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+e.cID+'&ctask=edit_external">'+ccmi18n_sitemap.editExternalLink+"</a></li>");e.canDelete&&(r+='<li><a class="ccm-menu-icon ccm-icon-delete-menu" dialog-append-buttons="true" id="menuDelete'+e.cID+'" dialog-width="360" dialog-height="150" dialog-modal="false" dialog-append-buttons="true" dialog-title="'+ccmi18n_sitemap.deleteExternalLink+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+e.cID+"&display_mode="+e.display_mode+"&instance_id="+e.instance_id+"&select_mode="+e.select_mode+'&ctask=delete_external">'+ccmi18n_sitemap.deleteExternalLink+"</a></li>")}else{r+='<li><a class="ccm-menu-icon ccm-icon-visit" id="menuVisit'+e.cID+'" href="'+CCM_DISPATCHER_FILENAME+"?cID="+e.cID+'">'+ccmi18n_sitemap.visitPage+"</a></li>";e.canCompose&&(r+='<li><a class="ccm-menu-icon ccm-icon-edit-in-composer-menu" id="menuComposer'+e.cID+'" href="'+CCM_DISPATCHER_FILENAME+"/dashboard/composer/write/-/edit/"+e.cID+'">'+ccmi18n_sitemap.editInComposer+"</a></li>");if(e.canEditProperties||e.canEditSpeedSettings||e.canEditPermissions||e.canEditDesign||e.canViewVersions||e.canDelete)r+='<li class="ccm-menu-separator"></li>';e.canEditProperties&&(r+='<li><a class="ccm-menu-icon ccm-icon-properties-menu" dialog-on-close="ccm_sitemapExitEditMode('+e.cID+')" dialog-width="670" dialog-height="360" dialog-append-buttons="true" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.pagePropertiesTitle+'" id="menuProperties'+e.cID+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+e.cID+'&ctask=edit_metadata">'+ccmi18n_sitemap.pageProperties+"</a></li>");e.canEditSpeedSettings&&(r+='<li><a class="ccm-menu-icon ccm-icon-speed-settings-menu" dialog-on-close="ccm_sitemapExitEditMode('+e.cID+')" dialog-width="550" dialog-height="280" dialog-append-buttons="true" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.speedSettingsTitle+'" id="menuSpeedSettings'+e.cID+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+e.cID+'&ctask=edit_speed_settings">'+ccmi18n_sitemap.speedSettings+"</a></li>");e.canEditPermissions&&(r+='<li><a class="ccm-menu-icon ccm-icon-permissions-menu" dialog-on-close="ccm_sitemapExitEditMode('+e.cID+')" dialog-width="420" dialog-height="630" dialog-append-buttons="true" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.setPagePermissions+'" id="menuPermissions'+e.cID+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+e.cID+'&ctask=edit_permissions">'+ccmi18n_sitemap.setPagePermissions+"</a></li>");e.canEditDesign&&(r+='<li><a class="ccm-menu-icon ccm-icon-design-menu" dialog-on-close="ccm_sitemapExitEditMode('+e.cID+')" dialog-width="610" dialog-append-buttons="true" dialog-height="405" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.pageDesign+'" id="menuDesign'+e.cID+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+e.cID+'&ctask=set_theme">'+ccmi18n_sitemap.pageDesign+"</a></li>");e.canViewVersions&&(r+='<li><a class="ccm-menu-icon ccm-icon-versions-menu" dialog-on-close="ccm_sitemapExitEditMode('+e.cID+')" dialog-width="640" dialog-height="340" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.pageVersions+'" id="menuVersions'+e.cID+'" href="'+CCM_TOOLS_PATH+"/versions.php?rel=SITEMAP&cID="+e.cID+'">'+ccmi18n_sitemap.pageVersions+"</a></li>");e.canDelete&&(r+='<li><a class="ccm-menu-icon ccm-icon-delete-menu" dialog-on-close="ccm_sitemapExitEditMode('+e.cID+')" dialog-append-buttons="true" id="menuDelete'+e.cID+'" dialog-width="360" dialog-height="150" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.deletePage+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+e.cID+"&display_mode="+e.display_mode+"&instance_id="+e.instance_id+"&select_mode="+e.select_mode+'&ctask=delete">'+ccmi18n_sitemap.deletePage+"</a></li>");if(e.display_mode=="explore"||e.display_mode=="search"){r+='<li class="ccm-menu-separator"></li>';r+='<li><a class="ccm-menu-icon ccm-icon-move-copy-menu" dialog-width="90%" dialog-height="70%" dialog-modal="false" dialog-title="'+ccmi18n_sitemap.moveCopyPage+'" id="menuMoveCopy'+e.cID+'" href="'+CCM_TOOLS_PATH+"/sitemap_search_selector?sitemap_select_mode=move_copy_delete&cID="+e.cID+'" id="menuMoveCopy'+e.cID+'">'+ccmi18n_sitemap.moveCopyPage+"</a></li>";if(e.display_mode=="explore"){r+='<li><a class="ccm-menu-icon ccm-icon-move-up" id="menuSendToStop'+e.cID+'" href="'+CCM_DISPATCHER_FILENAME+"/dashboard/sitemap/explore?cNodeID="+
e.cID+'&task=send_to_top">'+ccmi18n_sitemap.sendToTop+"</a></li>";r+='<li><a class="ccm-menu-icon ccm-icon-move-down" id="menuSendToBottom'+e.cID+'" href="'+CCM_DISPATCHER_FILENAME+"/dashboard/sitemap/explore?cNodeID="+e.cID+'&task=send_to_bottom">'+ccmi18n_sitemap.sendToBottom+"</a></li>"}}if(e.cNumChildren>0){r+='<li class="ccm-menu-separator"></li>';var i=CCM_DISPATCHER_FILENAME+"/dashboard/sitemap/search/?selectedSearchField[]=parent&cParentAll=1&cParentIDSearchField="+e.cID;if(e.display_mode=="full"||e.display_mode==""||e.display_mode=="explore")r+='<li><a class="ccm-menu-icon ccm-icon-search-pages" id="menuSearch'+e.cID+'" href="'+i+'">'+ccmi18n_sitemap.searchPages+"</a></li>";e.display_mode!="explore"&&(r+='<li><a class="ccm-menu-icon ccm-icon-flat-view" id="menuExplore'+e.cID+'" href="'+CCM_DISPATCHER_FILENAME+"/dashboard/sitemap/explore/-/"+e.cID+'">'+ccmi18n_sitemap.explorePages+"</a></li>")}if(e.canAddSubpages||e.canAddExternalLinks)r+='<li class="ccm-menu-separator"></li>';e.canAddSubpages&&(r+='<li><a class="ccm-menu-icon ccm-icon-add-page-menu" dialog-append-buttons="true" dialog-width="645" dialog-modal="false" dialog-height="345" dialog-title="'+ccmi18n_sitemap.addPage+'" id="menuSubPage'+e.cID+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&mode="+e.display_mode+"&cID="+e.cID+'&ctask=add">'+ccmi18n_sitemap.addPage+"</a></li>");e.display_mode!="search"&&e.canAddExternalLinks&&(r+='<li><a class="ccm-menu-icon ccm-icon-add-external-link-menu" dialog-width="350" dialog-modal="false" dialog-height="170" dialog-title="'+ccmi18n_sitemap.addExternalLink+'" dialog-modal="false" dialog-append-buttons="true" id="menuLink'+e.cID+'" href="'+CCM_TOOLS_PATH+"/edit_collection_popup.php?rel=SITEMAP&cID="+e.cID+'&ctask=add_external">'+ccmi18n_sitemap.addExternalLink+"</a></li>")}r+="</ul>";r+="</div></div></div>";n.append(r);$(n).find("a").bind("click.hide-menu",function(e){ccm_hideMenus()});$("#menuProperties"+e.cID).dialog();$("#menuSpeedSettings"+e.cID).dialog();$("#menuSubPage"+e.cID).dialog();$("#menuDesign"+e.cID).dialog();$("#menuLink"+e.cID).dialog();$("#menuVersions"+e.cID).dialog();$("#menuPermissions"+e.cID).dialog();$("#menuMoveCopy"+e.cID).dialog();$("#menuDelete"+e.cID).dialog()}else n=$("#ccm-page-menu"+e.cID);ccm_fadeInMenu(n,t)};hideBranch=function(e){$("#tree-node"+e).hide();$("#tree-dz"+e).hide()};cancelReorder=function(){if(tr_reorderMode){tr_reorderMode=!1;$("li.tree-node[draggable=true]").draggable("destroy");tr_moveCopyMode||hideSitemapMessage()}};ccm_sitemapExitEditMode=function(e){$.get(CCM_TOOLS_PATH+"/dashboard/sitemap_check_in?cID="+e+"&ccm_token="+CCM_SECURITY_TOKEN)};searchSubPages=function(e){$("#ccm-tree-search-trigger"+e).hide();if(ccm_animEffects)$("#ccm-tree-search"+e).fadeIn(200,function(){$("#ccm-tree-search"+e+" input").get(0).focus()});else{$("#ccm-tree-search"+e).show();$("#ccm-tree-search"+e+" input").get(0).focus()}};activateReorder=function(){tr_reorderMode=!0;$("li.tree-node[draggable=true]").draggable({handle:"img.handle",opacity:.5,revert:!1,helper:"clone",start:function(){$(document.body).css("overflowX","hidden")},stop:function(){$(document.body).css("overflowX","auto")}});fixResortingDroppables()};deleteBranchFade=function(e){if(ccm_animEffects){$("#tree-node"+e).fadeOut(300,function(){$("#tree-node"+e).remove()});$("#tree-dz"+e).fadeOut(300,function(){$("#tree-dz"+e).remove()})}else deleteBranchDirect(e)};deleteBranchDirect=function(e){$("#tree-node"+e).remove();$("#tree-dz"+e).remove()};showBranch=function(e){var t=$("#tree-node"+e);$("#tree-node"+e).show();$("#tree-dz"+e).show()};rescanDisplayOrder=function(e){setLoading(e);var t="?foo=1",n=$("#tree-root"+e).children("li.tree-node");for(i=0;i<n.length;i++){if($(n[i]).hasClass("ui-draggable-dragging"))continue;t+="&cID[]="+$(n[i]).attr("id").substring(9)}$.getJSON(CCM_TOOLS_PATH+"/dashboard/sitemap_update.php",t,function(t){ccm_parseJSON(t,function(){});removeLoading(e)})};var SITEMAP_LAST_DIALOGUE_URL="",ccm_sitemap_html="";parseSitemapResponse=function(e,t,n,r,i){var s=$("ul[tree-root-node-id="+r+"][sitemap-instance-id="+e+"]");s.html(i);s.slideDown(150,"easeOutExpo")};selectMoveCopyTarget=function(e,t,n,r,i){if(!i)var i=CCM_CID;var s=ccmi18n_sitemap.moveCopyPage,o=CCM_TOOLS_PATH+"/dashboard/sitemap_drag_request.php?instance_id="+e+"&display_mode="+t+"&select_mode="+n+"&origCID="+i+"&destCID="+r,u=350,a=350;try{if(CCM_NODE_ACTION=="<none>"){CCM_TARGET_ID!=""&&$("#"+CCM_TARGET_ID).val(r);$.fn.dialog.closeTop();return}CCM_NODE_ACTION!=""&&(o=CCM_NODE_ACTION+"?destCID="+r);CCM_DIALOG_TITLE!=""&&(s=CCM_DIALOG_TITLE);CCM_DIALOG_HEIGHT!=""&&(u=CCM_DIALOG_HEIGHT);CCM_DIALOG_WIDTH!=""&&(a=CCM_DIALOG_WIDTH)}catch(f){}$.fn.dialog.open({title:s,href:o,width:a,appendButtons:!0,modal:!1,height:u,onClose:function(){typeof CCM_TARGET_ID!="undefined"&&CCM_TARGET_ID!=""&&$("#"+CCM_TARGET_ID).val(r);tr_moveCopyMode==1&&deactivateMoveCopy()}})};selectLabel=function(e,node){var cNumChildren=node.attr("tree-node-children");if(node.attr("sitemap-select-mode")=="move_copy_delete"||tr_moveCopyMode==1){var destCID=node.attr("id").substring(10),origCID=node.attr("selected-page-id");selectMoveCopyTarget(node.attr("sitemap-instance-id"),node.attr("sitemap-display-mode"),node.attr("sitemap-select-mode"),destCID,origCID)}else if(node.attr("sitemap-select-mode")=="select_page"){var callback=node.parents("[sitemap-wrapper=1]").attr("sitemap-select-callback");if(callback==null||callback==""||typeof callback=="undefined")callback="ccm_selectSitemapNode";eval(callback+"(node.attr('id').substring(10), unescape(node.attr('tree-node-title')));");jQuery.fn.dialog.closeTop()}else{node.addClass("tree-label-selected");tr_activeNode!=0&&tr_activeNode.attr("id")!=node.attr("id")&&tr_activeNode.removeClass("tree-label-selected");params={cID:node.attr("id").substring(10),display_mode:node.attr("sitemap-display-mode"),isTrash:node.attr("tree-node-istrash"),inTrash:node.attr("tree-node-intrash"),select_mode:node.attr("sitemap-select-mode"),instance_id:node.attr("sitemap-instance-id"),canCompose:node.attr("tree-node-cancompose"),canEditProperties:node.attr("tree-node-can-edit-properties"),canEditSpeedSettings:node.attr("tree-node-can-edit-speed-settings"),canEditPermissions:node.attr("tree-node-can-edit-permissions"),canEditDesign:node.attr("tree-node-can-edit-design"),canViewVersions:node.attr("tree-node-can-view-versions"),canDelete:node.attr("tree-node-can-delete"),canAddSubpages:node.attr("tree-node-can-add-subpages"),canAddExternalLinks:node.attr("tree-node-can-add-external-links"),cNumChildren:node.attr("tree-node-children"),cAlias:node.attr("tree-node-alias")};showPageMenu(params,e);tr_activeNode=node}};ccmSitemapHighlightPageLabel=function(e,t){var n=$("#tree-label"+e+" > span");if(n.length==0){var n=$("tr.ccm-list-record[cID="+e+"]");n.length>0&&$("#ccm-page-advanced-search").submit()}else t!=null&&n.html(t);n.show("highlight")};activateLabels=function(e,t,n){var r=$("ul[sitemap-instance-id="+e+"]");r.find("div.tree-label span").unbind();r.find("div.tree-label span").click(function(e){selectLabel(e,$(this).parent())});r.find("ul[tree-root-state=closed]").each(function(){var e=$(this),t=$(this).attr("tree-root-node-id");if($(this).find("li").length>0){e.attr("tree-root-state","open");$("#tree-collapse"+t).attr("src",CCM_IMAGE_PATH+"/dashboard/minus.jpg")}});(n=="select_page"||n=="move_copy_delete")&&r.find("li.ccm-sitemap-explore-paging a").each(function(){$(this).click(function(){var r=$(this).parentsUntil("ul").parent().parentsUntil("ul").parent().attr("tree-root-node-id");jQuery.fn.dialog.showLoader();$.get($(this).attr("href"),function(i){parseSitemapResponse(e,t,n,r,i);activateLabels(e,t,n);jQuery.fn.dialog.hideLoader()});return!1})});(t=="explore"||t=="full")&&!n&&r.find("img.handle").addClass("moveable");if(t=="full"&&!n){r.find("div.tree-label").droppable({accept:".tree-node",hoverClass:"on-drop",drop:function(t,n){var r=n.draggable,i=$(this).attr("id").substring(10),s=$(r).attr("id").substring(9);if(i==s)return!1;var o=CCM_TOOLS_PATH+"/dashboard/sitemap_drag_request.php?instance_id="+e+"&origCID="+s+"&destCID="+i;if(SITEMAP_LAST_DIALOGUE_URL==o)return!1;SITEMAP_LAST_DIALOGUE_URL=o;$.fn.dialog.open({title:ccmi18n_sitemap.moveCopyPage,href:o,width:350,modal:!1,height:350,appendButtons:!0,onClose:function(){showBranch(s)}})}});r.find("li.tree-node[draggable=true]").draggable({handle:"img.handle",opacity:.5,revert:!1,helper:"clone",start:function(){$(document.body).css("overflowX","hidden")},stop:function(){$(document.body).css("overflowX","auto")}})}};moveCopyAliasNode=function(e){var t=$("#origCID").val(),n=$("#destParentID").val(),r=$("#destCID").val(),i=$("input[name=ctask]:checked").val(),s=$("input[name=instance_id]").val(),o=$("input[name=display_mode]").val(),u=$("input[name=select_mode]").val(),a=$("input[name=copyAll]:checked").val(),f=$("input[name=saveOldPagePath]:checked").val();params={origCID:t,destCID:r,ctask:i,ccm_token:CCM_SECURITY_TOKEN,copyAll:a,saveOldPagePath:f};jQuery.fn.dialog.showLoader();$.getJSON(CCM_TOOLS_PATH+"/dashboard/sitemap_drag_request.php",params,function(a){ccm_parseJSON(a,function(){jQuery.fn.dialog.closeAll();jQuery.fn.dialog.hideLoader();ccmAlert.hud(a.message,2e3);if(e==1){if(typeof CCM_LAUNCHER_SITEMAP=="undefined"){setTimeout(function(){window.location.href=CCM_DISPATCHER_FILENAME+"?cID="+a.cID},2e3);return!1}if(CCM_LAUNCHER_SITEMAP=="explore"){window.location.href=CCM_DISPATCHER_FILENAME+"/dashboard/sitemap/explore/-/"+r;return!1}if(CCM_LAUNCHER_SITEMAP=="search"){ccm_deactivateSearchResults(CCM_SEARCH_INSTANCE_ID);$("#ccm-"+CCM_SEARCH_INSTANCE_ID+"-advanced-search").ajaxSubmit(function(e){ccm_parseAdvancedSearchResponse(e,CCM_SEARCH_INSTANCE_ID)})}}switch(i){case"COPY":case"ALIAS":showBranch(t);break;case"MOVE":deleteBranchDirect(t)}openSub(s,n,o,u,function(){openSub(s,r,o,u)});jQuery.fn.dialog.closeTop();jQuery.fn.dialog.closeTop()})})};toggleSub=function(e,t,n,r){ccm_hideMenus();var i=$("ul[tree-root-node-id="+t+"][sitemap-instance-id="+e+"]");i.attr("tree-root-state")=="closed"?openSub(e,t,n,r):closeSub(e,t,n,r)};ccm_sitemapEmptyTrash=function(e,t){setLoading(t);$.getJSON(CCM_TOOLS_PATH+"/dashboard/sitemap_empty_trash.php",function(n){ccm_parseJSON(n,function(){closeSub(e,t,"full","");removeLoading(t);var r=$("ul[tree-root-node-id="+t+"][sitemap-instance-id="+e+"]").parent();r.find("img.tree-plus").remove();r.find("span.ccm-sitemap-num-subpages").remove();ccmAlert.hud(n.message,2e3)})})};ccm_sitemapDeleteForever=function(e,t){setLoading(t);params={cID:t};$.getJSON(CCM_TOOLS_PATH+"/dashboard/sitemap_delete_forever.php",params,function(e){ccm_parseJSON(e,function(){deleteBranchFade(t);ccmAlert.hud(e.message,2e3)})})};setLoading=function(e){var t=$("#tree-node"+e);t.removeClass("tree-node-"+t.attr("tree-node-type"));t.addClass("tree-node-loading")};removeLoading=function(e){var t=$("#tree-node"+e);t.removeClass("tree-node-loading");t.addClass("tree-node-"+t.attr("tree-node-type"))};openSub=function(e,t,n,r,i){setLoading(t);var s=$("#tree-root"+t);cancelReorder();ccm_sitemap_html="";$.get(CCM_TOOLS_PATH+"/dashboard/sitemap_data.php?instance_id="+e+"&node="+t+"&display_mode="+n+"&select_mode="+r+"&selectedPageID="+s.attr("selected-page-id"),function(n){parseSitemapResponse(e,"full",r,t,n);activateLabels(e,"full",r);r!="move_copy_delete"&&r!="select_page"&&activateReorder();setTimeout(function(){removeLoading(t);i!=null&&i()},200)})};closeSub=function(e,t,n,r){var i=$("ul[tree-root-node-id="+t+"][sitemap-instance-id="+e+"]");if(tr_doAnim){setLoading(t);i.slideUp(150,"easeOutExpo",function(){removeLoading(t);i.attr("tree-root-state","closed");i.html("");$("#ccm-tree-search"+t).hide();$("#tree-collapse"+t).attr("src",CCM_IMAGE_PATH+"/dashboard/plus.jpg");i.removeClass("ccm-sitemap-search-results")})}else{i.hide();i.attr("tree-root-state","closed");i.removeClass("ccm-sitemap-search-results");$("#ccm-tree-search"+t).hide();$("#tree-collapse"+t).attr("src",CCM_IMAGE_PATH+"/dashboard/plus.jpg")}tr_moveCopyMode==1&&$("#ccm-tree-search-trigger"+cID).show();$.get(CCM_TOOLS_PATH+"/dashboard/sitemap_data.php?instance_id="+e+"&select_mode="+r+"&display_mode="+n+"&node="+t+"&display_mode=full&ctask=close-node")};toggleMove=function(){if($("#copyThisPage").get(0)){$("#copyThisPage").get(0).disabled=!0;$("#copyChildren").get(0).disabled=!0;$("#saveOldPagePath").attr("disabled",!1)}};toggleAlias=function(){if($("#copyThisPage").get(0)){$("#copyThisPage").get(0).disabled=!0;$("#copyChildren").get(0).disabled=!0;$("#saveOldPagePath").attr("checked",!1);$("#saveOldPagePath").attr("disabled","disabled")}};toggleCopy=function(){if($("#copyThisPage").get(0)){$("#copyThisPage").get(0).disabled=!1;$("#copyThisPage").get(0).checked=!0;$("#copyChildren").get(0).disabled=!1;$("#saveOldPagePath").attr("checked",!1);$("#saveOldPagePath").attr("disabled","disabled")}};showSitemapMessage=function(e){$("#ccm-sitemap-message").addClass("message");$("#ccm-sitemap-message").html(e);$("#ccm-sitemap-message").fadeIn(200)};hideSitemapMessage=function(){$("#ccm-sitemap-message").hide()};ccmSitemapExploreNode=function(e,t,n,r,i){jQuery.fn.dialog.showLoader();$.get(CCM_TOOLS_PATH+"/dashboard/sitemap_data.php",{instance_id:e,display_mode:t,select_mode:n,node:r,selectedPageID:i},function(t){parseSitemapResponse(e,"explore",n,0,t);activateLabels(e,"explore",n);jQuery.fn.dialog.hideLoader();ccm_sitemap_html=""})};ccmSitemapLoad=function(e,t,n,r,s,o){if(n=="move_copy_delete"||n=="select_page")ccmSitemapExploreNode(e,t,n,r,s);else if(t=="full"){activateLabels(e,t,n);n!="move_copy_delete"&&n!="select_page"&&activateReorder();tr_doAnim=!0;tr_parseSubnodes=!1;ccm_sitemap_html=""}else{n!="move_copy_delete"&&n!="select_page"&&$("ul[sitemap-instance-id="+e+"]").sortable({cursor:"move",items:"li[draggable=true]",opacity:.5,stop:function(t){var n=$("ul[sitemap-instance-id="+e+"]").sortable("toArray"),r="";for(i=0;i<n.length;i++)n[i]!=""&&(r+="&cID[]="+n[i].substring(9));$.getJSON(CCM_TOOLS_PATH+"/dashboard/sitemap_update.php",r,function(e){ccm_parseJSON(e,function(){})})}});activateLabels(e,t,n)}o&&o()};ccm_sitemapSetupSearch=function(e){ccm_setupAdvancedSearch(e);ccm_sitemapSetupSearchPages(e);ccm_searchActivatePostFunction[e]=function(){ccm_sitemapSetupSearchPages(e);ccm_sitemapSearchSetupCheckboxes(e)};ccm_sitemapSearchSetupCheckboxes(e)};ccm_sitemapSearchSetupCheckboxes=function(e){$("#ccm-"+e+"-list-cb-all").click(function(t){t.stopPropagation();if($(this).prop("checked")==1){$(".ccm-list-record td.ccm-"+e+"-list-cb input[type=checkbox]").attr("checked",!0);$("#ccm-"+e+"-list-multiple-operations").attr("disabled",!1)}else{$(".ccm-list-record td.ccm-"+e+"-list-cb input[type=checkbox]").attr("checked",!1);$("#ccm-"+e+"-list-multiple-operations").attr("disabled",!0)}});$("td.ccm-"+e+"-list-cb input[type=checkbox]").click(function(t){t.stopPropagation();$("td.ccm-"+e+"-list-cb input[type=checkbox]:checked").length>0?$("#ccm-"+e+"-list-multiple-operations").attr("disabled",!1):$("#ccm-"+e+"-list-multiple-operations").attr("disabled",!0)});$("#ccm-"+e+"-list-multiple-operations").change(function(){var t=$(this).val();cIDstring="";$("td.ccm-"+e+"-list-cb input[type=checkbox]:checked").each(function(){cIDstring=cIDstring+"&cID[]="+$(this).val()});switch(t){case"delete":jQuery.fn.dialog.open({width:500,height:400,modal:!1,appendButtons:!0,href:CCM_TOOLS_PATH+"/pages/delete?"+cIDstring+"&searchInstance="+e,title:ccmi18n_sitemap.deletePages});break;case"design":jQuery.fn.dialog.open({width:610,height:405,modal:!1,appendButtons:!0,href:CCM_TOOLS_PATH+"/pages/design?"+cIDstring+"&searchInstance="+e,title:ccmi18n_sitemap.pageDesign});break;case"move_copy":jQuery.fn.dialog.open({width:640,height:340,modal:!1,href:CCM_TOOLS_PATH+"/sitemap_overlay?instance_id="+e+"&select_mode=move_copy_delete&"+cIDstring,title:ccmi18n_sitemap.moveCopyPage});break;case"speed_settings":jQuery.fn.dialog.open({width:610,height:340,modal:!1,appendButtons:!0,href:CCM_TOOLS_PATH+"/pages/speed_settings?"+cIDstring,title:ccmi18n_sitemap.speedSettingsTitle});break;case"permissions":jQuery.fn.dialog.open({width:430,height:630,modal:!1,appendButtons:!0,href:CCM_TOOLS_PATH+"/pages/permissions?"+cIDstring,title:ccmi18n_sitemap.pagePermissionsTitle});break;case"properties":jQuery.fn.dialog.open({width:630,height:450,modal:!1,href:CCM_TOOLS_PATH+"/pages/bulk_metadata_update?"+cIDstring,title:ccmi18n_sitemap.pagePropertiesTitle})}$(this).get(0).selectedIndex=0})};ccm_sitemapSetupSearchPages=function(instance_id){$("#ccm-"+instance_id+"-list tr").click(function(e){var node=$(this);if(node.hasClass("ccm-results-list-header"))return!1;if(node.attr("sitemap-select-mode")=="select_page"){var callback=node.attr("sitemap-select-callback");if(callback==null||callback==""||typeof callback=="undefined")callback="ccm_selectSitemapNode";eval(callback+"(node.attr('cID'), unescape(node.attr('cName')));");jQuery.fn.dialog.closeTop()}else if(node.attr("sitemap-select-mode")=="move_copy_delete"){var destCID=node.attr("cID"),origCID=node.attr("selected-page-id");selectMoveCopyTarget(node.attr("sitemap-instance-id"),node.attr("sitemap-display-mode"),node.attr("sitemap-select-mode"),destCID,origCID)}else{params={cID:node.attr("cID"),select_mode:node.attr("sitemap-select-mode"),display_mode:node.attr("sitemap-display-mode"),instance_id:node.attr("sitemap-instance-id"),isTrash:node.attr("tree-node-istrash"),inTrash:node.attr("tree-node-intrash"),canCompose:node.attr("tree-node-cancompose"),canEditProperties:node.attr("tree-node-can-edit-properties"),canEditSpeedSettings:node.attr("tree-node-can-edit-speed-settings"),canEditPermissions:node.attr("tree-node-can-edit-permissions"),canEditDesign:node.attr("tree-node-can-edit-design"),canViewVersions:node.attr("tree-node-can-view-versions"),canDelete:node.attr("tree-node-can-delete"),canAddSubpages:node.attr("tree-node-can-add-subpages"),canAddExternalLinks:node.attr("tree-node-can-add-external-links"),cNumChildren:node.attr("cNumChildren"),cAlias:node.attr("cAlias")};showPageMenu(params,e)}})};ccm_sitemapSelectDisplayMode=function(e,t,n,r){var i=$("ul[sitemap-instance-id="+e+"]");i.html("");i.attr("sitemap-display-mode",t);i.attr("sitemap-select-mode",n);i.attr("sitemap-display-mode",t);if(t=="explore")var s=1;else var s=0;ccmSitemapLoad(e,t,n,s,r,function(){t=="explore"?$("div[sitemap-wrapper=1][sitemap-instance-id="+e+"]").addClass("ccm-sitemap-explore"):$("div[sitemap-wrapper=1][sitemap-instance-id="+e+"]").removeClass("ccm-sitemap-explore")});$.get(CCM_TOOLS_PATH+"/dashboard/sitemap_data.php?task=save_sitemap_display_mode&display_mode="+t)};ccm_sitemapDeletePages=function(e){$("#ccm-"+e+"-delete-form").ajaxSubmit(function(t){ccm_parseJSON(t,function(){jQuery.fn.dialog.closeTop();ccm_deactivateSearchResults(e);$("#ccm-"+e+"-advanced-search").ajaxSubmit(function(t){ccm_parseAdvancedSearchResponse(t,e)})})})};ccm_sitemapUpdateDesign=function(e){$("#ccm-"+e+"-design-form").ajaxSubmit(function(t){ccm_parseJSON(t,function(){jQuery.fn.dialog.closeTop();ccm_deactivateSearchResults(e);$("#ccm-"+e+"-advanced-search").ajaxSubmit(function(t){ccm_parseAdvancedSearchResponse(t,e)})})})};$(function(){$(document).click(function(){ccm_hideMenus();$("div.tree-label").removeClass("tree-label-selected")});$("#ccm-show-all-pages-cb").click(function(){var e=$(this).get(0).checked==1?1:0;$.get(CCM_TOOLS_PATH+"/dashboard/sitemap_data.php?show_system="+e,function(e){location.reload()})})});ccm_statusBar={items:[],addItem:function(e){this.items.push(e)},activate:function(){if(this.items.length>0){var e='<div id="ccm-page-status-bar" class="ccm-ui">';for(i=0;i<this.items.length;i++){var t=this.items[i],n="",r=t.getButtons();for(j=0;j<r.length;j++){attribs="";var s="",o="";r[j].getInnerButtonLeftHTML()!=""&&(s=r[j].getInnerButtonLeftHTML()+" ");r[j].getInnerButtonRightHTML()!=""&&(o=" "+r[j].getInnerButtonRightHTML());var u=r[j].getAttributes();for(k in u)attribs+=u[k].key+'="'+u[k].value+'" ';r[j].getURL()!=""?n+='<a href="'+r[j].getURL()+'" '+attribs+' class="btn btn-small '+r[j].getCSSClass()+'">'+s+r[j].getLabel()+o+"</a>":n+='<button type="submit" '+attribs+' name="action_'+r[j].getAction()+'" class="btn-small btn '+r[j].getCSSClass()+'">'+s+r[j].getLabel()+o+"</button>"}var a='<form method="post" action="'+t.getAction()+'" id="ccm-status-bar-form-'+i+'" '+(t.useAjaxForm?'class="ccm-status-bar-ajax-form"':"")+'><div class="alert-message alert '+t.getCSSClass()+'"><button type="button" class="close" data-dismiss="alert"></button><span>'+t.getDescription()+'</span> <div class="ccm-page-status-bar-buttons">'+n+"</div></div></form>";e+=a}e+="</div>";$("#ccm-page-controls-wrapper").append(e);$("#ccm-page-status-bar .dialog-launch").dialog();$("#ccm-page-status-bar .alert").bind("closed",function(){$(this).remove();var e=$("#ccm-page-status-bar .alert:visible").length;e==0&&$("#ccm-page-status-bar").remove()});$("#ccm-page-status-bar .ccm-status-bar-ajax-form").ajaxForm({dataType:"json",beforeSubmit:function(){jQuery.fn.dialog.showLoader()},success:function(e){e.redirect&&(window.location.href=e.redirect)}})}}};ccm_statusBarItem=function(){this.css="";this.description="";this.buttons=[];this.action="";this.useAjaxForm=!1;this.setCSSClass=function(e){this.css=e};this.enableAjaxForm=function(){this.useAjaxForm=!0};this.setDescription=function(e){this.description=e};this.getCSSClass=function(){return this.css};this.getDescription=function(){return this.description};this.addButton=function(e){this.buttons.push(e)};this.getButtons=function(){return this.buttons};this.setAction=function(e){this.action=e};this.getAction=function(){return this.action}};ccm_statusBarItemButton=function(){this.css="";this.innerbuttonleft="";this.innerbuttonright="";this.label="";this.action="";this.url="";this.attribs=new Array;this.setLabel=function(e){this.label=e};this.setCSSClass=function(e){this.css=e};this.setInnerButtonLeftHTML=function(e){this.innerbuttonleft=e};this.setInnerButtonRightHTML=function(e){this.innerbuttonright=e};this.setAction=function(e){this.action=e};this.getAttributes=function(){return this.attribs};this.addAttribute=function(e,t){this.attribs.push({key:e,value:t})};this.getAction=function(){return this.action};this.setURL=function(e){this.url=e};this.getURL=function(){return this.url};this.getCSSClass=function(){return this.css};this.getInnerButtonLeftHTML=function(){return this.innerbuttonleft};this.getInnerButtonRightHTML=function(){return this.innerbuttonright};this.getLabel=function(){return this.label}};ccm_activateTabBar=function(e){$("#ccm-tab-content-"+e.find("li[class=active] a").attr("data-tab")).show();e.find("a").unbind().click(function(){e.find("li").removeClass("active");$(this).parent().addClass("active");e.find("a").each(function(){$("#ccm-tab-content-"+$(this).attr("data-tab")).hide()});var t=$(this).attr("data-tab");$("#ccm-tab-content-"+t).show();return!1})};var ccm_editorCurrentAuxTool=!1;ccm_editorSetupImagePicker=function(){tinyMCE.activeEditor.focus();var e=tinyMCE.activeEditor.selection.getBookmark();ccm_chooseAsset=function(t){var n=tinyMCE.activeEditor;n.selection.moveToBookmark(e);var r={};tinymce.extend(r,{src:t.filePathInline,alt:t.title,width:t.width,height:t.height});n.execCommand("mceInsertContent",!1,'<img id="__mce_tmp" src="javascript:;" />',{skip_undo:1});n.dom.setAttribs("__mce_tmp",r);n.dom.setAttrib("__mce_tmp","id","");n.undoManager.add()};return!1};ccm_editorSetupFilePicker=function(){tinyMCE.activeEditor.focus();var e=tinyMCE.activeEditor.selection.getBookmark();ccm_chooseAsset=function(t){var n=tinyMCE.activeEditor;n.selection.moveToBookmark(e);var r=n.selection.getContent();if(r!="")n.execCommand("mceInsertLink",!1,{href:t.filePath,title:t.title,target:null,"class":null});else{var i='<a href="'+t.filePath+'">'+t.title+"</a>";tinyMCE.execCommand("mceInsertRawHTML",!1,i,!0)}};return!1};ccm_editorSitemapOverlay=function(){tinyMCE.activeEditor.focus();var e=tinyMCE.activeEditor.selection.getBookmark();$.fn.dialog.open({title:ccmi18n_sitemap.choosePage,href:CCM_TOOLS_PATH+"/sitemap_search_selector.php?sitemap_select_mode=select_page&callback=ccm_editorSelectSitemapNode",width:"90%",modal:!1,height:"70%"});ccm_editorSelectSitemapNode=function(t,n){var r=tinyMCE.activeEditor;r.selection.moveToBookmark(e);var i=r.selection.getContent(),s=CCM_BASE_URL+CCM_DISPATCHER_FILENAME+"?cID="+t;if(i!="")r.execCommand("mceInsertLink",!1,{href:s,title:n,target:null,"class":null});else{var i='<a href="'+CCM_BASE_URL+CCM_DISPATCHER_FILENAME+"?cID="+t+'" title="'+n+'">'+n+"</a>";tinyMCE.execCommand("mceInsertRawHTML",!1,i,!0)}}};var ccm_arrangeMode=!1,ccm_selectedDomID=!1,ccm_isBlockError=!1,ccm_activeMenu=!1,ccm_blockError=!1;ccm_menuInit=function(e){if(CCM_EDIT_MODE&&!CCM_ARRANGE_MODE)switch(e.type){case"BLOCK":$("#b"+e.bID+"-"+e.aID).mouseover(function(t){ccm_activate(e,"#b"+e.bID+"-"+e.aID)});break;case"AREA":$("#a"+e.aID+"controls").mouseover(function(t){ccm_activate(e,"#a"+e.aID+"controls")})}};ccm_showBlockMenu=function(e,t){ccm_hideMenus();t.stopPropagation();ccm_activeMenu=!0;var n=document.getElementById("ccm-block-menu"+e.bID+"-"+e.aID);if(!n){el=document.createElement("DIV");el.id="ccm-block-menu"+e.bID+"-"+e.aID;el.className="ccm-menu ccm-ui";el.style.display="block";el.style.visibility="hidden";document.body.appendChild(el);n=$("#ccm-block-menu"+e.bID+"-"+e.aID);n.css("position","absolute");var r='<div class="popover"><div class="arrow"></div><div class="inner"><div class="content">';r+="<ul>";e.canWrite&&e.hasEditDialog&&(r+=e.editInline?'<li><a class="ccm-menu-icon ccm-icon-edit-menu" onclick="ccm_hideMenus()" id="menuEdit'+e.bID+"-"+e.aID+'" href="'+CCM_DISPATCHER_FILENAME+"?cID="+e.cID+"&bID="+e.bID+"&arHandle="+encodeURIComponent(e.arHandle)+"&btask=edit#_edit"+e.bID+'">'+ccmi18n.editBlock+"</a></li>":'<li><a class="ccm-menu-icon ccm-icon-edit-menu" onclick="ccm_hideMenus()" dialog-title="'+ccmi18n.editBlock+" "+e.btName+'" dialog-append-buttons="true" dialog-modal="false" dialog-on-close="ccm_blockWindowAfterClose()" dialog-width="'+e.width+'" dialog-height="'+e.height+'" id="menuEdit'+e.bID+"-"+e.aID+'" href="'+CCM_TOOLS_PATH+"/edit_block_popup.php?cID="+e.cID+"&bID="+e.bID+"&arHandle="+encodeURIComponent(e.arHandle)+'&btask=edit">'+ccmi18n.editBlock+"</a></li>");if(e.canWriteStack){r+='<li><a class="ccm-menu-icon ccm-icon-edit-menu" id="menuEdit'+e.bID+"-"+e.aID+'" href="'+CCM_DISPATCHER_FILENAME+"/dashboard/blocks/stacks/-/view_details/"+e.stID+'">'+ccmi18n.editStackContents+"</a></li>";r+='<li class="header"></li>'}e.canCopyToScrapbook&&(r+='<li><a class="ccm-menu-icon ccm-icon-clipboard-menu" id="menuAddToScrapbook'+e.bID+"-"+e.aID+'" href="#" onclick="javascript:ccm_addToScrapbook('+e.cID+","+e.bID+",'"+encodeURIComponent(e.arHandle)+"');return false;\">"+ccmi18n.copyBlockToScrapbook+"</a></li>");e.canArrange&&(r+='<li><a class="ccm-menu-icon ccm-icon-move-menu" id="menuArrange'+e.bID+"-"+e.aID+'" href="javascript:ccm_arrangeInit()">'+ccmi18n.arrangeBlock+"</a></li>");e.canDelete&&(r+='<li><a class="ccm-menu-icon ccm-icon-delete-menu" id="menuDelete'+e.bID+"-"+e.aID+'" href="#" onclick="javascript:ccm_deleteBlock('+e.cID+","+e.bID+","+e.aID+", '"+encodeURIComponent(e.arHandle)+"', '"+e.deleteMessage+"');return false;\">"+ccmi18n.deleteBlock+"</a></li>");if(e.canDesign||e.canEditBlockCustomTemplate)r+='<li class="ccm-menu-separator"></li>';e.canDesign&&(r+='<li><a class="ccm-menu-icon ccm-icon-design-menu" onclick="ccm_hideMenus()" dialog-modal="false" dialog-title="'+ccmi18n.changeBlockBaseStyle+'" dialog-width="475" dialog-height="500" dialog-append-buttons="true" id="menuChangeCSS'+e.bID+"-"+e.aID+'" href="'+CCM_TOOLS_PATH+"/edit_block_popup.php?cID="+e.cID+"&bID="+e.bID+"&arHandle="+encodeURIComponent(e.arHandle)+'&btask=block_css&modal=true&width=300&height=100" title="'+ccmi18n.changeBlockCSS+'">'+ccmi18n.changeBlockCSS+"</a></li>");e.canEditBlockCustomTemplate&&(r+='<li><a class="ccm-menu-icon ccm-icon-custom-template-menu" onclick="ccm_hideMenus()" dialog-append-buttons="true" 	dialog-modal="false" dialog-title="'+ccmi18n.changeBlockTemplate+'" dialog-width="300" dialog-height="275" id="menuChangeTemplate'+e.bID+"-"+e.aID+'" href="'+CCM_TOOLS_PATH+"/edit_block_popup.php?cID="+e.cID+"&bID="+e.bID+"&arHandle="+encodeURIComponent(e.arHandle)+'&btask=template&modal=true&width=300&height=275" title="'+ccmi18n.changeBlockTemplate+'">'+ccmi18n.changeBlockTemplate+"</a></li>");if(e.canModifyGroups||e.canScheduleGuestAccess||e.canAliasBlockOut||e.canSetupComposer)r+='<li class="ccm-menu-separator"></li>';e.canModifyGroups&&(r+='<li><a title="'+ccmi18n.setBlockPermissions+'" onclick="ccm_hideMenus()" class="ccm-menu-icon ccm-icon-permissions-menu" dialog-width="420" dialog-height="350" id="menuBlockGroups'+e.bID+"-"+e.aID+'" href="'+CCM_TOOLS_PATH+"/edit_block_popup.php?cID="+e.cID+"&bID="+e.bID+"&arHandle="+encodeURIComponent(e.arHandle)+'&btask=groups" dialog-append-buttons="true" dialog-title="'+ccmi18n.setBlockPermissions+'">'+ccmi18n.setBlockPermissions+"</a></li>");e.canScheduleGuestAccess&&(r+='<li><a title="'+ccmi18n.scheduleGuestAccess+'" onclick="ccm_hideMenus()" class="ccm-menu-icon ccm-icon-clock-menu" dialog-width="500" dialog-height="220" id="menuBlockViewClock'+e.bID+"-"+e.aID+'" href="'+CCM_TOOLS_PATH+"/edit_block_popup.php?cID="+e.cID+"&bID="+e.bID+"&arHandle="+encodeURIComponent(e.arHandle)+'&btask=guest_timed_access" dialog-append-buttons="true" dialog-title="'+ccmi18n.scheduleGuestAccess+'">'+ccmi18n.scheduleGuestAccess+"</a></li>");e.canAliasBlockOut&&(r+='<li><a class="ccm-menu-icon ccm-icon-setup-child-pages-menu" dialog-append-buttons="true" onclick="ccm_hideMenus()" dialog-width="550" dialog-height="450" id="menuBlockAliasOut'+e.bID+"-"+e.aID+'" href="'+CCM_TOOLS_PATH+"/edit_block_popup.php?cID="+e.cID+"&bID="+e.bID+"&arHandle="+encodeURIComponent(e.arHandle)+'&btask=child_pages" dialog-title="'+ccmi18n.setBlockAlias+'">'+ccmi18n.setBlockAlias+"</a></li>");e.canSetupComposer&&(r+='<li><a class="ccm-menu-icon ccm-icon-setup-composer-menu" dialog-append-buttons="true" onclick="ccm_hideMenus()" dialog-width="300" dialog-modal="false" dialog-height="130" id="menuBlockSetupComposer'+e.bID+"-"+e.aID+'" href="'+CCM_TOOLS_PATH+"/edit_block_popup.php?cID="+e.cID+"&bID="+e.bID+"&arHandle="+encodeURIComponent(e.arHandle)+'&btask=composer" dialog-title="'+ccmi18n.setBlockComposerSettings+'">'+ccmi18n.setBlockComposerSettings+"</a></li>");r+="</ul>";r+="</div></div></div>";n.append(r);e.canWrite&&!e.editInline&&$("a#menuEdit"+e.bID+"-"+e.aID).dialog();e.canEditBlockCustomTemplate&&$("a#menuChangeTemplate"+e.bID+"-"+e.aID).dialog();e.canDesign&&$("a#menuChangeCSS"+e.bID+"-"+e.aID).dialog();e.canAliasBlockOut&&$("a#menuBlockAliasOut"+e.bID+"-"+e.aID).dialog();e.canSetupComposer&&$("a#menuBlockSetupComposer"+e.bID+"-"+e.aID).dialog();e.canModifyGroups&&$("#menuBlockGroups"+e.bID+"-"+e.aID).dialog();e.canScheduleGuestAccess&&$("#menuBlockViewClock"+e.bID+"-"+e.aID).dialog()}else n=$("#ccm-block-menu"+e.bID+"-"+e.aID);ccm_fadeInMenu(n,t)};ccm_reloadAreaMenuPermissions=function(e,t){var n=window["ccm_areaMenuObj"+e];if(n){var r=CCM_TOOLS_PATH+"/reload_area_permissions_js.php"+"?arHandle="+n.arHandle+"&cID="+t+"&maximumBlocks="+n.maximumBlocks;$.getScript(r)}};ccm_openAreaAddBlock=function(e,t,n){t||(t=0);n||(n=CCM_CID);$.fn.dialog.open({title:ccmi18n.blockAreaMenu,href:CCM_TOOLS_PATH+"/edit_area_popup.php?cID="+n+"&atask=add&arHandle="+e+"&addOnly="+t,width:550,modal:!1,height:380})};ccm_showAreaMenu=function(e,t){var n=e.addOnly?1:0;ccm_activeMenu=!0;if(t.shiftKey)ccm_openAreaAddBlock(e.arHandle,n);else{t.stopPropagation();var r=document.getElementById("ccm-area-menu"+e.aID);if(!r){el=document.createElement("DIV");el.id="ccm-area-menu"+e.aID;el.className="ccm-menu ccm-ui";el.style.display="block";el.style.visibility="hidden";document.body.appendChild(el);r=$("#ccm-area-menu"+e.aID);r.css("position","absolute");var i='<div class="popover"><div class="arrow"></div><div class="inner"><div class="content">';i+="<ul>";if(e.canAddBlocks){i+='<li><a onclick="ccm_hideMenus()" class="ccm-menu-icon ccm-icon-add-block-menu" dialog-title="'+ccmi18n.addBlockNew+'" dialog-modal="false" dialog-width="550" dialog-height="380" id="menuAddNewBlock'+e.aID+'" href="'+CCM_TOOLS_PATH+"/edit_area_popup.php?cID="+CCM_CID+"&arHandle="+encodeURIComponent(e.arHandle)+"&atask=add&addOnly="+n+'">'+ccmi18n.addBlockNew+"</a></li>";i+='<li><a onclick="ccm_hideMenus()" class="ccm-menu-icon ccm-icon-clipboard-menu" dialog-title="'+ccmi18n.addBlockPaste+'" dialog-modal="false" dialog-width="550" dialog-height="380" id="menuAddPaste'+e.aID+'" href="'+CCM_TOOLS_PATH+"/edit_area_popup.php?cID="+
CCM_CID+"&arHandle="+encodeURIComponent(e.arHandle)+"&atask=paste&addOnly="+n+'">'+ccmi18n.addBlockPaste+"</a></li>"}e.canAddStacks&&(i+='<li><a onclick="ccm_hideMenus()" class="ccm-menu-icon ccm-icon-add-stack-menu" dialog-title="'+ccmi18n.addBlockStack+'" dialog-modal="false" dialog-width="550" dialog-height="380" id="menuAddNewStack'+e.aID+'" href="'+CCM_TOOLS_PATH+"/edit_area_popup.php?cID="+CCM_CID+"&arHandle="+encodeURIComponent(e.arHandle)+"&atask=add_from_stack&addOnly="+n+'">'+ccmi18n.addBlockStack+"</a></li>");e.canAddBlocks&&(e.canDesign||e.canLayout)&&(i+='<li class="ccm-menu-separator"></li>');e.canLayout&&(i+='<li><a onclick="ccm_hideMenus()" class="ccm-menu-icon ccm-icon-add-layout-menu" dialog-title="'+ccmi18n.addAreaLayout+'" dialog-modal="false" dialog-width="400" dialog-height="300" dialog-append-buttons="true" id="menuAreaLayout'+e.aID+'" href="'+CCM_TOOLS_PATH+"/edit_area_popup.php?cID="+CCM_CID+"&arHandle="+encodeURIComponent(e.arHandle)+'&atask=layout">'+ccmi18n.addAreaLayout+"</a></li>");e.canDesign&&(i+='<li><a onclick="ccm_hideMenus()" class="ccm-menu-icon ccm-icon-design-menu" dialog-title="'+ccmi18n.changeAreaCSS+'" dialog-modal="false" dialog-append-buttons="true" dialog-width="475" dialog-height="500" id="menuAreaStyle'+e.aID+'" href="'+CCM_TOOLS_PATH+"/edit_area_popup.php?cID="+CCM_CID+"&arHandle="+encodeURIComponent(e.arHandle)+'&atask=design">'+ccmi18n.changeAreaCSS+"</a></li>");e.canWrite&&e.canModifyGroups&&(i+='<li class="ccm-menu-separator"></li>');e.canModifyGroups&&(i+='<li><a onclick="ccm_hideMenus()" title="'+ccmi18n.setAreaPermissions+'" dialog-append-buttons="true" dialog-modal="false" class="ccm-menu-icon ccm-icon-permissions-menu" dialog-width="420" dialog-height="425" id="menuAreaGroups'+e.aID+'" href="'+CCM_TOOLS_PATH+"/edit_area_popup.php?cID="+CCM_CID+"&arHandle="+encodeURIComponent(e.arHandle)+'&atask=groups" dialog-title="'+ccmi18n.setAreaPermissions+'">'+ccmi18n.setAreaPermissions+"</a></li>");i+="</ul>";i+="</div></div></div>";r.append(i);if(e.canAddBlocks){$("a#menuAddNewBlock"+e.aID).dialog();$("a#menuAddPaste"+e.aID).dialog()}e.canAddStacks&&$("a#menuAddNewStack"+e.aID).dialog();e.canLayout&&$("a#menuAreaLayout"+e.aID).dialog();e.canDesign&&$("a#menuAreaStyle"+e.aID).dialog();e.canModifyGroups&&$("a#menuAreaGroups"+e.aID).dialog()}else r=$("#ccm-area-menu"+e.aID);ccm_fadeInMenu(r,t)}};ccm_hideHighlighter=function(){$("#ccm-highlighter").css("display","none");$("div.ccm-menu-hotspot-active").removeClass("ccm-menu-hotspot-active")};ccm_addError=function(e){if(!ccm_isBlockError){ccm_blockError="";ccm_blockError+="<ul>"}ccm_isBlockError=!0;ccm_blockError+="<li>"+e+"</li>"};ccm_resetBlockErrors=function(){ccm_isBlockError=!1;ccm_blockError=""};ccm_addToScrapbook=function(e,t,n){ccm_mainNavDisableDirectExit();ccm_hideHighlighter();$.ajax({type:"POST",url:CCM_TOOLS_PATH+"/pile_manager.php",data:"cID="+e+"&bID="+t+"&arHandle="+n+"&btask=add&scrapbookName=userScrapbook",success:function(e){ccm_hideHighlighter();ccmAlert.hud(ccmi18n.copyBlockToScrapbookMsg,2e3,"add",ccmi18n.copyBlockToScrapbook)}})};ccm_deleteBlock=function(e,t,n,r,i){if(confirm(i)){ccm_mainNavDisableDirectExit();ccm_hideHighlighter();$d=$("#b"+t+"-"+n);$d.hide();ccmAlert.hud(ccmi18n.deleteBlockMsg,2e3,"delete_small",ccmi18n.deleteBlock);$.ajax({type:"POST",url:CCM_DISPATCHER_FILENAME,data:"cID="+e+"&ccm_token="+CCM_SECURITY_TOKEN+"&isAjax=true&btask=remove&bID="+t+"&arHandle="+r});ccm_reloadAreaMenuPermissions(n,e);typeof window.ccm_parseBlockResponsePost=="function"&&ccm_parseBlockResponsePost({})}};ccm_hideMenus=function(){ccm_activeMenu=!1;$("div.ccm-menu").hide();$("div.ccm-menu").css("visibility","hidden");$("div.ccm-menu").show()};ccm_parseBlockResponse=function(r,currentBlockID,task){try{r=r.replace(/(<([^>]+)>)/ig,"");resp=eval("("+r+")");if(resp.error==1){var message="<ul>";for(i=0;i<resp.response.length;i++)message+="<li>"+resp.response[i]+"</li>";message+="</ul>";ccmAlert.notice(ccmi18n.error,message)}else{ccm_blockWindowClose();resp.cID?cID=resp.cID:cID=CCM_CID;var action=CCM_TOOLS_PATH+"/edit_block_popup?cID="+cID+"&bID="+resp.bID+"&arHandle="+encodeURIComponent(resp.arHandle)+"&btask=view_edit_mode";$.get(action,function(e){task=="add"?$("#a"+resp.aID+" div.ccm-area-styles-a"+resp.aID).length>0?$("#a"+resp.aID+" div.ccm-area-styles-a"+resp.aID).append(e):$("#a"+resp.aID).append(e):$("#b"+currentBlockID+"-"+resp.aID).before(e).remove();jQuery.fn.dialog.hideLoader();ccm_mainNavDisableDirectExit();if(task=="add"){ccmAlert.hud(ccmi18n.addBlockMsg,2e3,"add",ccmi18n.addBlock);jQuery.fn.dialog.closeAll()}else ccmAlert.hud(ccmi18n.updateBlockMsg,2e3,"success",ccmi18n.updateBlock);typeof window.ccm_parseBlockResponsePost=="function"&&ccm_parseBlockResponsePost(resp)});ccm_reloadAreaMenuPermissions(resp.aID,cID)}}catch(e){ccmAlert.notice(ccmi18n.error,r)}};ccm_mainNavDisableDirectExit=function(e){$("#ccm-exit-edit-mode-direct").hide();e||$("#ccm-exit-edit-mode-comment").show()};ccm_setupBlockForm=function(e,t,n){e.ajaxForm({type:"POST",iframe:!0,beforeSubmit:function(){ccm_hideHighlighter();$("input[name=ccm-block-form-method]").val("AJAX");jQuery.fn.dialog.showLoader();return ccm_blockFormSubmit()},success:function(e){ccm_parseBlockResponse(e,t,n)}})};ccm_activate=function(e,t){if(ccm_arrangeMode||ccm_activeMenu)return!1;ccm_selectedDomID&&$(ccm_selectedDomID).removeClass("ccm-menu-hotspot-active");aobj=$(t);aobj.addClass("ccm-menu-hotspot-active");ccm_selectedDomID=t;offs=aobj.offset();$("#ccm-highlighter").hide();$("#ccm-highlighter").css("width",aobj.outerWidth());$("#ccm-highlighter").css("height",aobj.outerHeight());$("#ccm-highlighter").css("top",offs.top);$("#ccm-highlighter").css("left",offs.left);$("#ccm-highlighter").fadeIn(120,"easeOutExpo");$("#ccm-highlighter").mouseout(function(e){ccm_activeMenu||(e.target?$(e.toElement).parents("div.ccm-menu").length==0&&ccm_hideHighlighter():ccm_hideHighlighter())});$("#ccm-highlighter").unbind("click");$("#ccm-highlighter").click(function(t){switch(e.type){case"BLOCK":ccm_showBlockMenu(e,t);break;case"AREA":ccm_showAreaMenu(e,t)}})};ccm_editInit=function(){document.write=function(){void 0};$(document.body).append('<div style="position: absolute; display:none" id="ccm-highlighter">&nbsp;</div>');$(document).click(function(){ccm_hideMenus()});$("div.ccm-menu a").bind("click.hide-menu",function(e){ccm_hideMenus();return!1})};ccm_triggerSelectUser=function(e,t,n){alert(e);alert(t);alert(n)};ccm_setupUserSearch=function(e){$(".chosen-select").chosen();$("#ccm-user-list-cb-all").click(function(){if($(this).prop("checked")==1){$(".ccm-list-record td.ccm-user-list-cb input[type=checkbox]").attr("checked",!0);$("#ccm-user-list-multiple-operations").attr("disabled",!1)}else{$(".ccm-list-record td.ccm-user-list-cb input[type=checkbox]").attr("checked",!1);$("#ccm-user-list-multiple-operations").attr("disabled",!0)}});$("td.ccm-user-list-cb input[type=checkbox]").click(function(e){$("td.ccm-user-list-cb input[type=checkbox]:checked").length>0?$("#ccm-user-list-multiple-operations").attr("disabled",!1):$("#ccm-user-list-multiple-operations").attr("disabled",!0)});$("#ccm-user-list-multiple-operations").change(function(){var t=$(this).val();switch(t){case"choose":var n="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){ccm_triggerSelectUser($(this).val(),$(this).attr("user-name"),$(this).attr("user-email"))});jQuery.fn.dialog.closeTop();break;case"properties":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:!1,href:CCM_TOOLS_PATH+"/users/bulk_properties?"+uIDstring,title:ccmi18n.properties});break;case"activate":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:!1,href:CCM_TOOLS_PATH+"/users/bulk_activate?searchInstance="+e+"&"+uIDstring,title:ccmi18n.user_activate});break;case"deactivate":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:!1,href:CCM_TOOLS_PATH+"/users/bulk_deactivate?searchInstance="+e+"&"+uIDstring,title:ccmi18n.user_deactivate});break;case"group_add":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:!1,href:CCM_TOOLS_PATH+"/users/bulk_group_add?searchInstance="+e+"&"+uIDstring,title:ccmi18n.user_group_add});break;case"group_remove":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:!1,href:CCM_TOOLS_PATH+"/users/bulk_group_remove?searchInstance="+e+"&"+uIDstring,title:ccmi18n.user_group_remove});break;case"delete":uIDstring="";$("td.ccm-user-list-cb input[type=checkbox]:checked").each(function(){uIDstring=uIDstring+"&uID[]="+$(this).val()});jQuery.fn.dialog.open({width:630,height:450,modal:!1,href:CCM_TOOLS_PATH+"/users/bulk_delete?searchInstance="+e+"&"+uIDstring,title:ccmi18n.user_delete})}$(this).get(0).selectedIndex=0})};ccm_triggerSelectGroup=function(e,t){alert(e);alert(t)};ccm_setupGroupSearchPaging=function(){$("div#ccm-group-paging").each(function(){$(this).closest(".ui-dialog-content").dialog("option","buttons",[{}]);$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane .ccm-pane-dialog-pagination").remove();$(this).appendTo($(this).closest(".ui-dialog").find(".ui-dialog-buttonpane").addClass("ccm-ui"))})};ccm_setupGroupSearch=function(e){$("div.ccm-group a").unbind();e?func=window[e]:func=ccm_triggerSelectGroup;$("div.ccm-group a").each(function(e){var t=$(this);$(this).click(function(){func(t.attr("group-id"),t.attr("group-name"));$.fn.dialog.closeTop();return!1})});$("#ccm-group-search").ajaxForm({beforeSubmit:function(){$("#ccm-group-search-wrapper").html("")},success:function(e){$("#ccm-group-search-wrapper").html(e)}});ccm_setupGroupSearchPaging();$("div#ccm-group-paging a").click(function(){$("#ccm-group-search-wrapper").html("");$.ajax({type:"GET",url:$(this).attr("href"),success:function(e){$("#ccm-group-search-wrapper").html(e)}});return!1})};ccm_saveArrangement=function(e){e||(e=CCM_CID);ccm_mainNavDisableDirectExit();var t="";$("div.ccm-area").each(function(){areaStr="&area["+$(this).attr("id").substring(1)+"][]=";bArray=$(this).sortable("toArray");for(i=0;i<bArray.length;i++)if(bArray[i]!=""&&bArray[i].substring(0,1)=="b"){var e=bArray[i].substring(1,bArray[i].indexOf("-")),n=$("#"+bArray[i]);n.attr("custom-style")&&(e+="-"+n.attr("custom-style"));t+=areaStr+e}});$.ajax({type:"POST",url:CCM_DISPATCHER_FILENAME,dataType:"json",data:"cID="+e+"&ccm_token="+CCM_SECURITY_TOKEN+"&btask=ajax_do_arrange"+t,success:function(e){ccm_parseJSON(e,function(){$("div.ccm-area").removeClass("ccm-move-mode");$("div.ccm-block-arrange").each(function(){$(this).addClass("ccm-block");$(this).removeClass("ccm-block-arrange")});ccm_arrangeMode=!1;$(".ccm-main-nav-edit-option").fadeIn(300);ccmAlert.hud(ccmi18n.arrangeBlockMsg,2e3,"up_down",ccmi18n.arrangeBlock)})}})};ccm_arrangeInit=function(){ccm_arrangeMode=!0;ccm_hideHighlighter();$("div.ccm-block").each(function(){$(this).addClass("ccm-block-arrange");$(this).removeClass("ccm-block")});$(".ccm-main-nav-edit-option").fadeOut(300,function(){$(".ccm-main-nav-arrange-option").fadeIn(300)});$("div.ccm-area").each(function(){var e=$(this).attr("cID");$(this).addClass("ccm-move-mode");$(this).sortable({items:"div.ccm-block-arrange",connectWith:$("div.ccm-area-move-enabled"),accept:"div.ccm-block-arrange",opacity:.5,stop:function(){ccm_saveArrangement(e)}})})};typeof ccm_selectSitemapNode!="function"&&(ccm_selectSitemapNode=function(e,t){alert(e);alert(t)});ccm_goToSitemapNode=function(e,t){window.location.href=CCM_DISPATCHER_FILENAME+"?cID="+e};ccm_fadeInMenu=function(e,t){var n=e.find("div.popover div.inner").width(),r=e.find("div.popover").height();e.hide();e.css("visibility","visible");var i=t.pageX+2,s=t.pageY+2;if($(window).height()<t.clientY+r){s=s-r-10;i-=n/2;e.find("div.popover").removeClass("below");e.find("div.popover").addClass("above")}else{i-=n/2;s+=10;e.find("div.popover").removeClass("above");e.find("div.popover").addClass("below")}e.css("top",s+"px");e.css("left",i+"px");e.fadeIn(60)};ccm_blockWindowClose=function(){jQuery.fn.dialog.closeTop();ccm_blockWindowAfterClose()};ccm_blockWindowAfterClose=function(){ccmValidateBlockForm=function(){return!0}};ccm_blockFormSubmit=function(){if(typeof window.ccmValidateBlockForm=="function"){r=window.ccmValidateBlockForm();if(ccm_isBlockError){jQuery.fn.dialog.hideLoader();ccm_blockError&&ccmAlert.notice(ccmi18n.error,ccm_blockError+"</ul>");ccm_resetBlockErrors();return!1}}return!0};ccm_paneToggleOptions=function(e){var t=$(e).parent().find("div.ccm-pane-options-content");if($(e).hasClass("ccm-icon-option-closed")){$(e).removeClass("ccm-icon-option-closed").addClass("ccm-icon-option-open");t.slideDown("fast","easeOutExpo")}else{$(e).removeClass("ccm-icon-option-open").addClass("ccm-icon-option-closed");t.slideUp("fast","easeOutExpo")}};ccm_setupGridStriping=function(e){$("#"+e+" tr").removeClass();var t=0;$("#"+e+" tr").each(function(){if($(this).css("display")!="none"){t%2==0&&$(this).addClass("ccm-row-alt");t++}})};ccm_t=function(e){return $("input[name=ccm-string-"+e+"]").val()};var ccmCustomStyle={tabs:function(e,t){$(".ccm-styleEditPane").hide();$("#ccm-styleEditPane-"+t).show();$(e.parentNode.parentNode).find("li").removeClass("ccm-nav-active");$(e.parentNode).addClass("ccm-nav-active");return!1},resetAll:function(){if(!confirm(ccmi18n.confirmCssReset))return!1;jQuery.fn.dialog.showLoader();$("#ccm-reset-style").val(1);$("#ccmCustomCssForm").get(0).submit();return!0},showPresetDeleteIcon:function(){$("select[name=cspID]").val()>0?$("#ccm-style-delete-preset").show():$("#ccm-style-delete-preset").hide()},deletePreset:function(){var e=$("select[name=cspID]").val();if(e>0){if(!confirm(ccmi18n.confirmCssPresetDelete))return!1;var t=$("#ccm-custom-style-refresh-action").val()+"&deleteCspID="+e+"&subtask=delete_custom_style_preset";jQuery.fn.dialog.showLoader();$.get(t,function(e){$("#ccm-custom-style-wrapper").html(e);jQuery.fn.dialog.hideLoader()})}},initForm:function(){$("#cspFooterPreset").length>0&&$("#ccmCustomCssFormTabs input, #ccmCustomCssFormTabs select, #ccmCustomCssFormTabs textarea").bind("change click",function(){$("#cspFooterPreset").show();$("#cspFooterNoPreset").remove();$("#ccmCustomCssFormTabs input, #ccmCustomCssFormTabs select").unbind("change click")});$("input[name=cspPresetAction]").click(function(){$(this).val()=="create_new_preset"&&$(this).prop("checked")?$("input[name=cspName]").attr("disabled",!1).focus():$("input[name=cspName]").val("").attr("disabled",!0)});ccmCustomStyle.showPresetDeleteIcon();ccmCustomStyle.lastPresetID=parseInt($("select[name=cspID]").val());$("select[name=cspID]").change(function(){var e=parseInt($(this).val()),t=parseInt($("input[name=selectedCsrID]").val());if(ccmCustomStyle.lastPresetID==e)return!1;ccmCustomStyle.lastPresetID=e;jQuery.fn.dialog.showLoader();if(e>0)var n=$("#ccm-custom-style-refresh-action").val()+"&cspID="+e;else var n=$("#ccm-custom-style-refresh-action").val()+"&csrID="+t;$.get(n,function(e){$("#ccm-custom-style-wrapper").html(e);jQuery.fn.dialog.hideLoader()})});$("#ccmCustomCssForm").submit(function(){if($("input[name=cspCreateNew]").prop("checked")==1&&$("input[name=cspName]").val()==""){$("input[name=cspName]").focus();alert(ccmi18n.errorCustomStylePresetNoName);return!1}jQuery.fn.dialog.showLoader();return!0});parseInt(ccmCustomStyle.lastPresetID)||setTimeout('$("#ccmCustomCssFormTabs input").attr("disabled", false).get(0).focus()',500)},validIdCheck:function(e,t){var n=$("#"+e.value);n&&n.get(0)&&n.get(0).id!=t?$("#ccm-styles-invalid-id").css("display","block"):$("#ccm-styles-invalid-id").css("display","none")}};$(function(){if($("#ccm-toolbar").length>0){ccm_intelligentSearchActivateResults();ccm_intelligentSearchDoRemoteCalls($("#ccm-nav-intelligent-search").val())}});ccm_togglePopover=function(e,t){if($(".popover").is(":visible"))$(t).popover("hide");else{$(t).popover("show");e.stopPropagation();$(window).bind("click.popover",function(){$(t).popover("hide");$(window).unbind("click.popover")})}};ccm_toggleQuickNav=function(e,t){var n=$("#ccm-add-to-quick-nav");n.hasClass("ccm-icon-favorite-selected")?n.removeClass("ccm-icon-favorite-selected").addClass("ccm-icon-favorite"):n.removeClass("ccm-icon-favorite").addClass("ccm-icon-favorite-selected");var r=$("#ccm-nav-dashboard"),i=n.parent().parent().parent().find("h3");i.css("display","inline");i.effect("transfer",{to:r,easing:"easeOutExpo"},600);$.get(CCM_TOOLS_PATH+"/dashboard/add_to_quick_nav",{cID:e,token:t},function(e){var t=$("<div />").html(e);$("#ccm-intelligent-search-results").html(t.find("#ccm-intelligent-search-results").html());$("#ccm-dashboard-overlay").html(t.find("#ccm-dashboard-overlay").html());$("#ccm-nav-intelligent-search").data("liveUpdate").setupCache()})};var ccm_hideToolbarMenusTimer=!1;ccm_hideToolbarMenus=function(){$(".ccm-system-nav-selected").removeClass("ccm-system-nav-selected");$(".ccm-system-nav-selected").removeClass("ccm-system-nav-selected");$("#ccm-edit-overlay").fadeOut(90,"easeOutExpo");$("#ccm-dashboard-overlay").fadeOut(90,"easeOutExpo");clearTimeout(ccm_hideToolbarMenusTimer)};ccm_activateToolbar=function(){$("#ccm-dashboard-overlay").css("visibility","visible").hide();$("#ccm-nav-intelligent-search-wrapper").click(function(){$("#ccm-nav-intelligent-search").focus()});$("#ccm-nav-intelligent-search").focus(function(){$(".ccm-system-nav-selected").removeClass("ccm-system-nav-selected");$(this).parent().addClass("ccm-system-nav-selected");if($("#ccm-dashboard-overlay").is(":visible")){$("#ccm-dashboard-overlay").fadeOut(90,"easeOutExpo");$(window).unbind("click.dashboard-nav")}});$(".ccm-nav-edit-mode-active").click(function(){void 0;return!1});$("#ccm-edit-overlay,#ccm-dashboard-overlay").mouseover(function(){clearTimeout(ccm_hideToolbarMenusTimer)});$("#ccm-nav-dashboard").hoverIntent(function(){clearTimeout(ccm_hideToolbarMenusTimer);$(".ccm-system-nav-selected").removeClass("ccm-system-nav-selected");$(this).parent().addClass("ccm-system-nav-selected");$("#ccm-nav-intelligent-search").val("");$("#ccm-intelligent-search-results").fadeOut(90,"easeOutExpo");if($("#ccm-edit-overlay").is(":visible")){$("#ccm-edit-overlay").fadeOut(90,"easeOutExpo");$(window).unbind("click.ccm-edit")}$("#ccm-dashboard-overlay").fadeIn(160,"easeOutExpo");$(window).bind("click.dashboard-nav",function(){$(".ccm-system-nav-selected").removeClass("ccm-system-nav-selected");$("#ccm-dashboard-overlay").fadeOut(90,"easeOutExpo");$(window).unbind("click.dashboard-nav")});return!1},function(){});$("#ccm-nav-dashboard,#ccm-dashboard-overlay,#ccm-nav-edit,#ccm-edit-overlay").mouseout(function(){ccm_hideToolbarMenusTimer=setTimeout(function(){ccm_hideToolbarMenus()},1500)});$("#ccm-nav-intelligent-search").bind("keydown.ccm-intelligent-search",function(e){if(e.keyCode==13||e.keyCode==40||e.keyCode==38){e.preventDefault();e.stopPropagation();if(e.keyCode==13&&$("a.ccm-intelligent-search-result-selected").length>0){var t=$("a.ccm-intelligent-search-result-selected").attr("href");!t||t=="#"||t=="javascript:void(0)"?$("a.ccm-intelligent-search-result-selected").click():window.location.href=t}var n=$("#ccm-intelligent-search-results li:visible"),r;if(e.keyCode==40||e.keyCode==38){$.each(n,function(t,i){if($(i).children("a").hasClass("ccm-intelligent-search-result-selected")){e.keyCode==38?io=n[t-1]:io=n[t+1];r=$(io).find("a")}});if(r&&r.length>0){$("a.ccm-intelligent-search-result-selected").removeClass();$(r).addClass("ccm-intelligent-search-result-selected")}}}});$("#ccm-nav-intelligent-search").bind("keyup.ccm-intelligent-search",function(e){ccm_intelligentSearchDoRemoteCalls($(this).val())});$("#ccm-nav-intelligent-search").blur(function(){$(this).parent().removeClass("ccm-system-nav-selected")});$("#ccm-nav-intelligent-search").liveUpdate("ccm-intelligent-search-results","intelligent-search");$("#ccm-nav-intelligent-search").bind("click",function(e){this.value==""&&$("#ccm-intelligent-search-results").hide()});$("#ccm-toolbar-nav-properties").dialog();$("#ccm-toolbar-nav-preview-as-user").dialog();$("#ccm-toolbar-add-subpage").dialog();$("#ccm-toolbar-nav-versions").dialog();$("#ccm-toolbar-nav-design").dialog();$("#ccm-toolbar-nav-permissions").dialog();$("#ccm-toolbar-nav-speed-settings").dialog();$("#ccm-toolbar-nav-move-copy").dialog();$("#ccm-toolbar-nav-delete").dialog();$("#ccm-edit-overlay,#ccm-dashboard-overlay").click(function(e){e.stopPropagation()});$("#ccm-nav-edit").hoverIntent(function(){clearTimeout(ccm_hideToolbarMenusTimer);$(".ccm-system-nav-selected").removeClass("ccm-system-nav-selected");$(this).parent().addClass("ccm-system-nav-selected");$("#ccm-nav-intelligent-search").val("");$("#ccm-intelligent-search-results").fadeOut(90,"easeOutExpo");if($("#ccm-dashboard-overlay").is(":visible")){$("#ccm-dashboard-overlay").fadeOut(90,"easeOutExpo");$(window).unbind("click.dashboard-nav")}setTimeout("$('#ccm-check-in-comments').focus();",300);$("#ccm-check-in-preview").click(function(){$("#ccm-approve-field").val("PREVIEW");$("#ccm-check-in").submit()});$("#ccm-check-in-discard").click(function(){$("#ccm-approve-field").val("DISCARD");$("#ccm-check-in").submit()});$("#ccm-check-in-publish").click(function(){$("#ccm-approve-field").val("APPROVE");$("#ccm-check-in").submit()});var e=$(this).position().left;e>0&&(e-=20);$("#ccm-edit-overlay").css("left",e+"px");$("#ccm-edit-overlay").fadeIn(160,"easeOutExpo",function(){$(this).find("a").click(function(){ccm_toolbarCloseEditMenu()})});$(window).bind("click.ccm-edit",function(){ccm_toolbarCloseEditMenu()});return!1},function(){})};var ajaxtimer=null,ajaxquery=null;ccm_toolbarCloseEditMenu=function(){$(".ccm-system-nav-selected").removeClass("ccm-system-nav-selected");$("#ccm-edit-overlay").fadeOut(90,"easeOutExpo");$(window).unbind("click.ccm-edit")};ccm_intelligentSearchActivateResults=function(){$("#ccm-intelligent-search-results div:visible").length==0&&$("#ccm-intelligent-search-results").hide();$("#ccm-intelligent-search-results a").hover(function(){$("a.ccm-intelligent-search-result-selected").removeClass();$(this).addClass("ccm-intelligent-search-result-selected")},function(){$(this).removeClass("ccm-intelligent-search-result-selected")})};ccm_intelligentSearchDoRemoteCalls=function(e){e=jQuery.trim(e);if(!e)return;if(e.length>2){if(e==ajaxquery)return;ajaxtimer&&window.clearTimeout(ajaxtimer);ajaxquery=e;ajaxtimer=window.setTimeout(function(){ajaxtimer=null;$("#ccm-intelligent-search-results-list-marketplace").parent().show();$("#ccm-intelligent-search-results-list-help").parent().show();$("#ccm-intelligent-search-results-list-your-site").parent().show();$("#ccm-intelligent-search-results-list-marketplace").parent().addClass("ccm-intelligent-search-results-module-loading");$("#ccm-intelligent-search-results-list-help").parent().addClass("ccm-intelligent-search-results-module-loading");$("#ccm-intelligent-search-results-list-your-site").parent().addClass("ccm-intelligent-search-results-module-loading");$.getJSON(CCM_TOOLS_PATH+"/marketplace/intelligent_search",{q:ajaxquery},function(e){$("#ccm-intelligent-search-results-list-marketplace").parent().removeClass("ccm-intelligent-search-results-module-loading");$("#ccm-intelligent-search-results-list-marketplace").html("");for(i=0;i<e.length;i++){var t=e[i],n="ccm_getMarketplaceItemDetails("+t.mpID+")";$("#ccm-intelligent-search-results-list-marketplace").append('<li><a href="javascript:void(0)" onclick="'+n+'"><img src="'+t.img+'" />'+t.name+"</a></li>")}e.length==0&&$("#ccm-intelligent-search-results-list-marketplace").parent().hide();if($(".ccm-intelligent-search-result-selected").length==0){$("#ccm-intelligent-search-results").find("li a").removeClass("ccm-intelligent-search-result-selected");$("#ccm-intelligent-search-results li:visible a:first").addClass("ccm-intelligent-search-result-selected")}ccm_intelligentSearchActivateResults()}).error(function(){$("#ccm-intelligent-search-results-list-marketplace").parent().hide()});$.getJSON(CCM_TOOLS_PATH+"/get_remote_help",{q:ajaxquery},function(e){$("#ccm-intelligent-search-results-list-help").parent().removeClass("ccm-intelligent-search-results-module-loading");$("#ccm-intelligent-search-results-list-help").html("");for(i=0;i<e.length;i++){var t=e[i];$("#ccm-intelligent-search-results-list-help").append('<li><a href="'+t.href+'">'+t.name+"</a></li>")}e.length==0&&$("#ccm-intelligent-search-results-list-help").parent().hide();if($(".ccm-intelligent-search-result-selected").length==0){$("#ccm-intelligent-search-results").find("li a").removeClass("ccm-intelligent-search-result-selected");$("#ccm-intelligent-search-results li:visible a:first").addClass("ccm-intelligent-search-result-selected")}ccm_intelligentSearchActivateResults()}).error(function(){$("#ccm-intelligent-search-results-list-help").parent().hide()});$.getJSON(CCM_TOOLS_PATH+"/pages/intelligent_search",{q:ajaxquery},function(e){$("#ccm-intelligent-search-results-list-your-site").parent().removeClass("ccm-intelligent-search-results-module-loading");$("#ccm-intelligent-search-results-list-your-site").html("");for(i=0;i<e.length;i++){var t=e[i];$("#ccm-intelligent-search-results-list-your-site").append('<li><a href="'+t.href+'">'+t.name+"</a></li>")}e.length==0&&$("#ccm-intelligent-search-results-list-your-site").parent().hide();if($(".ccm-intelligent-search-result-selected").length==0){$("#ccm-intelligent-search-results").find("li a").removeClass("ccm-intelligent-search-result-selected");$("#ccm-intelligent-search-results li:visible a:first").addClass("ccm-intelligent-search-result-selected")}ccm_intelligentSearchActivateResults()}).error(function(){$("#ccm-intelligent-search-results-list-your-site").parent().hide()})},500)}};ccm_marketplaceDetailShowMore=function(){$(".ccm-marketplace-item-information-more").hide();$(".ccm-marketplace-item-information-inner").css("max-height","none")};ccm_marketplaceUpdatesShowMore=function(e){$(e).parent().hide();$(e).parent().parent().find(".ccm-marketplace-update-changelog").css("max-height","none")};ccm_enableDesignScrollers=function(){$("a.ccm-scroller-l").hover(function(){$(this).find("img").attr("src",CCM_IMAGE_PATH+"/button_scroller_l_active.png")},function(){$(this).find("img").attr("src",CCM_IMAGE_PATH+"/button_scroller_l.png")});$("a.ccm-scroller-r").hover(function(){$(this).find("img").attr("src",CCM_IMAGE_PATH+"/button_scroller_r_active.png")},function(){$(this).find("img").attr("src",CCM_IMAGE_PATH+"/button_scroller_r.png")});var e=4,t=132;$("a.ccm-scroller-r").unbind("click");$("a.ccm-scroller-l").unbind("click");$("a.ccm-scroller-r").click(function(){var n=$(this).parent().children("div.ccm-scroller-inner").children("ul"),r=$(this).parent().attr("current-page"),i=$(this).parent().attr("current-pos"),s=$(this).parent().attr("num-pages"),o=e*t;i=parseInt(i)-o;r++;$(this).parent().attr("current-page",r);$(this).parent().attr("current-pos",i);r==s&&$(this).hide();r>1&&$(this).siblings("a.ccm-scroller-l").show();$(n).css("left",i+"px")});$("a.ccm-scroller-l").click(function(){var n=$(this).parent().children("div.ccm-scroller-inner").children("ul"),r=$(this).parent().attr("current-page"),i=$(this).parent().attr("current-pos"),s=$(this).parent().attr("num-pages"),o=e*t;i=parseInt(i)+o;r--;$(this).parent().attr("current-page",r);$(this).parent().attr("current-pos",i);r==1&&$(this).hide();r<s&&$(this).siblings("a.ccm-scroller-r").show();$(n).css("left",i+"px")});$("a.ccm-scroller-l").hide();$("a.ccm-scroller-r").each(function(){parseInt($(this).parent().attr("num-pages"))==1&&$(this).hide()});$("#ccm-select-page-type a").click(function(){$("#ccm-select-page-type li").each(function(){$(this).removeClass("ccm-item-selected")});$(this).parent().addClass("ccm-item-selected");$("input[name=ctID]").val($(this).attr("ccm-page-type-id"))});$("#ccm-select-theme a").click(function(){$("#ccm-select-theme li").each(function(){$(this).removeClass("ccm-item-selected")});$(this).parent().addClass("ccm-item-selected");$("input[name=plID]").val($(this).attr("ccm-theme-id"))})};