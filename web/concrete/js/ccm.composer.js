!function(a,b){var c={saveinterval:!1,"private":{saveDraft:function(d,e,f){var g=e.data("settings");formData=e.serializeArray(),formData.push({name:"task",value:d},{name:"token",value:g.token},{name:"cID",value:g.cID}),a.ajax({dataType:"json",type:"post",data:formData,url:e.data("saveURL"),error:function(a){c.private.handleAJAXGeneralError(a)},success:function(d){d.saveURL&&e.data("saveURL",d.saveURL),d.viewURL&&e.data("viewURL",d.viewURL),c.private.handleAJAXResponseError(d,a("#ccm-page-type-composer-form-error-list"))||(d.saveStatus&&a("#ccm-page-type-composer-form-save-status").html(d.saveStatus).show(),g.autoSavePushViewState&&d.viewURL!=document.URL&&b.history&&(b.history.replaceState({method:"loaddraft"},"",d.viewURL),g.viewURL=d.viewURL),f&&f(d))}})},handleAJAXGeneralError:function(a){ConcreteAlert.dialog("Error",'<div class="alert alert-danger">'+a.responseText+"</div>")},handleAJAXResponseError:function(a,b){return 1==a.error?(b?b.show().html(a.errors.join("<br>")):ConcreteAlert.dialog("Error",'<div class="alert alert-danger">'+a.errors.join("<br>")+"</div>"),!0):void 0}},init:function(d){var e=a.extend({cID:!1,token:!1,saveURL:CCM_TOOLS_PATH+"/pages/composer/save",onExit:function(){b.location.href=CCM_DISPATCHER_FILENAME+"/dashboard/composer/drafts"},autoSaveEnabled:!0,autoSavePushViewState:!1,autoSaveTimeout:5e3,onAfterSaveAndExit:function(a){b.location.href=a.redirectURL},onAfterSaveAndPreview:function(a){b.location.href=a.redirectURL},onAfterPublish:function(a){b.location.href=a.redirectURL}},d);return this.each(function(){var b=a(this);b.data("settings",e),b.data("saveURL",e.saveURL),b.data("viewURL",e.viewURL),e.autoSaveEnabled&&(c.saveinterval=setInterval(function(){c.private.saveDraft("autosave",b,function(){})},e.autoSaveTimeout)),a("button[data-page-type-composer-form-btn=preview]").unbind().on("click",function(){clearInterval(c.saveinterval),c.private.saveDraft("preview",b,function(a){e.onAfterSaveAndPreview(a)})}),a("button[data-page-type-composer-form-btn=exit]").unbind().on("click",function(){e.onExit()}),a("button[data-page-type-composer-form-btn=save]").unbind().on("click",function(){clearInterval(c.saveinterval),c.private.saveDraft("save",b,function(a){e.onAfterSaveAndExit(a)})}),b.on("submit.composer",function(){return!1}),a("button[data-page-type-composer-form-btn=publish]").unbind().on("click",function(){clearInterval(c.saveinterval),c.private.saveDraft("publish",b,function(a){e.onAfterPublish(a)})})})},disableAutoSave:function(){clearInterval(c.saveinterval)}};a.fn.ccmcomposer=function(b){return c[b]?c[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?(a.error("Method "+b+" does not exist on jQuery.ccmcomposer"),void 0):c.init.apply(this,arguments)}}(jQuery,window);