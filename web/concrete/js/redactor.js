var rwindow,rdocument;if("undefined"==typeof RELANG)var RELANG={};var RLANG={html:"HTML",video:"Insert Video",image:"Insert Image",table:"Table",link:"Link",link_insert:"Insert link",unlink:"Unlink",formatting:"Format",paragraph:"Paragraph",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code",file:"Insert File",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align text to the left",align_center:"Center text",align_right:"Align text to the right",align_justify:"Justify text",horizontalrule:"Insert Horizontal Rule",deleted:"Deleted",anchor:"Anchor",link_new_tab:"Open link in new tab",underline:"Underline",alignment:"Alignment"};if(function(a){jQuery.fn.redactor=function(c){return this.each(function(){var d=a(this),e=d.data("redactor");e||d.data("redactor",e=new b(this,c))})};var b=function(b,c){this.$el=a(b),"undefined"!=typeof c&&"undefined"!=typeof c.lang&&"en"!==c.lang&&"undefined"!=typeof RELANG[c.lang]&&(RLANG=RELANG[c.lang]),this.opts=a.extend({iframe:!1,css:!1,lang:"en",direction:"ltr",callback:!1,keyupCallback:!1,keydownCallback:!1,execCommandCallback:!1,plugins:!1,cleanup:!0,focus:!1,tabindex:!1,autoresize:!0,minHeight:!1,fixed:!1,fixedTop:0,fixedBox:!1,source:!0,shortcuts:!0,mobile:!0,air:!1,wym:!1,convertLinks:!0,convertDivs:!0,protocol:"http://",autosave:!1,autosaveCallback:!1,interval:60,imageGetJson:!1,imageUpload:!1,imageUploadCallback:!1,imageUploadErrorCallback:!1,fileUpload:!1,fileUploadCallback:!1,fileUploadErrorCallback:!1,uploadCrossDomain:!1,uploadFields:!1,observeImages:!0,overlay:!0,allowedTags:["form","input","button","select","option","datalist","output","textarea","fieldset","legend","section","header","hgroup","aside","footer","article","details","nav","progress","time","canvas","code","span","div","label","a","br","p","b","i","del","strike","u","img","video","source","track","audio","iframe","object","embed","param","blockquote","mark","cite","small","ul","ol","li","hr","dl","dt","dd","sup","sub","big","pre","code","figure","figcaption","strong","em","table","tr","td","th","tbody","thead","tfoot","h1","h2","h3","h4","h5","h6"],toolbarExternal:!1,buttonsCustom:{},buttonsAdd:[],buttons:["html","|","formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","image","video","file","table","link","|","fontcolor","backcolor","|","alignment","|","horizontalrule"],airButtons:["formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","fontcolor","backcolor"],formattingTags:["p","blockquote","pre","h1","h2","h3","h4"],activeButtons:["deleted","italic","bold","underline","unorderedlist","orderedlist"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",ul:"unorderedlist",ol:"orderedlist",u:"underline"},colors:["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],emptyHtml:"<p><br /></p>",buffer:!1,visual:!0,modal_file:String()+'<div id="redactor_modal_content"><form id="redactorUploadFileForm" method="post" action="" enctype="multipart/form-data"><label>Name (optional)</label><input type="text" id="redactor_filename" class="redactor_input" /><div style="margin-top: 7px;"><input type="file" id="redactor_file" name="file" /></div></form><br></div>',modal_image_edit:String()+'<div id="redactor_modal_content"><label>'+RLANG.title+'</label><input id="redactor_file_alt" class="redactor_input" /><label>'+RLANG.link+'</label><input id="redactor_file_link" class="redactor_input" /><label>'+RLANG.image_position+'</label><select id="redactor_form_image_align"><option value="none">'+RLANG.none+'</option><option value="left">'+RLANG.left+'</option><option value="right">'+RLANG.right+'</option></select></div><div id="redactor_modal_footer"><a href="javascript:void(null);" id="redactor_image_delete_btn" class="redactor_modal_btn">'+RLANG._delete+'</a>&nbsp;&nbsp;&nbsp;<a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" name="save" class="redactor_modal_btn" id="redactorSaveBtn" value="'+RLANG.save+'" /></div>',modal_image:String()+'<div id="redactor_modal_content"><div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">'+RLANG.upload+'</a><a href="javascript:void(null);">'+RLANG.choose+'</a><a href="javascript:void(null);">'+RLANG.link+'</a></div><form id="redactorInsertImageForm" method="post" action="" enctype="multipart/form-data"><div id="redactor_tab1" class="redactor_tab"><input type="file" id="redactor_file" name="file" /></div><div id="redactor_tab2" class="redactor_tab" style="display: none;"><div id="redactor_image_box"></div></div></form><div id="redactor_tab3" class="redactor_tab" style="display: none;"><label>'+RLANG.image_web_link+'</label><input type="text" name="redactor_file_link" id="redactor_file_link" style="width: 400px" /></div></div><div class="dialog-buttons"><a href="javascript:void(null);" class="btn pull-left redactor_modal_btn redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" name="upload" class="btn pull-right btn-primary" id="redactor_upload_btn" value="'+RLANG.insert+'" /></div>',modal_link:String()+'<div id="redactor_modal_content"><form id="redactorInsertLinkForm" method="post" action=""><ul class="nav nav-tabs" id="redactor_tabs"><li class="active"><a href="javascript:void(null);">URL</a></li><li><a href="javascript:void(null);">Email</a></li><li><a href="javascript:void(null);">'+RLANG.anchor+'</a></li></ul><input type="hidden" id="redactor_tab_selected" value="1" /><div class="redactor_tab" id="redactor_tab1"><label>URL</label><input type="text" id="redactor_link_url" class="redactor_input"  /><label>'+RLANG.text+'</label><input type="text" class="redactor_input redactor_link_text" id="redactor_link_url_text" /><label class="checkbox"><input type="checkbox" id="redactor_link_blank"> <span>'+RLANG.link_new_tab+'</span></label></div><div class="redactor_tab" id="redactor_tab2" style="display: none;"><label>Email</label><input type="text" id="redactor_link_mailto" class="redactor_input" /><label>'+RLANG.text+'</label><input type="text" class="redactor_input redactor_link_text" id="redactor_link_mailto_text" /></div><div class="redactor_tab" id="redactor_tab3" style="display: none;"><label>'+RLANG.anchor+'</label><input type="text" class="redactor_input" id="redactor_link_anchor"  /><label>'+RLANG.text+'</label><input type="text" class="redactor_input redactor_link_text" id="redactor_link_anchor_text" /></div></form></div><div class="dialog-buttons"><a href="javascript:void(null);" class="btn pull-left redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" class="btn pull-right btn-primary" id="redactor_insert_link_btn" value="'+RLANG.insert+'" /></div>',modal_table:String()+'<div id="redactor_modal_content"><label>'+RLANG.rows+'</label><input type="text" size="5" value="2" id="redactor_table_rows" /><label>'+RLANG.columns+'</label><input type="text" size="5" value="3" id="redactor_table_columns" /></div><div class="dialog-buttons"><a href="javascript:void(null);" class="btn pull-left redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" name="upload" class="btn pull-right btn-primary" id="redactor_insert_table_btn" value="'+RLANG.insert+'" /></div>',modal_video:String()+'<div id="redactor_modal_content"><form id="redactorInsertVideoForm"><label>'+RLANG.video_html_code+'</label><textarea id="redactor_insert_video_area" style="width: 500px; height: 160px;"></textarea></form></div><div class="dialog-buttons"><a href="javascript:void(null);" class="btn pull-left redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" class="btn pull-right btn-primary" id="redactor_insert_video_btn" value="'+RLANG.insert+'" /></div>',toolbar:{html:{title:RLANG.html,func:"toggle"},formatting:{title:RLANG.formatting,func:"show",format:"text",dropdown:{p:{title:RLANG.paragraph,exec:"formatblock"},blockquote:{title:RLANG.quote,exec:"formatblock",className:"redactor_format_blockquote"},pre:{title:RLANG.code,exec:"formatblock",className:"redactor_format_pre"},h1:{title:RLANG.header1,exec:"formatblock",className:"redactor_format_h1"},h2:{title:RLANG.header2,exec:"formatblock",className:"redactor_format_h2"},h3:{title:RLANG.header3,exec:"formatblock",className:"redactor_format_h3"},h4:{title:RLANG.header4,exec:"formatblock",className:"redactor_format_h4"}}},bold:{title:RLANG.bold,exec:"bold"},italic:{title:RLANG.italic,exec:"italic"},deleted:{title:RLANG.deleted,exec:"strikethrough"},underline:{title:RLANG.underline,exec:"underline"},unorderedlist:{title:"&bull; "+RLANG.unorderedlist,exec:"insertunorderedlist"},orderedlist:{title:"1. "+RLANG.orderedlist,exec:"insertorderedlist"},outdent:{title:"< "+RLANG.outdent,exec:"outdent"},indent:{title:"> "+RLANG.indent,exec:"indent"},image:{title:RLANG.image,func:"showImage"},video:{title:RLANG.video,func:"showVideo"},file:{title:RLANG.file,func:"showFile"},table:{title:RLANG.table,func:"show",dropdown:{insert_table:{title:RLANG.insert_table,func:"showTable"},separator_drop1:{name:"separator"},insert_row_above:{title:RLANG.insert_row_above,func:"insertRowAbove"},insert_row_below:{title:RLANG.insert_row_below,func:"insertRowBelow"},insert_column_left:{title:RLANG.insert_column_left,func:"insertColumnLeft"},insert_column_right:{title:RLANG.insert_column_right,func:"insertColumnRight"},separator_drop2:{name:"separator"},add_head:{title:RLANG.add_head,func:"addHead"},delete_head:{title:RLANG.delete_head,func:"deleteHead"},separator_drop3:{name:"separator"},delete_column:{title:RLANG.delete_column,func:"deleteColumn"},delete_row:{title:RLANG.delete_row,func:"deleteRow"},delete_table:{title:RLANG.delete_table,func:"deleteTable"}}},link:{title:RLANG.link,func:"show",dropdown:{link:{title:RLANG.link_insert,func:"showLink"},unlink:{title:RLANG.unlink,exec:"unlink"}}},fontcolor:{title:RLANG.fontcolor,func:"show"},backcolor:{title:RLANG.backcolor,func:"show"},alignment:{title:RLANG.alignment,func:"show",dropdown:{alignleft:{title:RLANG.align_left,exec:"JustifyLeft"},aligncenter:{title:RLANG.align_center,exec:"JustifyCenter"},alignright:{title:RLANG.align_right,exec:"JustifyRight"},justify:{title:RLANG.align_justify,exec:"JustifyFull"}}},alignleft:{exec:"JustifyLeft",title:RLANG.align_left},aligncenter:{exec:"JustifyCenter",title:RLANG.align_center},alignright:{exec:"JustifyRight",title:RLANG.align_right},justify:{exec:"JustifyFull",title:RLANG.align_justify},horizontalrule:{exec:"inserthorizontalrule",title:RLANG.horizontalrule}}},c,this.$el.data()),this.dropdowns=[],this.init()};b.prototype={init:function(){function b(){if(this.enableAir(),this.buildToolbar(),"object"==typeof this.opts.plugins&&a.each(this.opts.plugins,a.proxy(function(b,c){"undefined"!=typeof RedactorPlugins[c]&&(a.extend(this,RedactorPlugins[c]),"undefined"!=typeof RedactorPlugins[c].init&&this.init())},this)),this.opts.activeButtons!==!1&&this.opts.toolbar!==!1){var b=a.proxy(function(){this.observeFormatting()},this);this.$editor.click(b).keyup(b)}var c=!1;if(this.browser("webkit")&&-1===navigator.userAgent.indexOf("Chrome")){var d=this.browser("version").split(".");d[0]<536&&(c=!0)}if(this.isMobile(!0)===!1&&c===!1&&this.$editor.bind("paste",a.proxy(function(){if(this.opts.cleanup===!1)return!0;this.pasteRunning=!0,this.setBuffer(),this.saveScroll=this.opts.autoresize===!0?this.document.body.scrollTop:this.$editor.scrollTop();var b=this.extractContent();setTimeout(a.proxy(function(){var a=this.extractContent();this.$editor.append(b),this.restoreSelection();var c=this.getFragmentHtml(a);this.pasteCleanUp(c),this.pasteRunning=!1},this),1)},this)),this.keyup(),this.keydown(),this.opts.autosave!==!1&&this.autoSave(),setTimeout(a.proxy(function(){this.observeImages(),this.observeTables()},this),1),this.browser("mozilla")){this.$editor.click(a.proxy(function(){this.saveSelection()},this));try{this.document.execCommand("enableObjectResizing",!1,!1),this.document.execCommand("enableInlineTableEditing",!1,!1)}catch(e){}}this.opts.focus&&setTimeout(a.proxy(function(){this.$editor.focus()},this),1),this.opts.fixed&&(this.observeScroll(),a(document).scroll(a.proxy(this.observeScroll,this))),"function"==typeof this.opts.callback&&this.opts.callback(this),this.opts.toolbar!==!1&&this.$toolbar.find("a").attr("tabindex","-1")}if(this.height=this.$el.css("height"),this.width=this.$el.css("width"),rdocument=this.document=document,rwindow=this.window=window,this.opts.mobile===!1&&this.isMobile())return this.build(!0),!1;if(this.opts.iframe&&(this.opts.autoresize=!1),this.opts.air)this.opts.buttons=this.opts.airButtons;else if(this.opts.toolbar!==!1){if(this.opts.source===!1){var c=this.opts.buttons.indexOf("html"),d=this.opts.buttons[c+1];this.opts.buttons.splice(c,1),"undefined"!=typeof d&&"|"===d&&this.opts.buttons.splice(c,1)}a.extend(this.opts.toolbar,this.opts.buttonsCustom),a.each(this.opts.buttonsAdd,a.proxy(function(a,b){this.opts.buttons.push(b)},this))}this.opts.toolbar!==!1&&a.each(this.opts.toolbar.formatting.dropdown,a.proxy(function(b){"-1"==a.inArray(b,this.opts.formattingTags)&&delete this.opts.toolbar.formatting.dropdown[b]},this)),this.build(!1,b)},shortcuts:function(a,b){a.preventDefault(),this.execCommand(b,!1)},keyup:function(){this.$editor.keyup(a.proxy(function(a){var b=a.keyCode||a.which;return this.browser("mozilla")&&!this.pasteRunning&&this.saveSelection(),"function"==typeof this.opts.keyupCallback&&this.opts.keyupCallback(this,a),8===b||46===b?(this.observeImages(),this.formatEmpty(a)):(13!==b||a.shiftKey||a.ctrlKey||a.metaKey||(this.browser("webkit")&&this.formatNewLine(a),this.opts.convertLinks&&this.$editor.linkify()),this.syncCode(),void 0)},this))},keydown:function(){this.$editor.keydown(a.proxy(function(b){var c=b.keyCode||b.which,d=this.getParentNode(),e=this.getCurrentNode(),f=!1,g=b.ctrlKey||b.metaKey;if(!d&&!e||"PRE"!==a(d).get(0).tagName&&"PRE"!==a(e).get(0).tagName||(f=!0),"function"==typeof this.opts.keydownCallback&&this.opts.keydownCallback(this,b),g&&this.opts.shortcuts&&(90===c?this.opts.buffer!==!1?(b.preventDefault(),this.getBuffer()):b.shiftKey?this.shortcuts(b,"redo"):this.shortcuts(b,"undo"):77===c?this.shortcuts(b,"removeFormat"):66===c?this.shortcuts(b,"bold"):73===c?this.shortcuts(b,"italic"):74===c?this.shortcuts(b,"insertunorderedlist"):75===c?this.shortcuts(b,"insertorderedlist"):76===c?this.shortcuts(b,"superscript"):72===c&&this.shortcuts(b,"subscript")),g||90===c||(this.opts.buffer=!1),f===!0&&13===c){b.preventDefault();var h=a(e).parent().text();return this.insertNodeAtCaret(this.document.createTextNode("\r\n")),-1==h.search(/\s$/)&&this.insertNodeAtCaret(this.document.createTextNode("\r\n")),this.syncCode(),!1}if(this.opts.shortcuts&&!b.shiftKey&&9===c){if(f!==!1)return b.preventDefault(),this.insertNodeAtCaret(this.document.createTextNode("	")),this.syncCode(),!1;this.shortcuts(b,"indent")}else this.opts.shortcuts&&b.shiftKey&&9===c&&this.shortcuts(b,"outdent");return this.browser("webkit")&&-1===navigator.userAgent.indexOf("Chrome")?this.safariShiftKeyEnter(b,c):void 0},this))},build:function(b,c){function d(){this.$editor=this.$content.contents().find("body").attr("contenteditable",!0).attr("dir",this.opts.direction),rdocument=this.document=this.$editor[0].ownerDocument,rwindow=this.window=this.document.defaultView||window,this.opts.css!==!1&&this.$content.contents().find("head").append('<link rel="stylesheet" href="'+this.opts.css+'" />'),this.$editor.html(g),c&&(c.call(this),c=null)}if(b!==!0){if(this.$box=a('<div class="redactor_box"></div>'),this.opts.air&&(this.air=a('<div class="redactor_air" style="display: none;"></div>')),this.$content=null,this.textareamode=!0,"TEXTAREA"===this.$el.get(0).tagName){if(this.opts.iframe){var e=this;this.$content=a('<iframe style="width: 100%;" frameborder="0"></iframe>').load(function(){d.call(e)})}else this.$content=this.$editor=a("<div></div>");var f=this.$el.get(0).className.split(/\s+/);a.each(f,a.proxy(function(a,b){this.$content.addClass("redactor_"+b)},this))}else this.textareamode=!1,this.$content=this.$editor=this.$el,this.$el=a('<textarea name="'+this.$editor.attr("id")+'"></textarea>').css("height",this.height);this.$editor&&this.$editor.addClass("redactor_editor").attr("contenteditable",!0).attr("dir",this.opts.direction),this.opts.tabindex!==!1&&this.$content.attr("tabindex",this.opts.tabindex),this.opts.minHeight!==!1&&this.$content.css("min-height",this.opts.minHeight+"px"),this.opts.wym===!0&&this.$content.addClass("redactor_editor_wym"),this.opts.autoresize===!1&&this.$content.css("height",this.height),this.$el.hide();var g="";this.textareamode?(g=this.$el.val(),g=this.savePreCode(g),this.$box.insertAfter(this.$el).append(this.$content).append(this.$el)):(g=this.$editor.html(),g=this.savePreCode(g),this.$box.insertAfter(this.$content).append(this.$el).append(this.$editor)),g=this.paragraphy(g),this.$editor&&this.$editor.html(g),this.textareamode===!1&&this.syncCode()}else if("TEXTAREA"!==this.$el.get(0).tagName){var g=this.$el.val(),h=a('<textarea name="'+this.$editor.attr("id")+'"></textarea>').css("height",this.height).val(g);this.$el.hide(),this.$el.after(h)}c&&this.$editor&&c.call(this)},enableAir:function(){return this.opts.air===!1?!1:(this.air.hide(),this.$editor.bind("textselect",a.proxy(function(a){this.showAir(a)},this)),this.$editor.bind("textunselect",a.proxy(function(){this.air.hide()},this)),void 0)},showAir:function(b){a(".redactor_air").hide();var c=this.air.innerWidth(),d=b.clientX;a(this.document).width()<d+c&&(d-=c);var e=b.clientY+a(document).scrollTop()+14;this.opts.iframe===!0&&(e+=this.$box.position().top,d+=this.$box.position().left),this.air.css({left:d+"px",top:e+"px"}).show()},syncCode:function(){this.$el.val(this.$editor.html())},setCode:function(a){a=this.stripTags(a),this.$editor.html(a).focus(),this.syncCode()},getCode:function(){var a="";return a=this.opts.visual?this.$editor.html():this.$el.val(),this.stripTags(a)},insertHtml:function(a){this.$editor.focus(),this.pasteHtmlAtCaret(a),this.observeImages(),this.syncCode()},pasteHtmlAtCaret:function(a){var b,c;if(this.document.getSelection){if(b=this.window.getSelection(),b.getRangeAt&&b.rangeCount){c=b.getRangeAt(0),c.deleteContents();var d=this.document.createElement("div");d.innerHTML=a;for(var e,f,g=this.document.createDocumentFragment();e=d.firstChild;)f=g.appendChild(e);c.insertNode(g),f&&(c=c.cloneRange(),c.setStartAfter(f),c.collapse(!0),b.removeAllRanges(),b.addRange(c))}}else this.document.selection&&"Control"!=this.document.selection.type&&this.document.selection.createRange().pasteHTML(a)},destroy:function(){var b=this.getCode();this.textareamode?(this.$box.after(this.$el),this.$box.remove(),this.$el.height(this.height).val(b).show()):(this.$box.after(this.$editor),this.$box.remove(),this.$editor.removeClass("redactor_editor").removeClass("redactor_editor_wym").attr("contenteditable",!1).html(b).show()),this.opts.toolbarExternal&&a(this.opts.toolbarExternal).empty(),a(".redactor_air").remove();for(var c=0;c<this.dropdowns.length;c++)this.dropdowns[c].remove(),delete this.dropdowns[c];this.opts.autosave!==!1&&clearInterval(this.autosaveInterval)},observeFormatting:function(){var b=this.getCurrentNode();this.inactiveAllButtons(),a.each(this.opts.activeButtonsStates,a.proxy(function(c,d){0!=a(b).closest(c,this.$editor.get()[0]).length&&this.setBtnActive(d)},this));var c=a(b).closest(["p","div","h1","h2","h3","h4","h5","h6","blockquote","td"]);if("undefined"!=typeof c[0]&&"undefined"!=typeof c[0].elem&&0!=a(c[0].elem).size()){var d=a(c[0].elem).css("text-align");switch(d){case"right":this.setBtnActive("alignright");break;case"center":this.setBtnActive("aligncenter");break;case"justify":this.setBtnActive("justify");break;default:this.setBtnActive("alignleft")}}},observeImages:function(){return this.opts.observeImages===!1?!1:(this.$editor.find("img").each(a.proxy(function(b,c){this.browser("msie")&&a(c).attr("unselectable","on"),this.resizeImage(c)},this)),void 0)},observeTables:function(){this.$editor.find("table").click(a.proxy(this.tableObserver,this))},observeScroll:function(){var b=a(this.document).scrollTop(),c=this.$box.offset().top,d=0;if(b>c){var e="100%";this.opts.fixedBox&&(d=this.$box.offset().left,e=this.$box.innerWidth()),this.fixed=!0,this.$toolbar.css({position:"fixed",width:e,zIndex:1005,top:this.opts.fixedTop+"px",left:d})}else this.fixed=!1,this.$toolbar.css({position:"relative",width:"auto",zIndex:1,top:0,left:d})},setBuffer:function(){this.saveSelection(),this.opts.buffer=this.$editor.html()},getBuffer:function(){return this.opts.buffer===!1?!1:(this.$editor.html(this.opts.buffer),this.browser("msie")||this.restoreSelection(),this.opts.buffer=!1,void 0)},execCommand:function(b,c){if(0==this.opts.visual)return this.$el.focus(),!1;try{var d;if("inserthtml"===b)this.browser("msie")?(this.$editor.focus(),this.document.selection.createRange().pasteHTML(c)):this.pasteHtmlAtCaret(c),this.observeImages();else if("unlink"===b)d=this.getParentNode(),"A"===a(d).get(0).tagName?a(d).replaceWith(a(d).text()):this.execRun(b,c);else if("JustifyLeft"===b||"JustifyCenter"===b||"JustifyRight"===b||"JustifyFull"===b){d=this.getCurrentNode();var e=a(d).get(0).tagName;if(this.opts.iframe===!1&&0==a(d).parents(".redactor_editor").size())return!1;var f=["P","DIV","H1","H2","H3","H4","H5","H6","BLOCKQUOTE","TD"];if(-1!=a.inArray(e,f)){var g=!1;"JustifyCenter"===b?g="center":"JustifyRight"===b?g="right":"JustifyFull"===b&&(g="justify"),g===!1?a(d).css("text-align",""):a(d).css("text-align",g)}else this.execRun(b,c)}else if("formatblock"===b&&"blockquote"===c)if(d=this.getCurrentNode(),"BLOCKQUOTE"===a(d).get(0).tagName)if(this.browser("msie")){var h=a("<p>"+a(d).html()+"</p>");a(d).replaceWith(h)}else this.execRun(b,"p");else if("P"===a(d).get(0).tagName){var i=a(d).parent();if("BLOCKQUOTE"===a(i).get(0).tagName){var h=a("<p>"+a(d).html()+"</p>");a(i).replaceWith(h),this.setSelection(h[0],0,h[0],0)}else if(this.browser("msie")){var h=a("<blockquote>"+a(d).html()+"</blockquote>");a(d).replaceWith(h)}else this.execRun(b,c)}else this.execRun(b,c);else"formatblock"!==b||"pre"!==c&&"p"!==c?("inserthorizontalrule"===b&&this.browser("msie")&&this.$editor.focus(),"formatblock"===b&&this.browser("mozilla")&&this.$editor.focus(),this.execRun(b,c)):(d=this.getParentNode(),"PRE"===a(d).get(0).tagName?a(d).replaceWith("<p>"+this.encodeEntities(a(d).text())+"</p>"):this.execRun(b,c));"inserthorizontalrule"===b&&this.$editor.find("hr").removeAttr("id"),this.syncCode(),this.oldIE()&&this.$editor.focus(),"function"==typeof this.opts.execCommandCallback&&this.opts.execCommandCallback(this,b),this.opts.air&&this.air.hide()}catch(j){}},execRun:function(a,b){"formatblock"===a&&this.browser("msie")&&(b="<"+b+">"),this.document.execCommand(a,!1,b)},formatNewLine:function(){var b=this.getParentNode();if("DIV"===b.nodeName&&"redactor_editor"===b.className){var c=a(this.getCurrentNode());if("DIV"===c.get(0).tagName&&(""===c.html()||"<br>"===c.html())){var d=a("<p>").append(c.clone().get(0).childNodes);c.replaceWith(d),d.html("<br />"),this.setSelection(d[0],0,d[0],0)}}},safariShiftKeyEnter:function(b,c){return b.shiftKey&&13===c?(b.preventDefault(),this.insertNodeAtCaret(a("<span><br /></span>").get(0)),this.syncCode(),!1):!0},formatEmpty:function(b){var c=a.trim(this.$editor.html());c=c.replace(/<br\s?\/?>/i,"");var d=c.replace(/<p>\s?<\/p>/gi,"");if(""===c||""===d){b.preventDefault();var e=a(this.opts.emptyHtml).get(0);return this.$editor.html(e),this.setSelection(e,0,e,0),this.syncCode(),!1}this.syncCode()},paragraphy:function(b){if(b=a.trim(b),""===b||"<p></p>"===b)return this.opts.emptyHtml;this.opts.convertDivs&&(b=b.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>"));var c=function(a,b,c){return a.replace(new RegExp(b,"g"),c)},d=function(a,d){return c(b,a,d)},e="(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])";return b+="\n",d("<br />\\s*<br />","\n\n"),d("(<"+e+"[^>]*>)","\n$1"),d("(</"+e+">)","$1\n\n"),d("\r\n|\r","\n"),d("\n\n+","\n\n"),d("\n?((.|\n)+?)$","<p>$1</p>\n"),d("<p>\\s*?</p>",""),d("<p>(<div[^>]*>\\s*)","$1<p>"),d("<p>([^<]+)\\s*?(</(div|address|form)[^>]*>)","<p>$1</p>$2"),d("<p>\\s*(</?"+e+"[^>]*>)\\s*</p>","$1"),d("<p>(<li.+?)</p>","$1"),d("<p>\\s*(</?"+e+"[^>]*>)","$1"),d("(</?"+e+"[^>]*>)\\s*</p>","$1"),d("(</?"+e+"[^>]*>)\\s*<br />","$1"),d("<br />(\\s*</?(p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)","$1"),-1!=b.indexOf("<pre")&&d("(<pre(.|\n)*?>)((.|\n)*?)</pre>",function(a,b,d,e){return c(b,"\\\\(['\"\\\\])","$1")+c(c(c(e,"<p>","\n"),"</p>|<br />",""),"\\\\(['\"\\\\])","$1")+"</pre>"}),d("\n</p>$","</p>")},stripTags:function(b){var c=this.opts.allowedTags,d=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return b.replace(d,function(b,d){return a.inArray(d.toLowerCase(),c)>"-1"?b:""})},savePreCode:function(b){var c=b.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return null!==c&&a.each(c,a.proxy(function(a,c){var d=c.match(/<pre(.*?)>([\w\W]*?)<\/pre>/i);d[2]=this.encodeEntities(d[2]),b=b.replace(c,"<pre"+d[1]+">"+d[2]+"</pre>")},this)),b},encodeEntities:function(a){return a=String(a).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"'),String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},cleanupPre:function(a){a=a.replace(/<br>/gi,"\n"),a=a.replace(/<\/p>/gi,"\n"),a=a.replace(/<\/div>/gi,"\n");var b=this.document.createElement("div");return b.innerHTML=a,b.textContent||b.innerText},pasteCleanUp:function(b){var c=this.getParentNode();return"PRE"===a(c).get(0).tagName?(b=this.cleanupPre(b),this.pasteCleanUpInsert(b),!0):(b=b.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,""),b=b.replace(/(&nbsp;){2,}/gi,"&nbsp;"),b=b.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2"),b=this.stripTags(b),b=b.replace(/<td><\/td>/gi,"[td]"),b=b.replace(/<td>&nbsp;<\/td>/gi,"[td]"),b=b.replace(/<td><br><\/td>/gi,"[td]"),b=b.replace(/<a(.*?)href="(.*?)"(.*?)>([\w\W]*?)<\/a>/gi,'[a href="$2"]$4[/a]'),b=b.replace(/<iframe(.*?)>([\w\W]*?)<\/iframe>/gi,"[iframe$1]$2[/iframe]"),b=b.replace(/<video(.*?)>([\w\W]*?)<\/video>/gi,"[video$1]$2[/video]"),b=b.replace(/<audio(.*?)>([\w\W]*?)<\/audio>/gi,"[audio$1]$2[/audio]"),b=b.replace(/<embed(.*?)>([\w\W]*?)<\/embed>/gi,"[embed$1]$2[/embed]"),b=b.replace(/<object(.*?)>([\w\W]*?)<\/object>/gi,"[object$1]$2[/object]"),b=b.replace(/<param(.*?)>/gi,"[param$1]"),b=b.replace(/<img(.*?)style="(.*?)"(.*?)>/gi,"[img$1$3]"),b=b.replace(/<(\w+)([\w\W]*?)>/gi,"<$1>"),b=b.replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,""),b=b.replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,""),b=b.replace(/\[td\]/gi,"<td>&nbsp;</td>"),b=b.replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>'),b=b.replace(/\[iframe(.*?)\]([\w\W]*?)\[\/iframe\]/gi,"<iframe$1>$2</iframe>"),b=b.replace(/\[video(.*?)\]([\w\W]*?)\[\/video\]/gi,"<video$1>$2</video>"),b=b.replace(/\[audio(.*?)\]([\w\W]*?)\[\/audio\]/gi,"<audio$1>$2</audio>"),b=b.replace(/\[embed(.*?)\]([\w\W]*?)\[\/embed\]/gi,"<embed$1>$2</embed>"),b=b.replace(/\[object(.*?)\]([\w\W]*?)\[\/object\]/gi,"<object$1>$2</object>"),b=b.replace(/\[param(.*?)\]/gi,"<param$1>"),b=b.replace(/\[img(.*?)\]/gi,"<img$1>"),this.opts.convertDivs&&(b=b.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>")),b=b.replace(/<span>([\w\W]*?)<\/span>/gi,"$1"),b=b.replace(/\n{3,}/gi,"\n"),b=b.replace(/<p><p>/gi,"<p>"),b=b.replace(/<\/p><\/p>/gi,"</p>"),this.browser("mozilla")&&(b=b.replace(/<br>$/gi,"")),this.pasteCleanUpInsert(b),void 0)},pasteCleanUpInsert:function(b){this.execCommand("inserthtml",b),this.opts.autoresize===!0?a(this.document.body).scrollTop(this.saveScroll):this.$editor.scrollTop(this.saveScroll)},formattingRemove:function(b){var c=[],d=b.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return null!==d&&a.each(d,function(a,d){b=b.replace(d,"prebuffer_"+a),c.push(d)}),b=b.replace(/\s{2,}/g," "),b=b.replace(/\n/g," "),b=b.replace(/[\t]*/g,""),b=b.replace(/\n\s*\n/g,"\n"),b=b.replace(/^[\s\n]*/g,""),b=b.replace(/[\s\n]*$/g,""),b=b.replace(/>\s+</g,"><"),c&&(a.each(c,function(a,c){b=b.replace("prebuffer_"+a,c)}),c=[]),b},formattingIndenting:function(a){return a=a.replace(/<li/g,"	<li"),a=a.replace(/<tr/g,"	<tr"),a=a.replace(/<td/g,"		<td"),a=a.replace(/<\/tr>/g,"	</tr>")},formattingEmptyTags:function(a){for(var b=["<pre></pre>","<blockquote>\\s*</blockquote>","<em>\\s*</em>","<ul></ul>","<ol></ol>","<li></li>","<table></table>","<tr></tr>","<span>\\s*<span>","<span>&nbsp;<span>","<b>\\s*</b>","<b>&nbsp;</b>","<p>\\s*</p>","<p>&nbsp;</p>","<p>\\s*<br>\\s*</p>","<div>\\s*</div>","<div>\\s*<br>\\s*</div>"],c=0;c<b.length;++c){var d=b[c];a=a.replace(new RegExp(d,"gi"),"")}return a},formattingAddBefore:function(a){for(var b="\r\n",c=["<p","<form","</ul>","</ol>","<fieldset","<legend","<object","<embed","<select","<option","<input","<textarea","<pre","<blockquote","<ul","<ol","<li","<dl","<dt","<dd","<table","<thead","<tbody","<caption","</caption>","<th","<tr","<td","<figure"],d=0;d<c.length;++d){var e=c[d];a=a.replace(new RegExp(e,"gi"),b+e)}return a},formattingAddAfter:function(a){for(var b="\r\n",c=["</p>","</div>","</h1>","</h2>","</h3>","</h4>","</h5>","</h6>","<br>","<br />","</dl>","</dt>","</dd>","</form>","</blockquote>","</pre>","</legend>","</fieldset>","</object>","</embed>","</textarea>","</select>","</option>","</table>","</thead>","</tbody>","</tr>","</td>","</th>","</figure>"],d=0;d<c.length;++d){var e=c[d];a=a.replace(new RegExp(e,"gi"),e+b)}return a},formatting:function(a){return a=this.formattingRemove(a),a=this.formattingEmptyTags(a),a=this.formattingAddBefore(a),a=this.formattingAddAfter(a),a=this.formattingIndenting(a)},toggle:function(){var a;if(this.opts.visual){var b=this.$editor.innerHeight();this.$editor.hide(),this.$content.hide(),a=this.$editor.html(),this.$el.height(b).val(a).show().focus(),this.setBtnActive("html"),this.opts.visual=!1}else{this.$el.hide();var a=this.$el.val();this.$editor.html(a).show(),this.$content.show(),""===this.$editor.html()&&this.setCode(this.opts.emptyHtml),this.$editor.focus(),this.setBtnInactive("html"),this.opts.visual=!0,this.observeImages(),this.observeTables()}},autoSave:function(){this.autosaveInterval=setInterval(a.proxy(function(){a.ajax({url:this.opts.autosave,type:"post",data:this.$el.attr("name")+"="+escape(encodeURIComponent(this.getCode())),success:a.proxy(function(a){"function"==typeof this.opts.autosaveCallback&&this.opts.autosaveCallback(a,this)
},this)})},this),1e3*this.opts.interval)},buildToolbar:function(){return this.opts.toolbar===!1?!1:(this.$toolbar=a("<ul>").addClass("redactor_toolbar"),this.opts.air?(a(this.air).append(this.$toolbar),a("body").append(this.air)):this.opts.toolbarExternal===!1?this.$box.prepend(this.$toolbar):a(this.opts.toolbarExternal).html(this.$toolbar),a.each(this.opts.buttons,a.proxy(function(b,c){if("|"!==c&&"undefined"!=typeof this.opts.toolbar[c]){var d=this.opts.toolbar[c];if(this.opts.fileUpload===!1&&"file"===c)return!0;this.$toolbar.append(a("<li>").append(this.buildButton(c,d)))}"|"===c&&this.$toolbar.append(a('<li class="redactor_separator"></li>'))},this)),void 0)},buildButton:function(b,c){if("text"==c.format)var d=a('<a href="javascript:void(null);" title="'+c.title+'" class="redactor_btn_'+b+' redactor_btn_text_in_bar">'+c.title+"</a>");else var d=a('<a href="javascript:void(null);" title="'+c.title+'" class="redactor_btn_'+b+'"></a>');if("undefined"==typeof c.func?d.click(a.proxy(function(){-1!=a.inArray(b,this.opts.activeButtons)&&(this.inactiveAllButtons(),this.setBtnActive(b)),this.browser("mozilla")&&this.$editor.focus(),this.execCommand(c.exec,b)},this)):"show"!==c.func&&d.click(a.proxy(function(a){this[c.func](a)},this)),"undefined"!=typeof c.callback&&c.callback!==!1&&d.click(a.proxy(function(a){c.callback(this,a,b)},this)),"backcolor"===b||"fontcolor"===b||"undefined"!=typeof c.dropdown){var e=a('<ul class="dropdown-menu" style="display: none;">');e="backcolor"===b||"fontcolor"===b?this.buildColorPicker(e,b):this.buildDropdown(e,c.dropdown),0==a("#redactor-dropdown-holder").length&&a(document.body).append('<div id="redactor-dropdown-holder" class="ccm-ui" />');var f=a("#redactor-dropdown-holder");this.dropdowns.push(e.appendTo(f)),this.hdlShowDropDown=a.proxy(function(a){this.showDropDown(a,e,b)},this),d.click(this.hdlShowDropDown)}return d},buildDropdown:function(b,c){return a.each(c,a.proxy(function(c,d){"undefined"==typeof d.className&&(d.className="");var e;"undefined"!=typeof d.name&&"separator"===d.name?e=a('<li class="divider">'):(e=a('<a href="javascript:void(null);" class="'+d.className+'">'+d.title+"</a>"),"function"==typeof d.callback?a(e).click(a.proxy(function(a){d.callback(this,a,c)},this)):"undefined"==typeof d.func?a(e).click(a.proxy(function(){this.execCommand(d.exec,c)},this)):a(e).click(a.proxy(function(a){this[d.func](a)},this)),e=a("<li />").append(e)),a(b).append(e)},this)),b},buildColorPicker:function(b,c){var d;d="backcolor"===c?this.browser("msie")?"BackColor":"hilitecolor":"forecolor",a(b).width(210);for(var e=this.opts.colors.length,f=0;e>f;++f){var g=this.opts.colors[f],h=a('<a rel="'+g+'" href="javascript:void(null);" class="redactor_color_link"></a>').css({backgroundColor:g});_swatch=a('<li class="redactor_color_link_swatch" />').append(h),a(b).append(_swatch);var i=this;a(h).click(function(){i.execCommand(d,a(this).attr("rel")),"forecolor"===d&&i.$editor.find("font").replaceWith(function(){return a('<span style="color: '+a(this).attr("color")+';">'+a(this).html()+"</span>")}),i.browser("msie")&&"BackColor"===d&&i.$editor.find("font").replaceWith(function(){return a('<span style="'+a(this).attr("style")+'">'+a(this).html()+"</span>")})})}var j=a('<a href="javascript:void(null);" class="redactor_color_none"></a>').html(RLANG.none);return"backcolor"===c?j.click(a.proxy(this.setBackgroundNone,this)):j.click(a.proxy(this.setColorNone,this)),a(b).append('<li style="clear: both"></li>'),a(b).append('<li class="divider"></li>'),_elnone=a("<li />").append(j),a(b).append(_elnone),b},setBackgroundNone:function(){a(this.getParentNode()).css("background-color","transparent"),this.syncCode()},setColorNone:function(){a(this.getParentNode()).attr("color","").css("color",""),this.syncCode()},showDropDown:function(b,c,d){if(this.getBtn(d).hasClass("dropact"))this.hideAllDropDown();else{this.hideAllDropDown(),this.setBtnActive(d),this.getBtn(d).addClass("dropact");var e=this.getBtn(d).offset().left;if(this.opts.air){var f=this.air.offset().top;a(c).css({position:"absolute",left:e+"px",top:f+30+"px"}).show()}else if(this.opts.fixed&&this.fixed)a(c).css({position:"fixed",left:e+"px",top:"30px"}).show();else{var g=this.$toolbar.offset().top+30;a(c).css({position:"absolute",left:e+"px",top:g+"px"}).show()}}var h=a.proxy(function(a){this.hideDropDown(a,c,d)},this);a(document).one("click",h),this.$editor.one("click",h),this.$content.one("click",h),b.stopPropagation()},hideAllDropDown:function(){this.$toolbar.find("a.dropact").removeClass("redactor_act").removeClass("dropact"),a("#redactor-dropdown-holder .dropdown-menu").hide()},hideDropDown:function(b,c){a(b.target).hasClass("dropact")||(a(c).removeClass("dropact"),this.showedDropDown=!1,this.hideAllDropDown())},getBtn:function(b){return this.opts.toolbar===!1?!1:a(this.$toolbar.find("a.redactor_btn_"+b))},setBtnActive:function(a){this.getBtn(a).addClass("redactor_act")},setBtnInactive:function(a){this.getBtn(a).removeClass("redactor_act")},inactiveAllButtons:function(){a.each(this.opts.activeButtons,a.proxy(function(a,b){this.setBtnInactive(b)},this))},changeBtnIcon:function(a,b){this.getBtn(a).addClass("redactor_btn_"+b)},removeBtnIcon:function(a,b){this.getBtn(a).removeClass("redactor_btn_"+b)},addBtnSeparator:function(){this.$toolbar.append(a('<li class="redactor_separator"></li>'))},addBtnSeparatorAfter:function(b){var c=this.getBtn(b);c.parent().after(a('<li class="redactor_separator"></li>'))},addBtnSeparatorBefore:function(b){var c=this.getBtn(b);c.parent().before(a('<li class="redactor_separator"></li>'))},removeBtnSeparatorAfter:function(a){var b=this.getBtn(a);b.parent().next().remove()},removeBtnSeparatorBefore:function(a){var b=this.getBtn(a);b.parent().prev().remove()},setBtnRight:function(a){return this.opts.toolbar===!1?!1:(this.getBtn(a).parent().addClass("redactor_btn_right"),void 0)},setBtnLeft:function(a){return this.opts.toolbar===!1?!1:(this.getBtn(a).parent().removeClass("redactor_btn_right"),void 0)},addBtn:function(b,c,d,e){if(this.opts.toolbar===!1)return!1;var f=this.buildButton(b,{title:c,callback:d,dropdown:e});this.$toolbar.append(a("<li>").append(f))},addBtnFirst:function(b,c,d,e){if(this.opts.toolbar===!1)return!1;var f=this.buildButton(b,{title:c,callback:d,dropdown:e});this.$toolbar.prepend(a("<li>").append(f))},addBtnAfter:function(b,c,d,e,f){if(this.opts.toolbar===!1)return!1;var g=this.buildButton(c,{title:d,callback:e,dropdown:f}),h=this.getBtn(b);h.parent().after(a("<li>").append(g))},addBtnBefore:function(b,c,d,e,f){if(this.opts.toolbar===!1)return!1;var g=this.buildButton(c,{title:d,callback:e,dropdown:f}),h=this.getBtn(b);h.parent().before(a("<li>").append(g))},removeBtn:function(a,b){var c=this.getBtn(a);b===!0&&c.parent().next().remove(),c.parent().removeClass("redactor_btn_right"),c.remove()},getFragmentHtml:function(a){var b=a.cloneNode(!0),c=this.document.createElement("div");return c.appendChild(b),c.innerHTML},extractContent:function(){for(var a,b=this.$editor.get(0),c=this.document.createDocumentFragment();a=b.firstChild;)c.appendChild(a);return c},saveSelection:function(){this.$editor.focus(),this.savedSel=this.getOrigin(),this.savedSelObj=this.getFocus()},restoreSelection:function(){"undefined"!=typeof this.savedSel&&null!==this.savedSel&&null!==this.savedSelObj&&"BODY"!==this.savedSel[0].tagName?this.opts.iframe===!1&&0==a(this.savedSel[0]).closest(".redactor_editor").size()?this.$editor.focus():(this.browser("opera")&&this.$editor.focus(),this.setSelection(this.savedSel[0],this.savedSel[1],this.savedSelObj[0],this.savedSelObj[1]),this.browser("mozilla")&&this.$editor.focus()):this.$editor.focus()},getSelection:function(){var a=this.document;return this.window.getSelection?this.window.getSelection():a.getSelection?a.getSelection():a.selection.createRange()},hasSelection:function(){if(this.oldIE()){var a,b=this.$editor.get(0);return b.focus(),b.document.selection?(a=b.document.selection.createRange(),a&&a.parentElement().document===b.document):!1}var c;return(c=this.getSelection())&&null!=c.focusNode&&null!=c.anchorNode},getOrigin:function(){if(this.oldIE()){var a,b=this.$editor.get(0);return b.focus(),this.hasSelection()?(a=b.document.selection.createRange(),this._getBoundary(b.document,a,!0)):null}var c;return(c=this.getSelection())&&null!=c.anchorNode?[c.anchorNode,c.anchorOffset]:null},getFocus:function(){if(this.oldIE()){var a,b=this.$editor.get(0);return b.focus(),this.hasSelection()?(a=b.document.selection.createRange(),this._getBoundary(b.document,a,!1)):null}var c;return(c=this.getSelection())&&null!=c.focusNode?[c.focusNode,c.focusOffset]:null},setSelection:function(a,b,c,d){if(null==c&&(c=a),null==d&&(d=b),this.oldIE()){var e=this.$editor.get(0),f=e.document.body.createTextRange();return this._moveBoundary(e.document,f,!1,c,d),this._moveBoundary(e.document,f,!0,a,b),f.select()}var g=this.getSelection();if(g)if(g.collapse&&g.extend)g.collapse(a,b),g.extend(c,d);else{r=this.document.createRange(),r.setStart(a,b),r.setEnd(c,d);try{g.removeAllRanges()}catch(h){}g.addRange(r)}},getCurrentNode:function(){return"undefined"!=typeof this.window.getSelection?this.getSelectedNode().parentNode:"undefined"!=typeof this.document.selection?this.getSelection().parentElement():void 0},getParentNode:function(){return a(this.getCurrentNode()).parent()[0]},getSelectedNode:function(){if(this.oldIE())return this.getSelection().parentElement();if("undefined"!=typeof this.window.getSelection){var a=this.window.getSelection();return a.rangeCount>0?this.getSelection().getRangeAt(0).commonAncestorContainer:!1}return"undefined"!=typeof this.document.selection?this.getSelection():void 0},_getBoundary:function(a,b,c){var d,e,f,g,h;for(e=a.createElement("a"),d=b.duplicate(),d.collapse(c),h=d.parentElement();;)if(h.insertBefore(e,e.previousSibling),d.moveToElementText(e),!(d.compareEndPoints(c?"StartToStart":"StartToEnd",b)>0&&null!=e.previousSibling))break;return-1===d.compareEndPoints(c?"StartToStart":"StartToEnd",b)&&e.nextSibling?(d.setEndPoint(c?"EndToStart":"EndToEnd",b),f=e.nextSibling,g=d.text.length):(f=e.parentNode,g=this._getChildIndex(e)),e.parentNode.removeChild(e),[f,g]},_moveBoundary:function(a,b,c,d,e){var f,g,h,i,j;return j=0,f=this._isText(d)?d:d.childNodes[e],g=this._isText(d)?d.parentNode:d,this._isText(d)&&(j=e),i=a.createElement("a"),g.insertBefore(i,f||null),h=a.body.createTextRange(),h.moveToElementText(i),i.parentNode.removeChild(i),b.setEndPoint(c?"StartToStart":"EndToEnd",h),b[c?"moveStart":"moveEnd"]("character",j)},_isText:function(a){return null!=a?3==a.nodeType:!1},_getChildIndex:function(a){for(var b=0;a=a.previousSibling;)b++;return b},insertNodeAfterCaret:function(a){this.saveSelection(),this.insertNodeAtCaret(a),this.restoreSelection()},insertNodeAtCaret:function(a){if(this.window.getSelection){var b=this.getSelection();if(b.rangeCount){var c=b.getRangeAt(0);c.collapse(!1),c.insertNode(a),c=c.cloneRange(),c.selectNodeContents(a),c.collapse(!1),b.removeAllRanges(),b.addRange(c)}}else if(this.document.selection){var d=1===a.nodeType?a.outerHTML:a.data,e="marker_"+(""+Math.random()).slice(2);d+='<span id="'+e+'"></span>';var f=this.getSelection();f.collapse(!1),f.pasteHTML(d);var g=this.document.getElementById(e);f.moveToElementText(g),f.select(),g.parentNode.removeChild(g)}},getSelectedHtml:function(){var a="";if(this.window.getSelection){var b=this.window.getSelection();if(b.rangeCount){for(var c=this.document.createElement("div"),d=0,e=b.rangeCount;e>d;++d)c.appendChild(b.getRangeAt(d).cloneContents());a=c.innerHTML}}else this.document.selection&&"Text"===this.document.selection.type&&(a=this.document.selection.createRange().htmlText);return a},resizeImage:function(b){var c,d,e=!1,f=!1,g=a(b).width()/a(b).height(),h=10,i=10;a(b).off("hover mousedown mouseup click mousemove"),a(b).hover(function(){a(b).css("cursor","nw-resize")},function(){a(b).css("cursor",""),e=!1}),a(b).mousedown(function(h){h.preventDefault(),g=a(b).width()/a(b).height(),e=!0,f=!0,c=Math.round(h.pageX-a(b).eq(0).offset().left),d=Math.round(h.pageY-a(b).eq(0).offset().top)}),a(b).mouseup(a.proxy(function(){e=!1,a(b).css("cursor",""),this.syncCode()},this)),a(b).click(a.proxy(function(a){f&&this.imageEdit(a)},this)),a(b).mousemove(function(j){if(e){f=!1;var k=(Math.round(j.pageX-a(this).eq(0).offset().left)-c,Math.round(j.pageY-a(this).eq(0).offset().top)-d),l=a(b).height(),m=parseInt(l,10)+k,n=m*g;n>h&&a(b).width(n),m>i&&a(b).height(m),c=Math.round(j.pageX-a(this).eq(0).offset().left),d=Math.round(j.pageY-a(this).eq(0).offset().top)}})},showTable:function(){this.saveSelection(),this.modalInit(RLANG.table,this.opts.modal_table,200,a.proxy(function(){a("#redactor_insert_table_btn").click(a.proxy(this.insertTable,this)),setTimeout(function(){a("#redactor_table_rows").focus()},200)},this))},insertTable:function(){for(var b=a("#redactor_table_rows").val(),c=a("#redactor_table_columns").val(),d=a("<div></div>"),e=Math.floor(99999*Math.random()),f=a('<table id="table'+e+'"><tbody></tbody></table>'),g=0;b>g;g++){for(var h=a("<tr></tr>"),i=0;c>i;i++){var j=a("<td><br></td>");a(h).append(j)}a(f).append(h)}a(d).append(f);var k=a(d).html()+"<p></p>";this.restoreSelection(),this.execCommand("inserthtml",k),this.modalClose(),this.observeTables()},tableObserver:function(b){this.$table=a(b.target).closest("table"),this.$table_tr=this.$table.find("tr"),this.$table_td=this.$table.find("td"),this.$tbody=a(b.target).closest("tbody"),this.$thead=a(this.$table).find("thead"),this.$current_td=a(b.target),this.$current_tr=a(b.target).closest("tr")},deleteTable:function(){a(this.$table).remove(),this.$table=!1,this.syncCode()},deleteRow:function(){a(this.$current_tr).remove(),this.syncCode()},deleteColumn:function(){var b=a(this.$current_td).get(0).cellIndex;a(this.$table).find("tr").each(function(){a(this).find("td").eq(b).remove()}),this.syncCode()},addHead:function(){if(0!==a(this.$table).find("thead").size())this.deleteHead();else{var b=a(this.$table).find("tr").first().clone();b.find("td").html("&nbsp;"),this.$thead=a("<thead></thead>"),this.$thead.append(b),a(this.$table).prepend(this.$thead),this.syncCode()}},deleteHead:function(){a(this.$thead).remove(),this.$thead=!1,this.syncCode()},insertRowAbove:function(){this.insertRow("before")},insertRowBelow:function(){this.insertRow("after")},insertColumnLeft:function(){this.insertColumn("before")},insertColumnRight:function(){this.insertColumn("after")},insertRow:function(b){var c=a(this.$current_tr).clone();c.find("td").html("&nbsp;"),"after"===b?a(this.$current_tr).after(c):a(this.$current_tr).before(c),this.syncCode()},insertColumn:function(b){var c=0;this.$current_tr.find("td").each(a.proxy(function(b,d){a(d)[0]===this.$current_td[0]&&(c=b)},this)),this.$table_tr.each(function(d,e){var f=a(e).find("td").eq(c),g=f.clone();g.html("&nbsp;"),"after"===b?a(f).after(g):a(f).before(g)}),this.syncCode()},showVideo:function(){this.saveSelection(),this.modalInit(RLANG.video,this.opts.modal_video,500,a.proxy(function(){a("#redactor_insert_video_btn").click(a.proxy(this.insertVideo,this)),setTimeout(function(){a("#redactor_insert_video_area").focus()},200)},this))},insertVideo:function(){var b=a("#redactor_insert_video_area").val();b=this.stripTags(b),this.restoreSelection(),this.execCommand("inserthtml",b),this.modalClose()},imageEdit:function(b){var c=a(b.target),d=c.parent(),e=a.proxy(function(){a("#redactor_file_alt").val(c.attr("alt")),a("#redactor_image_edit_src").attr("href",c.attr("src")),a("#redactor_form_image_align").val(c.css("float")),"A"===a(d).get(0).tagName&&a("#redactor_file_link").val(a(d).attr("href")),a("#redactor_image_delete_btn").click(a.proxy(function(){this.imageDelete(c)},this)),a("#redactorSaveBtn").click(a.proxy(function(){this.imageSave(c)},this))},this);this.modalInit(RLANG.image,this.opts.modal_image_edit,380,e)},imageDelete:function(b){a(b).remove(),this.modalClose(),this.syncCode()},imageSave:function(b){var c=a(b).parent();a(b).attr("alt",a("#redactor_file_alt").val());var d=a("#redactor_form_image_align").val();"left"===d?a(b).css({"float":"left",margin:"0 10px 10px 0"}):"right"===d?a(b).css({"float":"right",margin:"0 0 10px 10px"}):a(b).css({"float":"none",margin:"0"});var e=a.trim(a("#redactor_file_link").val());""!==e?"A"!==a(c).get(0).tagName?a(b).replaceWith('<a href="'+e+'">'+this.outerHTML(b)+"</a>"):a(c).attr("href",e):"A"===a(c).get(0).tagName&&a(c).replaceWith(this.outerHTML(b)),this.modalClose(),this.observeImages(),this.syncCode()},showImage:function(){this.saveSelection();var b=a.proxy(function(){if(this.opts.imageGetJson!==!1?a.getJSON(this.opts.imageGetJson,a.proxy(function(b){var c={},d=0;a.each(b,a.proxy(function(a,b){"undefined"!=typeof b.folder&&(d++,c[b.folder]=d)},this));var e=!1;if(a.each(b,a.proxy(function(b,d){var f="";"undefined"!=typeof d.title&&(f=d.title);var g=0;a.isEmptyObject(c)||"undefined"==typeof d.folder||(g=c[d.folder],e===!1&&(e=".redactorfolder"+g));var h=a('<img src="'+d.thumb+'" class="redactorfolder redactorfolder'+g+'" rel="'+d.image+'" title="'+f+'" />');a("#redactor_image_box").append(h),a(h).click(a.proxy(this.imageSetThumb,this))},this)),!a.isEmptyObject(c)){a(".redactorfolder").hide(),a(e).show();var f=function(b){a(".redactorfolder").hide(),a(".redactorfolder"+a(b.target).val()).show()},g=a('<select id="redactor_image_box_select">');a.each(c,function(b,c){g.append(a('<option value="'+c+'">'+b+"</option>"))}),a("#redactor_image_box").before(g),g.change(f)}},this)):a("#redactor_tabs a").eq(1).remove(),this.opts.imageUpload!==!1)this.opts.uploadCrossDomain===!1&&this.isMobile()===!1&&0!==a("#redactor_file").size()&&a("#redactor_file").dragupload({url:this.opts.imageUpload,uploadFields:this.opts.uploadFields,success:a.proxy(this.imageUploadCallback,this),error:a.proxy(this.opts.imageUploadErrorCallback,this)}),this.uploadInit("redactor_file",{auto:!0,url:this.opts.imageUpload,success:a.proxy(this.imageUploadCallback,this),error:a.proxy(this.opts.imageUploadErrorCallback,this)});else if(a(".redactor_tab").hide(),this.opts.imageGetJson===!1)a("#redactor_tabs").remove(),a("#redactor_tab3").show();else{var b=a("#redactor_tabs a");b.eq(0).remove(),b.eq(1).addClass("redactor_tabs_act"),a("#redactor_tab2").show()}a("#redactor_upload_btn").click(a.proxy(this.imageUploadCallbackLink,this)),this.opts.imageUpload===!1&&this.opts.imageGetJson===!1&&setTimeout(function(){a("#redactor_file_link").focus()},200)},this);this.modalInit(RLANG.image,this.opts.modal_image,400,b)},imageSetThumb:function(b){this._imageSet('<img src="'+a(b.target).attr("rel")+'" alt="'+a(b.target).attr("title")+'" />',!0)},imageUploadCallbackLink:function(){if(""!==a("#redactor_file_link").val()){var b='<img src="'+a("#redactor_file_link").val()+'" />';this._imageSet(b,!0)}else this.modalClose()},imageUploadCallback:function(a){this._imageSet(a)},_imageSet:function(a,b){if(this.restoreSelection(),a!==!1){var c="";c=b!==!0?'<p><img src="'+a.filelink+'" /></p>':a,this.execCommand("inserthtml",c),b!==!0&&"function"==typeof this.opts.imageUploadCallback&&this.opts.imageUploadCallback(this,a)}this.modalClose(),this.observeImages()},showLink:function(){this.saveSelection();var b=a.proxy(function(){this.insert_link_node=!1;var b=this.getSelection(),c="",d="",e="";if(this.browser("msie")){var f=this.getParentNode();"A"===f.nodeName?(this.insert_link_node=a(f),d=this.insert_link_node.text(),c=this.insert_link_node.attr("href"),e=this.insert_link_node.attr("target")):d=this.oldIE()?b.text:b.toString()}else b&&b.anchorNode&&"A"===b.anchorNode.parentNode.tagName?(c=b.anchorNode.parentNode.href,d=b.anchorNode.parentNode.text,e=b.anchorNode.parentNode.target,""===b.toString()&&(this.insert_link_node=b.anchorNode.parentNode)):d=b.toString();a(".redactor_link_text").val(d);var g=self.location.href.replace(/\/$/i,""),h=c.replace(g,"");0===c.search("mailto:")?(this.setModalTab(2),a("#redactor_tab_selected").val(2),a("#redactor_link_mailto").val(c.replace("mailto:",""))):0===h.search(/^#/gi)?(this.setModalTab(3),a("#redactor_tab_selected").val(3),a("#redactor_link_anchor").val(h.replace(/^#/gi,""))):a("#redactor_link_url").val(h),"_blank"===e&&a("#redactor_link_blank").attr("checked",!0),a("#redactor_insert_link_btn").click(a.proxy(this.insertLink,this)),setTimeout(function(){a("#redactor_link_url").focus()},200)},this);this.modalInit(RLANG.link,this.opts.modal_link,200,b)},insertLink:function(){var b=a("#redactor_tab_selected").val(),c="",d="",e="",f="";if("1"===b){c=a("#redactor_link_url").val(),d=a("#redactor_link_url_text").val(),a("#redactor_link_blank").prop("checked")&&(e=' target="_blank"',f="_blank");var g="/(w+:{0,1}w*@)?(S+)(:[0-9]+)?(/|/([w#!:.?+=&%@!-/]))?/",h=new RegExp("^(http|ftp|https)://"+g,"i"),i=new RegExp("^"+g,"i");-1==c.search(h)&&0==c.search(i)&&this.opts.protocol!==!1&&(c=this.opts.protocol+c)}else"2"===b?(c="mailto:"+a("#redactor_link_mailto").val(),d=a("#redactor_link_mailto_text").val()):"3"===b&&(c="#"+a("#redactor_link_anchor").val(),d=a("#redactor_link_anchor_text").val());this._insertLink('<a href="'+c+'"'+e+">"+d+"</a>",a.trim(d),c,f)},_insertLink:function(b,c,d,e){this.$editor.focus(),this.restoreSelection(),""!==c&&(this.insert_link_node?(a(this.insert_link_node).text(c),a(this.insert_link_node).attr("href",d),""!==e?a(this.insert_link_node).attr("target",e):a(this.insert_link_node).removeAttr("target"),this.syncCode()):this.execCommand("inserthtml",b)),this.modalClose()},showFile:function(){this.saveSelection();var b=a.proxy(function(){var b=this.getSelection(),c="";c=this.oldIE()?b.text:b.toString(),a("#redactor_filename").val(c),this.opts.uploadCrossDomain===!1&&this.isMobile()===!1&&a("#redactor_file").dragupload({url:this.opts.fileUpload,uploadFields:this.opts.uploadFields,success:a.proxy(this.fileUploadCallback,this),error:a.proxy(this.opts.fileUploadErrorCallback,this)}),this.uploadInit("redactor_file",{auto:!0,url:this.opts.fileUpload,success:a.proxy(this.fileUploadCallback,this),error:a.proxy(this.opts.fileUploadErrorCallback,this)})},this);this.modalInit(RLANG.file,this.opts.modal_file,500,b)},fileUploadCallback:function(b){if(this.restoreSelection(),b!==!1){var c=a("#redactor_filename").val();""===c&&(c=b.filename);var d='<a href="'+b.filelink+'">'+c+"</a>";this.browser("webkit")&&this.window.chrome&&(d+="&nbsp;"),this.execCommand("inserthtml",d),"function"==typeof this.opts.fileUploadCallback&&this.opts.fileUploadCallback(this,b)}this.modalClose()},modalInit:function(b,c,d,e){if(td=a('<div class="ccm-ui" />').html(c),jQuery.fn.dialog.open({title:b,width:d,height:"auto",element:td,modal:!1}),"function"==typeof e&&e(),0!==a("#redactor_tabs").size()){var f=this;a("#redactor_tabs a").each(function(b,c){b++,a(c).click(function(){if(a("#redactor_tabs a").removeClass("redactor_tabs_act"),a(this).addClass("redactor_tabs_act"),a(".redactor_tab").hide(),a("#redactor_tab"+b).show(),a("#redactor_tab_selected").val(b),f.isMobile()===!1){var c=a("#redactor_modal").outerHeight();a("#redactor_modal").css("margin-top","-"+(c+10)/2+"px")}})})}a(".redactor_btn_modal_close").click(a.proxy(this.modalClose,this))},modalClose:function(){return jQuery.fn.dialog.closeTop(),!1},setModalTab:function(b){a(".redactor_tab").hide();var c=a("#redactor_tabs li");c.removeClass("active"),c.eq(b-1).addClass("active"),a("#redactor_tab"+b).show()},uploadInit:function(b,c){this.uploadOptions={url:!1,success:!1,error:!1,start:!1,trigger:!1,auto:!1,input:!1},a.extend(this.uploadOptions,c),0!==a("#"+b).size()&&"INPUT"===a("#"+b).get(0).tagName?(this.uploadOptions.input=a("#"+b),this.element=a(a("#"+b).get(0).form)):this.element=a("#"+b),this.element_action=this.element.attr("action"),this.uploadOptions.auto?a(this.uploadOptions.input).change(a.proxy(function(){this.element.submit(function(){return!1}),this.uploadSubmit()},this)):this.uploadOptions.trigger&&a("#"+this.uploadOptions.trigger).click(a.proxy(this.uploadSubmit,this))},uploadSubmit:function(){this.uploadForm(this.element,this.uploadFrame())},uploadFrame:function(){this.id="f"+Math.floor(99999*Math.random());var b=this.document.createElement("div"),c='<iframe style="display:none" id="'+this.id+'" name="'+this.id+'"></iframe>';return b.innerHTML=c,a(b).appendTo("body"),this.uploadOptions.start&&this.uploadOptions.start(),a("#"+this.id).load(a.proxy(this.uploadLoaded,this)),this.id},uploadForm:function(b,c){if(this.uploadOptions.input){var d="redactorUploadForm"+this.id,e="redactorUploadFile"+this.id;this.form=a('<form  action="'+this.uploadOptions.url+'" method="POST" target="'+c+'" name="'+d+'" id="'+d+'" enctype="multipart/form-data"></form>'),this.opts.uploadFields!==!1&&"object"==typeof this.opts.uploadFields&&a.each(this.opts.uploadFields,a.proxy(function(b,c){0===c.toString().indexOf("#")&&(c=a(c).val());var d=a("<input/>",{type:"hidden",name:b,value:c});a(this.form).append(d)},this));var f=this.uploadOptions.input,g=a(f).clone();a(f).attr("id",e),a(f).before(g),a(f).appendTo(this.form),a(this.form).css("position","absolute"),a(this.form).css("top","-2000px"),a(this.form).css("left","-2000px"),a(this.form).appendTo("body"),this.form.submit()}else b.attr("target",c),b.attr("method","POST"),b.attr("enctype","multipart/form-data"),b.attr("action",this.uploadOptions.url),this.element.submit()},uploadLoaded:function(){var b,c=a("#"+this.id)[0];if(b=c.contentDocument?c.contentDocument:c.contentWindow?c.contentWindow.document:window.frames[this.id].document,this.uploadOptions.success)if("undefined"!=typeof b){var d=b.body.innerHTML,e=d.match(/\{(.|\n)*\}/)[0],f=a.parseJSON(e);"undefined"==typeof f.error?this.uploadOptions.success(f):(this.uploadOptions.error(this,f),this.modalClose())}else alert("Upload failed!"),this.modalClose();this.element.attr("action",this.element_action),this.element.attr("target","")},browser:function(a){var b=navigator.userAgent.toLowerCase(),c=/(chrome)[ \/]([\w.]+)/.exec(b)||/(webkit)[ \/]([\w.]+)/.exec(b)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(b)||/(msie) ([\w.]+)/.exec(b)||b.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(b)||[];return"version"==a?c[2]:"webkit"==a?"chrome"==c[1]||"webkit"==c[1]:c[1]==a},oldIE:function(){return this.browser("msie")&&parseInt(this.browser("version"),10)<9?!0:!1},outerHTML:function(b){return a("<p>").append(a(b).eq(0).clone()).html()},normalize:function(a){return parseInt(a.replace("px",""),10)},isMobile:function(a){return a===!0&&/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)?!0:/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)?!0:!1}},a.fn.getObject=function(){return this.data("redactor")},a.fn.getEditor=function(){return this.data("redactor").$editor},a.fn.getCode=function(){return a.trim(this.data("redactor").getCode())},a.fn.getText=function(){return this.data("redactor").$editor.text()},a.fn.getSelected=function(){return this.data("redactor").getSelectedHtml()},a.fn.setCode=function(a){this.data("redactor").setCode(a)},a.fn.insertHtml=function(a){this.data("redactor").insertHtml(a)},a.fn.destroyEditor=function(){this.each(function(){"undefined"!=typeof a(this).data("redactor")&&(a(this).data("redactor").destroy(),a(this).removeData("redactor"))})},a.fn.setFocus=function(){this.data("redactor").$editor.focus()},a.fn.execCommand=function(a,b){this.data("redactor").execCommand(a,b)}}(jQuery),function(a){"use strict";function b(b,c){this.opts=a.extend({url:!1,success:!1,error:!1,preview:!1,uploadFields:!1,text:RLANG.drop_file_here,atext:RLANG.or_choose},c),this.$el=a(b)}a.fn.dragupload=function(a){return this.each(function(){var c=new b(this,a);c.init()})},b.prototype={init:function(){if(-1===navigator.userAgent.search("MSIE")){this.droparea=a('<div class="redactor_droparea"></div>'),this.dropareabox=a('<div class="redactor_dropareabox">'+this.opts.text+"</div>"),this.dropalternative=a('<div class="redactor_dropalternative">'+this.opts.atext+"</div>"),this.droparea.append(this.dropareabox),this.$el.before(this.droparea),this.$el.before(this.dropalternative),this.dropareabox.bind("dragover",a.proxy(function(){return this.ondrag()},this)),this.dropareabox.bind("dragleave",a.proxy(function(){return this.ondragleave()},this));var b=a.proxy(function(a){var b=parseInt(a.loaded/a.total*100,10);this.dropareabox.text("Loading "+b+"%")},this),c=jQuery.ajaxSettings.xhr();c.upload&&c.upload.addEventListener("progress",b,!1);var d=function(){return c};this.dropareabox.get(0).ondrop=a.proxy(function(b){b.preventDefault(),this.dropareabox.removeClass("hover").addClass("drop");var c=b.dataTransfer.files[0],e=new FormData;this.opts.uploadFields!==!1&&"object"==typeof this.opts.uploadFields&&a.each(this.opts.uploadFields,a.proxy(function(b,c){0===c.toString().indexOf("#")&&(c=a(c).val()),e.append(b,c)},this)),e.append("file",c),a.ajax({url:this.opts.url,dataType:"html",data:e,xhr:d,cache:!1,contentType:!1,processData:!1,type:"POST",success:a.proxy(function(b){var c=a.parseJSON(b);"undefined"==typeof c.error?this.opts.success(c):(this.opts.error(this,c),this.opts.success(!1))},this)})},this)}},ondrag:function(){return this.dropareabox.addClass("hover"),!1},ondragleave:function(){return this.dropareabox.removeClass("hover"),!1}}}(jQuery),function(a){"use strict";var b="http://",c=/(^|&lt;|\s)(www\..+?\..+?)(\s|&gt;|$)/g,d=/(^|&lt;|\s)(((https?|ftp):\/\/|mailto:).+?)(\s|&gt;|$)/g,e=function(){for(var f=this.childNodes,g=f.length;g--;){var h=f[g];if(3===h.nodeType){var i=h.nodeValue;i&&(i=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(c,'$1<a href="'+b+'$2">$2</a>$3').replace(d,'$1<a href="$2">$2</a>$5'),a(h).after(i).remove())}else 1!==h.nodeType||/^(a|button|textarea)$/i.test(h.tagName)||e.call(h)}};a.fn.linkify=function(){this.each(e)}}(jQuery),function(a){a.event.special.textselect={setup:function(b){a(this).data("textselected",!1),a(this).data("ttt",b),a(this).on("mouseup",a.event.special.textselect.handler)},teardown:function(){a(this).off("mouseup",a.event.special.textselect.handler)},handler:function(b){var c=a(this).data("ttt"),d=a.event.special.textselect.getSelectedText(c).toString();""!=d&&(a(this).data("textselected",!0),b.type="textselect",b.text=d,a.event.dispatch.apply(this,arguments))},getSelectedText:function(){var a="";return rwindow.getSelection?a=rwindow.getSelection():rdocument.getSelection?a=rdocument.getSelection():rdocument.selection&&(a=rdocument.selection.createRange().text),a}},a.event.special.textunselect={setup:function(b){a(this).data("rttt",b),a(this).data("textselected",!1),a(this).on("mouseup",a.event.special.textunselect.handler),a(this).on("keyup",a.event.special.textunselect.handlerKey)},teardown:function(){a(this).unbind("mouseup",a.event.special.textunselect.handler)},handler:function(b){if(a(this).data("textselected")){var c=a(this).data("rttt"),d=a.event.special.textselect.getSelectedText(c).toString();""==d&&(a(this).data("textselected",!1),b.type="textunselect",a.event.dispatch.apply(this,arguments))}},handlerKey:function(b){if(a(this).data("textselected")){var c=a(this).data("rttt"),d=a.event.special.textselect.getSelectedText(c).toString();(b.keyCode=27)&&""==d&&(a(this).data("textselected",!1),b.type="textunselect",a.event.dispatch.apply(this,arguments))}}}}(jQuery),"undefined"==typeof RedactorPlugins)var RedactorPlugins={};RedactorPlugins.concrete5inline={init:function(){this.$toolbar.addClass("ccm-inline-toolbar"),this.$toolbar.append($('<li class="ccm-inline-toolbar-button ccm-inline-toolbar-button-cancel"><button id="ccm-redactor-cancel-button" type="button" class="btn btn-mini">Cancel</button></li><li class="ccm-inline-toolbar-button ccm-inline-toolbar-button-save"><button id="ccm-redactor-save-button" type="button" class="btn btn-primary btn-mini">Save</button></li>'));var a=this.$toolbar,b=this.$editor;$("#ccm-redactor-cancel-button").on("click",function(){a.hide(),$("li#ccm-redactor-actions-buttons").hide(),ConcreteEvent.fire("EditModeExitInline"),b.destroyEditor()}),$("#ccm-redactor-save-button").on("click",function(){$("#redactor-content").val(b.getCode()),a.hide(),b.destroyEditor(),$("#ccm-block-form").submit()
})}},RedactorPlugins.concrete5={init:function(){var a=this;$.ajax({type:"get",dataType:"json",url:CCM_TOOLS_PATH+"/system_content_editor_menu?ccm_token="+CCM_EDITOR_SECURITY_TOKEN,success:function(b){dropdownOptions={},$.each(b.coreMenus,function(a,b){switch(b){case"insert_page":dropdownOptions.insertLinkToPage={title:ccmi18n_editor.insertLinkToPage,callback:function(a){$.fn.dialog.open({title:ccmi18n_sitemap.choosePage,href:CCM_TOOLS_PATH+"/sitemap_search_selector.php?sitemap_select_mode=select_page",width:"90%",modal:!1,height:"70%"}),ccm_selectSitemapNode=function(b,c){try{e=a.$el.getSelected()}catch(d){e=a.$editor.getSelected()}if(""!=e)a.execCommand("inserthtml",'<a href="'+CCM_BASE_URL+CCM_DISPATCHER_FILENAME+"?cID="+b+'" title="'+c+'">'+e+"</a>");else{var e='<a href="'+CCM_BASE_URL+CCM_DISPATCHER_FILENAME+"?cID="+b+'" title="'+c+'">'+c+"</a>";a.insertHtml(e)}}}};break;case"insert_file":dropdownOptions.insertLinkToFile={title:ccmi18n_editor.insertLinkToFile,callback:function(a){a.saveSelection(),ccm_launchFileManager(),ccm_chooseAsset=function(b){a.restoreSelection();try{selectedText=a.$el.getSelected()}catch(c){selectedText=a.$editor.getSelected()}if(""!=selectedText){var d='<a href="'+b.filePathInline+'">'+selectedText+"</a>";a.execCommand("inserthtml",d)}else{var d='<a href="'+b.filePathInline+'">'+b.title+"</a>";a.insertHtml(d)}}}};break;case"insert_image":dropdownOptions.insertImage={title:ccmi18n_editor.insertImage,callback:function(a){a.saveSelection(),ccm_launchFileManager(),ccm_chooseAsset=function(b){a.restoreSelection(),a.insertHtml('<img src="'+b.filePathInline+'" alt="'+b.title+'" width="'+b.width+'" height="'+b.height+'">')}}}}}),b.coreMenus.length>0&&b.snippets.length>0&&(dropdownOptions.snippet_separator={name:"separator"}),a.snippetsByHandle={},$.each(b.snippets,function(b,c){a.snippetsByHandle[c.scsHandle]={scsHandle:c.scsHandle,scsName:c.scsName},dropdownOptions[c.scsHandle]={title:c.scsName,callback:function(b,c,d){var e=a.snippetsByHandle[d],f=String()+'<span class="ccm-content-editor-snippet" contenteditable="false" data-scsHandle="'+e.scsHandle+'">'+e.scsName+"</span>";b.insertHtml(f)}}}),(b.coreMenus.length>0||b.snippets.length>0)&&a.addBtnFirst("concrete5","concrete5",!1,dropdownOptions)}}),this.opts.observeImages=!1}};